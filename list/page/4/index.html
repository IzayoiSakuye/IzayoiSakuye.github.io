<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"izayoisakuye.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.23.2","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":false,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js" defer></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="红魔咖啡馆">
<meta property="og:url" content="https://izayoisakuye.github.io/list/page/4/index.html">
<meta property="og:site_name" content="红魔咖啡馆">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="IzayoiSakuye">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://izayoisakuye.github.io/list/page/4/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"list/page/4/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>红魔咖啡馆</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  






  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-shiki-plugin@latest/lib/codeblock.css">
<style>:root{--hl-color:#90a4ae;--hl-bg:#f6f8fa;--hltools-bg:#e6ebf1;--hltools-color:#90a4ae;--hlnumber-bg:#f6f8fa;--hlnumber-color:rgba(144,164,174,0.5);--hlscrollbar-bg:#dce4eb;--hlexpand-bg:linear-gradient(180deg,rgba(246,248,250,0.1),rgba(246,248,250,0.9))}</style><!-- hexo injector head_end end --><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">红魔咖啡馆</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">头发越掉越多，头发越掉越少</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">21</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">6</span></a></li><li class="menu-item menu-item-passages"><a href="/list/" rel="section"><i class="fa-regular fa-file fa-fw"></i>文章</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="IzayoiSakuye"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">IzayoiSakuye</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">102</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://izayoisakuye.github.io/C++/%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="IzayoiSakuye">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="红魔咖啡馆">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | 红魔咖啡馆">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/C++/%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0/" class="post-title-link" itemprop="url">【C++】高阶函数</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-07-31 17:30:05 / 修改时间：17:30:15" itemprop="dateCreated datePublished" datetime="2025-07-31T17:30:05+08:00">2025-07-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/C-C/" itemprop="url" rel="index"><span itemprop="name">C/C++</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="高阶函数">高阶函数</h1>
<h2 id="函数的默认参数">函数的默认参数</h2>
<p>C++中，形参是可以有缺省值的</p>
<p>注：</p>
<ul>
<li>若某个位置已经有了缺省值，则从该位置之后往后都必须要有缺省值</li>
<li>若函数声明有缺省值，则函数实现就不能有缺省值 （二义性）</li>
</ul>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">20</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">c</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">30</span><span style="color: #24292E">){</span><span style="color: #6A737D"> // 形参有缺省值</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> a</span><span style="color: #D73A49">+</span><span style="color: #24292E">b</span><span style="color: #D73A49">+</span><span style="color: #24292E">c;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #005CC5">10</span><span style="color: #24292E">)</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span><span style="color: #6A737D"> // 有缺省值时可以不传参</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #005CC5">10</span><span style="color: #24292E">, </span><span style="color: #005CC5">30</span><span style="color: #24292E">)</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span><span style="color: #6A737D"> // 若传参则会覆盖缺省值</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; </span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="函数的占位参数">函数的占位参数</h2>
<p>C++中函数的形参列表中可以有占位参数，调用时必须填补该位置</p>
<p>语法：<code>&lt;返回值类型&gt; &lt;函数名&gt;([数据类型]){}</code></p>
<p>注：</p>
<ul>
<li>目前占位参数传入的参数无法使用</li>
<li>占位参数可以有缺省值</li>
</ul>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> a </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">" occupation"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #005CC5">10</span><span style="color: #24292E">, </span><span style="color: #005CC5">10</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="函数重载">函数重载</h2>
<p>作用：函数名可以相同，用于提高复用性</p>
<p>满足条件：</p>
<ul>
<li>同一个作用域下</li>
<li>函数名相同</li>
<li>函数参数类型，个数，顺序不同</li>
</ul>
<p><strong>函数返回值类型不可以做为函数重载的条件</strong></p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(){</span><span style="color: #6A737D"> // 两函数参数不同，实现重载</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"invoke f"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"invoke f(int "</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">a</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">')'</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">){</span><span style="color: #6A737D"> // 两函数参数类型不同，实现重载</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"invoke f(double "</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">a</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">')'</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span><span style="color: #6A737D"> // 两函数参数顺序不同，实现重载</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"invoke f(double "</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">a</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">", int "</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">b </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">')'</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span><span style="color: #6A737D"> // 两函数参数顺序不同，实现重载</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"invoke f(int "</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">a</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">", double "</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">b </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">')'</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  // 根据传入的参数执行对应函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">f</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #005CC5">10</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #005CC5">3.14</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #005CC5">10</span><span style="color: #24292E">,</span><span style="color: #005CC5">3.14</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #005CC5">3.14</span><span style="color: #24292E">,</span><span style="color: #005CC5">10</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">invoke f</span></span>
<span class="line"><span style="color: #24292e">invoke f(int 10)</span></span>
<span class="line"><span style="color: #24292e">invoke f(double 3.14)</span></span>
<span class="line"><span style="color: #24292e">invoke f(int 10, double 3.14)</span></span>
<span class="line"><span style="color: #24292e">invoke f(double 3.14, int 10)</span></span></code></pre></div></div></figure>
<h3 id="引用作为重载条件">引用作为重载条件</h3>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 引用作为函数重载条件</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f2</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">a</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"invoke f(int &amp;"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">a</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">')'</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f2</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">a</span><span style="color: #24292E">){</span><span style="color: #6A737D"> // const int 与int 类型不同</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"invoke f(const int &amp;"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">a</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">')'</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  // 根据传入的参数执行对应函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">f2</span><span style="color: #24292E">(a);</span><span style="color: #6A737D"> // 调用了无const的</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">f2</span><span style="color: #24292E">(</span><span style="color: #005CC5">10</span><span style="color: #24292E">);</span><span style="color: #6A737D"> // 调用了有const的</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<ul>
<li>11行相当于实现<code>int &amp;b = a</code>，是合法的</li>
<li>但若只传值，则11行相当于<code>int &amp;a = 10</code>，
是不合法的，此时12行相当于<code>const int &amp;a = 10</code>，是合法的</li>
</ul>
<h3 id="缺省值与函数重载">缺省值与函数重载</h3>
<p>当存在缺省值，使得调用函数传入参数个数和被重载的函数的传入参数个数一样时，会出现二义性，故报错</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 函数重载与默认参数</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f3</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"invoke f3(int &amp;"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">a</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">')'</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f3</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"invoke f3(int &amp;"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">a</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">") with b = 10"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  //f3(10); // 会出错，出现二义性</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://izayoisakuye.github.io/C++/%E5%87%BD%E6%95%B0%E5%B0%81%E8%A3%85%E4%B8%8E%E7%BB%91%E5%AE%9A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="IzayoiSakuye">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="红魔咖啡馆">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | 红魔咖啡馆">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/C++/%E5%87%BD%E6%95%B0%E5%B0%81%E8%A3%85%E4%B8%8E%E7%BB%91%E5%AE%9A/" class="post-title-link" itemprop="url">【C++】函数封装与绑定</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-07-31 17:29:26 / 修改时间：17:29:57" itemprop="dateCreated datePublished" datetime="2025-07-31T17:29:26+08:00">2025-07-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/C-C/" itemprop="url" rel="index"><span itemprop="name">C/C++</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="函数封装与绑定">函数封装与绑定</h1>
<h2 id="stdfunction">std::function</h2>
<p>std::function是一个通用的多态函数封装器，用于将可调用对象进行封装</p>
<p>语法<code>function&lt;R(Args...)&gt; fname = target;</code></p>
<p>其中R为返回类型，括号内为参数类型</p>
<p>进行类成员函数封装时，括号内第一个参数是类引用，第二个开始才是参数类型</p>
<p>也可以进行类成员变量的引用</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;functional&gt;</span></span>
<span class="line"><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #6F42C1">mul</span><span style="color: #24292E">(</span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> a</span><span style="color: #D73A49">*</span><span style="color: #24292E">b;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  // 将mul的地址保存到f1对象中</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::function</span><span style="color: #D73A49">&lt;double</span><span style="color: #24292E">(</span><span style="color: #D73A49">double</span><span style="color: #24292E">,</span><span style="color: #D73A49">double</span><span style="color: #24292E">)</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> f1 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> mul;</span></span>
<span class="line"><span style="color: #6A737D">  // 通过重载调用运算符来调用mul函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">double</span><span style="color: #24292E"> res </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f1</span><span style="color: #24292E">(</span><span style="color: #005CC5">1.1</span><span style="color: #24292E">,</span><span style="color: #005CC5">2.3</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> res </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;functional&gt;</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Linear</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">Linear</span><span style="color: #24292E">(</span><span style="color: #D73A49">float</span><span style="color: #24292E"> </span><span style="color: #E36209">k</span><span style="color: #24292E">, </span><span style="color: #D73A49">float</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">):</span><span style="color: #6F42C1">k_</span><span style="color: #24292E">(k),</span><span style="color: #6F42C1">b_</span><span style="color: #24292E">(b) {}</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">float</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #D73A49">float</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">) {</span><span style="color: #D73A49">return</span><span style="color: #24292E"> k_</span><span style="color: #D73A49">*</span><span style="color: #24292E"> x</span><span style="color: #D73A49">+</span><span style="color: #24292E">b_; }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">float</span><span style="color: #24292E"> k_, b_;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E"> :: function</span><span style="color: #D73A49">&lt;float</span><span style="color: #24292E">(Linear</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">, </span><span style="color: #D73A49">float</span><span style="color: #24292E">)</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> mf </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #6F42C1">Linear</span><span style="color: #24292E">::f;</span></span>
<span class="line"><span style="color: #24292E">    Linear </span><span style="color: #6F42C1">l</span><span style="color: #24292E">(</span><span style="color: #005CC5">1.2</span><span style="color: #24292E">,</span><span style="color: #005CC5">2.3</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">float</span><span style="color: #24292E"> res </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">mf</span><span style="color: #24292E">(l,</span><span style="color: #005CC5">5</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E"> :: cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> res </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E"> :: endl;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E"> :: function</span><span style="color: #D73A49">&lt;float</span><span style="color: #24292E">(Linear</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">)</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> k </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #6F42C1">Linear</span><span style="color: #24292E"> :: k_;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E"> :: cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">k</span><span style="color: #24292E">(l) </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E"> :: endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>std::function实现了<strong>类型擦除</strong>：即通过单个通用接口类使用各种具体类型</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;functional&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;map&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #6F42C1">add</span><span style="color: #24292E">(</span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> a</span><span style="color: #D73A49">+</span><span style="color: #24292E">b;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">substract</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">()</span><span style="color: #24292E">(</span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span><span style="color: #D73A49">return</span><span style="color: #24292E"> a</span><span style="color: #D73A49">-</span><span style="color: #24292E">b;}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::map</span><span style="color: #D73A49">&lt;char</span><span style="color: #24292E">, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::function</span><span style="color: #D73A49">&lt;double</span><span style="color: #24292E">(</span><span style="color: #D73A49">double</span><span style="color: #24292E">,</span><span style="color: #D73A49">double</span><span style="color: #24292E">)</span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E">cal{</span></span>
<span class="line"><span style="color: #24292E">    {</span><span style="color: #032F62">'+'</span><span style="color: #24292E">, add},</span></span>
<span class="line"><span style="color: #24292E">    {</span><span style="color: #032F62">'-'</span><span style="color: #24292E">, </span><span style="color: #6F42C1">substract</span><span style="color: #24292E">()},</span></span>
<span class="line"><span style="color: #24292E">    {</span><span style="color: #032F62">'*'</span><span style="color: #24292E">, [](</span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">)-&gt;</span><span style="color: #D73A49">double{return</span><span style="color: #24292E"> </span><span style="color: #D73A49">a*b;}}</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">};</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">std::cout</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;cal['+'](12.0,13)&lt;&lt;std::endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">std::cout</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;cal['-'](13.0,6.2)&lt;&lt;std::endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">std::cout</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;cal['+'](2.3,3.2)&lt;&lt;std::endl;</span></span>
<span class="line"><span style="color: #D73A49">}</span></span></code></pre></div></div></figure>
<p>可以看到，通过std::function可以把完全不同的类型按同一个接口统一封装一个类型来使用</p>
<h2 id="stdmem_fn">std::mem_fn</h2>
<p>封装类成员可以直接使用<code>std::mem_fn</code>，返回一个可调用的包装器</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;functional&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">foo</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">double</span><span style="color: #24292E"> w;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #6F42C1">cal</span><span style="color: #24292E">(</span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #D73A49">*</span><span style="color: #24292E">a</span><span style="color: #D73A49">+</span><span style="color: #24292E">w</span><span style="color: #D73A49">*</span><span style="color: #24292E">b;}</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">foo</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">+=</span><span style="color: #24292E">(</span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    w</span><span style="color: #D73A49">+=</span><span style="color: #24292E">a;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #005CC5">this</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">print</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"w="</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">w</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  foo f{</span><span style="color: #005CC5">1.0</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> memfn </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">mem_fn</span><span style="color: #24292E">(</span><span style="color: #D73A49">&amp;</span><span style="color: #6F42C1">foo</span><span style="color: #24292E">::cal);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">double</span><span style="color: #24292E"> res </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">memfn</span><span style="color: #24292E">(f, </span><span style="color: #005CC5">2.0</span><span style="color: #24292E">, </span><span style="color: #005CC5">3.0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"res="</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">res</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> op </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">mem_fn</span><span style="color: #24292E">(</span><span style="color: #D73A49">&amp;</span><span style="color: #6F42C1">foo</span><span style="color: #24292E">::operator</span><span style="color: #D73A49">+=</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> f2 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">op</span><span style="color: #24292E">(f,</span><span style="color: #005CC5">2.0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  f2.</span><span style="color: #6F42C1">print</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="stdbind">std::bind</h2>
<p>用于生成一个函数对象，调用该包装器时相当于调用他所包装的函数或者对象f</p>
<p>可以将给定的函数和参数进行绑定，调用时直接使用对应函数与参数</p>
<p>其中，参数可以用<code>std::placeholders</code>占位符占位(<code>_1</code>,<code>_2</code>…)，在调用包装器时可以指定传入参数</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;functional&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">placeholders</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">sum</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">c</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"a="</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">a</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">", b="</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">b</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">", c="</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">c;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> a</span><span style="color: #D73A49">+</span><span style="color: #24292E">b</span><span style="color: #D73A49">+</span><span style="color: #24292E">c;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> f </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">bind</span><span style="color: #24292E">(sum, </span><span style="color: #005CC5">1</span><span style="color: #24292E">, _1, </span><span style="color: #005CC5">3</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> res </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #005CC5">5</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">", res="</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">res</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>注意，如果直接用变量作为bind绑定，绑定后修改变量不会影响结果，因为是用值传入的</p>
<p>如果想用引用传入，使用<code>cref()</code>函数，用于返回一个变量的引用封装器s</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://izayoisakuye.github.io/C++/%E5%AE%8F%E5%AE%9A%E4%B9%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="IzayoiSakuye">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="红魔咖啡馆">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | 红魔咖啡馆">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/C++/%E5%AE%8F%E5%AE%9A%E4%B9%89/" class="post-title-link" itemprop="url">【C/C++】宏定义</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-07-31 17:29:02 / 修改时间：17:29:18" itemprop="dateCreated datePublished" datetime="2025-07-31T17:29:02+08:00">2025-07-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/C-C/" itemprop="url" rel="index"><span itemprop="name">C/C++</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="宏定义">宏定义</h1>
<h2 id="常量替换">常量替换</h2>
<p><code>#define 标识符 替换表达式</code></p>
<p>C++中常用const方式进行常量替换</p>
<h2 id="条件编译">条件编译</h2>
<p>可以定义一个空的宏来用于条件编译</p>
<ul>
<li><p><code>#ifdef 宏名</code>：若定义了对应宏则执行下面的宏指令</p></li>
<li><p><code>#else</code>：否则执行else下面的宏指令</p></li>
<li><p><code>#undef 宏名</code>：取消原来的定义</p></li>
<li><p><code>#endif</code>：条件编译的结尾</p></li>
</ul>
<h2 id="宏函数">宏函数</h2>
<p><code>#define 标识符(参数列表) 替换表达式</code></p>
<p>为了防止运算符优先级造成问题，一般要对表达式加上括号</p>
<p>C++中可以被内联函数取代</p>
<h2 id="与">#与</h2>
<ul>
<li>#将符号转为字符串</li>
</ul>
<p>e.g.<code>#define PRINT(a) cout&lt;&lt;#a&lt;&lt;"="&lt;&lt;(a)&lt;&lt;" ";</code></p>
<ul>
<li>##将两个表达式连接在一起</li>
</ul>
<p>e.g.<code>#define MEMBER(type, a) type m_##a</code></p>
<h2 id="多行宏定义">多行宏定义</h2>
<p>若想定义多行宏定义，则需要在每行结尾加一个<br>
</p>
<h2 id="可变参的宏函数">可变参的宏函数</h2>
<p><code>#define 标识符(参数列表,...) 替换表达式</code></p>
<p>表达式中用<code>__VA_ARGS__</code>标识符表示这些参数，宏展开时，实际参数会替换掉该标识符</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;stdio.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">LOG</span><span style="color: #24292E">(</span><span style="color: #E36209">fmt</span><span style="color: #24292E">, ...) printf(fmt, ##__VA_ARGS__)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">LOG</span><span style="color: #24292E">(</span><span style="color: #032F62">"Hello, </span><span style="color: #005CC5">%s\n</span><span style="color: #032F62">"</span><span style="color: #24292E">, </span><span style="color: #032F62">"World"</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">LOG</span><span style="color: #24292E">(</span><span style="color: #032F62">"This is a test.</span><span style="color: #005CC5">\n</span><span style="color: #032F62">"</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://izayoisakuye.github.io/C++/%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="IzayoiSakuye">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="红魔咖啡馆">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | 红魔咖啡馆">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/C++/%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/" class="post-title-link" itemprop="url">【C++】类与对象</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-07-31 17:28:37 / 修改时间：17:28:53" itemprop="dateCreated datePublished" datetime="2025-07-31T17:28:37+08:00">2025-07-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/C-C/" itemprop="url" rel="index"><span itemprop="name">C/C++</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="类与对象">类与对象</h1>
<p>C++面向对象的三大特性：<strong>封装、继承、多态</strong></p>
<p>C++中，<strong>任何事物都为对象</strong>，对象有其属性和行为</p>
<p>具有<strong>相同性质</strong>的对象，我们可以抽象称为类</p>
<h2 id="封装">封装</h2>
<h3 id="封装的实现">封装的实现</h3>
<p>意义：</p>
<ul>
<li>将属性和行为作为一个整体，表现生活中的事物</li>
<li>将属性和行为加以权限控制</li>
</ul>
<p>语法：<code>class &lt;类名&gt;{ &lt;访问权限&gt;: &lt;属性/行为&gt;}</code></p>
<p>一些名词：</p>
<ul>
<li>成员：类中的属性和行为的统称</li>
<li>成员属性（成员变量）：类中的属性</li>
<li>成员函数（成员方法）：类中的函数</li>
</ul>
<p>e.g.1 设计一个圆类，求其周长</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">// 设计一个圆类，求其周长</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">double</span><span style="color: #24292E"> PI </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">3.14</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">circle</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #6A737D">// 访问权限: 公共权限</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #6A737D">  // 属性：半径</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> r;</span></span>
<span class="line"><span style="color: #6A737D">  // 行为：获取周长</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #6F42C1">calC</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #D73A49">*</span><span style="color: #24292E">PI</span><span style="color: #D73A49">*</span><span style="color: #24292E">r;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  // 通过类创建一个对象——实例化</span></span>
<span class="line"><span style="color: #24292E">  circle c1;</span></span>
<span class="line"><span style="color: #6A737D">  // 给对象的属性进行赋值，使用.</span></span>
<span class="line"><span style="color: #24292E">  c1.r </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  // 调用行为</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"r="</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> c1.</span><span style="color: #6F42C1">calC</span><span style="color: #24292E">()</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>e.g.2 设计一个学生类，属性有姓名和学号，可以赋值并显示姓名和学号</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;string&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">// 设计一个学生类，有姓名和学号，可以赋值并显示</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">student</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #6A737D">  //属性</span></span>
<span class="line"><span style="color: #24292E">  string name;</span><span style="color: #6A737D"> // 姓名</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> id;</span><span style="color: #6A737D"> // 学号</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 行为</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">display</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"name:"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> name</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"id:"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> id </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">set_info</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">s_name</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">s_id</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    name </span><span style="color: #D73A49">=</span><span style="color: #24292E"> s_name;</span></span>
<span class="line"><span style="color: #24292E">    id </span><span style="color: #D73A49">=</span><span style="color: #24292E"> s_id;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  student stu1;</span><span style="color: #6A737D">// 实例化</span></span>
<span class="line"><span style="color: #24292E">  student stu2;</span></span>
<span class="line"><span style="color: #6A737D">  // 一般赋值</span></span>
<span class="line"><span style="color: #24292E">  stu1.name </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">"Jack"</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  stu1.id </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  stu1.</span><span style="color: #6F42C1">display</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #6A737D">  // 通过行为赋值</span></span>
<span class="line"><span style="color: #24292E">  stu2.</span><span style="color: #6F42C1">set_info</span><span style="color: #24292E">(</span><span style="color: #032F62">"Mary"</span><span style="color: #24292E">, </span><span style="color: #005CC5">2</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  stu2.</span><span style="color: #6F42C1">display</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="权限">权限</h3>
<p>类可以将属性和方法放在不同权限下：</p>
<ul>
<li>public：公共权限，成员类内可以访问，类外也可以访问</li>
<li>protected：保护权限，成员类内可以访问，类外不可以访问，子类可以访问父类的保护成员</li>
<li>private：私有权限，成员类内可以访问，类外不可以访问，
子类不可访问父类的私有成员</li>
</ul>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;string&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span><span style="color: #6A737D"> //公共权限</span></span>
<span class="line"><span style="color: #24292E">  string name;</span></span>
<span class="line"><span style="color: #D73A49">protected:</span><span style="color: #6A737D"> // 保护权限</span></span>
<span class="line"><span style="color: #24292E">  string car;</span></span>
<span class="line"><span style="color: #D73A49">private:</span><span style="color: #6A737D"> // 私有权限</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> password;</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #6A737D"> // 类内可以访问</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    name </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">"Jack"</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    car </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">"xiaomisu7"</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    password </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">123456</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person p;</span></span>
<span class="line"><span style="color: #24292E">  p.name </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">"Mary"</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  //p.car = "?" // protected 类外不可访问</span></span>
<span class="line"><span style="color: #6A737D">  //p.password = 123 // private 类外不可访问</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="struct与class的区别">struct与class的区别</h3>
<p>C++中class与struct的唯一区别在于<strong>默认的访问权限不同</strong></p>
<ul>
<li>class默认权限私有</li>
<li>struct默认权限公共</li>
</ul>
<h3 id="成员属性私有化">成员属性私有化</h3>
<p>优点：</p>
<ul>
<li>可以自己控制读写权限</li>
<li>可以检测数据有效性</li>
</ul>
<p>基本思路：<strong>用公有方法对私有属性进行操作</strong></p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;string&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #6A737D">// 属性私有</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  string name;</span><span style="color: #6A737D"> // 姓名：可读可写</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">18</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 年龄：只读</span></span>
<span class="line"><span style="color: #24292E">  string hobby;</span><span style="color: #6A737D"> // 爱好：只写</span></span>
<span class="line"><span style="color: #6A737D">// 方法公有</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #6A737D">  // 设置姓名</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">setName</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    name </span><span style="color: #D73A49">=</span><span style="color: #24292E"> s;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 获取姓名</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">getName</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"name:"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">name</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 获取年龄</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">getAge</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"age:"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">age</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 设置爱好</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">setHobby</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    hobby </span><span style="color: #D73A49">=</span><span style="color: #24292E"> s;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person p;</span></span>
<span class="line"><span style="color: #24292E">  p.</span><span style="color: #6F42C1">setName</span><span style="color: #24292E">(</span><span style="color: #032F62">"Jack"</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  p.</span><span style="color: #6F42C1">getAge</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  p.</span><span style="color: #6F42C1">setHobby</span><span style="color: #24292E">(</span><span style="color: #032F62">"jerk"</span><span style="color: #24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="对象的初始化和清理">对象的初始化和清理</h2>
<p>对象的初始化和清理是很重要的安全问题：</p>
<ul>
<li>一个对象或变量没有初始状态，对其使用后果未知</li>
<li>使用完一个对象或变量，没有及时清理，也会造成安全问题</li>
</ul>
<h3 id="构造函数与析构函数">构造函数与析构函数</h3>
<p>C++提供了这两种函数，被编译器自动调用，完成对象初始化与清理工作</p>
<p>这两个工作是强制执行的，若我们不提供，编译器会提供自己的构造函数与析构函数，他们是<strong>空实现</strong></p>
<p><strong>构造函数：</strong>用于创建对象时为对象成员赋值</p>
<ul>
<li><p>语法：<code>&lt;类名&gt;(){}</code></p></li>
<li><p>无返回值，不用写void</p></li>
<li><p>函数名与类名相同</p></li>
<li><p>构造函数可以有参数，可以发生重载</p></li>
<li><p>调用对象时会自动调用构造，只会调用一次</p></li>
</ul>
<p>析构函数：用于对象销毁前自动调用，执行清理操作</p>
<ul>
<li>语法：<code>~&lt;类名&gt;(){}</code></li>
<li>无返回值，不用写void</li>
<li>函数名与类名相同，名前面加~</li>
<li>析构函数不可以有参数，不可发生重载</li>
<li>程序在对象销毁前会自动调用析构。只会调用一次</li>
</ul>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #6A737D">  // 构造函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"构造函数被调用"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 析构函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">~person</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"析构函数被调用"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person p;</span><span style="color: #6A737D"> // 栈上的数据，执行完后会被释放，故执行析构函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="构造函数的分类与调用">构造函数的分类与调用</h3>
<p>分类：</p>
<ul>
<li>参数分：有参构造与无参构造（默认构造）</li>
<li>类型分：普通构造与拷贝构造</li>
</ul>
<p>调用：</p>
<ul>
<li>括号法</li>
<li>显式法</li>
<li>隐式转换法</li>
</ul>
<p><strong>注意：</strong></p>
<ul>
<li><strong>无参构造时不需要加括号，否则编译器会认为是一个函数声明</strong></li>
<li>显式声明中，单纯调用对象<code>&lt;类名&gt;([值])</code>称为<strong>匿名对象</strong>，特点是当前行执行后就会被立即回收</li>
<li><strong>不要利用拷贝构造函数初始化匿名对象</strong></li>
</ul>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #6A737D">  // 无参构造(默认构造)</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"无参构造函数被调用"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 有参构造</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"有参构造函数被调用"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 拷贝构造 </span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p.age;</span><span style="color: #6A737D"> // 将传入数据拷贝到当前对象</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"拷贝构造函数被调用"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 析构函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">~person</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"析构函数被调用"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  // 括号法</span></span>
<span class="line"><span style="color: #24292E">  person p;</span><span style="color: #6A737D"> // 默认构造函数被调用(不加括号)</span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #6F42C1">p1</span><span style="color: #24292E">(</span><span style="color: #005CC5">10</span><span style="color: #24292E">);</span><span style="color: #6A737D"> // 有参构造函数被调用</span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #6F42C1">p2</span><span style="color: #24292E">(p1);</span><span style="color: #6A737D"> // 拷贝构造函数被调用</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"age of p1:"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p1.age </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"age of p2:"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p2.age </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #6A737D">  // 显式法</span></span>
<span class="line"><span style="color: #24292E">  person p3 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #005CC5">20</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  person p4 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(p3);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 隐式转换法</span></span>
<span class="line"><span style="color: #24292E">  person p5 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 相当于 person p5 = person(10);</span></span>
<span class="line"><span style="color: #24292E">  person p6 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p5;</span><span style="color: #6A737D"> // 相当于 person p6 = person(p5);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="拷贝构造函数调用时机">拷贝构造函数调用时机</h3>
<p>拷贝构造调用的三种情况：</p>
<ul>
<li>使用一个已经创建完毕的对象来初始化一个新对象</li>
<li>值传递的方式给函数参数传值</li>
<li>以值方式返回局部对象</li>
</ul>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #6A737D">  // 无参构造(默认构造)</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"无参构造函数被调用"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 有参构造</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"有参构造函数被调用"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 拷贝构造  </span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p.age;</span><span style="color: #6A737D"> // 将传入数据拷贝到当前对象</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"拷贝构造函数被调用"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 析构函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">~person</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"析构函数被调用"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 使用已经创建完毕的对象来初始化一个新对象</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">test1</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #6F42C1">p1</span><span style="color: #24292E">(</span><span style="color: #005CC5">20</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #6F42C1">p2</span><span style="color: #24292E">(p1);</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6A737D">// 值传递方式给函数参数传值</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">test2</span><span style="color: #24292E">(</span><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6A737D">// 值传递返回局部对象</span></span>
<span class="line"><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #6F42C1">test3</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person p1;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> p1;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person p1;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">test1</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">test2</span><span style="color: #24292E">(p1);</span></span>
<span class="line"><span style="color: #24292E">  person p2 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">test3</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">无参构造函数被调用</span></span>
<span class="line"><span style="color: #24292e">----------------</span></span>
<span class="line"><span style="color: #24292e">有参构造函数被调用</span></span>
<span class="line"><span style="color: #24292e">拷贝构造函数被调用</span></span>
<span class="line"><span style="color: #24292e">析构函数被调用</span></span>
<span class="line"><span style="color: #24292e">析构函数被调用</span></span>
<span class="line"><span style="color: #24292e">----------------</span></span>
<span class="line"><span style="color: #24292e">拷贝构造函数被调用</span></span>
<span class="line"><span style="color: #24292e">析构函数被调用</span></span>
<span class="line"><span style="color: #24292e">----------------</span></span>
<span class="line"><span style="color: #24292e">无参构造函数被调用</span></span>
<span class="line"><span style="color: #24292e">析构函数被调用</span></span>
<span class="line"><span style="color: #24292e">析构函数被调用</span></span></code></pre></div></div></figure>
<h3 id="构造函数调用规则">构造函数调用规则</h3>
<p>默认下，编译器至少给一个类添加三个函数：</p>
<ul>
<li>默认构造函数（无参，函数体为空）</li>
<li>默认析构函数（无参，函数体为空）</li>
<li>默认拷贝构造函数，对属性值拷贝</li>
</ul>
<p>调用规则：</p>
<ul>
<li>若用户定义有参构造函数，C++不再提供默认无参构造，但是会提供默认拷贝构造</li>
<li>如果用户定义拷贝构造函数 ，C++不再提供其他构造函数</li>
</ul>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #6A737D">  // 无参构造(默认构造)</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"无参构造函数被调用"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 有参构造</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"有参构造函数被调用"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // // 拷贝构造 </span></span>
<span class="line"><span style="color: #6A737D">  // person(const person &amp;p){</span></span>
<span class="line"><span style="color: #6A737D">  //   age = p.age; // 将传入数据拷贝到当前对象</span></span>
<span class="line"><span style="color: #6A737D">  //   cout &lt;&lt; "拷贝构造函数被调用" &lt;&lt; endl;</span></span>
<span class="line"><span style="color: #6A737D">  // }</span></span>
<span class="line"><span style="color: #6A737D">  // 析构函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">~person</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"析构函数被调用"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person p;</span></span>
<span class="line"><span style="color: #24292E">  p.age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">18</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #6F42C1">p2</span><span style="color: #24292E">(p);</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"p2的年龄是:"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p2.age </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">```</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">此种情况下，编译器使用了默认拷贝构造，进行了值传递</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">```c</span><span style="color: #D73A49">++</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #6A737D">  // // 无参构造(默认构造)</span></span>
<span class="line"><span style="color: #6A737D">  // person(){</span></span>
<span class="line"><span style="color: #6A737D">  //   cout &lt;&lt; "无参构造函数被调用" &lt;&lt; endl;</span></span>
<span class="line"><span style="color: #6A737D">  // }</span></span>
<span class="line"><span style="color: #6A737D">  // 有参构造</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"有参构造函数被调用"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 析构函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">~person</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"析构函数被调用"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person p;</span></span>
<span class="line"><span style="color: #24292E">  p.age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">18</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #6F42C1">p2</span><span style="color: #24292E">(p);</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"p2的年龄是:"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p2.age </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">```</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">此种情况下，由于有有参函数，编译器不会提供默认无参函数，同时会报错没有默认无参函数</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">```c</span><span style="color: #D73A49">++</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #6A737D">  // // 无参构造(默认构造)</span></span>
<span class="line"><span style="color: #6A737D">  // person(){</span></span>
<span class="line"><span style="color: #6A737D">  //   cout &lt;&lt; "无参构造函数被调用" &lt;&lt; endl;</span></span>
<span class="line"><span style="color: #6A737D">  // }</span></span>
<span class="line"><span style="color: #6A737D">  // // 有参构造</span></span>
<span class="line"><span style="color: #6A737D">  // person(int a){</span></span>
<span class="line"><span style="color: #6A737D">  //   age = a;</span></span>
<span class="line"><span style="color: #6A737D">  //   cout &lt;&lt; "有参构造函数被调用" &lt;&lt; endl;</span></span>
<span class="line"><span style="color: #6A737D">  // }</span></span>
<span class="line"><span style="color: #6A737D">  // 拷贝构造 </span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p.age;</span><span style="color: #6A737D"> // 将传入数据拷贝到当前对象</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"拷贝构造函数被调用"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 析构函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">~person</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"析构函数被调用"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person p;</span></span>
<span class="line"><span style="color: #24292E">  p.age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">18</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #6F42C1">p2</span><span style="color: #24292E">(p);</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"p2的年龄是:"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p2.age </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>此种情况下，提供了拷贝函数，则编译器不再提供任何构造函数，同时报错没有默认构造函数</p>
<h3 id="深拷贝与浅拷贝">深拷贝与浅拷贝</h3>
<ul>
<li>浅拷贝：简单的赋值操作（默认拷贝构造即为浅拷贝 ）</li>
<li>深拷贝：在堆区重新申请空间，进行拷贝操作</li>
</ul>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #6A737D">  // 无参构造(默认构造)</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"无参构造函数被调用"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 有参构造</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">iheight</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">    height </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E">(iheight);</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"有参构造函数被调用"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // // 拷贝构造 </span></span>
<span class="line"><span style="color: #6A737D">  // person(const person &amp;p){</span></span>
<span class="line"><span style="color: #6A737D">  //   age = p.age; // 将传入数据拷贝到当前对象</span></span>
<span class="line"><span style="color: #6A737D">  //   cout &lt;&lt; "拷贝构造函数被调用" &lt;&lt; endl;</span></span>
<span class="line"><span style="color: #6A737D">  // }</span></span>
<span class="line"><span style="color: #6A737D">  // 析构函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">~person</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">    // 在析构函数中进行堆区数据释放</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (height</span><span style="color: #D73A49">!=</span><span style="color: #005CC5">NULL</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">delete</span><span style="color: #24292E"> height;</span></span>
<span class="line"><span style="color: #24292E">      height </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">NULL</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"析构函数被调用"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int*</span><span style="color: #24292E"> height;</span><span style="color: #6A737D"> // 身高，使用指针将数据创建在堆区</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #6F42C1">p1</span><span style="color: #24292E">(</span><span style="color: #005CC5">18</span><span style="color: #24292E">,</span><span style="color: #005CC5">160</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"p1的年龄是:"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p1.age </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"p1的身高是:"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E">p1.height </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #6F42C1">p2</span><span style="color: #24292E">(p1);</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"p2的年龄是:"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p2.age </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"p2的身高是:"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E">p2.height </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>该代码会卡住，原因是利用拷贝构造只进行了值传递，p1与p2执行完毕后，均执行析构函数，对height指向的空间进行释放，但是其中一个已经执行释放后，另一个再次释放会产生非法操作，故出错</p>
<p>这也就是浅拷贝的缺点：只进行了值传递，我们需要利用深拷贝来结局</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 拷贝构造 </span></span>
<span class="line"><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> person </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">p){</span></span>
<span class="line"><span style="color: #24292E">  age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p.age;</span><span style="color: #6A737D"> // 将传入数据拷贝到当前对象</span></span>
<span class="line"><span style="color: #6A737D">  // 深拷贝，在堆区开辟新的空间</span></span>
<span class="line"><span style="color: #24292E">  height </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E">(</span><span style="color: #D73A49">*</span><span style="color: #24292E">p.height);</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"拷贝构造函数被调用"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>即在拷贝构造中，重新给拷贝的指针变量申请一块空间</p>
<p><strong>如果属性有在堆区开辟的，一定要自己提供拷贝构造函数，防止浅拷贝出现问题</strong></p>
<h3 id="初始化列表">初始化列表</h3>
<p>C++提供了初始化列表来初始化属性</p>
<p>语法：<code>&lt;构造函数&gt;(): &lt;属性1&gt;(&lt;值1&gt;), &lt;属性2&gt;(&lt;值2&gt;) ... {}</code></p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> b;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> c;</span></span>
<span class="line"><span style="color: #6A737D">  // 初始化列表赋值</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">c</span><span style="color: #24292E">):</span><span style="color: #6F42C1">a</span><span style="color: #24292E">(</span><span style="color: #005CC5">10</span><span style="color: #24292E">), </span><span style="color: #6F42C1">b</span><span style="color: #24292E">(</span><span style="color: #005CC5">20</span><span style="color: #24292E">), </span><span style="color: #6F42C1">c</span><span style="color: #24292E">(</span><span style="color: #005CC5">30</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person p;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"a:"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p.a </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"b:"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p.b </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"c:"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p.c </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="类对象作为类成员">类对象作为类成员</h3>
<p>C++中的成员可以是另一个类的对象，称为<strong>对象成员</strong></p>
<p>如</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">A</span><span style="color: #24292E">{};</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">B</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    A a;</span></span>
<span class="line"><span style="color: #24292E">};</span></span></code></pre></div></div></figure>
<p>该B类中有对象A作为成员，则A为对象成员</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;string&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">phone</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  string brand;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">float</span><span style="color: #24292E"> price;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">phone</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">pname</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    brand </span><span style="color: #D73A49">=</span><span style="color: #24292E"> pname;</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"phone构造函数被调用"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">~phone</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"phone析构函数被调用"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  string name;</span></span>
<span class="line"><span style="color: #24292E">  phone iphone;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">pname</span><span style="color: #24292E">, </span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">pbrand</span><span style="color: #24292E">):</span><span style="color: #6F42C1">name</span><span style="color: #24292E">(pname),</span><span style="color: #6F42C1">iphone</span><span style="color: #24292E">(pbrand){</span></span>
<span class="line"><span style="color: #6A737D">    //相当于phone iphone = pname;的隐式转换</span></span>
<span class="line"><span style="color: #24292E">    cout</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"person构造函数被调用"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">~person</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"person析构函数被调用"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #6F42C1">p</span><span style="color: #24292E">(</span><span style="color: #032F62">"小明"</span><span style="color: #24292E">,</span><span style="color: #032F62">"苹果"</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"姓名:"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p.name </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"手机品牌:"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p.iphone.brand </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">phone构造函数被调用</span></span>
<span class="line"><span style="color: #24292e">person构造函数被调用</span></span>
<span class="line"><span style="color: #24292e">姓名:小明</span></span>
<span class="line"><span style="color: #24292e">手机品牌:苹果</span></span>
<span class="line"><span style="color: #24292e">person析构函数被调用</span></span>
<span class="line"><span style="color: #24292e">phone析构函数被调用</span></span></code></pre></div></div></figure>
<p>注意构造函数的调用顺序：</p>
<ul>
<li>当其他类对象作为本类成员，构造时先构造类对象，在构造自身</li>
<li>当其他类对象作为本类成员，析构时先析构自身，再析构类对象</li>
</ul>
<h3 id="静态成员">静态成员</h3>
<p>在成员变量与成员函数前加上关键字static，称为静态成员</p>
<p>分类：</p>
<ul>
<li>静态成员变量
<ul>
<li>不属于某个对象，所有对象共享一份数据</li>
<li>编译阶段分配内存</li>
<li>类内声明，类外初始化</li>
</ul></li>
<li>静态成员函数
<ul>
<li>所有成员共享同一个函数</li>
<li>静态成员函数只能访问静态成员变量</li>
</ul></li>
</ul>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a;</span><span style="color: #6A737D"> // 需要类内声明，类外初始化</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> c;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"静态成员函数f调用"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">    a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">100</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">    // c = 200; // 静态成员函数不可以访问非静态成员变量</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> b;</span><span style="color: #6A737D"> // 静态成员变量也有权限</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">::a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">100</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 在类外初始化，需要指定作用域</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">::b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">100</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 也需要在类外初始化</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person p;</span><span style="color: #6A737D"> // 栈上的数据，执行完后会被释放，故执行析构函数</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p.a</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  person p2;</span></span>
<span class="line"><span style="color: #24292E">  p2.a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">200</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 数据共享，此处改变即一起改变</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p.a</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span><span style="color: #6A737D"> // 通过对象进行访问</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">::a</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span><span style="color: #6A737D"> // 通过类名进行访问</span></span>
<span class="line"><span style="color: #6A737D">  // cout &lt;&lt; p.b&lt;&lt;endl; // 不可访问</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 同样两种访问模式</span></span>
<span class="line"><span style="color: #24292E">  p.</span><span style="color: #6F42C1">f</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">::</span><span style="color: #6F42C1">f</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>应用：实现单例对象，即一个类只有一个类对象</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Singleton</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">static</span><span style="color: #24292E"> Singleton</span><span style="color: #D73A49">*</span><span style="color: #24292E"> m_insntance;</span><span style="color: #6A737D"> // 存储该类的唯一实例</span></span>
<span class="line"><span style="color: #6A737D">  // 将构造与析构设为私有</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">Singleton</span><span style="color: #24292E">(){}</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">~Singleton</span><span style="color: #24292E">(){}</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #6A737D">  // 删除拷贝构造与赋值运算符构造</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">Singleton</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Singleton</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">obj</span><span style="color: #24292E">) </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">delete</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">Singleton</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">=</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Singleton</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">) </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">delete</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 创建该唯一实例, 只能通过该方法创建获得对象</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Singleton</span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">getInstance</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">m_insntance){</span></span>
<span class="line"><span style="color: #24292E">      m_insntance </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Singleton</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> m_insntance;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  string m_name;</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">setName</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">string</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">name</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    m_name </span><span style="color: #D73A49">=</span><span style="color: #24292E"> name;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">string</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">getName</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> m_name;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">Singleton</span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Singleton</span><span style="color: #24292E">::m_insntance </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">NULL</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  // 第一次调用创建实例</span></span>
<span class="line"><span style="color: #24292E">  Singleton</span><span style="color: #D73A49">*</span><span style="color: #24292E"> s1 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Singleton</span><span style="color: #24292E">::</span><span style="color: #6F42C1">getInstance</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> s1-&gt;</span><span style="color: #6F42C1">getName</span><span style="color: #24292E">()</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #6A737D">  // 第二次调用使用已经创建的实例</span></span>
<span class="line"><span style="color: #24292E">  Singleton</span><span style="color: #D73A49">*</span><span style="color: #24292E"> s2 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Singleton</span><span style="color: #24292E">::</span><span style="color: #6F42C1">getInstance</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> s1-&gt;</span><span style="color: #6F42C1">getName</span><span style="color: #24292E">()</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="c对象模型与this指针">C++对象模型与this指针</h2>
<h3 id="成员变量与成员函数分开存储">成员变量与成员函数分开存储</h3>
<p>c++中，类内成员变量与成员函数分开存储</p>
<p>只有非静态成员变量才属于类的对象上</p>
<p>对于空对象，编译器会给每个空对象分配一个字节空间，是为了区分空对象占内存的位置</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person2</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person3</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> b;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(){}</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person p;</span></span>
<span class="line"><span style="color: #24292E">  person2 p2;</span></span>
<span class="line"><span style="color: #24292E">  person3 p3;</span></span>
<span class="line"><span style="color: #6A737D">  // 占用内存为1</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"size of empty class: "</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(p)</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 占用内存为4</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"size of class person2: "</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(p2)</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 静态成员与非静态成员函数不属于类的对象上，故占用内存也为4</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"size of class person3: "</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(p3)</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="this指针">this指针</h3>
<p>C++通过提供this指针解决了区分多个对象调用同一块代码分不清的问题</p>
<p><strong>this指针指向被调用的成员函数所属的对象</strong>，不需要定义，直接使用</p>
<p>用途：</p>
<ul>
<li>形参和成员变量同名时，可以用this指针来区分</li>
<li>在类的非静态成员函数中返回对象本身，可使用<code>retrun *this</code></li>
</ul>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">age</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #6A737D">    // 当形参和成员变量同名时,this 指针指向被调用成员函数所属对象</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> age;</span><span style="color: #6A737D"> // 此时this-&gt;age和定义的成员变量age是同一个</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 成员函数返回对象本身</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">addage</span><span style="color: #24292E">(</span><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;age</span><span style="color: #D73A49">+=</span><span style="color: #24292E">p.age;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #005CC5">this</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  // 解决名称冲突</span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #6F42C1">p</span><span style="color: #24292E">(</span><span style="color: #005CC5">18</span><span style="color: #24292E">); </span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #6F42C1">p2</span><span style="color: #24292E">(</span><span style="color: #005CC5">10</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"age:"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">p.age</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 返回对象本身可以实现链式调用</span></span>
<span class="line"><span style="color: #24292E">  p2.</span><span style="color: #6F42C1">addage</span><span style="color: #24292E">(p).</span><span style="color: #6F42C1">addage</span><span style="color: #24292E">(p).</span><span style="color: #6F42C1">addage</span><span style="color: #24292E">(p);</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"age of p2:"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">p2.age</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="空指针访问成员函数">空指针访问成员函数</h3>
<p>C++允许空指针调用成员函数，但是要注意有没有用到this指针</p>
<p>如果用到this指针，要注意保证代码的鲁棒性</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">show</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"this is person class"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">showage</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">    // 防止指向空 </span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #005CC5">this</span><span style="color: #D73A49">==</span><span style="color: #005CC5">NULL</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #6A737D">    // 调用成员变量时，默认在前面加this-&gt;,但此时p是空指针，故指向的是空对象，this没有指向数据</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"age = "</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">age </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #D73A49">*</span><span style="color: #24292E">p </span><span style="color: #D73A49">=</span><span style="color: #24292E">  </span><span style="color: #005CC5">NULL</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  p-&gt;</span><span style="color: #6F42C1">show</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  p-&gt;</span><span style="color: #6F42C1">showage</span><span style="color: #24292E">(); </span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="const修饰成员函数">const修饰成员函数</h3>
<p><strong>常函数：</strong></p>
<ul>
<li>成员函数后加const称该函数为常函数</li>
<li>常函数内不可以修改成员属性</li>
<li>成员属性声明时加关键字mutable后，在常函数内依然可以修改</li>
</ul>
<p><strong>常对象：</strong></p>
<ul>
<li>声明对象前加const称该对象为常对象</li>
<li>常对象构造时需要对内部成员变量初始化（构造函数）</li>
<li>常对象只能调用常函数</li>
</ul>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">mutable</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> b;</span><span style="color: #6A737D"> // 加上mutable也可以在常函数中修改</span></span>
<span class="line"><span style="color: #6A737D">  // this指针本身是指针常量，指针指向是不可修改的，指针指向的值是可以修改的</span></span>
<span class="line"><span style="color: #6A737D">  // 而加上const修饰后，修饰的是this指向的值，让指向的值也不可修改</span></span>
<span class="line"><span style="color: #6A737D">  // 相当于const person * const this;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">show</span><span style="color: #24292E">() </span><span style="color: #D73A49">const</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #6A737D">    //this-&gt;age = 100; // 此时不可修改 </span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">100</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(){}</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(){</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  // 常对象</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> person p;</span></span>
<span class="line"><span style="color: #6A737D">  // p.age = 100; // 常对象下不能修改值</span></span>
<span class="line"><span style="color: #24292E">  p.b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">100</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 但有mutable的可以修改</span></span>
<span class="line"><span style="color: #6A737D">  // p.f() // 常对象只能调用常函数</span></span>
<span class="line"><span style="color: #24292E">  p.</span><span style="color: #6F42C1">show</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="类的特殊成员函数">类的特殊成员函数</h3>
<p>特殊成员函数包括默认构造函数、拷贝构造函数、拷贝赋值运算符、移动构造函数、移动赋值运算符、析构函数，他们均可以用以下两个关键字修饰</p>
<ul>
<li><p><code>=delete</code>：</p>
<p>可以在函数声明后添加
<code>=delete</code>来删除当前函数，如删除构造函数、删除不需要的传参类型</p></li>
<li><p><code>=default</code>：</p>
<p>加在特殊函数后，可以用来声明一个默认特殊函数，还可以自动使用默认值初始化变量</p></li>
</ul>
<h3 id="可平凡复制类">可平凡复制类</h3>
<p>C++中，各种数据类型及他们的数组、指针、枚举等在内存中是连续存储的，可以使用memcpy()函数进行拷贝，称为可平凡复制类型</p>
<p>一个类若满足以下条件，被称为可平凡复制类，也是一种可平凡复制类型</p>
<ul>
<li>没有虚函数</li>
<li>没有用户自定义的特殊成员函数</li>
<li>有自动生成的析构函数</li>
<li>所有非静态成员变量也是可平凡复制类型</li>
<li>拷贝、移动构造函数，拷贝、移动赋值运算符中至少有一个是未被删除的</li>
<li>对于继承类，其父类要满足上述条件</li>
</ul>
<p>可以使用<code>&lt;type_traits&gt;</code>库中的<code>is_trivially_copyable&lt;类&gt;::value</code>来判断是否可拷贝</p>
<h3 id="标准布局类">标准布局类</h3>
<p>C++中，所有标量类型都是标准布局类型</p>
<p>对一个非继承类，满足以下条件被称为标准布局类</p>
<ul>
<li>没有虚函数</li>
<li>所有类成员都具有相同访问属性</li>
<li>所有类成员都是标准布局类型</li>
<li>若类是继承类，则满足该类和父类中只有一个类有非静态数据成员，且类型与访问控制满足上述条件</li>
</ul>
<p>可以使用<code>&lt;type_traits&gt;</code>库中的<code>is_standard_;leyout&lt;类&gt;::value</code>来判断是否可拷贝</p>
<h2 id="友元">友元</h2>
<p>友元可以让一个函数或者类访问另一个类中的私有成员</p>
<p>友元的关键字为<code>friend</code></p>
<h3 id="全局函数做友元">全局函数做友元</h3>
<p>在class中声明对应全局函数，并在最前面加<code>friend</code>关键词，可以声明友元</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">building</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">friend</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fir</span><span style="color: #24292E">(</span><span style="color: #6F42C1">building</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">building</span><span style="color: #24292E">);</span><span style="color: #6A737D"> // 声明该全局函数为building类的友元</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  string sitting_room;</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  string bedroom;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">building</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    sitting_room </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">"客厅"</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    bedroom </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">"卧室"</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fir</span><span style="color: #24292E">(</span><span style="color: #6F42C1">building</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">building</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"访问公共属性:"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">building.sitting_room</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"访问私有属性:"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">building.bedroom</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  building b;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">fir</span><span style="color: #24292E">(b);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="类做友元">类做友元</h3>
<p>在class中声明对应类，并在最前面加<code>friend</code>关键词，可以声明友元，被声明的类可以访问原类中的私有属性</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">buildings</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fri</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  buildings</span><span style="color: #D73A49">*</span><span style="color: #24292E"> building;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">fri</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">visit</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">buildings</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">friend</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fri</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 声明fri类是building类的友元</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  string sitting_room;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">buildings</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  string bedroom;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 在类外写成员函数</span></span>
<span class="line"><span style="color: #6F42C1">buildings</span><span style="color: #24292E">::</span><span style="color: #6F42C1">buildings</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  sitting_room </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">"客厅"</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  bedroom </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">"卧室"</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6F42C1">fri</span><span style="color: #24292E">::</span><span style="color: #6F42C1">fri</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  building </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> buildings;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fri</span><span style="color: #24292E">::</span><span style="color: #6F42C1">visit</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"访问公共属性:"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">building-&gt;sitting_room</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"访问私有属性:"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">building-&gt;bedroom</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span><span style="color: #6A737D"> // 友元可以访问类中的私有属性</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  fri f;</span></span>
<span class="line"><span style="color: #24292E">  f.</span><span style="color: #6F42C1">visit</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="成员函数做友元">成员函数做友元</h3>
<p>在class中声明对应类中的成员函数，并在最前面加<code>friend</code>关键词，可以声明友元，被声明的成员函数可以访问原类中的私有属性</p>
<p><figure class="shiki C++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></div><div class="code"><pre><code>#include <iostream>
using namespace std;
class buildings;
class fri{
public:
  buildings* building;
  fri(){
    building = new buildings;
  }
  void visit(); // 让visit可以访问buildings中的私有属性
};

class buildings{
  friend void fri::visit(); // 声明fri类下的visit成员函数是building类的友元
public:
  string sitting_room;
  buildings(){
    sitting_room = "客厅";
    bedroom = "卧室";
  }
private:
  string bedroom;
};

void fri::visit(){
  cout &lt;&lt;"访问公共属性:" &lt;<building->sitting_room&lt;&lt;endl;
  cout &lt;&lt;"访问私有属性:" &lt;<building->bedroom&lt;&lt;endl; // 友元可以访问类中的私有属性
}

int main(){
  fri f;
  f.visit();
}</building-></building-></iostream></code></pre></div></div></figure></p>
<h2 id="运算符重载">运算符重载</h2>
<p>运算符重载可以对已有的运算符重新定义，赋予另一种功能以适用于不同的数据类型</p>
<p>如我们通过写成员函数来实现两个类相加属性后返回新的对象</p>
<p>可以通过编译器提供的通用名称<code>operator</code>来重载运算符以简化运算</p>
<p>重载的本质调用为（以person类为例）：</p>
<ul>
<li>成员函数：<code>person p3 = p1.operator&lt;运算符&gt;(p2)</code></li>
<li>全局函数：<code>person p3 = p1.operator&lt;运算符&gt;(p1, p2)</code></li>
</ul>
<p>注意：</p>
<ul>
<li>运算符重载也可以实现函数重载</li>
<li>对于内置数据类型的表达式的运算符是不可以重载的</li>
<li>不要滥用运算符重载</li>
</ul>
<h3 id="加号运算符重载">加号运算符重载</h3>
<p>成员函数：</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">+</span><span style="color: #24292E">(</span><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    person temp;</span></span>
<span class="line"><span style="color: #24292E">    temp.a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;a</span><span style="color: #D73A49">+</span><span style="color: #24292E">p.a;</span></span>
<span class="line"><span style="color: #24292E">    temp.b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;b</span><span style="color: #D73A49">+</span><span style="color: #24292E">p.b;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> temp;</span></span>
<span class="line"><span style="color: #24292E"> }</span></span></code></pre></div></div></figure>
<p>全局函数：</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">+</span><span style="color: #24292E">(</span><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">p1</span><span style="color: #24292E">, </span><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">p2</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  person temp;</span></span>
<span class="line"><span style="color: #24292E">    temp.a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p1.a</span><span style="color: #D73A49">+</span><span style="color: #24292E">p2.a;</span></span>
<span class="line"><span style="color: #24292E">    temp.b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p1.b</span><span style="color: #D73A49">+</span><span style="color: #24292E">p2.b;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> temp;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="左移运算符重载">左移运算符重载</h3>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 只能全局重载左移运算符</span></span>
<span class="line"><span style="color: #6A737D">// 若在类内重载会称为p.operator&lt;&lt;(cout) 即p&lt;&lt;cout (cout是ostream流中的对象)</span></span>
<span class="line"><span style="color: #6A737D">// 这里先写cout即可实现cout在左边p在右边</span></span>
<span class="line"><span style="color: #6A737D">// 返回值作为cout本身的引用，可以实现链式编程</span></span>
<span class="line"><span style="color: #6F42C1">ostream</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">&lt;&lt;</span><span style="color: #24292E">(</span><span style="color: #6F42C1">ostream</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">cout</span><span style="color: #24292E">, </span><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"a="</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p.a </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"b="</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p.b;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> cout;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="递增运算符重载">递增运算符重载</h3>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 前置++</span></span>
<span class="line"><span style="color: #6A737D">// 这里返回引用是为了确保只对同一个数据进行操作</span></span>
<span class="line"><span style="color: #6F42C1">myint</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">++</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  num</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 先进行自增运算</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #005CC5">this</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 再返回自身</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 后置++</span></span>
<span class="line"><span style="color: #6A737D">// 这里为了防止重复，添加一个int占位符来实现函数重载以区分前后置</span></span>
<span class="line"><span style="color: #6F42C1">myint</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">++</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  myint temp </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #005CC5">this</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  num</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> temp;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="赋值运算符重载">赋值运算符重载</h3>
<p>C++编译器会额外给一个类添加赋值运算符的重载函数</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E">age;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">age</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E">(age);</span><span style="color: #6A737D"> // 年龄放在堆区</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 将age内存释放</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">~person</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (age</span><span style="color: #D73A49">!=</span><span style="color: #005CC5">NULL</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">delete</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">      age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">NULL</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #6F42C1">p1</span><span style="color: #24292E">(</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"p1's age:"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E">p1.age </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #6F42C1">p2</span><span style="color: #24292E">(</span><span style="color: #005CC5">2</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  p2 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p1;</span><span style="color: #6A737D"> // 赋值操作</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"p2's age:"</span><span style="color: #D73A49">&lt;&lt;*</span><span style="color: #24292E">p2.age</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>该代码出错，由于age开到了同一块堆区内存，故在p1赋值给p2时，两者的age指针都指向同一块区域</p>
<p>则当p2执行完毕，执行析构函数时，将该堆区内存释放；再等p1执行完毕，执行析构函数时，将已经释放的内存重复释放了，故报错</p>
<p>我们需要通过重载赋值运算符来实现深拷贝</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 重载赋值运算符</span></span>
<span class="line"><span style="color: #6F42C1">person</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">=</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #6A737D">  // 首先判断是否有属性在堆区，若有先释放，再深拷贝</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (age</span><span style="color: #D73A49">!=</span><span style="color: #005CC5">NULL</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">delete</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">    age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">NULL</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E">(</span><span style="color: #D73A49">*</span><span style="color: #24292E">p.age);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #005CC5">this</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="关系运算符重载">关系运算符重载</h3>
<p>实现自定义数据类型的比较</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 重载==运算符</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">bool</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">==</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;name</span><span style="color: #D73A49">==</span><span style="color: #24292E">p.name </span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E"> </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;age</span><span style="color: #D73A49">==</span><span style="color: #24292E">p.age){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">true</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 重载!=运算符</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">bool</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">!=</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;name</span><span style="color: #D73A49">==</span><span style="color: #24292E">p.name </span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E"> </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;age</span><span style="color: #D73A49">==</span><span style="color: #24292E">p.age){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">true</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span></code></pre></div></div></figure>
<p>大于小于类似</p>
<h3 id="函数调用运算符重载">函数调用运算符重载</h3>
<ul>
<li>函数调用运算符即()</li>
<li>重载后的使用方式很像函数的调用，故也称为仿函数</li>
<li>仿函数没有固定写法</li>
</ul>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">print</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #6A737D">  //重载函数调用运算符</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">()</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> s </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">add</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">()</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">n1</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">n2</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> n1</span><span style="color: #D73A49">+</span><span style="color: #24292E">n2;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span></code></pre></div></div></figure>
<p>也可以用匿名函数对象进行调用</p>
<h2 id="继承">继承</h2>
<p>有些类与其他类之间除了有共性，还有自己的特性，我们可以用继承的技术来减少重复代码优点：减少重复代码</p>
<p>语法：<code>&lt;子类&gt;: &lt;继承方式&gt; &lt;父类&gt;</code></p>
<p>其中子类也称作派生类，父类也称基类</p>
<p>子类中的成员包含两部分：</p>
<p>一类是从基类继承过来的，一类是自己增加的成员</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">page</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f1</span><span style="color: #24292E">()</span></span>
<span class="line"><span style="color: #24292E">  {</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"f1"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f2</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"f2"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f3</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"f3"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">page2</span><span style="color: #24292E">:</span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">page</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">s1</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"s1"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span></code></pre></div></div></figure>
<h3 id="继承方式">继承方式</h3>
<img src="/C++/%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20250602151243297.png" class="" title="继承方式">
<p>即：</p>
<ul>
<li>私有成员子类均不可访问</li>
<li>公共继承下：各成员权限不变</li>
<li>保护继承下：public变为protected</li>
<li>私有继承下：public与protected变为private</li>
</ul>
<h3 id="继承中的对象模型">继承中的对象模型</h3>
<p>父类中所有非静态成员属性都会被子类继承</p>
<p>而私有属性被编译器隐藏，故访问不到</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fa</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">protected:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> b;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> c;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">son</span><span style="color: #24292E">:</span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fa</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> d;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  // 结果为16，即父类中所有属性都会被继承</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(son)</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="继承中的构造与析构顺序">继承中的构造与析构顺序</h3>
<p>子类继承父类后，创建子类对象时，也会调用父类的构造函数</p>
<p>顺序：先构造父类，再构造子类，析构相反</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">base</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">base</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"base构造函数"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">~base</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"base析构函数"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">son</span><span style="color: #24292E">:</span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">base</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">son</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"son构造函数"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">~son</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"son析构函数"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  son s;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<figure class="shiki"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">base构造函数</span></span>
<span class="line"><span style="color: #24292e">son构造函数</span></span>
<span class="line"><span style="color: #24292e">son析构函数</span></span>
<span class="line"><span style="color: #24292e">base析构函数</span></span></code></pre></div></div></figure>
<h3 id="同名成员处理方式">同名成员处理方式</h3>
<p>当子类和父类出现同名成员：子类的同名成员会隐藏掉所有父类中同名成员（函数重载也会被隐藏）</p>
<ul>
<li>访问子类同名成员：直接访问</li>
<li>访问父类同名成员：加作用域</li>
</ul>
<p>静态与非静态处理方式一样</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fa</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> b; </span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">fa</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">100</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"f in fa"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ff</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"ff in fa"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">son</span><span style="color: #24292E">:</span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fa</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> b;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">son</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">200</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"f in son"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ff</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"ff in son"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fa</span><span style="color: #24292E">::b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">son</span><span style="color: #24292E">::b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">20</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  son s;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"a in son:"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">s.a</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #6A737D">  // 加作用域访问父类中的同名成员变量</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"a in fa:"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">s.fa::a</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  s.</span><span style="color: #6F42C1">f</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #6A737D">  // 加作用域调用父类中的同名成员函数</span></span>
<span class="line"><span style="color: #24292E">  s.fa::</span><span style="color: #6F42C1">f</span><span style="color: #24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 非静态同名成员访问：通过对象</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"static b in son:"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">s.b</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"static b in fa:"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">s.fa::b</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  s.</span><span style="color: #6F42C1">ff</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  s.fa::</span><span style="color: #6F42C1">ff</span><span style="color: #24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 非静态同名成员访问：通过类名</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"static b in son:"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">son</span><span style="color: #24292E">::b </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl; </span></span>
<span class="line"><span style="color: #6A737D">  // 第一个::代表通过类名访问，第二个::代表访问父类作用域下</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"static b in fa:"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">son</span><span style="color: #24292E">::</span><span style="color: #6F42C1">fa</span><span style="color: #24292E">::b</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">son</span><span style="color: #24292E">::</span><span style="color: #6F42C1">ff</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">son</span><span style="color: #24292E">::</span><span style="color: #6F42C1">fa</span><span style="color: #24292E">::</span><span style="color: #6F42C1">ff</span><span style="color: #24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="多继承">多继承</h3>
<p>C++允许一个类继承多个类</p>
<p>语法：<code>&lt;子类&gt;: &lt;继承方式&gt; &lt;父类1&gt;, &lt;继承方式&gt; &lt;父类2&gt;...</code></p>
<p>同名成员出现时需要加作用域区分</p>
<p><strong>实际开发时不建议使用多继承</strong></p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fa</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">fa</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">100</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"f in fa"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fa2</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">fa2</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    a</span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">200</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"f in fa"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">son</span><span style="color: #24292E">:</span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fa</span><span style="color: #24292E">, </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fa2</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> c;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> d;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">son</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    c </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">300</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    d </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">400</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  // 多继承子类空间</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"size of son:"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;sizeof</span><span style="color: #24292E">(son)</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  son s;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"a in fa:"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">s.fa::a</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"a in fa2:"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">s.fa2::a</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="菱形继承">菱形继承</h3>
<p>概念：两个派生类继承同一个基类，又有某个类同时继承两个派生类</p>
<p>菱形继承时，两个父类拥有相同数据，需要加作用域区分</p>
<p>但该数据对于最后的子类来说存在两份，会浪费空间，需要利用<strong>虚继承</strong>来解决问题</p>
<p>在需要虚继承的部分的访问权限前添加关键字<code>vritual</code>即可，此时对应父类称为<strong>虚基类</strong></p>
<p>原理：此时的父类继承的是虚基类指针(vbptr)，指向一个虚基类表，该表存储了指针位置以及对应偏移量，根据偏移量便可以找到继承的那唯一一份数据</p>
<p>缺点：虚继承占用内存很大</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">animal</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// sheep 继承了 animal</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">sheep</span><span style="color: #24292E">: </span><span style="color: #D73A49">virtual</span><span style="color: #24292E"> </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">animal</span><span style="color: #24292E">{};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// camel 继承了 animal</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">camel</span><span style="color: #24292E">: </span><span style="color: #D73A49">virtual</span><span style="color: #24292E"> </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">animal</span><span style="color: #24292E">{};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// alpaca 继承了 sheep和camel</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">alpaca</span><span style="color: #24292E">: </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">sheep</span><span style="color: #24292E">, </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">camel</span><span style="color: #24292E">{};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  alpaca st;</span></span>
<span class="line"><span style="color: #6A737D">  // 菱形继承时，两个父类有相同数据，需要加作用域区分</span></span>
<span class="line"><span style="color: #24292E">  st.sheep::age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">18</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  st.camel::age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">20</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"age of sheep: "</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">st.sheep::age</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"age of camel: "</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">st.camel::age</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"age of alpaca: "</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">st.alpaca::age</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="多态">多态</h2>
<h3 id="分类">分类</h3>
<ul>
<li>静态多态：函数和运算符重载属于静态多态，复用函数名；函数地址在编译阶段确定</li>
<li>动态多态：派生类和虚函数实现运行时多态；函数地址在运行阶段确定</li>
</ul>
<p>### 动态多态</p>
<p>满足条件：</p>
<ul>
<li><p>存在继承关系</p></li>
<li><p>子类要重写父类的虚函数</p>
<p>（重写即函数返回值类型、函数名、参数列表完全相同）</p></li>
</ul>
<p>使用：父类的指针或者引用指向子类对象</p>
<p>原理：父类记录的也是虚基类指针，指向对应虚基类表。当子类重写后，对应指向的虚基类表被现子类覆盖，得到对应参数</p>
<p>优点：</p>
<ul>
<li>组织结构清晰</li>
<li>可读性强</li>
<li>前期后期拓展以及维护性高</li>
</ul>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">animal</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #6A737D">  // 虚函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">virtual</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">speak</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"speaking"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">cat</span><span style="color: #24292E">: </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">animal</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">speak</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"cat is speaking"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 地址在编译阶段确定函数地址，但为了让多个类输出对应，需要在运行时确定</span></span>
<span class="line"><span style="color: #6A737D">// 当给animal中的speak变为虚函数后，便可以实现子类重写父类</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">dospeak</span><span style="color: #24292E">(</span><span style="color: #6F42C1">animal</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">ani</span><span style="color: #24292E">){</span><span style="color: #6A737D"> // 父类引用</span></span>
<span class="line"><span style="color: #24292E">  ani.</span><span style="color: #6F42C1">speak</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 但调用的是animal中的speak函数</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  cat cat;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">dospeak</span><span style="color: #24292E">(cat);</span><span style="color: #6A737D"> // 父类引用指向了子类</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>在开发时，提倡开闭原则：即对扩展进行开放，对修改进行关闭</p>
<h3 id="纯虚函数与抽象类">纯虚函数与抽象类</h3>
<p>多态中，通常父类中的虚函数实现是毫无意义的，都是调用子类中的重写内容</p>
<p>因此可以将虚函数改为纯虚函数</p>
<p>语法：<code>virtual &lt;返回值类型&gt; &lt;函数名&gt;([参数列表]) = 0;</code></p>
<p>此时这个类称为<strong>抽象类</strong></p>
<ul>
<li>抽象类无法实例化对象</li>
<li>子类必须重写抽象类中的纯虚函数，否则也属于抽象类</li>
</ul>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">base</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">virtual</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">func</span><span style="color: #24292E">() </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 纯虚函数</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">son</span><span style="color: #24292E"> :</span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">base</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #6A737D">// 子类必须重写父类中的纯虚函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">virtual</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">func</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"func调用"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  // base b; 不允许实例化抽象类</span></span>
<span class="line"><span style="color: #24292E">  base </span><span style="color: #D73A49">*</span><span style="color: #24292E">b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> son;</span></span>
<span class="line"><span style="color: #24292E">  b-&gt;</span><span style="color: #6F42C1">func</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="虚析构与纯虚析构">虚析构与纯虚析构</h3>
<p>多态使用时，如果子类中有属性开辟到堆区，则父类指针在释放时就无法调用到子类的虚构代码，此时需要将父类中的析构函数改为<strong>虚析构或纯虚析构</strong></p>
<ul>
<li>可以解决父类指针释放子类对象</li>
<li>都需要有函数具体实现</li>
</ul>
<p>其中，纯虚析构需要类外实现</p>
<p>有纯虚析构后该类便成为了抽象类</p>
<p>语法：<code>virtual ~&lt;类名&gt;(){}</code>或<code>virtual ~&lt;类名&gt;()=0;</code></p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">animal</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">virtual</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">speak</span><span style="color: #24292E">() </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  // 用虚析构解决父类指针释放子类对象时释放不完全的问题</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">virtual</span><span style="color: #24292E"> </span><span style="color: #6F42C1">~animal</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"animal析构调用"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">cat</span><span style="color: #24292E">: </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">animal</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">cat</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">name</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    cname </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">string</span><span style="color: #24292E">(name);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">virtual</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">speak</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;*</span><span style="color: #24292E">cname</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"'s speaking"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">~cat</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (cname </span><span style="color: #D73A49">!=</span><span style="color: #005CC5">NULL</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"cat析构调用"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">delete</span><span style="color: #24292E"> cname;</span></span>
<span class="line"><span style="color: #24292E">      cname </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">NULL</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  string </span><span style="color: #D73A49">*</span><span style="color: #24292E">cname;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  animal </span><span style="color: #D73A49">*</span><span style="color: #24292E"> ani </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">cat</span><span style="color: #24292E">(</span><span style="color: #032F62">"Tom"</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  ani-&gt;</span><span style="color: #6F42C1">speak</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #6A737D">  // 父类指针析构时不会调用子类析构函数，导致若子类有析构属性时不会被释放</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">delete</span><span style="color: #24292E"> ani;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="杂项">杂项</h2>
<h3 id="override与final限定符">override与final限定符</h3>
<p>在基类是虚函数的情况下，子类对该虚函数进行重写，在要重写的函数后面加上<code>override</code>可以防止因为子类的拼写错误，数据类型错误等问题，导致无法调用到子类而直接调用了基类</p>
<p>（若不相同会直接报错）</p>
<p>在虚函数声明的结尾加上<code>final</code>可以防止该虚函数被子类重写，在类声明的后面加上<code>final</code>可以防止该类被继承</p>
<p>注意这两个限定符不是保留关键字</p>
<h3 id="const成员函数">const成员函数</h3>
<p>在成员函数声明和定义的后面加上关键字<code>const</code></p>
<p>const成员函数不能修改其成员变量，不能调用非const成员函数，不能通过const类型的对象调用非const成员函数</p>
<p><strong>即常量对象只可以调用常量方法</strong></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://izayoisakuye.github.io/C++/%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="IzayoiSakuye">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="红魔咖啡馆">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | 红魔咖啡馆">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/C++/%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4/" class="post-title-link" itemprop="url">【C++】命名空间</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-07-31 17:28:12 / 修改时间：17:28:21" itemprop="dateCreated datePublished" datetime="2025-07-31T17:28:12+08:00">2025-07-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/C-C/" itemprop="url" rel="index"><span itemprop="name">C/C++</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="命名空间">命名空间</h1>
<h2 id="使用">使用</h2>
<p>格式：</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">namespace</span><span style="color: #24292E"> 标识符{</span></span>
<span class="line"><span style="color: #6A737D">    // 类，对象，变量，函数等</span></span>
<span class="line"><span style="color: #24292E">};</span></span></code></pre></div></div></figure>
<p>使用：</p>
<p>使用限定名：<code>标识符::名字</code></p>
<p>同一个命名空间可以在一个或多个文件下重复使用</p>
<h2 id="引入">引入</h2>
<ul>
<li>使用using
namespace可以引入某个命名空间中的所有名称，这样就可以直接使用内部对应内容</li>
<li>使用using声明可以引入某个限定标识符，这样就不需要使用限定名了</li>
<li>引入声明区分全局与局部</li>
<li>不限定命名空间的均默认处于全局命名空间global，引入时只需要使用<code>::名字</code></li>
</ul>
<h2 id="嵌套">嵌套</h2>
<p>命名空间可以嵌套使用：</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Space1</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Space2</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">3</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>调用时需要明确指出引用哪个，否则会造成不明确，默认输出全局的</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Space1</span><span style="color: #24292E">::a;</span></span>
<span class="line"><span style="color: #24292E">cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> a </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Space1</span><span style="color: #24292E">::</span><span style="color: #6F42C1">Space2</span><span style="color: #24292E">::a;</span></span>
<span class="line"><span style="color: #24292E">cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> a </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span></code></pre></div></div></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://izayoisakuye.github.io/C++/%E6%A8%A1%E6%9D%BF%E4%B8%8E%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="IzayoiSakuye">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="红魔咖啡馆">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | 红魔咖啡馆">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/C++/%E6%A8%A1%E6%9D%BF%E4%B8%8E%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B/" class="post-title-link" itemprop="url">【C++】模板与泛型编程</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-07-31 17:27:37 / 修改时间：17:27:57" itemprop="dateCreated datePublished" datetime="2025-07-31T17:27:37+08:00">2025-07-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/C-C/" itemprop="url" rel="index"><span itemprop="name">C/C++</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="模板与泛型编程">模板与泛型编程</h1>
<h2 id="模板">模板</h2>
<p>概念：建立通用模具，大大提高复用性，利用模板进行编程的思想被称为泛型编程</p>
<p>机制：函数模板与类模板</p>
<h2 id="函数模板">函数模板</h2>
<p>建立一个通用函数，返回值类型与形参类型可以不具体指定，用虚拟类型代表</p>
<h3 id="语法">语法</h3>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #6A737D">/*函数声明或定义*/</span></span></code></pre></div></div></figure>
<ul>
<li>template：声明创建模板</li>
<li>typename：表示后面的符号是一种数据类型</li>
<li>T：通用数据类型，名称可以替换，但通常是大写字母</li>
</ul>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span><span style="color: #6A737D"> // 声明模板</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">swapt</span><span style="color: #24292E">(</span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  T temp </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">  a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> b;</span></span>
<span class="line"><span style="color: #24292E">  b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> temp;</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">20</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  // 方法一：自动类型推导</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">swapt</span><span style="color: #24292E">(a,b);</span></span>
<span class="line"><span style="color: #6A737D">  // 方法二：显式指定类型</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">swapt</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt;(a,b);</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> a </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">" "</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> b;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="注意">注意</h3>
<ul>
<li><p>自动类型推导时，必须推导出一致的数据类型T才能使用</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #D73A49">char</span><span style="color: #24292E"> c;</span></span>
<span class="line"><span style="color: #6F42C1">swapt</span><span style="color: #24292E">(a,c);</span><span style="color: #6A737D"> // 出错</span></span></code></pre></div></div></figure></li>
<li><p>模板必须要确定出T的数据类型才能用</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6F42C1">f</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 报错</span></span></code></pre></div></div></figure></li>
<li><p>typename可以用class替换（class可以声明函数模板和类模板）</p></li>
</ul>
<h3 id="与普通函数的区别">与普通函数的区别</h3>
<ul>
<li>普通函数调用可以发生隐式类型转换</li>
<li>函数模板使用自动类型推导时不可以发生隐式类型转换</li>
<li>使用显式指定类型时可以发生隐式类型转换</li>
</ul>
<h3 id="调用规则">调用规则</h3>
<ul>
<li>普通函数与函数模板都可以实现时，优先调用普通函数</li>
<li>可以通过空模板参数列表来强制调用函数模板</li>
<li>函数模板也可以发生重载</li>
<li>如果函数模板可以产生更好的匹配，则优先调用函数模板</li>
</ul>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">print</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"普通函数调用"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> a </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">" "</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> b </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">print</span><span style="color: #24292E">(</span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"函数模板调用"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> a </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">" "</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> b </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">print</span><span style="color: #24292E">(</span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">, </span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #E36209">c</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"重载函数模板调用"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> a </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">" "</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> b </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">" "</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">c </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">print</span><span style="color: #24292E">(a,b);</span></span>
<span class="line"><span style="color: #6A737D">  // 更好匹配</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">char</span><span style="color: #24292E"> c </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">'1'</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">char</span><span style="color: #24292E"> d </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">'2'</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">print</span><span style="color: #24292E">(c,d);</span></span>
<span class="line"><span style="color: #6A737D">  // 强制调用</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">print</span><span style="color: #24292E">&lt;&gt;(a,b);</span></span>
<span class="line"><span style="color: #6A737D">  //重载调用</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> e </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">print</span><span style="color: #24292E">(a, b, e);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="类模板">类模板</h2>
<p>建立一个通用类，类中的成员数据类型可以用虚拟类型代表</p>
<h3 id="语法-1">语法</h3>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #6A737D">/*类*/</span></span></code></pre></div></div></figure>
<ul>
<li>template：声明创建模板</li>
<li>typename：表示后面的符号是一种数据类型</li>
<li>T：通用数据类型，名称可以替换，但通常是大写字母</li>
</ul>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #6F42C1">NameType</span><span style="color: #24292E"> </span><span style="color: #E36209">name</span><span style="color: #24292E">, </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E"> </span><span style="color: #E36209">age</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;name </span><span style="color: #D73A49">=</span><span style="color: #24292E"> name;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">show</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"name: "</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;name</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"age: "</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;age</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  NameType name;</span></span>
<span class="line"><span style="color: #24292E">  AgeType age;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  // 使用模板参数列表指定类型</span></span>
<span class="line"><span style="color: #24292E">  person</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">string, </span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">p1</span><span style="color: #24292E">(</span><span style="color: #032F62">"Jack"</span><span style="color: #24292E">, </span><span style="color: #005CC5">18</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  p1.</span><span style="color: #6F42C1">show</span><span style="color: #24292E">();</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="与函数模板的区别">与函数模板的区别</h3>
<ul>
<li><p>类模板没有自动类型推导的方式</p>
<p>不能写<code>person p("a", 1);</code>这种写法，只能显式指定</p></li>
<li><p>类模板在模板参数列表中可以有默认参数</p>
<p><code>template&lt;class NameType, class AgeType = int&gt;</code>可以指定默认的数据类型</p></li>
</ul>
<h3 id="创建时机">创建时机</h3>
<ul>
<li>普通类中的成员函数一开始就可以创建</li>
<li>类模板中的成员函数在调用时才创建，因为调用时才能确定数据类型</li>
</ul>
<h3 id="类模板对象做函数参数">类模板对象做函数参数</h3>
<p>传入方式：</p>
<ul>
<li>指定传入类型：直接显示对象的数据类型</li>
<li>参数模板化：将对象中的参数变为模板进行传递</li>
<li>整个类模板化：将这个对象类型模板化进行传递</li>
</ul>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #6F42C1">NameType</span><span style="color: #24292E"> </span><span style="color: #E36209">name</span><span style="color: #24292E">, </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E"> </span><span style="color: #E36209">age</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;name </span><span style="color: #D73A49">=</span><span style="color: #24292E"> name;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">show</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"name: "</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;name</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"age: "</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;age</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  NameType name;</span></span>
<span class="line"><span style="color: #24292E">  AgeType age;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #6A737D">// 指定传入类型</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">printp1</span><span style="color: #24292E">(</span><span style="color: #6F42C1">person</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">string</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt; </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  p.</span><span style="color: #6F42C1">show</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6A737D">// 参数模板化</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T1</span><span style="color: #24292E">, </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T2</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">printp2</span><span style="color: #24292E">(</span><span style="color: #6F42C1">person</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">T1</span><span style="color: #24292E">, </span><span style="color: #6F42C1">T2</span><span style="color: #24292E">&gt; </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"T1: "</span><span style="color: #D73A49">&lt;&lt;typeid</span><span style="color: #24292E">(T1).</span><span style="color: #6F42C1">name</span><span style="color: #24292E">()</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"T2: "</span><span style="color: #D73A49">&lt;&lt;typeid</span><span style="color: #24292E">(T2).</span><span style="color: #6F42C1">name</span><span style="color: #24292E">()</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  p.</span><span style="color: #6F42C1">show</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6A737D">// 整个类模板化</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">printp3</span><span style="color: #24292E">(</span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"T: "</span><span style="color: #D73A49">&lt;&lt;typeid</span><span style="color: #24292E">(T).</span><span style="color: #6F42C1">name</span><span style="color: #24292E">()</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  p.</span><span style="color: #6F42C1">show</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">string, </span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">p</span><span style="color: #24292E">(</span><span style="color: #032F62">"Jack"</span><span style="color: #24292E">, </span><span style="color: #005CC5">18</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printp1</span><span style="color: #24292E">(p);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printp2</span><span style="color: #24292E">(p);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printp3</span><span style="color: #24292E">(p);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="类模板与继承">类模板与继承</h3>
<ul>
<li><p>当子类继承的父类是一个类模板时，子类在声明的时候，要指定出父类中T的类型</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">base</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  T m;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">son</span><span style="color: #24292E">:</span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">base</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt;{</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">};</span></span></code></pre></div></div></figure></li>
<li><p>若想灵活指定父类中的T类型，子类也需要变成类模板</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">base</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  T m;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T1</span><span style="color: #24292E">, </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T2</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">son</span><span style="color: #24292E">:</span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">base</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">T2</span><span style="color: #24292E">&gt;{</span></span>
<span class="line"><span style="color: #24292E">  T1 obj;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  son</span><span style="color: #D73A49">&lt;int</span><span style="color: #24292E">, </span><span style="color: #D73A49">char&gt;</span><span style="color: #24292E"> s1;</span><span style="color: #6A737D"> // 此时int为T1对应的obj的类型，char为T2对应父类中T的类型</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure></li>
</ul>
<h2 id="模板特化">模板特化</h2>
<p>有些特定数据类型需要一些特定的实现方式，需要具体化实现</p>
<h3 id="函数模板特化">函数模板特化</h3>
<p>在需要特化的函数前添加<code>template&lt;&gt;</code></p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">name</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">age</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;name </span><span style="color: #D73A49">=</span><span style="color: #24292E"> name;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  string name;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">bool</span><span style="color: #24292E"> </span><span style="color: #6F42C1">cmp</span><span style="color: #24292E">(</span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (a</span><span style="color: #D73A49">==</span><span style="color: #24292E">b){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">true</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">else</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6A737D">// 使用具体化person的版本实现代码，具体化优先调用</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;&gt; </span><span style="color: #D73A49">bool</span><span style="color: #24292E"> </span><span style="color: #6F42C1">cmp</span><span style="color: #24292E">(</span><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">p1</span><span style="color: #24292E">, </span><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">p2</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (p1.name</span><span style="color: #D73A49">==</span><span style="color: #24292E">p2.name</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E">p1.age </span><span style="color: #D73A49">==</span><span style="color: #24292E">p2.age) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">true</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #6F42C1">p1</span><span style="color: #24292E">(</span><span style="color: #032F62">"Jack"</span><span style="color: #24292E">, </span><span style="color: #005CC5">10</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #6F42C1">p2</span><span style="color: #24292E">(</span><span style="color: #032F62">"Jack"</span><span style="color: #24292E">, </span><span style="color: #005CC5">10</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #6F42C1">cmp</span><span style="color: #24292E">(p1,p2)){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"a==b"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"a!=b"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="类模板成员函数类外实现">类模板成员函数类外实现</h3>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #6F42C1">NameType</span><span style="color: #24292E"> </span><span style="color: #E36209">name</span><span style="color: #24292E">, </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E"> </span><span style="color: #E36209">age</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">show</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  NameType name;</span></span>
<span class="line"><span style="color: #24292E">  AgeType age;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 类外实现</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #6F42C1">person</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt;::</span><span style="color: #6F42C1">person</span><span style="color: #24292E">(NameType name, AgeType age){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;name </span><span style="color: #D73A49">=</span><span style="color: #24292E"> name;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt;::</span><span style="color: #6F42C1">show</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"name: "</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;name </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"age: "</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;age</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">string, </span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">p</span><span style="color: #24292E">(</span><span style="color: #032F62">"Jack"</span><span style="color: #24292E">, </span><span style="color: #005CC5">18</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  p.</span><span style="color: #6F42C1">show</span><span style="color: #24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="类模板分文件编写">类模板分文件编写</h3>
<p>由于类模板中成员函数在调用时才创建，这导致了分文件编写时链接不到，有两个方法</p>
<ul>
<li><p>直接引入.cpp文件</p></li>
<li><p>将声明和实现写在同一个文件中，改后缀名为.hpp</p></li>
</ul>
<p>常用第二种</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#pragma</span><span style="color: #24292E"> </span><span style="color: #6F42C1">once</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #6F42C1">NameType</span><span style="color: #24292E"> </span><span style="color: #E36209">name</span><span style="color: #24292E">, </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E"> </span><span style="color: #E36209">age</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">show</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  NameType name;</span></span>
<span class="line"><span style="color: #24292E">  AgeType age;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 类外实现</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #6F42C1">person</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt;::</span><span style="color: #6F42C1">person</span><span style="color: #24292E">(NameType name, AgeType age){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;name </span><span style="color: #D73A49">=</span><span style="color: #24292E"> name;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt;::</span><span style="color: #6F42C1">show</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"name: "</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;name </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"age: "</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;age</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>（hpp文件）</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">"person.hpp"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">string, </span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">p</span><span style="color: #24292E">(</span><span style="color: #032F62">"Jack"</span><span style="color: #24292E">, </span><span style="color: #005CC5">18</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  p.</span><span style="color: #6F42C1">show</span><span style="color: #24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>（调用文件）</p>
<h3 id="类模板与友元">类模板与友元</h3>
<p>使用场景</p>
<ul>
<li>全局函数类内实现：直接类内声明友元</li>
<li>全局函数类外实现：需要提前让编译器知道全局函数的存在</li>
</ul>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">// 前向声明 类与模板函数</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">printPerson2</span><span style="color: #24292E">(</span><span style="color: #6F42C1">person</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt; </span><span style="color: #E36209">p</span><span style="color: #24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #6A737D">  // 类内实现</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">friend</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">printPerson</span><span style="color: #24292E">(</span><span style="color: #6F42C1">person</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt; </span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"name: "</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">p.name </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"age: "</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">p.age</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 类外实现 需要让编译器提前知道这个函数的存在</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">friend</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">printPerson2</span><span style="color: #24292E">&lt;&gt;(person</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">NameType, AgeType</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> p);</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #6F42C1">NameType</span><span style="color: #24292E"> </span><span style="color: #E36209">name</span><span style="color: #24292E">, </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E"> </span><span style="color: #E36209">age</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;name </span><span style="color: #D73A49">=</span><span style="color: #24292E"> name;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  NameType name;</span></span>
<span class="line"><span style="color: #24292E">  AgeType age;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 类外实现</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">printPerson2</span><span style="color: #24292E">(</span><span style="color: #6F42C1">person</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt; </span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"name: "</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p.name </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"age: "</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p.age </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">string, </span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">p</span><span style="color: #24292E">(</span><span style="color: #032F62">"Jack"</span><span style="color: #24292E">, </span><span style="color: #005CC5">18</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printPerson</span><span style="color: #24292E">(p);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printPerson2</span><span style="color: #24292E">(p);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://izayoisakuye.github.io/C++/%E5%AE%8C%E7%BE%8E%E8%BD%AC%E5%8F%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="IzayoiSakuye">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="红魔咖啡馆">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | 红魔咖啡馆">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/C++/%E5%AE%8C%E7%BE%8E%E8%BD%AC%E5%8F%91/" class="post-title-link" itemprop="url">【C++】完美转发</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-07-31 17:27:04 / 修改时间：17:27:25" itemprop="dateCreated datePublished" datetime="2025-07-31T17:27:04+08:00">2025-07-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/C-C/" itemprop="url" rel="index"><span itemprop="name">C/C++</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="完美转发">完美转发</h1>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">string</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"左值:"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">s</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"右值"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">s</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">g</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">string</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(s);</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">g</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(s);</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  // 右值</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">g</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E">(</span><span style="color: #032F62">"hello1"</span><span style="color: #24292E">));</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 左值</span></span>
<span class="line"><span style="color: #24292E">  string </span><span style="color: #6F42C1">s1</span><span style="color: #24292E">(</span><span style="color: #032F62">"hello2"</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">g</span><span style="color: #24292E">(s1);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>这段代码，我们希望让右值调用右值的重载函数f，左值调用左值的重载函数f，但最后结果均调用了左值重载函数</p>
<p>这是因为在函数g中，s本身是一个局部变量，拥有地址，是一个左值</p>
<p>这时候我们需要进行类型转换</p>
<h2 id="stdforward">std::forward</h2>
<p>我们当然可以使用<code>static_cast&lt;&gt;()</code>来进行转换，但是这里可以使用<code>forward&lt;&gt;()</code>函数进行转换，结合函数模板，使得代码更加方便易读</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">g</span><span style="color: #24292E">(</span><span style="color: #6F42C1">T</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #6F42C1">forward</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;(s));</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>这里在<strong>形参列表中</strong>的<code>T&amp;&amp; s</code>被称为<strong>万能引用或转发引用</strong></p>
<p>它既可以绑定左值也可以绑定右值，会在实例化时根据传入参数类型自动推导成对应类型</p>
<p>T的类型取决于传入的是左值还是右值</p>
<ul>
<li>左值：T被推导为实参类型的引用</li>
<li>右值：T被推导为实参类型的非引用</li>
</ul>
<p><code>forward</code>函数实现了一个类型转换</p>
<ul>
<li>若传入实参是右值，则forward函数会返回一个右值引用</li>
<li>若传入实参是左值，则函数模板T会被替换为该类型的引用，但此时会出现引用的引用(&amp;&amp;&amp;)，这时遵循<strong>引用折叠规则</strong>，得到类型的左值引用</li>
</ul>
<img src="/C++/%E5%AE%8C%E7%BE%8E%E8%BD%AC%E5%8F%91/image-20250722105549229.png" class="" title="引用折叠规则">
<p>即除了右值引用的右值引用被折叠为右值引用外，其余的只要有左值引用，就会被折叠为左值引用</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://izayoisakuye.github.io/C++/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="IzayoiSakuye">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="红魔咖啡馆">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | 红魔咖啡馆">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/C++/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/" class="post-title-link" itemprop="url">【C++】文件操作</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-07-31 17:26:36 / 修改时间：17:26:50" itemprop="dateCreated datePublished" datetime="2025-07-31T17:26:36+08:00">2025-07-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/C-C/" itemprop="url" rel="index"><span itemprop="name">C/C++</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="文件操作">文件操作</h1>
<p>C++中提供了文件流来对文件进行操作</p>
<p>需要引入头文件<code>fstream</code></p>
<p>文件类型：</p>
<ul>
<li>文本文件：以ASCII码存储</li>
<li>二进制文件：以二进制形式存储</li>
</ul>
<p>操作文件三大类：</p>
<ul>
<li>ofstream：写</li>
<li>ifstream：读</li>
<li>fstream：读/写</li>
</ul>
<h2 id="文本文件">文本文件</h2>
<h3 id="写文件">写文件</h3>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;fstream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    ofstream ofs;</span><span style="color: #6A737D"> // 创建流对象</span></span>
<span class="line"><span style="color: #24292E">    ofs.</span><span style="color: #6F42C1">open</span><span style="color: #24292E">(</span><span style="color: #032F62">"路径"</span><span style="color: #24292E">, </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">打开方式</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">)</span><span style="color: #6A737D"> // 指定打开方式</span></span>
<span class="line"><span style="color: #24292E">    ofs </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"写入的数据"</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 写内容</span></span>
<span class="line"><span style="color: #24292E">    ofs.</span><span style="color: #6F42C1">close</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 关闭文件</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>其中打开方式有：</p>
<table>
<thead>
<tr>
<th>打开方式</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>ios::in</td>
<td>读文件而打开文件</td>
</tr>
<tr>
<td>ios::out</td>
<td>写文件而打开文件</td>
</tr>
<tr>
<td>ios::ate</td>
<td>文件打开时指针位于文件末尾，可以移动指针进行读写</td>
</tr>
<tr>
<td>ios::app</td>
<td>所有读写操作都会添加到文件末尾</td>
</tr>
<tr>
<td>ios::trunc</td>
<td>若文件存在则先删除再创建</td>
</tr>
<tr>
<td>ios::binary</td>
<td>二进制方式操作</td>
</tr>
</tbody>
</table>
<p>可以使用|操作符来配合使用多个文件操作</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;fstream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  // 创建流对象</span></span>
<span class="line"><span style="color: #24292E">  ofstream ofs;</span></span>
<span class="line"><span style="color: #6A737D">  // 指定打开方式</span></span>
<span class="line"><span style="color: #24292E">  ofs.</span><span style="color: #6F42C1">open</span><span style="color: #24292E">(</span><span style="color: #032F62">"test.txt"</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ios</span><span style="color: #24292E">::out);</span></span>
<span class="line"><span style="color: #6A737D">  // 写内容</span></span>
<span class="line"><span style="color: #24292E">  ofs </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"name: Li Hua"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  ofs </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"age: male"</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #6A737D">  // 关闭文件</span></span>
<span class="line"><span style="color: #24292E">  ofs.</span><span style="color: #6F42C1">close</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="读文件">读文件</h3>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;fstream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    ifstream ofs;</span><span style="color: #6A737D"> // 创建流对象</span></span>
<span class="line"><span style="color: #24292E">    ofs.</span><span style="color: #6F42C1">open</span><span style="color: #24292E">(</span><span style="color: #032F62">"路径"</span><span style="color: #24292E">, </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">打开方式</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">)</span><span style="color: #6A737D"> // 打开文件并判断是否成功</span></span>
<span class="line"><span style="color: #24292E">    ofs </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"写入的数据"</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 读取数据</span></span>
<span class="line"><span style="color: #24292E">    ofs.</span><span style="color: #6F42C1">close</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 关闭文件</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>其中读取数据有多种方式：</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;fstream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;string&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  // 创建流对象</span></span>
<span class="line"><span style="color: #24292E">  ifstream ifs;</span></span>
<span class="line"><span style="color: #6A737D">  // 打开文件</span></span>
<span class="line"><span style="color: #24292E">  ifs.</span><span style="color: #6F42C1">open</span><span style="color: #24292E">(</span><span style="color: #032F62">"test.txt"</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ios</span><span style="color: #24292E">::in);</span></span>
<span class="line"><span style="color: #6A737D">  // 判断打开是否成功</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E">(</span><span style="color: #D73A49">!</span><span style="color: #24292E">ifs.</span><span style="color: #6F42C1">is_open</span><span style="color: #24292E">()){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"Open failed"</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 读取数据</span></span>
<span class="line"><span style="color: #6A737D">  // 方式1: 使用字符数组，但遇到空格也会停下</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">char</span><span style="color: #24292E"> buf[</span><span style="color: #005CC5">1024</span><span style="color: #24292E">]</span><span style="color: #D73A49">=</span><span style="color: #24292E">{};</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">(ifs</span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E">buf){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> buf </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 方式2： 使用getline，只有遇到回车才会停下</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">char</span><span style="color: #24292E"> buf2[</span><span style="color: #005CC5">1024</span><span style="color: #24292E">]</span><span style="color: #D73A49">=</span><span style="color: #24292E">{};</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">(ifs.</span><span style="color: #6F42C1">getline</span><span style="color: #24292E">(buf2, sizeof buf2)){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> buf </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 方式3：使用string</span></span>
<span class="line"><span style="color: #24292E">  string bufs;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">(</span><span style="color: #6F42C1">getline</span><span style="color: #24292E">(ifs, bufs)){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> buf </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 方式4：使用char，一个个读取</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">char</span><span style="color: #24292E"> c;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">((c</span><span style="color: #D73A49">=</span><span style="color: #24292E">ifs.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">())</span><span style="color: #D73A49">!=</span><span style="color: #24292E">EOF){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> c;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  ifs.</span><span style="color: #6F42C1">close</span><span style="color: #24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="二进制文件">二进制文件</h2>
<p>二进制打开方式指定为<code>ios::binary</code></p>
<h3 id="写文件-1">写文件</h3>
<p>注意：写入二进制文件时，不建议使用string，会引发指针异常</p>
<p>使用write方式来写入文件，而不是用流式输入，对一个对象我们使用<code>const char*</code>这样一个常量指针类型取得对象实例地址后进行写入</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;fstream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">char</span><span style="color: #24292E"> name[</span><span style="color: #005CC5">64</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  ofstream ofs;</span></span>
<span class="line"><span style="color: #24292E">  ofs.</span><span style="color: #6F42C1">open</span><span style="color: #24292E">(</span><span style="color: #032F62">"person.txt"</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ios</span><span style="color: #24292E">::out</span><span style="color: #D73A49">|</span><span style="color: #6F42C1">ios</span><span style="color: #24292E">::binary);</span></span>
<span class="line"><span style="color: #24292E">  person p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span><span style="color: #032F62">"Jack"</span><span style="color: #24292E">, </span><span style="color: #005CC5">18</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">  ofs.</span><span style="color: #6F42C1">write</span><span style="color: #24292E">((</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">char*</span><span style="color: #24292E">)</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">p, </span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(person));</span></span>
<span class="line"><span style="color: #24292E">  ofs.</span><span style="color: #6F42C1">close</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="读文件-1">读文件</h3>
<p>使用read方式来读文件</p>
<p>参数原型：<code>istream&amp; read(char *buffer, int len);</code></p>
<p>即字符指针buffer指向内存中一段存储空间，len为读写的字节数</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;fstream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">char</span><span style="color: #24292E"> name[</span><span style="color: #005CC5">64</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  ifstream ifs;</span></span>
<span class="line"><span style="color: #24292E">  ifs.</span><span style="color: #6F42C1">open</span><span style="color: #24292E">(</span><span style="color: #032F62">"person.txt"</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ios</span><span style="color: #24292E">::in</span><span style="color: #D73A49">|</span><span style="color: #6F42C1">ios</span><span style="color: #24292E">::binary);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E">(</span><span style="color: #D73A49">!</span><span style="color: #24292E">ifs.</span><span style="color: #6F42C1">is_open</span><span style="color: #24292E">()){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"Open failed"</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  person p;</span></span>
<span class="line"><span style="color: #24292E">  ifs.</span><span style="color: #6F42C1">read</span><span style="color: #24292E">((</span><span style="color: #D73A49">char</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E">)</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">p, </span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(person));</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"name: "</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">p.name</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"age: "</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">p.age</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  ifs.</span><span style="color: #6F42C1">close</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://izayoisakuye.github.io/C++/%E5%8D%8F%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="IzayoiSakuye">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="红魔咖啡馆">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | 红魔咖啡馆">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/C++/%E5%8D%8F%E7%A8%8B/" class="post-title-link" itemprop="url">【C++】协程</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-07-31 17:25:27 / 修改时间：17:26:15" itemprop="dateCreated datePublished" datetime="2025-07-31T17:25:27+08:00">2025-07-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/C-C/" itemprop="url" rel="index"><span itemprop="name">C/C++</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="协程">协程</h1>
<h2 id="协程函数">协程函数</h2>
<p>若一个函数中出现了以下三个关键字之一，则编译器就知道这是一个协程函数</p>
<ul>
<li>co_await</li>
<li>co_yield</li>
<li>co_return</li>
</ul>
<p>并且，协程函数必须返回一个符合要求的协程对象，若有返回值，需要通过协程对象获得</p>
<h2 id="协程对象">协程对象</h2>
<p>协程函数的返回值是自定义的一个协程对象</p>
<h3 id="模板">模板</h3>
<p>通常需要内嵌一个名为<code>promise_type</code>的结构定义，内部需要实现一些函数</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;coroutine&gt;</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">promise_type</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get_return_object</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">suspend_never</span><span style="color: #24292E"> </span><span style="color: #6F42C1">initial_suspend</span><span style="color: #24292E">() { </span><span style="color: #D73A49">return</span><span style="color: #24292E"> {}; }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">suspend_never</span><span style="color: #24292E"> </span><span style="color: #6F42C1">final_suspend</span><span style="color: #24292E">() </span><span style="color: #D73A49">noexcept</span><span style="color: #24292E"> { </span><span style="color: #D73A49">return</span><span style="color: #24292E"> {}; }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">return_void</span><span style="color: #24292E">() {}</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">unhandled_exception</span><span style="color: #24292E">() {}</span></span>
<span class="line"><span style="color: #24292E">  };</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E"> </span><span style="color: #6F42C1">coroFunc</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"hello world"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">co_return</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  MyCoroutine coro </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">coroFunc</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>此时coroFunc刚开始执行就被挂起，MyCoroutine对象也没有实现任何协程，故后面的代码不会执行，稍微进行修改</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;coroutine&gt;</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">promise_type</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get_return_object</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #6A737D">      // 获得协程句柄</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">coroutine_handle</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">promise_type</span><span style="color: #24292E">&gt;::</span><span style="color: #6F42C1">from_promise</span><span style="color: #24292E">(</span><span style="color: #D73A49">*</span><span style="color: #005CC5">this</span><span style="color: #24292E">));</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">suspend_always</span><span style="color: #24292E"> </span><span style="color: #6F42C1">initial_suspend</span><span style="color: #24292E">() { </span><span style="color: #D73A49">return</span><span style="color: #24292E"> {}; }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">suspend_always</span><span style="color: #24292E"> </span><span style="color: #6F42C1">final_suspend</span><span style="color: #24292E">() </span><span style="color: #D73A49">noexcept</span><span style="color: #24292E"> { </span><span style="color: #D73A49">return</span><span style="color: #24292E"> {}; }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">return_void</span><span style="color: #24292E">() {}</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">unhandled_exception</span><span style="color: #24292E">() {}</span></span>
<span class="line"><span style="color: #24292E">  };</span></span>
<span class="line"><span style="color: #6A737D">  // 通过构造函数传给新创建的对象</span></span>
<span class="line"><span style="color: #6A737D">  // 调用了协程句柄的resume函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">coroutine_handle</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">promise_type</span><span style="color: #24292E">&gt; </span><span style="color: #E36209">h</span><span style="color: #24292E">) : </span><span style="color: #6F42C1">handle</span><span style="color: #24292E">(h) {}</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">resume</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (handle) {</span></span>
<span class="line"><span style="color: #24292E">      handle.</span><span style="color: #6F42C1">resume</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 恢复协程执行</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::coroutine_handle</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">promise_type</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> handle;</span><span style="color: #6A737D"> // 封装了一个指向协程帧的指针，并提供函数</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E"> </span><span style="color: #6F42C1">coroFunc</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"hello world"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">co_return</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  MyCoroutine coro </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">coroFunc</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  coro.</span><span style="color: #6F42C1">resume</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 恢复协程执行</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="返回值">返回值</h3>
<p>若需要提供返回值，则需要将return_void改为return_value，并添加get函数存储并获取反返回值：</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;coroutine&gt;</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">promise_type</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get_return_object</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #6A737D">      // 获得协程句柄</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">coroutine_handle</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">promise_type</span><span style="color: #24292E">&gt;::</span><span style="color: #6F42C1">from_promise</span><span style="color: #24292E">(</span><span style="color: #D73A49">*</span><span style="color: #005CC5">this</span><span style="color: #24292E">));</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">suspend_always</span><span style="color: #24292E"> </span><span style="color: #6F42C1">initial_suspend</span><span style="color: #24292E">() { </span><span style="color: #D73A49">return</span><span style="color: #24292E"> {}; }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">suspend_always</span><span style="color: #24292E"> </span><span style="color: #6F42C1">final_suspend</span><span style="color: #24292E">() </span><span style="color: #D73A49">noexcept</span><span style="color: #24292E"> { </span><span style="color: #D73A49">return</span><span style="color: #24292E"> {}; }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">return_value</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">v</span><span style="color: #24292E">) {_value </span><span style="color: #D73A49">=</span><span style="color: #24292E"> v;}</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">unhandled_exception</span><span style="color: #24292E">() {}</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get</span><span style="color: #24292E">(){</span><span style="color: #D73A49">return</span><span style="color: #24292E"> _value;}</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">int</span><span style="color: #24292E"> _value;</span><span style="color: #6A737D"> // 存储协程返回值</span></span>
<span class="line"><span style="color: #24292E">  };</span></span>
<span class="line"><span style="color: #6A737D">  // 通过构造函数传给新创建的对象</span></span>
<span class="line"><span style="color: #6A737D">  // 调用了协程句柄的resume函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">coroutine_handle</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">promise_type</span><span style="color: #24292E">&gt; </span><span style="color: #E36209">h</span><span style="color: #24292E">) : </span><span style="color: #6F42C1">handle</span><span style="color: #24292E">(h) {}</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    handle.</span><span style="color: #6F42C1">resume</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 恢复协程执行</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> handle.</span><span style="color: #6F42C1">promise</span><span style="color: #24292E">().</span><span style="color: #6F42C1">get</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 获取协程返回值</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::coroutine_handle</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">promise_type</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> handle;</span><span style="color: #6A737D"> // 封装了一个指向协程帧的指针，并提供函数</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E"> </span><span style="color: #6F42C1">coroFunc</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">"hello world"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">co_return</span><span style="color: #24292E"> </span><span style="color: #005CC5">666</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  MyCoroutine coro </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">coroFunc</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> value </span><span style="color: #D73A49">=</span><span style="color: #24292E"> coro.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"value= "</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> value </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="co_yield">co_yield</h3>
<p>如果要使用co_yield，需要添加yield_value函数</p>
<p>由于co_yield不是函数执行的结尾，故需要返回一个可等待对象，并使用co_await对该对象进行等待，即</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">co_yield</span><span style="color: #24292E"> v;</span></span>
<span class="line"><span style="color: #D73A49">co_await</span><span style="color: #24292E"> promise.</span><span style="color: #6F42C1">yield_value</span><span style="color: #24292E">(v);</span></span></code></pre></div></div></figure>
<p>或者返回一个suspend_always对象，让程序挂起</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">auto</span><span style="color: #24292E"> </span><span style="color: #6F42C1">yield_value</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">v</span><span style="color: #24292E">) { _value </span><span style="color: #D73A49">=</span><span style="color: #24292E"> v; </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::suspend_always{};}</span></span></code></pre></div></div></figure>
<p>为方便使用，还可以重载一下布尔运算符，通过调用handle的done函数来判断协程是否执行完毕</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">operator</span><span style="color: #24292E"> </span><span style="color: #6F42C1">bool</span><span style="color: #24292E">(){</span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">!</span><span style="color: #24292E">handle.</span><span style="color: #6F42C1">done</span><span style="color: #24292E">();}</span></span></code></pre></div></div></figure>
<p>在主函数中，就可以通过一个循环对协程执行进行挂起和继续操作，并获得每次的返回值</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">MyCoroutine coro </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">coroFunc</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #D73A49">while</span><span style="color: #24292E">(coro){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> value </span><span style="color: #D73A49">=</span><span style="color: #24292E"> coro.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"value= "</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> value </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="应用实现发生器generator">应用：实现发生器(Generator)</h3>
<blockquote>
<p>一个斐波那契数列生成器</p>
</blockquote>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;coroutine&gt;</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">promise_type</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get_return_object</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #6A737D">      // 获得协程句柄</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">coroutine_handle</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">promise_type</span><span style="color: #24292E">&gt;::</span><span style="color: #6F42C1">from_promise</span><span style="color: #24292E">(</span><span style="color: #D73A49">*</span><span style="color: #005CC5">this</span><span style="color: #24292E">));</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">suspend_always</span><span style="color: #24292E"> </span><span style="color: #6F42C1">initial_suspend</span><span style="color: #24292E">() { </span><span style="color: #D73A49">return</span><span style="color: #24292E"> {}; }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">suspend_always</span><span style="color: #24292E"> </span><span style="color: #6F42C1">final_suspend</span><span style="color: #24292E">() </span><span style="color: #D73A49">noexcept</span><span style="color: #24292E"> { </span><span style="color: #D73A49">return</span><span style="color: #24292E"> {}; }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">return_value</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">v</span><span style="color: #24292E">) {_value </span><span style="color: #D73A49">=</span><span style="color: #24292E"> v;}</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> </span><span style="color: #6F42C1">yield_value</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">v</span><span style="color: #24292E">) { _value </span><span style="color: #D73A49">=</span><span style="color: #24292E"> v; </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::suspend_always{};}</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">unhandled_exception</span><span style="color: #24292E">() {}</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get</span><span style="color: #24292E">(){</span><span style="color: #D73A49">return</span><span style="color: #24292E"> _value;}</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">int</span><span style="color: #24292E"> _value;</span><span style="color: #6A737D"> // 存储协程返回值</span></span>
<span class="line"><span style="color: #24292E">  };</span></span>
<span class="line"><span style="color: #6A737D">  // 通过构造函数传给新创建的对象</span></span>
<span class="line"><span style="color: #6A737D">  // 调用了协程句柄的resume函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">coroutine_handle</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">promise_type</span><span style="color: #24292E">&gt; </span><span style="color: #E36209">h</span><span style="color: #24292E">) : </span><span style="color: #6F42C1">handle</span><span style="color: #24292E">(h) {}</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">operator</span><span style="color: #24292E"> </span><span style="color: #6F42C1">bool</span><span style="color: #24292E">(){</span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">!</span><span style="color: #24292E">handle.</span><span style="color: #6F42C1">done</span><span style="color: #24292E">();}</span><span style="color: #6A737D"> // 重载bool运算符，判断协程是否完成</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    handle.</span><span style="color: #6F42C1">resume</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 恢复协程执行</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> handle.</span><span style="color: #6F42C1">promise</span><span style="color: #24292E">().</span><span style="color: #6F42C1">get</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 获取协程返回值</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::coroutine_handle</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">promise_type</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> handle;</span><span style="color: #6A737D"> // 封装了一个指向协程帧的指针，并提供函数</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fib</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">, b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">, n </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">40</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">co_yield</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">co_yield</span><span style="color: #24292E"> b;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">(n</span><span style="color: #D73A49">--</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> r </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a</span><span style="color: #D73A49">+</span><span style="color: #24292E">b;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">co_yield</span><span style="color: #24292E"> r;</span><span style="color: #6A737D"> // 每生成一项就把协程挂起，等待外部调用resume函数</span></span>
<span class="line"><span style="color: #24292E">    a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> b;</span></span>
<span class="line"><span style="color: #24292E">    b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> r;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">co_return</span><span style="color: #24292E"> a</span><span style="color: #D73A49">+</span><span style="color: #24292E">b;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  MyCoroutine coro </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fib</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">(coro){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> value </span><span style="color: #D73A49">=</span><span style="color: #24292E"> coro.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"value= "</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> value </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="co_await">co_await</h3>
<p>语法：<code>co_await 表达式</code></p>
<p>表达式可以是可等待对象，重载co_await()运算符，也可以是一个promise类型的await_transform()函数，将表达式作为函数参数并返回可等待对象</p>
<p>可等待类型awaitable的定义如下：</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">awaitable</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">bool</span><span style="color: #24292E"> </span><span style="color: #6F42C1">await_ready</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">await_suspend</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">coroutine_handle</span><span style="color: #24292E">&lt;&gt; </span><span style="color: #E36209">h</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> </span><span style="color: #6F42C1">await_resume</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">};</span></span></code></pre></div></div></figure>
<p>调用对象时，首先调用await_ready()，若返回值为false，则调用await_suspend()让程序挂起，当协程继续执行后，会接下来执行await_resume()，若返回值为true，则直接执行await_resume()</p>
<p>内置类型suspend_always中await_ready()返回false，其余两个函数什么都不做，作用是将程序挂起</p>
<p>内置类型suspend_never中await_ready()返回true，其余两个函数什么都不做</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;coroutine&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;thread&gt;</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">promise</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E">: std::</span><span style="color: #6F42C1">coroutine_handle</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">promise</span><span style="color: #24292E">&gt;{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #6F42C1">promise_type</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> ::</span><span style="color: #6F42C1">promise</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">promise</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get_return_object</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> {</span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E">::</span><span style="color: #6F42C1">from_promise</span><span style="color: #24292E">(</span><span style="color: #D73A49">*</span><span style="color: #005CC5">this</span><span style="color: #24292E">)};</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> </span><span style="color: #6F42C1">initial_suspend</span><span style="color: #24292E">() { </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::suspend_always{}; }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> </span><span style="color: #6F42C1">final_suspend</span><span style="color: #24292E">() </span><span style="color: #D73A49">noexcept</span><span style="color: #24292E"> { </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::suspend_always{}; }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">unhandled_exception</span><span style="color: #24292E">() {}</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">awaitable</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">bool</span><span style="color: #24292E"> </span><span style="color: #6F42C1">await_ready</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"await_ready called"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 返回false表示协程需要挂起</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">await_suspend</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">coroutine_handle</span><span style="color: #24292E">&lt;&gt; </span><span style="color: #E36209">h</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"await_suspend called"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #6A737D">    // 在这里可以执行一些异步操作</span></span>
<span class="line"><span style="color: #6A737D">    // ...</span></span>
<span class="line"><span style="color: #24292E">      h.</span><span style="color: #6F42C1">resume</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 恢复协程执行</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> </span><span style="color: #6F42C1">await_resume</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"await_resume called"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">666</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 返回协程的结果</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};  </span></span>
<span class="line"></span>
<span class="line"><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E"> </span><span style="color: #6F42C1">coroFunc</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"coroFunc started"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">co_await</span><span style="color: #24292E"> awaitable{};</span><span style="color: #6A737D"> // 使用协程挂起</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"coroFunc resumed"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  MyCoroutine coro </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">coroFunc</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"main started"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  coro.</span><span style="color: #6F42C1">resume</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 恢复协程执行</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"main finished"</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">main started</span></span>
<span class="line"><span style="color: #24292E">coroFunc started</span></span>
<span class="line"><span style="color: #24292E">await_ready called</span></span>
<span class="line"><span style="color: #24292E">await_suspend called</span></span>
<span class="line"><span style="color: #24292E">await_resume called</span></span>
<span class="line"><span style="color: #24292E">coroFunc resumed</span></span>
<span class="line"><span style="color: #24292E">main finished</span></span></code></pre></div></div></figure>
<p>根据返回结果，证明了函数调用的顺序是ready-&gt;suspend-&gt;resume</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://izayoisakuye.github.io/C++/%E5%BC%95%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="IzayoiSakuye">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="红魔咖啡馆">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | 红魔咖啡馆">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/C++/%E5%BC%95%E7%94%A8/" class="post-title-link" itemprop="url">【C++】引用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-07-31 17:24:14 / 修改时间：17:24:56" itemprop="dateCreated datePublished" datetime="2025-07-31T17:24:14+08:00">2025-07-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/C-C/" itemprop="url" rel="index"><span itemprop="name">C/C++</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="引用">引用</h1>
<h2 id="语法">语法</h2>
<p>本质：引用在内部的实现是一个<strong>指针常量</strong>（指针指向不可修改，但指针指向的值可修改）</p>
<p>作用：即给变量起别名，即两者操作同一块内存</p>
<p>语法：<code>&lt;数据类型&gt; &amp;&lt;别名&gt; = &lt;原名&gt;</code></p>
<p>注意：</p>
<ul>
<li>引用必须初始化</li>
<li>引用在初始化后不可改变</li>
</ul>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a;</span><span style="color: #6A737D"> // b 是 a 的引用</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"a: "</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> a </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl; </span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"b: "</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> b </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">20</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 修改 b 的值, a 的值也会改变</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"a: "</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> a </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"b: "</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> b </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="引用作为函数参数">引用作为函数参数</h2>
<p>作用：函数传参时可以让形参修饰实参</p>
<p>优点：简化指针修改实参</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Swap</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">b</span><span style="color: #24292E">){</span><span style="color: #6A737D"> // 使用形参修饰实参</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> temp </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">  a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> b;</span></span>
<span class="line"><span style="color: #24292E">  b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> temp;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">20</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">Swap</span><span style="color: #24292E">(a, b);</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"a: "</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> a </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"b: "</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> b </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="引用作为函数返回值">引用作为函数返回值</h2>
<p>作用：</p>
<ul>
<li>引用可以作为函数的返回值存在</li>
<li>函数的调用可以作为左值</li>
</ul>
<p><strong>不要返回局部变量引用</strong></p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">// 函数返回引用</span></span>
<span class="line"><span style="color: #6A737D">// 注意：返回局部变量的引用是危险的，因为局部变量在函数结束后会被销毁</span></span>
<span class="line"><span style="color: #D73A49">int&amp;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">test</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span><span style="color: #6A737D"> //静态变量，存在全局区</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> a;</span><span style="color: #6A737D"> // 返回局部变量的引用</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">ref </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">test</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"ref: "</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> ref </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span><span style="color: #6A737D"> // 输出 10</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">test</span><span style="color: #24292E">() </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">20</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 返回引用的函数的调用可以作为左值, 相当于直接对a赋值</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">"ref: "</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> ref </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span><span style="color: #6A737D"> // 输出 20</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>## 常量引用</p>
<p>常量引用常用来修饰形参，防止误操作</p>
<figure class="shiki c++"><div class="codeblock"><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">print</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">val</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #6A737D">  // 由于此处是引用，在函数内部对val进行修改，外部的b也会改变</span></span>
<span class="line"><span style="color: #6A737D">  // 形参前加const后，val变成了一个常量引用，内部val就不允许修改了</span></span>
<span class="line"><span style="color: #6A737D">  // val = 1000; </span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> val;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  // 常量引用，相当于编译器自动创建了一个临时空间，并将ref指向该空间</span></span>
<span class="line"><span style="color: #6A737D">  // 此时不许修改</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int&amp;</span><span style="color: #24292E"> ref </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">; </span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #6A737D">  // 实际应用</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">100</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">print</span><span style="color: #24292E">(b);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/list/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/list/">1</a><span class="space">&hellip;</span><a class="page-number" href="/list/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/list/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/list/page/11/">11</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/list/page/5/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">IzayoiSakuye</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

<!-- hexo injector body_end start -->
<script src="https://cdn.jsdelivr.net/npm/hexo-shiki-plugin@latest/lib/codeblock.js"></script>

  <script>
  const CODE_CONFIG = {
    beautify: true,
    highlightCopy: true,
    highlightLang: true,
    highlightHeightLimit: undefined,
    isHighlightShrink: false,
    copy: {
      success: 'Copy Success',
      error: 'Copy Error',
      noSupport: 'Browser Not Support',
    }
  };
  console.log(
    `%c hexo-shiki-plugin %c v1.0.27 %c https://github.com/nova1751/hexo-shiki-plugin`,
    "color: #fff; background: #5f5f5f",
    "color: #fff; background: #80c8f8",
    ""
  );
  </script>
  <!-- hexo injector body_end end --></body>
</html>
