<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>【C++STL】Algorithm库</title>
    <url>/C++/Algorithm%E5%BA%93/</url>
    <content><![CDATA[<h1 id="algorithm库">Algorithm库</h1>
<h2 id="copy_if">copy_if()</h2>
<p>语法：<code>copy_if(first, last, out, pred)</code></p>
<p>作用：按传入的对象pred条件复制容器内容</p>
<blockquote>
<p>如实现查找string数组中指定单词</p>
</blockquote>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">, </span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">P</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt; </span><span style="color: #6F42C1">Filter</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">vec</span><span style="color: #24292E">, </span><span style="color: #6F42C1">P</span><span style="color: #24292E"> </span><span style="color: #E36209">pred</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::vector</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">T</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> res;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">copy_if</span><span style="color: #24292E">(vec.</span><span style="color: #6F42C1">begin</span><span style="color: #24292E">(),vec.</span><span style="color: #6F42C1">end</span><span style="color: #24292E">(),</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">back_inserter</span><span style="color: #24292E">(res),pred);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> res;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(</span><span style="color: #D73A49">void</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::string word</span><span style="color: #D73A49">=</span><span style="color: #032F62">&quot;apple&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> hasWord </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [</span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">word</span><span style="color: #24292E">](</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">string</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">) {</span><span style="color: #D73A49">return</span><span style="color: #24292E"> s. </span><span style="color: #6F42C1">find</span><span style="color: #24292E">(word) </span><span style="color: #D73A49">!=</span><span style="color: #24292E"> s.npos;};</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::vector</span><span style="color: #D73A49">&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::string</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> words{</span><span style="color: #032F62">&quot;An apple&quot;</span><span style="color: #24292E">,</span><span style="color: #032F62">&quot;big apple&quot;</span><span style="color: #24292E">,</span><span style="color: #032F62">&quot;orange&quot;</span><span style="color: #24292E">,</span><span style="color: #032F62">&quot;green apple&quot;</span><span style="color: #24292E">,</span><span style="color: #032F62">&quot;grape&quot;</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::vector</span><span style="color: #D73A49">&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::string</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> res </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Filter</span><span style="color: #24292E">(words, hasWord);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">auto</span><span style="color: #24292E"> s:res)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> s </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot; &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E"> </span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>C++20中，在range库中进行了拓展</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(</span><span style="color: #D73A49">void</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::string word</span><span style="color: #D73A49">=</span><span style="color: #032F62">&quot;apple&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> hasWord </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [</span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">word</span><span style="color: #24292E">](</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">string</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">) {</span><span style="color: #D73A49">return</span><span style="color: #24292E"> s. </span><span style="color: #6F42C1">find</span><span style="color: #24292E">(word) </span><span style="color: #D73A49">!=</span><span style="color: #24292E"> s.npos;};</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::vector</span><span style="color: #D73A49">&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::string</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> words{</span><span style="color: #032F62">&quot;An apple&quot;</span><span style="color: #24292E">,</span><span style="color: #032F62">&quot;big apple&quot;</span><span style="color: #24292E">,</span><span style="color: #032F62">&quot;orange&quot;</span><span style="color: #24292E">,</span><span style="color: #032F62">&quot;green apple&quot;</span><span style="color: #24292E">,</span><span style="color: #032F62">&quot;grape&quot;</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::vector</span><span style="color: #D73A49">&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::string</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> res ;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">ranges</span><span style="color: #24292E">::</span><span style="color: #6F42C1">copy_if</span><span style="color: #24292E">(words, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">back_inserter</span><span style="color: #24292E">(res),hasWord);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">auto</span><span style="color: #24292E"> s:res)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> s </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot; &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E"> </span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="partition">partition()</h2>
<p>语法：<code>copy_if(first, last, pred)</code></p>
<p>作用：将一个序列按条件分割</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(</span><span style="color: #D73A49">void</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> numbers{</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">23</span><span style="color: #24292E">,</span><span style="color: #005CC5">4</span><span style="color: #24292E">,</span><span style="color: #005CC5">5</span><span style="color: #24292E">,</span><span style="color: #005CC5">67</span><span style="color: #24292E">,</span><span style="color: #005CC5">8</span><span style="color: #24292E">,</span><span style="color: #005CC5">67</span><span style="color: #24292E">,</span><span style="color: #005CC5">23</span><span style="color: #24292E">,</span><span style="color: #005CC5">20</span><span style="color: #24292E">,</span><span style="color: #005CC5">11</span><span style="color: #24292E">,</span><span style="color: #005CC5">32</span><span style="color: #24292E">,</span><span style="color: #005CC5">33</span><span style="color: #24292E">,</span><span style="color: #005CC5">45</span><span style="color: #24292E">,</span><span style="color: #005CC5">17</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> bound1 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">partition</span><span style="color: #24292E">(numbers.</span><span style="color: #6F42C1">begin</span><span style="color: #24292E">(),numbers.</span><span style="color: #6F42C1">end</span><span style="color: #24292E">(), [](</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">v</span><span style="color: #24292E">){</span><span style="color: #D73A49">return</span><span style="color: #24292E"> v</span><span style="color: #D73A49">%</span><span style="color: #005CC5">3</span><span style="color: #24292E"> </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;});</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> bound2 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">partition</span><span style="color: #24292E">(bound1, numbers. </span><span style="color: #6F42C1">end</span><span style="color: #24292E">(), [](</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">v</span><span style="color: #24292E">){</span><span style="color: #D73A49">return</span><span style="color: #24292E"> v</span><span style="color: #D73A49">%</span><span style="color: #005CC5">3</span><span style="color: #24292E"> </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;});</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">\n</span><span style="color: #032F62">{x=3k}:</span><span style="color: #005CC5">\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">for_each</span><span style="color: #24292E">(numbers.</span><span style="color: #6F42C1">begin</span><span style="color: #24292E">(),bound1, [](</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">v</span><span style="color: #24292E">){</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> v </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;&quot;</span><span style="color: #24292E">;});</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">\n</span><span style="color: #032F62">{x=3k+1}:</span><span style="color: #005CC5">\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">for_each</span><span style="color: #24292E">(bound1,bound2, [](</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">v</span><span style="color: #24292E">){</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> v </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;&quot;</span><span style="color: #24292E">;});</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">\n</span><span style="color: #032F62">{x=3k+2}:</span><span style="color: #005CC5">\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">for_each</span><span style="color: #24292E">(bound2,numbers.</span><span style="color: #6F42C1">end</span><span style="color: #24292E">(), [](</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">v</span><span style="color: #24292E">){</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> v </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;&quot;</span><span style="color: #24292E">;});</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="序列运算">序列运算</h2>
<ul>
<li>set_difference()：将不是两个序列共有的元素拷贝到单独的元素中（差集）</li>
<li>set_symmetric_difference()：上述加了绝对值（对称差集）</li>
<li>set_intersection()</li>
<li>set_union()</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(</span><span style="color: #D73A49">void</span><span style="color: #24292E">){</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> numbers1{</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">2</span><span style="color: #24292E">,</span><span style="color: #005CC5">3</span><span style="color: #24292E">,</span><span style="color: #005CC5">4</span><span style="color: #24292E">,</span><span style="color: #005CC5">4</span><span style="color: #24292E">,</span><span style="color: #005CC5">5</span><span style="color: #24292E">,</span><span style="color: #005CC5">6</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> numbers2{</span><span style="color: #005CC5">9</span><span style="color: #24292E">,</span><span style="color: #005CC5">8</span><span style="color: #24292E">,</span><span style="color: #005CC5">7</span><span style="color: #24292E">,</span><span style="color: #005CC5">6</span><span style="color: #24292E">,</span><span style="color: #005CC5">5</span><span style="color: #24292E">,</span><span style="color: #005CC5">5</span><span style="color: #24292E">,</span><span style="color: #005CC5">4</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> result;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">sort</span><span style="color: #24292E">(numbers1.</span><span style="color: #6F42C1">begin</span><span style="color: #24292E">(),numbers1.</span><span style="color: #6F42C1">end</span><span style="color: #24292E">());</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">sort</span><span style="color: #24292E">(numbers2.</span><span style="color: #6F42C1">begin</span><span style="color: #24292E">(),numbers2.</span><span style="color: #6F42C1">end</span><span style="color: #24292E">());</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">set_symmetric_difference</span><span style="color: #24292E">(numbers1.</span><span style="color: #6F42C1">begin</span><span style="color: #24292E">(),numbers1.</span><span style="color: #6F42C1">end</span><span style="color: #24292E">(),</span></span>
<span class="line"><span style="color: #24292E">    numbers2.</span><span style="color: #6F42C1">begin</span><span style="color: #24292E">(),numbers2.</span><span style="color: #6F42C1">end</span><span style="color: #24292E">(),</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">back_insert_iterator</span><span style="color: #24292E">(result));</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">auto</span><span style="color: #24292E"> v:result)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> v </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot; &quot;</span><span style="color: #24292E">;	</span></span>
<span class="line"><span style="color: #24292E">   </span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="序列操作">序列操作</h2>
<ul>
<li>for_each()</li>
<li>transform()</li>
<li>remove_if()</li>
<li>reduce()</li>
<li>inner_product()</li>
<li>transform_reduce()</li>
<li>transform_exclusive_scan()</li>
</ul>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
        <tag>STL</tag>
      </tags>
  </entry>
  <entry>
    <title>【C++】Niebloid &amp; CPO</title>
    <url>/C++/Niebloid%20&amp;%20CPO/</url>
    <content><![CDATA[<h1 id="niebloid-cpo">Niebloid &amp; CPO</h1>
<h2 id="实参依赖查找adl">实参依赖查找(ADL)</h2>
<p>C++中，编译器处理代码中出现的所有标识符时，都需要查找他的出处</p>
<p>为了防止名称冲突，可以使用命名空间来限定作用域，使用时可以使用有限定的标识符：命名空间+作用域解析运算符+标识符，相对应的，没有限定的称为未限定的标识符，编译器对两种标识符进行两种查找</p>
<p>其中，未限定的标识符使用实参依赖查找，除了常规查找范围，编译器还会将<strong>函数实参所在的命名空间</strong>加入查找范围</p>
<p><strong>ADL只适用于函数与函数模板</strong></p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">hello</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;[global]hello&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">char*</span><span style="color: #24292E">)x</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">cat</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">A</span></span>
<span class="line"><span style="color: #24292E">  {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::string s;</span></span>
<span class="line"><span style="color: #24292E">    operator </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">char*</span><span style="color: #24292E">() </span><span style="color: #D73A49">const</span><span style="color: #24292E">{</span><span style="color: #D73A49">return</span><span style="color: #24292E"> s.</span><span style="color: #6F42C1">c_str</span><span style="color: #24292E">();}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  };</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">hello</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">A</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;[cat]hello&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">char*</span><span style="color: #24292E">)x</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  ::</span><span style="color: #6F42C1">hello</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;world&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">hello</span><span style="color: #24292E">(</span><span style="color: #6F42C1">cat</span><span style="color: #24292E">::A{</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">string</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;world&quot;</span><span style="color: #24292E">)});</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">[global]helloworld</span></span>
<span class="line"><span style="color: #24292e">[cat]helloworld</span></span></code></pre></div></div></figure>
<h2 id="定制点">定制点</h2>
<p>如标准库中的函数，允许用户在自己的命名空间为某些类型进行函数重载，并能通过ADL找到这个函数的函数称为定制点，如swap、begin、end</p>
<p>标准库中其他函数在使用到定制点函数时，也会通过ADL找到自定义的定制点函数</p>
<p>如reverse函数中用到了swap函数，若此时的类型是我们自定义的swap函数的重载类型，reverse的时候就会使用我们自定义的swap函数</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">cat</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">MyType</span><span style="color: #24292E">{</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  };</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">MyType2</span><span style="color: #24292E">{</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  };</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">swap</span><span style="color: #24292E">(</span><span style="color: #6F42C1">MyType</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #6F42C1">MyType</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;Custom Swap&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T1</span><span style="color: #24292E">, </span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T2</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">do_sth</span><span style="color: #24292E">(</span><span style="color: #6F42C1">T1</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #6F42C1">T2</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::swap;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">swap</span><span style="color: #24292E">(a,b);</span></span>
<span class="line"><span style="color: #24292E">} </span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">cat</span><span style="color: #24292E">::MyType a;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">cat</span><span style="color: #24292E">::MyType b;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">do_sth</span><span style="color: #24292E">(a,b);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::string s1{</span><span style="color: #032F62">&quot;hello&quot;</span><span style="color: #24292E">}, s2{</span><span style="color: #032F62">&quot;world&quot;</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">do_sth</span><span style="color: #24292E">(s1,s2);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">cat</span><span style="color: #24292E">::MyType2 c;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">cat</span><span style="color: #24292E">::MyType2 d;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">do_sth</span><span style="color: #24292E">(c,d);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>例如该函数中，</p>
<p>当实参类型是MyType时，进入do_sth时，由于using声明，首先找到了std::swap，后面编译器通过ADL找到了cat::swap，而后者优先级更高，故采用后者</p>
<p>优先级的基本原则为<strong>越专用越优先</strong></p>
<p>当实参类型为基本类型或MyType2时，由于cat中没有对应的重载函数，故使用std的swap函数，但若没有using声明，这两个在cat命名空间，全局命名空间都找不到swap函数，会报错</p>
<h2 id="定制点对象cpo">定制点对象(CPO)</h2>
<p>C++20后，要对定制点函数进行类型检查，而ADL下直接使用用户函数重载则绕过了检查，因此，C++20中提出了定制点对象</p>
<p>将do_sth函数中的swap进行修改</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">do_sth</span><span style="color: #24292E">(</span><span style="color: #6F42C1">T1</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #6F42C1">T2</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">ranges</span><span style="color: #24292E">::</span><span style="color: #6F42C1">swap</span><span style="color: #24292E">(a,b);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>此时<code>std::ranges::swap</code>不是一个函数，而是一个函数对象，其中封装了未限定名的调用</p>
<p>由于是个对象，因此不会进行ADL，也就不会直接调用用户自定义的重载函数，而是经过定制点对象进行实参类型检查，再调用真swap函数进行ADL查找</p>
<h2 id="neibloid">Neibloid</h2>
<p>ranges库中称为算法函数对象（AFO），是一种CPO</p>
<p>为了避免使用非限定名算法函数时由于ADL无法调用ranges库，会调用其他命名空间的同名函数，使用CPO对ADL进行屏蔽</p>
<p>Neibloid是用于实现ranges的函数对象，并且为了保证调用，它使用CPO来实现了对ADL的屏蔽</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;vector&gt;</span></span>
<span class="line"><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">cat</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">MyType</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> v;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">bool</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">==</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">MyType</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">other</span><span style="color: #24292E">) </span><span style="color: #D73A49">const</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> v </span><span style="color: #D73A49">==</span><span style="color: #24292E"> other.v;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  };</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">decltype</span><span style="color: #24292E">(</span><span style="color: #D73A49">auto</span><span style="color: #24292E">) </span><span style="color: #6F42C1">find</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">MyType</span><span style="color: #24292E">&gt;::iterator</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> first, </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">MyType</span><span style="color: #24292E">&gt;::iterator </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> last, </span><span style="color: #D73A49">const</span><span style="color: #24292E"> MyType </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">value ){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;Custom&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">find</span><span style="color: #24292E">(first, last, value);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::vector</span><span style="color: #D73A49">&lt;</span><span style="color: #6F42C1">cat</span><span style="color: #24292E">::MyType</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> v1{{</span><span style="color: #005CC5">1</span><span style="color: #24292E">},{</span><span style="color: #005CC5">2</span><span style="color: #24292E">},{</span><span style="color: #005CC5">3</span><span style="color: #24292E">},{</span><span style="color: #005CC5">4</span><span style="color: #24292E">}};</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">cat</span><span style="color: #24292E">::MyType value{</span><span style="color: #005CC5">3</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">ranges</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> it </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">find</span><span style="color: #24292E">(v1.</span><span style="color: #6F42C1">begin</span><span style="color: #24292E">(), v1.</span><span style="color: #6F42C1">end</span><span style="color: #24292E">(),value);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (it</span><span style="color: #D73A49">!=</span><span style="color: #24292E">v1.</span><span style="color: #6F42C1">end</span><span style="color: #24292E">()){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;Found value: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">it-&gt;v</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">else</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;Value not found&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>我们在这定义了自己的find函数，又在主函数中使用using
namespace并调用find</p>
<p>由于ranges库中算法函数对象的存在，ADL不起作用，自定义函数不会被调用</p>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
      </tags>
  </entry>
  <entry>
    <title>【C++】decltype</title>
    <url>/C++/decltype/</url>
    <content><![CDATA[<h1 id="decltype">decltype</h1>
<h2 id="用法">用法</h2>
<p>该运算符可以获得一个变量或表达式的值的类型</p>
<p>语法:<code>decltype(变量\表达式)</code></p>
<p>用于变量时，可以获得变量类型、引用类型、cv限定符</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">3</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">decltype</span><span style="color: #24292E">(a) b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">5</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // b的类型是int</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">3</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">decltype</span><span style="color: #24292E">(a) b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">5</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // b的类型是const int</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">3</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int&amp;</span><span style="color: #24292E"> b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #D73A49">decltype</span><span style="color: #24292E">(b) c </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a;</span><span style="color: #6A737D"> // c的类型是int&amp;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">s</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">double</span><span style="color: #24292E"> a</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">decltype</span><span style="color: #24292E">(</span><span style="color: #6F42C1">s</span><span style="color: #24292E">::a) a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0.1</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // a的类型是double</span></span>
<span class="line"><span style="color: #24292E">s t;</span></span>
<span class="line"><span style="color: #D73A49">decltype</span><span style="color: #24292E">(t.a) a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0.1</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // a的类型是double</span></span></code></pre></div></div></figure>
<p>用于表达式时：</p>
<img src="/C++/decltype/image-20250722141643248.png" class="" title="表达式">
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #D73A49">decltype</span><span style="color: #24292E">((a)) b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a;</span><span style="color: #6A737D"> // b的类型是int&amp;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f1</span><span style="color: #24292E">(){}</span><span style="color: #6A737D"> // 返回string，是右值</span></span>
<span class="line"><span style="color: #6F42C1">string</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f2</span><span style="color: #24292E">(){}</span><span style="color: #6A737D"> // 返回string&amp;，是左值</span></span>
<span class="line"><span style="color: #6F42C1">string</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f3</span><span style="color: #24292E">(){}</span><span style="color: #6A737D"> // 返回string&amp;&amp;，是将亡值</span></span>
<span class="line"><span style="color: #D73A49">decltype</span><span style="color: #24292E">(</span><span style="color: #6F42C1">f1</span><span style="color: #24292E">()) s1;</span><span style="color: #6A737D"> // b的类型是string</span></span>
<span class="line"><span style="color: #D73A49">decltype</span><span style="color: #24292E">(</span><span style="color: #6F42C1">f2</span><span style="color: #24292E">()) s2 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> s1;</span><span style="color: #6A737D"> // b的类型是string&amp;</span></span>
<span class="line"><span style="color: #D73A49">decltype</span><span style="color: #24292E">(</span><span style="color: #6F42C1">f3</span><span style="color: #24292E">()) s3 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;hello&quot;</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // b的类型是string&amp;&amp;</span></span></code></pre></div></div></figure>
<p>即推导函数正好是函数的返回值类型</p>
<p><strong>注意：decltype中的表达式仅用于编译时的类型推导，不会真正执行</strong></p>
<h2 id="decltypeauto">decltype(auto)</h2>
<p><code>decltype(auto) 变量 = 初始值表达式</code>替换后等同于</p>
<p><code>decltype(初始值表达式) 变量 = 初始值表达式</code></p>
<p>此时表达式是可以执行的</p>
<h2 id="value_category">value_category</h2>
<p>该类模板可以推导出所给的值属于左值、纯右值还是将亡值</p>
<p>经典用法：将表达式的类别表达出来</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">VALUE_CATEGORY</span><span style="color: #24292E">(</span><span style="color: #E36209">expr</span><span style="color: #24292E">) value_category&lt;decltype((expr))&gt;::value</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">CAT</span><span style="color: #24292E">(</span><span style="color: #E36209">a</span><span style="color: #24292E">) std::cout &lt;&lt;&quot;Category of &quot;&lt;&lt; #a &lt;&lt;&quot;:&quot;&lt;&lt;VALUE_CATEGORY(a)&lt;&lt;std::endl;</span></span></code></pre></div></div></figure>
<h2 id="应用">应用</h2>
<p>常用于定义函数模板时，函数返回值的类型推到</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E"> &lt;</span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">, </span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">U</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">decltype</span><span style="color: #24292E">(</span><span style="color: #D73A49">auto</span><span style="color: #24292E">) </span><span style="color: #6F42C1">add</span><span style="color: #24292E">(T</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E"> t, U</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E"> u){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">forward</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;(t)</span><span style="color: #D73A49">+</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">forward</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">U</span><span style="color: #24292E">&gt;(u);</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">auto</span><span style="color: #24292E"> s </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">add</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;a&quot;</span><span style="color: #24292E">), </span><span style="color: #6F42C1">string</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;b&quot;</span><span style="color: #24292E">) )</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
      </tags>
  </entry>
  <entry>
    <title>【C++】内存分区模型</title>
    <url>/C++/%E5%86%85%E5%AD%98%E5%88%86%E5%8C%BA%E6%A8%A1%E5%9E%8B/</url>
    <content><![CDATA[<h1 id="内存分区模型">内存分区模型</h1>
<p>内存在计算机中大致分为四个区域：</p>
<ul>
<li>代码区：存放函数体的二进制代码，由操作系统管理</li>
<li>全局区：存放全局变量，静态变量与常量</li>
<li>栈区：由编译器自动分配释放，存放函数的参数值，局部变量等</li>
<li>堆区：由用户分配释放，若不释放程序结束后由操作系统回收</li>
</ul>
<h2 id="程序运行前">程序运行前</h2>
<p>程序编译后，生成exe可执行程序，未执行前分为两个区域</p>
<p><strong>代码区：</strong></p>
<ul>
<li>存放CPU执行的机器指令</li>
<li>代码区是<strong>共享</strong>的，对于频繁执行的程序，只需要在内存中有一份代码即可</li>
<li>代码区是<strong>只读</strong>的，防止程序意外修改他的指令</li>
</ul>
<p><strong>全局区：</strong></p>
<ul>
<li>存放全局变量、静态变量与常量（<strong>不包括const修饰的局部变量</strong>）</li>
<li>该区域数据在程序结束后由操作系统释放</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">// 全局变量</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> g_a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> g_b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">// const修饰的全局变量</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> g_c </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  // 局部变量</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> l_a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> l_b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  // 静态局部变量</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> s_a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> s_b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 常量</span></span>
<span class="line"><span style="color: #6A737D">  // 字符串常量</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;字符串常量的地址：&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> (</span><span style="color: #D73A49">void*</span><span style="color: #24292E">)</span><span style="color: #D73A49">&amp;</span><span style="color: #032F62">&quot;hello world&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #6A737D">  // const修饰的局部变量</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> l_c </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 输出</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;局部变量l_a的地址: &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> (</span><span style="color: #D73A49">void*</span><span style="color: #24292E">)</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">l_a </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;局部变量l_b的地址: &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> (</span><span style="color: #D73A49">void*</span><span style="color: #24292E">)</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">l_b </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;静态局部变量s_a的地址: &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> (</span><span style="color: #D73A49">void*</span><span style="color: #24292E">)</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">s_a </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;静态局部变量s_b的地址: &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> (</span><span style="color: #D73A49">void*</span><span style="color: #24292E">)</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">s_b </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;全局变量g_a的地址: &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> (</span><span style="color: #D73A49">void*</span><span style="color: #24292E">)</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">g_a </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;全局变量g_b的地址: &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> (</span><span style="color: #D73A49">void*</span><span style="color: #24292E">)</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">g_b </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;const修饰的全局变量g_c的地址: &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> (</span><span style="color: #D73A49">void*</span><span style="color: #24292E">)</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">g_c </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;const修饰的局部变量l_c的地址: &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> (</span><span style="color: #D73A49">void*</span><span style="color: #24292E">)</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">l_c </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>输出发现，不同类型的量所在地址位置有较大差异</p>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">字符串常量的地址：0x404024</span></span>
<span class="line"><span style="color: #24292e">局部变量l_a的地址: 0x61fe1c</span></span>
<span class="line"><span style="color: #24292e">局部变量l_b的地址: 0x61fe18</span></span>
<span class="line"><span style="color: #24292e">静态局部变量s_a的地址: 0x403018</span></span>
<span class="line"><span style="color: #24292e">静态局部变量s_b的地址: 0x40301c</span></span>
<span class="line"><span style="color: #24292e">全局变量g_a的地址: 0x403010</span></span>
<span class="line"><span style="color: #24292e">全局变量g_b的地址: 0x403014</span></span>
<span class="line"><span style="color: #24292e">const修饰的全局变量g_c的地址: 0x404004</span></span>
<span class="line"><span style="color: #24292e">const修饰的局部变量l_c的地址: 0x61fe14</span></span></code></pre></div></div></figure>
<h2 id="程序运行后">程序运行后</h2>
<p><strong>栈区：</strong></p>
<p>由编译器自动分配释放，存放函数参数，局部变量等</p>
<p><strong>不要返回局部变量的地址</strong></p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span><span style="color: #6A737D"> // 形参b也放在栈区</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 存放在栈区的局部变量，函数执行结束后自动释放</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">a;</span><span style="color: #6A737D"> // (不要)返回局部变量的地址</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E">p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #005CC5">100</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #6A737D">  // 访问已经释放的内存，可能会导致未定义行为</span></span>
<span class="line"><span style="color: #6A737D">  // 可能会输出10(编译器做了一次保留)，也可能会输出其他值</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E">p </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl; </span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E">p </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl; </span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p><strong>堆区：</strong></p>
<p>由用户分配释放，若不释放，程序结束后由操作系统回收</p>
<p>使用关键字new开辟内存</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(){ </span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E">p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E">(</span><span style="color: #005CC5">10</span><span style="color: #24292E">);</span><span style="color: #6A737D"> // 使用new在堆区分配内存</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> p; </span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E">p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E">p </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span><span style="color: #6A737D"> // 输出10</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;地址: &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> (</span><span style="color: #D73A49">void*</span><span style="color: #24292E">)p </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span><span style="color: #6A737D"> // 输出地址</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="关键字new">关键字new</h2>
<p>C++中，使用<strong>new</strong>关键字在堆区开辟空间，使用<strong>delete</strong>关键字释放内存</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int*</span><span style="color: #24292E"> p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E">(</span><span style="color: #005CC5">10</span><span style="color: #24292E">);</span><span style="color: #6A737D"> // 用new在堆区分配内存</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int*</span><span style="color: #24292E"> arr </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E">[</span><span style="color: #005CC5">10</span><span style="color: #24292E">];</span><span style="color: #6A737D"> // 用new在堆区分配数组</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">10</span><span style="color: #24292E">;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    arr[i]</span><span style="color: #D73A49">=</span><span style="color: #24292E">i;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E">p </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span><span style="color: #6A737D"> // 输出10</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">10</span><span style="color: #24292E">;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> arr[i] </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot; &quot;</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 输出数组元素</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">delete</span><span style="color: #24292E"> p;</span><span style="color: #6A737D"> // 释放单个变量的内存</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">delete[]</span><span style="color: #24292E"> arr;</span><span style="color: #6A737D"> // 释放数组的内存</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
        <tag>内存</tag>
      </tags>
  </entry>
  <entry>
    <title>【C++】函数封装与绑定</title>
    <url>/C++/%E5%87%BD%E6%95%B0%E5%B0%81%E8%A3%85%E4%B8%8E%E7%BB%91%E5%AE%9A/</url>
    <content><![CDATA[<h1 id="函数封装与绑定">函数封装与绑定</h1>
<h2 id="stdfunction">std::function</h2>
<p>std::function是一个通用的多态函数封装器，用于将可调用对象进行封装</p>
<p>语法<code>function&lt;R(Args...)&gt; fname = target;</code></p>
<p>其中R为返回类型，括号内为参数类型</p>
<p>进行类成员函数封装时，括号内第一个参数是类引用，第二个开始才是参数类型</p>
<p>也可以进行类成员变量的引用</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;functional&gt;</span></span>
<span class="line"><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #6F42C1">mul</span><span style="color: #24292E">(</span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> a</span><span style="color: #D73A49">*</span><span style="color: #24292E">b;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  // 将mul的地址保存到f1对象中</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::function</span><span style="color: #D73A49">&lt;double</span><span style="color: #24292E">(</span><span style="color: #D73A49">double</span><span style="color: #24292E">,</span><span style="color: #D73A49">double</span><span style="color: #24292E">)</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> f1 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> mul;</span></span>
<span class="line"><span style="color: #6A737D">  // 通过重载调用运算符来调用mul函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">double</span><span style="color: #24292E"> res </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f1</span><span style="color: #24292E">(</span><span style="color: #005CC5">1.1</span><span style="color: #24292E">,</span><span style="color: #005CC5">2.3</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> res </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;functional&gt;</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Linear</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">Linear</span><span style="color: #24292E">(</span><span style="color: #D73A49">float</span><span style="color: #24292E"> </span><span style="color: #E36209">k</span><span style="color: #24292E">, </span><span style="color: #D73A49">float</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">):</span><span style="color: #6F42C1">k_</span><span style="color: #24292E">(k),</span><span style="color: #6F42C1">b_</span><span style="color: #24292E">(b) {}</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">float</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #D73A49">float</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">) {</span><span style="color: #D73A49">return</span><span style="color: #24292E"> k_</span><span style="color: #D73A49">*</span><span style="color: #24292E"> x</span><span style="color: #D73A49">+</span><span style="color: #24292E">b_; }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">float</span><span style="color: #24292E"> k_, b_;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E"> :: function</span><span style="color: #D73A49">&lt;float</span><span style="color: #24292E">(Linear</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">, </span><span style="color: #D73A49">float</span><span style="color: #24292E">)</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> mf </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #6F42C1">Linear</span><span style="color: #24292E">::f;</span></span>
<span class="line"><span style="color: #24292E">    Linear </span><span style="color: #6F42C1">l</span><span style="color: #24292E">(</span><span style="color: #005CC5">1.2</span><span style="color: #24292E">,</span><span style="color: #005CC5">2.3</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">float</span><span style="color: #24292E"> res </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">mf</span><span style="color: #24292E">(l,</span><span style="color: #005CC5">5</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E"> :: cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> res </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E"> :: endl;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E"> :: function</span><span style="color: #D73A49">&lt;float</span><span style="color: #24292E">(Linear</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">)</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> k </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #6F42C1">Linear</span><span style="color: #24292E"> :: k_;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E"> :: cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">k</span><span style="color: #24292E">(l) </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E"> :: endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>std::function实现了<strong>类型擦除</strong>：即通过单个通用接口类使用各种具体类型</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;functional&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;map&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #6F42C1">add</span><span style="color: #24292E">(</span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> a</span><span style="color: #D73A49">+</span><span style="color: #24292E">b;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">substract</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">()</span><span style="color: #24292E">(</span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span><span style="color: #D73A49">return</span><span style="color: #24292E"> a</span><span style="color: #D73A49">-</span><span style="color: #24292E">b;}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::map</span><span style="color: #D73A49">&lt;char</span><span style="color: #24292E">, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::function</span><span style="color: #D73A49">&lt;double</span><span style="color: #24292E">(</span><span style="color: #D73A49">double</span><span style="color: #24292E">,</span><span style="color: #D73A49">double</span><span style="color: #24292E">)</span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E">cal{</span></span>
<span class="line"><span style="color: #24292E">    {</span><span style="color: #032F62">&#39;+&#39;</span><span style="color: #24292E">, add},</span></span>
<span class="line"><span style="color: #24292E">    {</span><span style="color: #032F62">&#39;-&#39;</span><span style="color: #24292E">, </span><span style="color: #6F42C1">substract</span><span style="color: #24292E">()},</span></span>
<span class="line"><span style="color: #24292E">    {</span><span style="color: #032F62">&#39;*&#39;</span><span style="color: #24292E">, [](</span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">)-&gt;</span><span style="color: #D73A49">double{return</span><span style="color: #24292E"> </span><span style="color: #D73A49">a*b;}}</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">};</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">std::cout</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;cal[&#39;+&#39;](12.0,13)&lt;&lt;std::endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">std::cout</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;cal[&#39;-&#39;](13.0,6.2)&lt;&lt;std::endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">std::cout</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;cal[&#39;+&#39;](2.3,3.2)&lt;&lt;std::endl;</span></span>
<span class="line"><span style="color: #D73A49">}</span></span></code></pre></div></div></figure>
<p>可以看到，通过std::function可以把完全不同的类型按同一个接口统一封装一个类型来使用</p>
<h2 id="stdmem_fn">std::mem_fn</h2>
<p>封装类成员可以直接使用<code>std::mem_fn</code>，返回一个可调用的包装器</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;functional&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">foo</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">double</span><span style="color: #24292E"> w;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #6F42C1">cal</span><span style="color: #24292E">(</span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #D73A49">*</span><span style="color: #24292E">a</span><span style="color: #D73A49">+</span><span style="color: #24292E">w</span><span style="color: #D73A49">*</span><span style="color: #24292E">b;}</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">foo</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">+=</span><span style="color: #24292E">(</span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    w</span><span style="color: #D73A49">+=</span><span style="color: #24292E">a;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #005CC5">this</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">print</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;w=&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">w</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  foo f{</span><span style="color: #005CC5">1.0</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> memfn </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">mem_fn</span><span style="color: #24292E">(</span><span style="color: #D73A49">&amp;</span><span style="color: #6F42C1">foo</span><span style="color: #24292E">::cal);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">double</span><span style="color: #24292E"> res </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">memfn</span><span style="color: #24292E">(f, </span><span style="color: #005CC5">2.0</span><span style="color: #24292E">, </span><span style="color: #005CC5">3.0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;res=&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">res</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> op </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">mem_fn</span><span style="color: #24292E">(</span><span style="color: #D73A49">&amp;</span><span style="color: #6F42C1">foo</span><span style="color: #24292E">::operator</span><span style="color: #D73A49">+=</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> f2 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">op</span><span style="color: #24292E">(f,</span><span style="color: #005CC5">2.0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  f2.</span><span style="color: #6F42C1">print</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="stdbind">std::bind</h2>
<p>用于生成一个函数对象，调用该包装器时相当于调用他所包装的函数或者对象f</p>
<p>可以将给定的函数和参数进行绑定，调用时直接使用对应函数与参数</p>
<p>其中，参数可以用<code>std::placeholders</code>占位符占位(<code>_1</code>,<code>_2</code>…)，在调用包装器时可以指定传入参数</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;functional&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">placeholders</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">sum</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">c</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;a=&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">a</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;, b=&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">b</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;, c=&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">c;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> a</span><span style="color: #D73A49">+</span><span style="color: #24292E">b</span><span style="color: #D73A49">+</span><span style="color: #24292E">c;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> f </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">bind</span><span style="color: #24292E">(sum, </span><span style="color: #005CC5">1</span><span style="color: #24292E">, _1, </span><span style="color: #005CC5">3</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> res </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #005CC5">5</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;, res=&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">res</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>注意，如果直接用变量作为bind绑定，绑定后修改变量不会影响结果，因为是用值传入的</p>
<p>如果想用引用传入，使用<code>cref()</code>函数，用于返回一个变量的引用封装器s</p>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
      </tags>
  </entry>
  <entry>
    <title>【C++】std::variant</title>
    <url>/C++/variant/</url>
    <content><![CDATA[<h1 id="stdvariant">std::variant</h1>
<p>variant实现了union的作用</p>
<h2 id="用法">用法</h2>
<h3 id="创建">创建</h3>
<p><code>std::variant&lt;type0,type1,type2,...&gt; 名称</code></p>
<p>创建一个variant，其中值可以是给定type的任意一种</p>
<h3 id="获取值">获取值</h3>
<p><code>get&lt;类型下标/类型名称&gt;(名称)</code>按对应下标的数据类型获取值，若不匹配则抛出异常</p>
<p><code>名称.index()</code>获取当前值对应数据类型的索引</p>
<p><code>holds_alternative&lt;类型&gt;(名称)</code>判断variant对象是否含有指定类型的值</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;variant&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::variant</span><span style="color: #D73A49">&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::string, </span><span style="color: #D73A49">int</span><span style="color: #24292E">, </span><span style="color: #D73A49">double&gt;</span><span style="color: #24292E"> v1;</span></span>
<span class="line"><span style="color: #24292E">  v1 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;hello&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">try</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">get</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt;(v1);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">catch</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::bad_variant_access</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> e){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;Bad variant access&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">e.</span><span style="color: #6F42C1">what</span><span style="color: #24292E">()</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #005CC5">0</span><span style="color: #D73A49">==</span><span style="color: #24292E">v1.</span><span style="color: #6F42C1">index</span><span style="color: #24292E">()){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">get</span><span style="color: #24292E">&lt;</span><span style="color: #005CC5">0</span><span style="color: #24292E">&gt;(v1)</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">holds_alternative</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">string</span><span style="color: #24292E">&gt;(v1)){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">get</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">string</span><span style="color: #24292E">&gt;(v1)</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">else</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;Not a String&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="stdvisit">std::visit</h2>
<p>visit函数会根据variant中值的类型来调用自定义对象中对应的函数调用运算符重载</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;variant&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">visitor</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">()</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">i</span><span style="color: #24292E">) </span><span style="color: #D73A49">const</span><span style="color: #24292E">{</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;int: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">i</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;}</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">()</span><span style="color: #24292E">(</span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">d</span><span style="color: #24292E">) </span><span style="color: #D73A49">const</span><span style="color: #24292E">{</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;double: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">d</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;}</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">()</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">s</span><span style="color: #24292E">) </span><span style="color: #D73A49">const</span><span style="color: #24292E">{</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;string: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">s</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;}</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::variant</span><span style="color: #D73A49">&lt;int</span><span style="color: #24292E">, </span><span style="color: #D73A49">double</span><span style="color: #24292E">, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::string</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> v;</span></span>
<span class="line"><span style="color: #24292E">  v </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">6</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">visit</span><span style="color: #24292E">(visitor{}, v);</span></span>
<span class="line"><span style="color: #24292E">  v </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;hello&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">visit</span><span style="color: #24292E">(visitor{}, v);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E">: </span><span style="color: #005CC5">6</span></span>
<span class="line"><span style="color: #24292E">string: hello</span></span></code></pre></div></div></figure>
<h2 id="overload-pattern">overload pattern</h2>
<p>我们可以使用overload模式使得variant使用更加方便</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;variant&gt;</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">A</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">()</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">i</span><span style="color: #24292E">) </span><span style="color: #D73A49">const</span><span style="color: #24292E">{</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;int: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">i</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;}</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">B</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">()</span><span style="color: #24292E">(</span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">d</span><span style="color: #24292E">) </span><span style="color: #D73A49">const</span><span style="color: #24292E">{</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;double: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">d</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;}</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">C</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">()</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">s</span><span style="color: #24292E">) </span><span style="color: #D73A49">const</span><span style="color: #24292E">{</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;string: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">s</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;}</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 变参类模板</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E">... </span><span style="color: #6F42C1">Ts</span><span style="color: #24292E">&gt;</span><span style="color: #6A737D"> // Ts为模板形参包，表示实例化时传入的多个实参</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Visitor</span><span style="color: #24292E">:Ts...{</span><span style="color: #6A737D"> // 这里的省略号表示将形参包展开，替换为实际的参数列表</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Ts</span><span style="color: #24292E">::operator()...;</span><span style="color: #6A737D"> // 基类重载函数都引入成为自己的</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::variant</span><span style="color: #D73A49">&lt;int</span><span style="color: #24292E">, </span><span style="color: #D73A49">double</span><span style="color: #24292E">, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::string</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> v;</span></span>
<span class="line"><span style="color: #24292E">  v </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">6</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  Visitor</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">A,B,C</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> visitor{};</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">visitor</span><span style="color: #24292E">(</span><span style="color: #005CC5">6</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">visitor</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;hello&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">visit</span><span style="color: #24292E">(visitor, v);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [](</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">i</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;int: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">i </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  };</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [](</span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">d</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;double: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">d </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  };</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> c </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [](</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;string: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">s </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  };</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  v </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;hello&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  // 用lambda函数实例化对象</span></span>
<span class="line"><span style="color: #24292E">  Visitor</span><span style="color: #D73A49">&lt;decltype</span><span style="color: #24292E">(a), </span><span style="color: #D73A49">decltype</span><span style="color: #24292E">(b), </span><span style="color: #D73A49">decltype</span><span style="color: #24292E">(c)</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> visitor2{a,b,c};</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">visit</span><span style="color: #24292E">(visitor2, v);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  v </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">6.3</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  Visitor visitor3{a,b,c};</span><span style="color: #6A737D"> // CTAD，让编译器推断类型</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">visit</span><span style="color: #24292E">(visitor3, v);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>这里将visitor类模板进行改造</p>
<p>使用<code>class... Ts</code>表示实例化传入多个实参</p>
<p>使用<code>Ts...</code>将形参包展开</p>
<p>使用<code>using Ts::operator()...</code>将基类成员引入作为继承类成员定义，将所有基类中的重载函数引入成为自己的成员函数</p>
<p>以下使用了三种方法：</p>
<ul>
<li><p>让Visitor类继承A,B,C三个模板，拥有三个运算符重载</p></li>
<li><p>定义三个lambda对象，使用decltype获得他们的类型，用来实例化Vistor模板</p></li>
<li><p>使用CTAD，让编译器从对象的初始化器列表来推断模板类型（C++17）</p></li>
</ul>
<p>​
这时编译器会自动将类型推到为第二种方法中的类型，因此我们可以直接将三个lambda函数塞入Visitor函数让编译器自动推导</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">visit</span><span style="color: #24292E">(Visitor{</span></span>
<span class="line"><span style="color: #24292E">  [](</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">i</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;int: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">i </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;},</span></span>
<span class="line"><span style="color: #24292E">  [](</span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">d</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;double: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">d </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;},</span></span>
<span class="line"><span style="color: #24292E">  [](</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;string: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">s </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;}},</span></span>
<span class="line"><span style="color: #24292E">v);</span></span></code></pre></div></div></figure>
<p>这样在C++20以上可以实现，C++17下需要用户自定义推导指引</p>
<p>即将初始化列表实参类型作为模板实参列表</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E">... </span><span style="color: #6F42C1">Ts</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #6F42C1">overload</span><span style="color: #24292E">(Ts...) -&gt; overload</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">Ts...</span><span style="color: #D73A49">&gt;</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
      </tags>
  </entry>
  <entry>
    <title>【C++】右值引用与移动语义</title>
    <url>/C++/%E5%8F%B3%E5%80%BC%E5%BC%95%E7%94%A8%E4%B8%8E%E7%A7%BB%E5%8A%A8%E8%AF%AD%E4%B9%89/</url>
    <content><![CDATA[<h1 id="右值引用">右值引用</h1>
<h2 id="左值与右值">左值与右值</h2>
<p>左值：能用在赋值运算符左侧的表达式</p>
<p>右值：能用在赋值运算符右侧，但不能用在左侧的表达式</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">5</span><span style="color: #24292E">;</span></span></code></pre></div></div></figure>
<p>这里a为左值，5为右值，不能写成<code>5=a</code></p>
<h3 id="判断方法">判断方法：</h3>
<p>左值：能够获得某个表达式的引用或地址即为左值</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">5</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int&amp;</span><span style="color: #24292E"> b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> c;</span></span>
<span class="line"><span style="color: #D73A49">int*</span><span style="color: #24292E"> p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">c;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #005CC5">4</span></span></code></pre></div></div></figure>
<ul>
<li>b取到了a的引用，a是（不可修改的）左值</li>
<li>p取到了c的地址，c是左值</li>
<li>4不能取地址，4是右值</li>
</ul>
<h3 id="c11后的分类">C++11后的分类</h3>
<ul>
<li><code>glvalue</code>：泛左值</li>
<li><code>prvalue</code>：纯右值</li>
<li><code>xvalue</code>：将亡值</li>
</ul>
<img src="/C++/%E5%8F%B3%E5%80%BC%E5%BC%95%E7%94%A8%E4%B8%8E%E7%A7%BB%E5%8A%A8%E8%AF%AD%E4%B9%89/image-20250721094049230.png" class="" title="分类">
<h3 id="举例">举例</h3>
<ul>
<li>左值：</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 整型/浮点型等变量</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">8</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">double</span><span style="color: #24292E"> m </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1.5</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int*</span><span style="color: #24292E">p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E">{</span><span style="color: #005CC5">5</span><span style="color: #24292E">};</span><span style="color: #6A737D"> // 指针</span></span>
<span class="line"><span style="color: #D73A49">*</span><span style="color: #24292E">p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">4</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 表达式解引用</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> b[</span><span style="color: #005CC5">5</span><span style="color: #24292E">]; </span></span>
<span class="line"><span style="color: #24292E">b[</span><span style="color: #005CC5">1</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 数组（不可更改）、数组元素</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int&amp;</span><span style="color: #24292E"> r </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a;</span><span style="color: #6A737D"> // 左值引用中右侧的表达式</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 类的数据成员</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">s</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> id;</span></span>
<span class="line"><span style="color: #24292E">}s1;</span></span>
<span class="line"><span style="color: #24292E">s1.id </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">3</span><span style="color: #24292E">; </span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 返回引用的函数的调用表达式</span></span>
<span class="line"><span style="color: #D73A49">int&amp;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">refn</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> n </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> n;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6F42C1">refn</span><span style="color: #24292E">()</span><span style="color: #D73A49">=</span><span style="color: #005CC5">5</span><span style="color: #24292E">;</span></span></code></pre></div></div></figure>
<ul>
<li>纯右值</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> x,y,z;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> m </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">3</span><span style="color: #24292E">, n </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">double</span><span style="color: #24292E"> d;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">x </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 字面值</span></span>
<span class="line"><span style="color: #6A737D">// 将计算结果存放在临时中间对象中的表达式</span></span>
<span class="line"><span style="color: #24292E">x </span><span style="color: #D73A49">=</span><span style="color: #24292E"> m</span><span style="color: #D73A49">+</span><span style="color: #24292E">n;</span></span>
<span class="line"><span style="color: #24292E">y </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #24292E">m;</span></span>
<span class="line"><span style="color: #24292E">z </span><span style="color: #D73A49">=</span><span style="color: #24292E"> n</span><span style="color: #D73A49">+</span><span style="color: #005CC5">2</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">d </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">double</span><span style="color: #24292E">(z)</span><span style="color: #6A737D"> // 类型转换</span></span>
<span class="line"><span style="color: #24292E">    </span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">s</span><span style="color: #24292E">{};</span></span>
<span class="line"><span style="color: #24292E">s obj;</span></span>
<span class="line"><span style="color: #24292E">obj </span><span style="color: #D73A49">=</span><span style="color: #24292E"> s{};</span><span style="color: #6A737D"> // 未命名类的对象</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6F42C1">s</span><span style="color: #24292E"> </span><span style="color: #6F42C1">func</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> s{};</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6F42C1">func</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 函数调用返回对象值时的调用</span></span>
<span class="line"><span style="color: #6F42C1">s</span><span style="color: #24292E"> (*f)(</span><span style="color: #D73A49">int</span><span style="color: #24292E">) </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">func;</span><span style="color: #6A737D"> // 函数地址</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 非静态类成员函数、枚举、数组、this指针、lambda表达式、一些内置运算符表达式</span></span></code></pre></div></div></figure>
<h3 id="左右值引用">左右值引用</h3>
<ul>
<li>左值引用：普通的引用</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">5</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int&amp;</span><span style="color: #24292E"> b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a;</span></span></code></pre></div></div></figure>
<ul>
<li>右值引用：使用两个&amp;进行引用</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E">c </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">5</span><span style="color: #24292E">;</span></span></code></pre></div></div></figure>
<p>只能绑定右值，不能绑定左值</p>
<h3 id="应用">应用</h3>
<p>函数重载：</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">func</span><span style="color: #24292E">(</span><span style="color: #D73A49">int&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;调用左值引用重载&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">func</span><span style="color: #24292E">(</span><span style="color: #D73A49">int&amp;&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;调用右值引用重载&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">5</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">func</span><span style="color: #24292E">(a);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">func</span><span style="color: #24292E">(</span><span style="color: #005CC5">5</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">调用左值引用重载</span></span>
<span class="line"><span style="color: #24292e">调用右值引用重载</span></span></code></pre></div></div></figure>
<h1 id="移动语义">移动语义</h1>
<h2 id="移动构造函数">移动构造函数</h2>
<p>当类中存在指针等变量，而没有设置拷贝构造，编译器会自动生成拷贝构造函数，此时为浅拷贝。我们应该自己设计深拷贝，申请新的内存，并将原来的内容复制到新分配的内存中，并实现赋值运算符的重载函数，释放原有内存，申请新的内存，并复制值</p>
<p>此时参数中为左值引用，称为<strong>拷贝赋值运算符重载函数</strong></p>
<p>为了实现移动语义，我们需要实现移动赋值运算符重载函数</p>
<p>此时参数为右值引用，且没有const限定符</p>
<p>该方法少了内存的分配和数据的复制，修改了被移动对象</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">CharBuffer</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #6A737D">// 左值函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">CharBuffer</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">size</span><span style="color: #24292E">):</span><span style="color: #6F42C1">m_buff</span><span style="color: #24292E">(</span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #D73A49">char</span><span style="color: #24292E">[size]), </span><span style="color: #6F42C1">m_size</span><span style="color: #24292E">(size){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;普通构造函数&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">CharBuffer</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">CharBuffer</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">other</span><span style="color: #24292E">):</span><span style="color: #6F42C1">m_size</span><span style="color: #24292E">(other.m_size), </span><span style="color: #6F42C1">m_buff</span><span style="color: #24292E">(</span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #D73A49">char</span><span style="color: #24292E">[m_size]){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">memcpy</span><span style="color: #24292E">(m_buff, other.m_buff, m_size);</span></span>
<span class="line"><span style="color: #24292E">    cout</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;拷贝构造函数&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">CharBuffer</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">=</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">CharBuffer</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">other</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #005CC5">this</span><span style="color: #D73A49">==&amp;</span><span style="color: #24292E">other){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #005CC5">this</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    m_size </span><span style="color: #D73A49">=</span><span style="color: #24292E"> other.m_size;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">delete[]</span><span style="color: #24292E"> m_buff;</span></span>
<span class="line"><span style="color: #24292E">    m_buff </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #D73A49">char</span><span style="color: #24292E">[m_size];</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">memcpy</span><span style="color: #24292E">(m_buff, other.m_buff, m_size);</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;拷贝赋值运算符&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">// 右值函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">CharBuffer</span><span style="color: #24292E">(</span><span style="color: #6F42C1">CharBuffer</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">other</span><span style="color: #24292E">):</span><span style="color: #6F42C1">m_size</span><span style="color: #24292E">(other.m_size), </span><span style="color: #6F42C1">m_buff</span><span style="color: #24292E">(other.m_buff){</span></span>
<span class="line"><span style="color: #24292E">    other.m_buff </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">nullptr</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    other.m_size </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;移动构造函数&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">CharBuffer</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">=</span><span style="color: #24292E">(</span><span style="color: #6F42C1">CharBuffer</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">other</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #005CC5">this</span><span style="color: #D73A49">==&amp;</span><span style="color: #24292E">other){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #005CC5">this</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">delete[]</span><span style="color: #24292E"> m_buff;</span></span>
<span class="line"><span style="color: #24292E">    m_size </span><span style="color: #D73A49">=</span><span style="color: #24292E"> other.m_size;</span></span>
<span class="line"><span style="color: #24292E">    m_buff </span><span style="color: #D73A49">=</span><span style="color: #24292E"> other.m_buff;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    other.m_size</span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    other.m_buff </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">nullptr</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;移动赋值运算符&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> m_size;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">char*</span><span style="color: #24292E"> m_buff;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">~CharBuffer</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">delete[]</span><span style="color: #24292E"> m_buff;</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;析构函数&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  CharBuffer buff2{</span><span style="color: #6F42C1">CharBuffer</span><span style="color: #24292E">(</span><span style="color: #005CC5">100</span><span style="color: #24292E">)};</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="拷贝省略">拷贝省略</h2>
<p>当我们运行语句，构造一个未命名的对象作为右值</p>
<p><code>CharBuffer buff2&#123;CharBuffer(100)&#125;;</code></p>
<p>按照移动语义，会先通过普通构造函数创建临时对象，然后将该临时对象赋值给buff2，但编译器会对这种代码进行优化，省略调临时对象的创建，直接在目标存储位置构造该对象即输出：</p>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">普通构造函数</span></span>
<span class="line"><span style="color: #24292e">析构函数</span></span></code></pre></div></div></figure>
<p>C++17后，这种优化成为语言规范</p>
<h2 id="返回值优化rvo">返回值优化(RVO)</h2>
<p>类似，函数直接返回值的情况下，临时对象的创建也会省略</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6F42C1">CharBuffer</span><span style="color: #24292E"> </span><span style="color: #6F42C1">generate</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">n</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">CharBuffer</span><span style="color: #24292E">(n);</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  CharBuffer buff2 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">generate</span><span style="color: #24292E">(</span><span style="color: #005CC5">100</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">普通构造函数</span></span>
<span class="line"><span style="color: #24292e">析构函数</span></span></code></pre></div></div></figure>
<h2 id="具名的返回值优化nrvo">具名的返回值优化(NRVO)</h2>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6F42C1">CharBuffer</span><span style="color: #24292E"> </span><span style="color: #6F42C1">generate_nv</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">n</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  CharBuffer </span><span style="color: #6F42C1">buf</span><span style="color: #24292E">(n);</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;&amp;</span><span style="color: #24292E">buf</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> buf;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  CharBuffer buff2 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">generate_nv</span><span style="color: #24292E">(</span><span style="color: #005CC5">100</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;&amp;</span><span style="color: #24292E">buff2</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">普通构造函数</span></span>
<span class="line"><span style="color: #24292e">0x61fe30</span></span>
<span class="line"><span style="color: #24292e">0x61fe30</span></span>
<span class="line"><span style="color: #24292e">析构函数</span></span></code></pre></div></div></figure>
<p>buff2与buff的地址相同，说明他们是对同一个对象的引用，原理同上</p>
<h2 id="stdmove">std::move()</h2>
<p>该函数将传入的参数转换为右值引用并返回</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  CharBuffer </span><span style="color: #6F42C1">buff1</span><span style="color: #24292E">(</span><span style="color: #005CC5">100</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  CharBuffer </span><span style="color: #6F42C1">buff2</span><span style="color: #24292E">(</span><span style="color: #6F42C1">move</span><span style="color: #24292E">(buff1));</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">普通构造函数</span></span>
<span class="line"><span style="color: #24292e">移动构造函数</span></span>
<span class="line"><span style="color: #24292e">析构函数</span></span>
<span class="line"><span style="color: #24292e">析构函数</span></span></code></pre></div></div></figure>
<p>此时由于传入的转换为了右值引用，故正确调用了移动构造函数</p>
<p>等同于<code>static_cast&lt;CharBuffer&amp;&amp;&gt;(buff1)</code></p>
<h2 id="xvalue">xvalue</h2>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  CharBuffer </span><span style="color: #6F42C1">buff2</span><span style="color: #24292E">(</span><span style="color: #005CC5">10</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  {</span></span>
<span class="line"><span style="color: #24292E">    CharBuffer </span><span style="color: #6F42C1">buff1</span><span style="color: #24292E">(</span><span style="color: #005CC5">100</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    buff2 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">move</span><span style="color: #24292E">(buff1);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>这段代码中，buff1就是一个将亡值，我们使用move函数获得其右值引用，从而将它的资源回收再利用，转移buff2中</p>
<h3 id="常见xvalue">常见xvalue</h3>
<ul>
<li>函数返回的右值引用</li>
<li><code>static_cast&lt;T&amp;&amp;&gt;(v)</code></li>
<li>未命名的右值对象获得的非静态成员变量</li>
</ul>
<h2 id="移动语义的应用">移动语义的应用</h2>
<p>大部分情况下都不需要移动语义</p>
<ul>
<li>若一个类涉及到深拷贝，需要复制较多数据，可以使用移动语义</li>
<li>当转移<code>unique_ptr</code>的所有权时，需要移动语义</li>
<li>编写供其他程序使用的STL，需要提供移动语义的支持</li>
</ul>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
      </tags>
  </entry>
  <entry>
    <title>【C++】命名空间</title>
    <url>/C++/%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4/</url>
    <content><![CDATA[<h1 id="命名空间">命名空间</h1>
<h2 id="使用">使用</h2>
<p>格式：</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">namespace</span><span style="color: #24292E"> 标识符{</span></span>
<span class="line"><span style="color: #6A737D">    // 类，对象，变量，函数等</span></span>
<span class="line"><span style="color: #24292E">};</span></span></code></pre></div></div></figure>
<p>使用：</p>
<p>使用限定名：<code>标识符::名字</code></p>
<p>同一个命名空间可以在一个或多个文件下重复使用</p>
<h2 id="引入">引入</h2>
<ul>
<li>使用using
namespace可以引入某个命名空间中的所有名称，这样就可以直接使用内部对应内容</li>
<li>使用using声明可以引入某个限定标识符，这样就不需要使用限定名了</li>
<li>引入声明区分全局与局部</li>
<li>不限定命名空间的均默认处于全局命名空间global，引入时只需要使用<code>::名字</code></li>
</ul>
<h2 id="嵌套">嵌套</h2>
<p>命名空间可以嵌套使用：</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Space1</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Space2</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">3</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>调用时需要明确指出引用哪个，否则会造成不明确，默认输出全局的</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Space1</span><span style="color: #24292E">::a;</span></span>
<span class="line"><span style="color: #24292E">cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> a </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Space1</span><span style="color: #24292E">::</span><span style="color: #6F42C1">Space2</span><span style="color: #24292E">::a;</span></span>
<span class="line"><span style="color: #24292E">cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> a </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
      </tags>
  </entry>
  <entry>
    <title>【C++】Lambda表达式</title>
    <url>/C++/Lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F/</url>
    <content><![CDATA[<h1 id="lambda表达式">Lambda表达式</h1>
<p>用于快速定义一个匿名函数对象（闭包）</p>
<p>语法：</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">[捕获变量](参数列表) 可选限定符-&gt;</span><span style="color: #D73A49">返回类型{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">代码</span></span>
<span class="line"><span style="color: #D73A49">}</span></span></code></pre></div></div></figure>
<h2 id="原理">原理</h2>
<p>实际上是函数对象的一种快速定义方式</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> x </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">7</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">float</span><span style="color: #24292E"> y </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">3.0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> _x;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">float</span><span style="color: #24292E"> y;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">float</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">()</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">,</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">) </span><span style="color: #D73A49">const</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> _x </span><span style="color: #D73A49">*</span><span style="color: #24292E">_ y</span><span style="color: #D73A49">+</span><span style="color: #24292E">a</span><span style="color: #D73A49">*</span><span style="color: #24292E">b;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}p{x,y};</span></span></code></pre></div></div></figure>
<h2 id="变量捕获">变量捕获</h2>
<h3 id="按值捕获">按值捕获</h3>
<p>lambda中的成员变量是外部变量的拷贝</p>
<p>外部更改不会改变内部的变量</p>
<p>此时lambda对应的函数调用运算符默认是const函数，函数内部不能修改按值捕获的变量，也不能调用非常量函数（或者可以在lambda函数后加上mutable限制符）</p>
<h3 id="按引用捕获">按引用捕获</h3>
<p>在中括号中变量前添加引用运算符</p>
<p>外部更改会改变内部的变量</p>
<p>若所引用的变量已经失效，则会报错或访问无效数据</p>
<h3 id="默认捕获方式">默认捕获方式</h3>
<ul>
<li><p>[=]：默认按值捕获</p></li>
<li><p>[&amp;]：默认按引用捕获</p></li>
<li><p>[this]/[*this]：在类中按引用/按值捕获，可以访问类成员</p></li>
</ul>
<p>此时也可以添加特例，添加显式捕获的变量</p>
<p>但默认捕获和显式捕获不能相同</p>
<p>其中[=], [&amp;], [&amp;, this], [=, *this], [=,
this]这几种捕获方式，this都是按引用捕获的</p>
<h2 id="变量使用">变量使用</h2>
<p>除了可以使用捕获变量，还可以使用自定义变量，外层中的静态变量与全局变量</p>
<h2 id="泛型lambda">泛型lambda</h2>
<p>在参数类型中使用auto即可实现泛型lambda，相当于套了类模板</p>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
      </tags>
  </entry>
  <entry>
    <title>【C++】完美转发</title>
    <url>/C++/%E5%AE%8C%E7%BE%8E%E8%BD%AC%E5%8F%91/</url>
    <content><![CDATA[<h1 id="完美转发">完美转发</h1>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">string</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;左值:&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">s</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;右值&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">s</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">g</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">string</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(s);</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">g</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(s);</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  // 右值</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">g</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;hello1&quot;</span><span style="color: #24292E">));</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 左值</span></span>
<span class="line"><span style="color: #24292E">  string </span><span style="color: #6F42C1">s1</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;hello2&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">g</span><span style="color: #24292E">(s1);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>这段代码，我们希望让右值调用右值的重载函数f，左值调用左值的重载函数f，但最后结果均调用了左值重载函数</p>
<p>这是因为在函数g中，s本身是一个局部变量，拥有地址，是一个左值</p>
<p>这时候我们需要进行类型转换</p>
<h2 id="stdforward">std::forward</h2>
<p>我们当然可以使用<code>static_cast&lt;&gt;()</code>来进行转换，但是这里可以使用<code>forward&lt;&gt;()</code>函数进行转换，结合函数模板，使得代码更加方便易读</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">g</span><span style="color: #24292E">(</span><span style="color: #6F42C1">T</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #6F42C1">forward</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;(s));</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>这里在<strong>形参列表中</strong>的<code>T&amp;&amp; s</code>被称为<strong>万能引用或转发引用</strong></p>
<p>它既可以绑定左值也可以绑定右值，会在实例化时根据传入参数类型自动推导成对应类型</p>
<p>T的类型取决于传入的是左值还是右值</p>
<ul>
<li>左值：T被推导为实参类型的引用</li>
<li>右值：T被推导为实参类型的非引用</li>
</ul>
<p><code>forward</code>函数实现了一个类型转换</p>
<ul>
<li>若传入实参是右值，则forward函数会返回一个右值引用</li>
<li>若传入实参是左值，则函数模板T会被替换为该类型的引用，但此时会出现引用的引用(&amp;&amp;&amp;)，这时遵循<strong>引用折叠规则</strong>，得到类型的左值引用</li>
</ul>
<img src="/C++/%E5%AE%8C%E7%BE%8E%E8%BD%AC%E5%8F%91/image-20250722105549229.png" class="" title="引用折叠规则">
<p>即除了右值引用的右值引用被折叠为右值引用外，其余的只要有左值引用，就会被折叠为左值引用</p>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
      </tags>
  </entry>
  <entry>
    <title>【C/C++】宏定义</title>
    <url>/C++/%E5%AE%8F%E5%AE%9A%E4%B9%89/</url>
    <content><![CDATA[<h1 id="宏定义">宏定义</h1>
<h2 id="常量替换">常量替换</h2>
<p><code>#define 标识符 替换表达式</code></p>
<p>C++中常用const方式进行常量替换</p>
<h2 id="条件编译">条件编译</h2>
<p>可以定义一个空的宏来用于条件编译</p>
<ul>
<li><p><code>#ifdef 宏名</code>：若定义了对应宏则执行下面的宏指令</p></li>
<li><p><code>#else</code>：否则执行else下面的宏指令</p></li>
<li><p><code>#undef 宏名</code>：取消原来的定义</p></li>
<li><p><code>#endif</code>：条件编译的结尾</p></li>
</ul>
<h2 id="宏函数">宏函数</h2>
<p><code>#define 标识符(参数列表) 替换表达式</code></p>
<p>为了防止运算符优先级造成问题，一般要对表达式加上括号</p>
<p>C++中可以被内联函数取代</p>
<h2 id="与">#与</h2>
<ul>
<li>#将符号转为字符串</li>
</ul>
<p>e.g.<code>#define PRINT(a) cout&lt;&lt;#a&lt;&lt;"="&lt;&lt;(a)&lt;&lt;" ";</code></p>
<ul>
<li>##将两个表达式连接在一起</li>
</ul>
<p>e.g.<code>#define MEMBER(type, a) type m_##a</code></p>
<h2 id="多行宏定义">多行宏定义</h2>
<p>若想定义多行宏定义，则需要在每行结尾加一个<br />
</p>
<h2 id="可变参的宏函数">可变参的宏函数</h2>
<p><code>#define 标识符(参数列表,...) 替换表达式</code></p>
<p>表达式中用<code>__VA_ARGS__</code>标识符表示这些参数，宏展开时，实际参数会替换掉该标识符</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;stdio.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">LOG</span><span style="color: #24292E">(</span><span style="color: #E36209">fmt</span><span style="color: #24292E">, ...) printf(fmt, ##__VA_ARGS__)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">LOG</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Hello, </span><span style="color: #005CC5">%s\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">, </span><span style="color: #032F62">&quot;World&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">LOG</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;This is a test.</span><span style="color: #005CC5">\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
      </tags>
  </entry>
  <entry>
    <title>【C++】协程</title>
    <url>/C++/%E5%8D%8F%E7%A8%8B/</url>
    <content><![CDATA[<h1 id="协程">协程</h1>
<h2 id="协程函数">协程函数</h2>
<p>若一个函数中出现了以下三个关键字之一，则编译器就知道这是一个协程函数</p>
<ul>
<li>co_await</li>
<li>co_yield</li>
<li>co_return</li>
</ul>
<p>并且，协程函数必须返回一个符合要求的协程对象，若有返回值，需要通过协程对象获得</p>
<h2 id="协程对象">协程对象</h2>
<p>协程函数的返回值是自定义的一个协程对象</p>
<h3 id="模板">模板</h3>
<p>通常需要内嵌一个名为<code>promise_type</code>的结构定义，内部需要实现一些函数</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;coroutine&gt;</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">promise_type</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get_return_object</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">suspend_never</span><span style="color: #24292E"> </span><span style="color: #6F42C1">initial_suspend</span><span style="color: #24292E">() { </span><span style="color: #D73A49">return</span><span style="color: #24292E"> {}; }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">suspend_never</span><span style="color: #24292E"> </span><span style="color: #6F42C1">final_suspend</span><span style="color: #24292E">() </span><span style="color: #D73A49">noexcept</span><span style="color: #24292E"> { </span><span style="color: #D73A49">return</span><span style="color: #24292E"> {}; }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">return_void</span><span style="color: #24292E">() {}</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">unhandled_exception</span><span style="color: #24292E">() {}</span></span>
<span class="line"><span style="color: #24292E">  };</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E"> </span><span style="color: #6F42C1">coroFunc</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;hello world&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">co_return</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  MyCoroutine coro </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">coroFunc</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>此时coroFunc刚开始执行就被挂起，MyCoroutine对象也没有实现任何协程，故后面的代码不会执行，稍微进行修改</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;coroutine&gt;</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">promise_type</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get_return_object</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #6A737D">      // 获得协程句柄</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">coroutine_handle</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">promise_type</span><span style="color: #24292E">&gt;::</span><span style="color: #6F42C1">from_promise</span><span style="color: #24292E">(</span><span style="color: #D73A49">*</span><span style="color: #005CC5">this</span><span style="color: #24292E">));</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">suspend_always</span><span style="color: #24292E"> </span><span style="color: #6F42C1">initial_suspend</span><span style="color: #24292E">() { </span><span style="color: #D73A49">return</span><span style="color: #24292E"> {}; }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">suspend_always</span><span style="color: #24292E"> </span><span style="color: #6F42C1">final_suspend</span><span style="color: #24292E">() </span><span style="color: #D73A49">noexcept</span><span style="color: #24292E"> { </span><span style="color: #D73A49">return</span><span style="color: #24292E"> {}; }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">return_void</span><span style="color: #24292E">() {}</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">unhandled_exception</span><span style="color: #24292E">() {}</span></span>
<span class="line"><span style="color: #24292E">  };</span></span>
<span class="line"><span style="color: #6A737D">  // 通过构造函数传给新创建的对象</span></span>
<span class="line"><span style="color: #6A737D">  // 调用了协程句柄的resume函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">coroutine_handle</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">promise_type</span><span style="color: #24292E">&gt; </span><span style="color: #E36209">h</span><span style="color: #24292E">) : </span><span style="color: #6F42C1">handle</span><span style="color: #24292E">(h) {}</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">resume</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (handle) {</span></span>
<span class="line"><span style="color: #24292E">      handle.</span><span style="color: #6F42C1">resume</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 恢复协程执行</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::coroutine_handle</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">promise_type</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> handle;</span><span style="color: #6A737D"> // 封装了一个指向协程帧的指针，并提供函数</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E"> </span><span style="color: #6F42C1">coroFunc</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;hello world&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">co_return</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  MyCoroutine coro </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">coroFunc</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  coro.</span><span style="color: #6F42C1">resume</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 恢复协程执行</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="返回值">返回值</h3>
<p>若需要提供返回值，则需要将return_void改为return_value，并添加get函数存储并获取反返回值：</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;coroutine&gt;</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">promise_type</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get_return_object</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #6A737D">      // 获得协程句柄</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">coroutine_handle</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">promise_type</span><span style="color: #24292E">&gt;::</span><span style="color: #6F42C1">from_promise</span><span style="color: #24292E">(</span><span style="color: #D73A49">*</span><span style="color: #005CC5">this</span><span style="color: #24292E">));</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">suspend_always</span><span style="color: #24292E"> </span><span style="color: #6F42C1">initial_suspend</span><span style="color: #24292E">() { </span><span style="color: #D73A49">return</span><span style="color: #24292E"> {}; }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">suspend_always</span><span style="color: #24292E"> </span><span style="color: #6F42C1">final_suspend</span><span style="color: #24292E">() </span><span style="color: #D73A49">noexcept</span><span style="color: #24292E"> { </span><span style="color: #D73A49">return</span><span style="color: #24292E"> {}; }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">return_value</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">v</span><span style="color: #24292E">) {_value </span><span style="color: #D73A49">=</span><span style="color: #24292E"> v;}</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">unhandled_exception</span><span style="color: #24292E">() {}</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get</span><span style="color: #24292E">(){</span><span style="color: #D73A49">return</span><span style="color: #24292E"> _value;}</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">int</span><span style="color: #24292E"> _value;</span><span style="color: #6A737D"> // 存储协程返回值</span></span>
<span class="line"><span style="color: #24292E">  };</span></span>
<span class="line"><span style="color: #6A737D">  // 通过构造函数传给新创建的对象</span></span>
<span class="line"><span style="color: #6A737D">  // 调用了协程句柄的resume函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">coroutine_handle</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">promise_type</span><span style="color: #24292E">&gt; </span><span style="color: #E36209">h</span><span style="color: #24292E">) : </span><span style="color: #6F42C1">handle</span><span style="color: #24292E">(h) {}</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    handle.</span><span style="color: #6F42C1">resume</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 恢复协程执行</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> handle.</span><span style="color: #6F42C1">promise</span><span style="color: #24292E">().</span><span style="color: #6F42C1">get</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 获取协程返回值</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::coroutine_handle</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">promise_type</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> handle;</span><span style="color: #6A737D"> // 封装了一个指向协程帧的指针，并提供函数</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E"> </span><span style="color: #6F42C1">coroFunc</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;hello world&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">co_return</span><span style="color: #24292E"> </span><span style="color: #005CC5">666</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  MyCoroutine coro </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">coroFunc</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> value </span><span style="color: #D73A49">=</span><span style="color: #24292E"> coro.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;value= &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> value </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="co_yield">co_yield</h3>
<p>如果要使用co_yield，需要添加yield_value函数</p>
<p>由于co_yield不是函数执行的结尾，故需要返回一个可等待对象，并使用co_await对该对象进行等待，即</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">co_yield</span><span style="color: #24292E"> v;</span></span>
<span class="line"><span style="color: #D73A49">co_await</span><span style="color: #24292E"> promise.</span><span style="color: #6F42C1">yield_value</span><span style="color: #24292E">(v);</span></span></code></pre></div></div></figure>
<p>或者返回一个suspend_always对象，让程序挂起</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">auto</span><span style="color: #24292E"> </span><span style="color: #6F42C1">yield_value</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">v</span><span style="color: #24292E">) { _value </span><span style="color: #D73A49">=</span><span style="color: #24292E"> v; </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::suspend_always{};}</span></span></code></pre></div></div></figure>
<p>为方便使用，还可以重载一下布尔运算符，通过调用handle的done函数来判断协程是否执行完毕</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">operator</span><span style="color: #24292E"> </span><span style="color: #6F42C1">bool</span><span style="color: #24292E">(){</span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">!</span><span style="color: #24292E">handle.</span><span style="color: #6F42C1">done</span><span style="color: #24292E">();}</span></span></code></pre></div></div></figure>
<p>在主函数中，就可以通过一个循环对协程执行进行挂起和继续操作，并获得每次的返回值</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">MyCoroutine coro </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">coroFunc</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #D73A49">while</span><span style="color: #24292E">(coro){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> value </span><span style="color: #D73A49">=</span><span style="color: #24292E"> coro.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;value= &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> value </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="应用实现发生器generator">应用：实现发生器(Generator)</h3>
<blockquote>
<p>一个斐波那契数列生成器</p>
</blockquote>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;coroutine&gt;</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">promise_type</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get_return_object</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #6A737D">      // 获得协程句柄</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">coroutine_handle</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">promise_type</span><span style="color: #24292E">&gt;::</span><span style="color: #6F42C1">from_promise</span><span style="color: #24292E">(</span><span style="color: #D73A49">*</span><span style="color: #005CC5">this</span><span style="color: #24292E">));</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">suspend_always</span><span style="color: #24292E"> </span><span style="color: #6F42C1">initial_suspend</span><span style="color: #24292E">() { </span><span style="color: #D73A49">return</span><span style="color: #24292E"> {}; }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">suspend_always</span><span style="color: #24292E"> </span><span style="color: #6F42C1">final_suspend</span><span style="color: #24292E">() </span><span style="color: #D73A49">noexcept</span><span style="color: #24292E"> { </span><span style="color: #D73A49">return</span><span style="color: #24292E"> {}; }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">return_value</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">v</span><span style="color: #24292E">) {_value </span><span style="color: #D73A49">=</span><span style="color: #24292E"> v;}</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> </span><span style="color: #6F42C1">yield_value</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">v</span><span style="color: #24292E">) { _value </span><span style="color: #D73A49">=</span><span style="color: #24292E"> v; </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::suspend_always{};}</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">unhandled_exception</span><span style="color: #24292E">() {}</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get</span><span style="color: #24292E">(){</span><span style="color: #D73A49">return</span><span style="color: #24292E"> _value;}</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">int</span><span style="color: #24292E"> _value;</span><span style="color: #6A737D"> // 存储协程返回值</span></span>
<span class="line"><span style="color: #24292E">  };</span></span>
<span class="line"><span style="color: #6A737D">  // 通过构造函数传给新创建的对象</span></span>
<span class="line"><span style="color: #6A737D">  // 调用了协程句柄的resume函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">coroutine_handle</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">promise_type</span><span style="color: #24292E">&gt; </span><span style="color: #E36209">h</span><span style="color: #24292E">) : </span><span style="color: #6F42C1">handle</span><span style="color: #24292E">(h) {}</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">operator</span><span style="color: #24292E"> </span><span style="color: #6F42C1">bool</span><span style="color: #24292E">(){</span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">!</span><span style="color: #24292E">handle.</span><span style="color: #6F42C1">done</span><span style="color: #24292E">();}</span><span style="color: #6A737D"> // 重载bool运算符，判断协程是否完成</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    handle.</span><span style="color: #6F42C1">resume</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 恢复协程执行</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> handle.</span><span style="color: #6F42C1">promise</span><span style="color: #24292E">().</span><span style="color: #6F42C1">get</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 获取协程返回值</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::coroutine_handle</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">promise_type</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> handle;</span><span style="color: #6A737D"> // 封装了一个指向协程帧的指针，并提供函数</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fib</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">, b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">, n </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">40</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">co_yield</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">co_yield</span><span style="color: #24292E"> b;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">(n</span><span style="color: #D73A49">--</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> r </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a</span><span style="color: #D73A49">+</span><span style="color: #24292E">b;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">co_yield</span><span style="color: #24292E"> r;</span><span style="color: #6A737D"> // 每生成一项就把协程挂起，等待外部调用resume函数</span></span>
<span class="line"><span style="color: #24292E">    a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> b;</span></span>
<span class="line"><span style="color: #24292E">    b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> r;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">co_return</span><span style="color: #24292E"> a</span><span style="color: #D73A49">+</span><span style="color: #24292E">b;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  MyCoroutine coro </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fib</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">(coro){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> value </span><span style="color: #D73A49">=</span><span style="color: #24292E"> coro.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;value= &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> value </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="co_await">co_await</h3>
<p>语法：<code>co_await 表达式</code></p>
<p>表达式可以是可等待对象，重载co_await()运算符，也可以是一个promise类型的await_transform()函数，将表达式作为函数参数并返回可等待对象</p>
<p>可等待类型awaitable的定义如下：</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">awaitable</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">bool</span><span style="color: #24292E"> </span><span style="color: #6F42C1">await_ready</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">await_suspend</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">coroutine_handle</span><span style="color: #24292E">&lt;&gt; </span><span style="color: #E36209">h</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> </span><span style="color: #6F42C1">await_resume</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">};</span></span></code></pre></div></div></figure>
<p>调用对象时，首先调用await_ready()，若返回值为false，则调用await_suspend()让程序挂起，当协程继续执行后，会接下来执行await_resume()，若返回值为true，则直接执行await_resume()</p>
<p>内置类型suspend_always中await_ready()返回false，其余两个函数什么都不做，作用是将程序挂起</p>
<p>内置类型suspend_never中await_ready()返回true，其余两个函数什么都不做</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;coroutine&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;thread&gt;</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">promise</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E">: std::</span><span style="color: #6F42C1">coroutine_handle</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">promise</span><span style="color: #24292E">&gt;{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #6F42C1">promise_type</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> ::</span><span style="color: #6F42C1">promise</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">promise</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get_return_object</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> {</span><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E">::</span><span style="color: #6F42C1">from_promise</span><span style="color: #24292E">(</span><span style="color: #D73A49">*</span><span style="color: #005CC5">this</span><span style="color: #24292E">)};</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> </span><span style="color: #6F42C1">initial_suspend</span><span style="color: #24292E">() { </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::suspend_always{}; }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> </span><span style="color: #6F42C1">final_suspend</span><span style="color: #24292E">() </span><span style="color: #D73A49">noexcept</span><span style="color: #24292E"> { </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::suspend_always{}; }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">unhandled_exception</span><span style="color: #24292E">() {}</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">awaitable</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">bool</span><span style="color: #24292E"> </span><span style="color: #6F42C1">await_ready</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;await_ready called&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 返回false表示协程需要挂起</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">await_suspend</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">coroutine_handle</span><span style="color: #24292E">&lt;&gt; </span><span style="color: #E36209">h</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;await_suspend called&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #6A737D">    // 在这里可以执行一些异步操作</span></span>
<span class="line"><span style="color: #6A737D">    // ...</span></span>
<span class="line"><span style="color: #24292E">      h.</span><span style="color: #6F42C1">resume</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 恢复协程执行</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> </span><span style="color: #6F42C1">await_resume</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;await_resume called&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">666</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 返回协程的结果</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};  </span></span>
<span class="line"></span>
<span class="line"><span style="color: #6F42C1">MyCoroutine</span><span style="color: #24292E"> </span><span style="color: #6F42C1">coroFunc</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;coroFunc started&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">co_await</span><span style="color: #24292E"> awaitable{};</span><span style="color: #6A737D"> // 使用协程挂起</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;coroFunc resumed&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  MyCoroutine coro </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">coroFunc</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;main started&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  coro.</span><span style="color: #6F42C1">resume</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 恢复协程执行</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;main finished&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">main started</span></span>
<span class="line"><span style="color: #24292E">coroFunc started</span></span>
<span class="line"><span style="color: #24292E">await_ready called</span></span>
<span class="line"><span style="color: #24292E">await_suspend called</span></span>
<span class="line"><span style="color: #24292E">await_resume called</span></span>
<span class="line"><span style="color: #24292E">coroFunc resumed</span></span>
<span class="line"><span style="color: #24292E">main finished</span></span></code></pre></div></div></figure>
<p>根据返回结果，证明了函数调用的顺序是ready-&gt;suspend-&gt;resume</p>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
      </tags>
  </entry>
  <entry>
    <title>【C++】异常</title>
    <url>/C++/%E5%BC%82%E5%B8%B8%E4%B8%8E%E9%94%99%E8%AF%AF/</url>
    <content><![CDATA[<h1 id="异常与错误">异常与错误</h1>
<h2 id="传统错误处理">传统错误处理</h2>
<p>C风格的传统错误处理通常通过在出现异常时返回一个异常值(如-1)，main函数捕获到了异常值后，进行对应的提示与操作</p>
<p>如sqrt函数中，当输入值小于0时，返回-1，main函数捕获后输出错误信息，因为这里可以保证sqrt操作返回的都是非负数，所以可以设置-1值</p>
<p>进步之处：错误信息的输出应由main决定，因为sqrt函数仅仅为一个计算函数，不应该涉及输入输出流</p>
<p>另一种方法：为了不与值域冲突，可以返回一个pair&lt;int,
bool&gt;，bool判断是否合法。但这样也会造成</p>
<p><strong>注意：报错与退出逻辑不应该直接写在被调用函数中，合适的方法应该是返回值</strong></p>
<h2 id="optional">Optional</h2>
<p>返回Optional数据类型，该类型可以表示一个可能存在也可能不存在的值</p>
<p>当发现异常值传入，我们可以返回一个空值<code>std::nullopt</code>，让main函数捕获</p>
<p>判断时可以使用以下方法：</p>
<ul>
<li><code>.has_value()</code>判断返回的是否是异常值</li>
<li>或直接用该类型变量判断是否是异常值（存在一个bool的显式转换）</li>
<li><code>.value()</code>获取正常值</li>
</ul>
<p>缺点：当有多种错误类型区分的需求便无法处理</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;optional&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;vector&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">optional</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt; </span><span style="color: #6F42C1">findIndex</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt;</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">data</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">value</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">size_t</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> data.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">(); </span><span style="color: #D73A49">++</span><span style="color: #24292E">i) {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (data[i] </span><span style="color: #D73A49">==</span><span style="color: #24292E"> value) {</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> i;</span><span style="color: #6A737D"> // 返回找到的索引</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::nullopt;</span><span style="color: #6A737D"> // 未找到</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> data </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span><span style="color: #005CC5">1</span><span style="color: #24292E">, </span><span style="color: #005CC5">2</span><span style="color: #24292E">, </span><span style="color: #005CC5">3</span><span style="color: #24292E">, </span><span style="color: #005CC5">4</span><span style="color: #24292E">, </span><span style="color: #005CC5">5</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> index </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">findIndex</span><span style="color: #24292E">(data, </span><span style="color: #005CC5">3</span><span style="color: #24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (index) {</span></span>
<span class="line"><span style="color: #24292E">    	</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;Found at index: &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E">index </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">    } </span><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    	</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;Value not found&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="错误码">错误码</h2>
<p>通过设置一个全局变量错误码，当出现对应错误时，设置对应错误码并返回-1，main函数捕获并根据错误码处理</p>
<p>错误码的设置可以参考<code>errno.h</code>中的宏定义设置</p>
<p>使用<code>strerror(errno)</code>来输出对应错误</p>
<p>使用<code>setlocate(LC_ALL, "zh-CN.UTF-8")</code></p>
<p>使用<code>perror</code> 在错误输出前加上一段描述加一个冒号</p>
<h2 id="异常">异常</h2>
<p>错误码的缺点：无法自动穿透调用栈，必须编写代码并每一层都检查并保存错误码，一直传递，有时候还需要转换；并且<strong>错误码无法携带更多完整信息</strong></p>
<p>这时我们需要使用异常，包含三个部分：try，catch，throw</p>
<ul>
<li>try用于检查后面大括号中代码块所产生的异常</li>
<li>catch用于捕获和处理上述异常</li>
<li>throw用于在try中抛出异常</li>
</ul>
<p>其中，throw抛出的异常可以是标准库中定义的异常类，传入string类型的参数用于描述异常</p>
<p>e.g.</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #6F42C1">divide</span><span style="color: #24292E">(</span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (b</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">throw</span><span style="color: #24292E"> </span><span style="color: #6F42C1">runtime_error</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Divided by zero&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> a</span><span style="color: #D73A49">/</span><span style="color: #24292E">b;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">try</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> c</span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">divide</span><span style="color: #24292E">(</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> c </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">catch</span><span style="color: #24292E">(runtime_error</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> e){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;exception: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">e.</span><span style="color: #6F42C1">what</span><span style="color: #24292E">()</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl; </span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="throw">throw</h3>
<p>C++中可以将各种类型的变量、对象与指针作为异常抛出</p>
<p>对应在catch代码中要设置为对应类型即可捕获到对应异常</p>
<p>一般推荐使用自定义或标准库中的异常类，如可以创建错误类继承自<code>std::exception</code>类，并手动修改异常</p>
<h3 id="catch">catch</h3>
<p>catch代码块只能捕捉到括号中指定的类型，如果捕获的是类对象，则可以捕获到该类以及继承类中的对象</p>
<p>一个try代码块可以跟多个catch代码块，原则：越专用的越靠前，越通用的越靠后</p>
<p>对于未知异常，可以使用<code>catch(...)</code>捕获，不过不建议捕获自己代码无法处理的异常，而是留给能处理的代码或者让程序终止</p>
<h3 id="资源管理">资源管理</h3>
<p>当函数中内存释放的部分出现在了异常后，则会在抛出异常后结束函数，从而导致内存泄漏</p>
<p>我们可以使用类进行封装，当类对象被自动释放时，会调用析构函数进行释放</p>
<p>我们也可以使用智能指针来封装，当抛出异常后，封装的对象会被自动释放</p>
<p>上述资源管理的方式称为RAII(Resource Acquisition Is
Initialization)</p>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
      </tags>
  </entry>
  <entry>
    <title>【C++】并发编程</title>
    <url>/C++/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/</url>
    <content><![CDATA[<h1 id="并发编程">并发编程</h1>
<h2 id="多个任务的执行方式">多个任务的执行方式</h2>
<ul>
<li>顺序：一个接着一个</li>
<li>并行：同一时间执行多个任务（并行是并发的子集）</li>
<li>并发：多个任务在同一个重叠时间段执行</li>
</ul>
<h2 id="openmp">OpenMP</h2>
<p>使用<code>#prgma</code>预处理指令可以将代码转变为并行处理</p>
<p>此时需要在编译时添加参数<code>-fopenmp</code></p>
<p>e.g. 计算<span class="math inline">\(\pi\)</span></p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #6F42C1">cal</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #E36209">num_steps</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">double</span><span style="color: #24292E"> step </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1.0</span><span style="color: #D73A49">/</span><span style="color: #24292E">num_steps;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">double</span><span style="color: #24292E"> sum </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0.0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">#pragma</span><span style="color: #24292E"> </span><span style="color: #6F42C1">omp</span><span style="color: #24292E"> </span><span style="color: #6F42C1">parallel</span><span style="color: #24292E"> </span><span style="color: #6F42C1">for</span><span style="color: #24292E"> </span><span style="color: #6F42C1">reduction</span><span style="color: #24292E">(+:</span><span style="color: #6F42C1">sum</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">long</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">num_steps;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">double</span><span style="color: #24292E"> x </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (i</span><span style="color: #D73A49">+</span><span style="color: #005CC5">0.5</span><span style="color: #24292E">)</span><span style="color: #D73A49">*</span><span style="color: #24292E">step;</span></span>
<span class="line"><span style="color: #24292E">    sum</span><span style="color: #D73A49">+=</span><span style="color: #005CC5">4.0</span><span style="color: #D73A49">/</span><span style="color: #24292E">(</span><span style="color: #005CC5">1.0</span><span style="color: #D73A49">+</span><span style="color: #24292E">x</span><span style="color: #D73A49">*</span><span style="color: #24292E">x);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> sum</span><span style="color: #D73A49">*</span><span style="color: #24292E">step;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">cal</span><span style="color: #24292E">(</span><span style="color: #005CC5">10</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>其中第六行语句的意思：</p>
<ul>
<li><p><code>omp parallel for</code>表示将for循环每次循环转化为并行计算</p></li>
<li><p><code>reduction</code>表示用于reduce计算的变量与运算符</p></li>
<li><p>局部变量x在每个线程中修改，不影响其他线程</p></li>
<li><p>sum是共享对象，不能在并行线程中直接修改，否则导致数据竞争</p>
<p>sum需要reduce操作，其中reduction表明了需要reduce操作的变量与运算符</p></li>
</ul>
<h2 id="stl并行算法库">STL并行算法库</h2>
<p>使用<code>&lt;algorithm&gt;</code>与<code>&lt;numeric&gt;</code>库中的函数，可以简单实现并行</p>
<p>在支持并行的算法函数中，首个参数可以选择执行策略：</p>
<ul>
<li><code>std::execution::sequenced_policy</code>：顺序执行策略（实例：seq）</li>
<li><code>std::execution::parallel_policy</code>：并行执行策略（实例：par）</li>
<li><code>std::execution::parallel_unsequenced_policy</code>：多线程加向量化策略（实例：par_seq）</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;algorithm&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;execution&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;vector&gt;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> op </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [](</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">v</span><span style="color: #24292E">){</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> v </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;;</span><span style="color: #005CC5">\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">;};</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> numbers{</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">2</span><span style="color: #24292E">,</span><span style="color: #005CC5">3</span><span style="color: #24292E">,</span><span style="color: #005CC5">4</span><span style="color: #24292E">,</span><span style="color: #005CC5">5</span><span style="color: #24292E">,</span><span style="color: #005CC5">6</span><span style="color: #24292E">,</span><span style="color: #005CC5">7</span><span style="color: #24292E">,</span><span style="color: #005CC5">8</span><span style="color: #24292E">,</span><span style="color: #005CC5">9</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;sequential for_each&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">for_each</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">execution</span><span style="color: #24292E">::seq, numbers.</span><span style="color: #6F42C1">begin</span><span style="color: #24292E">(), numbers.</span><span style="color: #6F42C1">end</span><span style="color: #24292E">(), op);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;parallel for_each&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">for_each</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">execution</span><span style="color: #24292E">::par, numbers.</span><span style="color: #6F42C1">begin</span><span style="color: #24292E">(), numbers.</span><span style="color: #6F42C1">end</span><span style="color: #24292E">(), op);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;parallel unseq for_each&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">for_each</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">execution</span><span style="color: #24292E">::par_unseq, numbers.</span><span style="color: #6F42C1">begin</span><span style="color: #24292E">(), numbers.</span><span style="color: #6F42C1">end</span><span style="color: #24292E">(), op);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>以上没有对cout进行同步措施，会导致<strong>输出错误</strong></p>
<h2 id="线程">线程</h2>
<h3 id="线程与进程">线程与进程</h3>
<p>进程：程序执行过程，相互独立，操作系统为每一个进程分配一个执行控制块来控制进程</p>
<p>线程：进程中的执行过程，系统为每一个线程分配一个栈于线程控制块，线程间共享堆与全局数据</p>
<h3 id="创建线程">创建线程</h3>
<p>使用<code>&lt;thread&gt;</code>类创建线程</p>
<p><code>thread(F&amp;&amp; f, Args&amp;&amp;... args);</code></p>
<ul>
<li>第一个参数为线程的入口函数（线程函数），可以是各种可调用的对象</li>
<li>后面的Args为传递给可调用对象的实参</li>
<li>若第一个参数为非静态成员函数，则后面的第一个参数为调用这个成员函数的类对象地址</li>
</ul>
<p>thread的返回值会被忽略，故要使用按引用传递的参数，或存储在类对象的数据成员中</p>
<p>用该函数初始化后会创建一个新线程，执行线程函数</p>
<p>线程<strong>只能移动构造或移动赋值</strong>，防止多个线程对象代表一个执行线程</p>
<h3 id="join">.join()</h3>
<p>该函数会使得当前线程执行结束后等待其他线程回会合，避免出现提前结束导致出现错误</p>
<p>这种等待状态称为<strong>阻塞</strong>，若对应线程提前结束，则join函数也会直接返回</p>
<p>调用函数时，该线程必须是joinable的，意味着该线程必须是<strong>正在执行或执行完毕但未合并的线程</strong>，可以使用<code>.joinable()</code>判断是否可合并</p>
<p>不能被合并的情况：</p>
<ul>
<li>默认构造函数初始化的</li>
<li>join()完成的</li>
<li>detach()后的</li>
<li>被移动的</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;thread&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;array&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">greeting</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">idx</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Hello from thread </span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">, idx);</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::array</span><span style="color: #D73A49">&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread, </span><span style="color: #005CC5">10</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> workers;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">10</span><span style="color: #24292E">;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    workers[i] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">thread</span><span style="color: #24292E">(greeting, i);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">auto</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">workers:workers){</span></span>
<span class="line"><span style="color: #24292E">    workers.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">Hello from thread 0</span></span>
<span class="line"><span style="color: #24292e">Hello from thread 1</span></span>
<span class="line"><span style="color: #24292e">Hello from thread 2</span></span>
<span class="line"><span style="color: #24292e">Hello from thread 3</span></span>
<span class="line"><span style="color: #24292e">Hello from thread 4</span></span>
<span class="line"><span style="color: #24292e">Hello from thread 5</span></span>
<span class="line"><span style="color: #24292e">Hello from thread 6</span></span>
<span class="line"><span style="color: #24292e">Hello from thread 7</span></span>
<span class="line"><span style="color: #24292e">Hello from thread 8</span></span>
<span class="line"><span style="color: #24292e">Hello from thread 9</span></span></code></pre></div></div></figure>
<h3 id="fork-and-join">Fork and join</h3>
<p>可以使用线程实现并行</p>
<p>通过Fork and
join模式：把要执行的数据分成n份，由n个线程并行处理自己的那部分数据，再进行汇总，n可以根据cpu核心设置</p>
<p>实现简单，但对于复杂计算，相同数据处理时间不同，导致有些线程很早处理完毕，有的需要更长时间结束</p>
<blockquote>
<p>实现transform_reduce函数</p>
</blockquote>
<figure class="shiki C++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></div><div class="code"><pre><code>#include<thread>
#include<vector>
#include<array>
#include<iostream>
template<typename Iter, typename UnaryOp, typename BinaryOp, typename Result>
void transform_reduce(Iter first, Iter last, UnaryOp transform, BinaryOp reduce, Result& res){
  for (auto it=first;it<last;it++){
    res = reduce(res, transform(*it));
  }
}

int main(){
  const int N = 1000000;
  std::vector<double> numbers;
  numbers.reserve(N);
  for (int i = 0; i < N; ++i) {
    numbers.push_back((double)i/N);
  }
  auto transform = [](double x) { return x * x; };
  auto reduce = [](double x, double y) { return x + y; };
  const int N_thraeds = 8;
  std::vector<std::thread> workers;
  std::array<double, N_thraeds> subResults={};
  for (int i = 0; i<N_thraeds; i++){
    auto low = numbers.begin()+i*numbers.size()/N_thraeds;
    auto high = numbers.begin()+(i+1)*numbers.size()/N_thraeds;
    workers.push_back(
        std::thread(
        transform_reduce<std::vector<double>::iterator,
        decltype(transform),
        decltype(reduce),double>,
        low, high, transform, reduce, std::ref(subResults[i])
      )
    );
  }
  double result = 0;
  for (int i = 0; i < N_thraeds; ++i) {
    workers[i].join();
    result = reduce(result,subResults[i]);
  }
  std::cout << "Result: " << result << std::endl;
  return 0;
}</code></pre></div></div></figure>
<h3 id="divide-and-conquer">Divide and conquer</h3>
<p>使用分治将一个任务分成两个小任务，由两个线程完成，然后小任务再分成两个小任务，创建两个线程完成，直到不能分解</p>
<p>另外需要设计一个阈值，当线程过多时就不再创建，而是使用同步计算</p>
<p>为了让各个线程任务饱满，可以采用一半采用同步调用，一半分给另一个线程</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;thread&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;vector&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;array&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Iter</span><span style="color: #24292E">, </span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">UnaryOp</span><span style="color: #24292E">, </span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">BinaryOp</span><span style="color: #24292E">, </span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Result</span><span style="color: #24292E">, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #D73A49">size_t</span><span style="color: #24292E"> MinDist </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">transform_reduce</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Iter</span><span style="color: #24292E"> </span><span style="color: #E36209">first</span><span style="color: #24292E">, </span><span style="color: #6F42C1">Iter</span><span style="color: #24292E"> </span><span style="color: #E36209">last</span><span style="color: #24292E">, </span><span style="color: #6F42C1">UnaryOp</span><span style="color: #24292E"> </span><span style="color: #E36209">transform</span><span style="color: #24292E">, </span><span style="color: #6F42C1">BinaryOp</span><span style="color: #24292E"> </span><span style="color: #E36209">reduce</span><span style="color: #24292E">, </span><span style="color: #6F42C1">Result</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">res</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #D73A49">size_t</span><span style="color: #24292E"> distance </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">distance</span><span style="color: #24292E">(first, last);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (distance</span><span style="color: #D73A49">==</span><span style="color: #005CC5">1</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    res </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">reduce</span><span style="color: #24292E">(res, </span><span style="color: #6F42C1">transform</span><span style="color: #24292E">(</span><span style="color: #D73A49">*</span><span style="color: #24292E">first));</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">else</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #D73A49">size_t</span><span style="color: #24292E"> half </span><span style="color: #D73A49">=</span><span style="color: #24292E"> distance </span><span style="color: #D73A49">/</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    Iter middle </span><span style="color: #D73A49">=</span><span style="color: #24292E"> first</span><span style="color: #D73A49">+</span><span style="color: #24292E">half;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    Result r_result </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    Result l_result </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">l_thread</span><span style="color: #24292E">(</span></span>
<span class="line"><span style="color: #24292E">      transform_reduce</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">Iter, UnaryOp, BinaryOp, Result</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">,</span></span>
<span class="line"><span style="color: #24292E">      first, middle, transform, reduce, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">ref</span><span style="color: #24292E">(l_result)</span></span>
<span class="line"><span style="color: #24292E">    );</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">r_thread</span><span style="color: #24292E">(</span></span>
<span class="line"><span style="color: #24292E">      transform_reduce</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">Iter, UnaryOp, BinaryOp, Result</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">,</span></span>
<span class="line"><span style="color: #24292E">      middle, last, transform, reduce, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">ref</span><span style="color: #24292E">(r_result)</span></span>
<span class="line"><span style="color: #24292E">    );</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    l_thread.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    r_thread.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    res </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">reduce</span><span style="color: #24292E">(res, </span><span style="color: #6F42C1">reduce</span><span style="color: #24292E">(l_result, r_result));</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="promise-future">promise &amp; future</h2>
<p>这两个类提供了线程之间简单的通信机制</p>
<p>通过promise来设置值或异常，通过future来获得值或异常</p>
<p>一对promise&amp;future共享一个shared
state（共享状态），是一个类对象，提供了在保证线程安全的情况下，设置和获取状态与结果的方法，使用shared_ptr指向该状态</p>
<p>常用于发送-接受模式中</p>
<h3 id="promise">promise</h3>
<p>promise类模板提供了按值、按引用传递数据，以及仅传递信号三种版本</p>
<p>对应的成员函数：</p>
<ul>
<li>promise()：构造函数，创建一个共享状态</li>
<li>promise(promise&amp;&amp;
x)：移动构造函数，将被移动对象x的共享状态转移过去</li>
<li>get_future()：创建一个future对象，使用promise中的共享状态，<strong>只能调用一次</strong></li>
<li>set_value()：设置共享状态中的值，并设置为就绪状态</li>
<li>set_exception()：设置共享状态的异常</li>
</ul>
<p><strong>注：为了保证一对一性，promise类删除了拷贝构造函数</strong></p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;future&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">compute_pi</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #E36209">num_steps</span><span style="color: #24292E">, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">promise</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">double</span><span style="color: #24292E">&gt;</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">promise</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">double</span><span style="color: #24292E"> step </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1.0</span><span style="color: #D73A49">/</span><span style="color: #24292E"> num_steps;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">double</span><span style="color: #24292E"> sum </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0.0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">long</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> num_steps; </span><span style="color: #D73A49">++</span><span style="color: #24292E">i){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">double</span><span style="color: #24292E"> x </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (i </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">0.5</span><span style="color: #24292E">) </span><span style="color: #D73A49">*</span><span style="color: #24292E"> step;</span></span>
<span class="line"><span style="color: #24292E">    sum </span><span style="color: #D73A49">+=</span><span style="color: #24292E"> </span><span style="color: #005CC5">4.0</span><span style="color: #24292E"> </span><span style="color: #D73A49">/</span><span style="color: #24292E"> (</span><span style="color: #005CC5">1.0</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> x </span><span style="color: #D73A49">*</span><span style="color: #24292E"> x);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  promise.</span><span style="color: #6F42C1">set_value</span><span style="color: #24292E">(sum </span><span style="color: #D73A49">*</span><span style="color: #24292E"> step);</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">display</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">future</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">double</span><span style="color: #24292E">&gt;</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">receiver</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">double</span><span style="color: #24292E"> pi </span><span style="color: #D73A49">=</span><span style="color: #24292E"> receiver.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;Computed value of Pi: &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> pi </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N_steps </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">100000000</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::promise</span><span style="color: #D73A49">&lt;double&gt;</span><span style="color: #24292E"> promise;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> receiver </span><span style="color: #D73A49">=</span><span style="color: #24292E"> promise.</span><span style="color: #6F42C1">get_future</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 调用获得future对象后就没什么用了</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">th1</span><span style="color: #24292E">(compute_pi, N_steps, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">move</span><span style="color: #24292E">(promise));</span><span style="color: #6A737D"> // 将promose对象转换为xvalue，作为实参换入</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">th2</span><span style="color: #24292E">(display, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">move</span><span style="color: #24292E">(receiver));</span></span>
<span class="line"><span style="color: #24292E">  th1.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  th2.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="future">future</h3>
<p>future中的方法主要用于获取状态与结果</p>
<ul>
<li>get()：获得结果，若对应结果没有处在就绪状态，那么这个调用会阻塞直到就绪</li>
<li>wait()：等待状态就绪，之后返回，此时调用get可以直接获得结果</li>
<li>wait_for()：等待指定时长，返回状态码</li>
<li>wait_until()：等待到指定时刻，返回状态码</li>
<li>share()：</li>
</ul>
<p>状态码包括：</p>
<ul>
<li>ready：共享状态就绪</li>
<li>timeout：超时</li>
<li>deferred：共享状态中有延缓执行的函数（显式请求中才会调用的函数）</li>
</ul>
<p>若需要让多个线程获得结果，需要shared_future，构建方法如下：</p>
<ul>
<li>定义对象，使用promise的get_future()作为初始化参数</li>
<li>在原有future上调用方法.share()，此时原有不再使用</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;future&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;sstream&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">compute_pi</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #E36209">num_steps</span><span style="color: #24292E">, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">promise</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">double</span><span style="color: #24292E">&gt;</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">promise</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">double</span><span style="color: #24292E"> step </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1.0</span><span style="color: #D73A49">/</span><span style="color: #24292E"> num_steps;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">double</span><span style="color: #24292E"> sum </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0.0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">long</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> num_steps; </span><span style="color: #D73A49">++</span><span style="color: #24292E">i){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">double</span><span style="color: #24292E"> x </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (i </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">0.5</span><span style="color: #24292E">) </span><span style="color: #D73A49">*</span><span style="color: #24292E"> step;</span></span>
<span class="line"><span style="color: #24292E">    sum </span><span style="color: #D73A49">+=</span><span style="color: #24292E"> </span><span style="color: #005CC5">4.0</span><span style="color: #24292E"> </span><span style="color: #D73A49">/</span><span style="color: #24292E"> (</span><span style="color: #005CC5">1.0</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> x </span><span style="color: #D73A49">*</span><span style="color: #24292E"> x);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  promise.</span><span style="color: #6F42C1">set_value</span><span style="color: #24292E">(sum </span><span style="color: #D73A49">*</span><span style="color: #24292E"> step);</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">display</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">shared_future</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">double</span><span style="color: #24292E">&gt; </span><span style="color: #E36209">reveiver</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::mutex mu;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">double</span><span style="color: #24292E"> pi </span><span style="color: #D73A49">=</span><span style="color: #24292E"> reveiver.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Computed value of Pi: </span><span style="color: #005CC5">%f\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">, pi);</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N_steps </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">100000000</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::promise</span><span style="color: #D73A49">&lt;double&gt;</span><span style="color: #24292E"> promise;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::shared_future</span><span style="color: #D73A49">&lt;double&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">shared_receiver</span><span style="color: #24292E">(promise.</span><span style="color: #6F42C1">get_future</span><span style="color: #24292E">());</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">th1</span><span style="color: #24292E">(compute_pi, N_steps, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">move</span><span style="color: #24292E">(promise));</span></span>
<span class="line"><span style="color: #6A737D">  // 使用shared_future可以让多个线程共享同一个future对象</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">th2</span><span style="color: #24292E">(display, shared_receiver);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">th3</span><span style="color: #24292E">(display, shared_receiver);</span></span>
<span class="line"><span style="color: #24292E">  th1.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  th2.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  th3.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="互斥和锁">互斥和锁</h2>
<p>多线程中，当多个线程队同一个对象进行访问，并且至少有一个在写数据时，会产生数据竞争</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;array&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;thread&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">inc</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">res</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">1000000</span><span style="color: #24292E">; </span><span style="color: #D73A49">++</span><span style="color: #24292E">i){</span></span>
<span class="line"><span style="color: #24292E">    res</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> counter </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">th1</span><span style="color: #24292E">(inc, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">ref</span><span style="color: #24292E">(counter));</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">th2</span><span style="color: #24292E">(inc, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">ref</span><span style="color: #24292E">(counter));</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  th1.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  th2.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;Counter: &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> counter </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>该程序创建了两个线程进行累加，但最后得到的结果都不是正确结果，且每次都不一样</p>
<p><img src="并行编程/image-20250725112934180.png" alt="正常" style="zoom:50%;" /></p>
<p>这是一个正常的执行过程</p>
<p><img src="并行编程/image-20250725113007523.png" alt="错误执行" style="zoom:50%;" /></p>
<p>若顺序是这样结果就不对了</p>
<h3 id="互斥量">互斥量</h3>
<p>C++中所有运算默认为<strong>非原子操作</strong>，即该线程操作随时会被终端或被其他线程访问</p>
<p>mutex提供了一种同步机制，实现多个线程的安全访问</p>
<p>C++11开始，提供了<code>std::mutex</code>来实现互斥原语，是最常用的同步原语之一</p>
<p>有三个主要函数：</p>
<ul>
<li>lock()：锁定互斥量，即获得互斥量，若已经被其他线程锁定，则会进入阻塞直到被解锁</li>
<li>try_lock()：尝试锁定互斥量，若成功锁定则返回true，否则返回false（不保证被其他线程锁定）</li>
<li>unlock()：解锁，释放互斥量</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;array&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;thread&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;mutex&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">counter</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">inc</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">    // 对要修改的资源进行保护</span></span>
<span class="line"><span style="color: #6A737D">    // 保证同一时间只有一个线程可以修改资源</span></span>
<span class="line"><span style="color: #6A737D">    // 即要么获得互斥量的锁，要么等待</span></span>
<span class="line"><span style="color: #24292E">    counter_mutex.</span><span style="color: #6F42C1">lock</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    m_count</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 临界区</span></span>
<span class="line"><span style="color: #24292E">    counter_mutex.</span><span style="color: #6F42C1">unlock</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> temp;</span></span>
<span class="line"><span style="color: #24292E">    counter_mutex.</span><span style="color: #6F42C1">lock</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    temp </span><span style="color: #D73A49">=</span><span style="color: #24292E"> m_count;</span><span style="color: #6A737D"> // 临界区</span></span>
<span class="line"><span style="color: #24292E">    counter_mutex.</span><span style="color: #6F42C1">unlock</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> temp;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> m_count </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::mutex counter_mutex;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  counter c;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> increase </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [](</span><span style="color: #6F42C1">counter</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">c</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">1000000</span><span style="color: #24292E">; </span><span style="color: #D73A49">++</span><span style="color: #24292E">i){</span></span>
<span class="line"><span style="color: #24292E">      c.</span><span style="color: #6F42C1">inc</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  };</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">th1</span><span style="color: #24292E">(increase, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">ref</span><span style="color: #24292E">(c));</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">th2</span><span style="color: #24292E">(increase, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">ref</span><span style="color: #24292E">(c));</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  th1.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  th2.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;Counter: &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> c.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">() </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>其中，被mutex保护的操作区域叫做<strong>临界区</strong></p>
<p>为了避免未释放互斥量的问题，我们通常结合以下对象使用</p>
<ul>
<li>lock_guard()：可以通过调用上锁后自动解锁，防止忘记解锁以及出现异常离开作用域时没有解锁</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">counter</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">inc</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::lock_guard </span><span style="color: #6F42C1">lock</span><span style="color: #24292E">(counter_mutex);</span></span>
<span class="line"><span style="color: #24292E">    m_count</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 临界区</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::lock_guard </span><span style="color: #6F42C1">lock</span><span style="color: #24292E">(counter_mutex);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> m_count;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> m_count </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::mutex counter_mutex;</span></span>
<span class="line"><span style="color: #24292E">};</span></span></code></pre></div></div></figure>
<ul>
<li>unique_lock()：更加灵活，可以随时指定锁定与解锁</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;array&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;thread&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;mutex&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">counter</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">inc</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">n</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::unique_lock </span><span style="color: #6F42C1">lock</span><span style="color: #24292E">(counter_mutex, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::defer_lock);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E">(n</span><span style="color: #D73A49">--</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      lock.</span><span style="color: #6F42C1">lock</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 对要修改的资源进行保护</span></span>
<span class="line"><span style="color: #24292E">      m_count</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 临界区</span></span>
<span class="line"><span style="color: #24292E">      lock.</span><span style="color: #6F42C1">unlock</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::unique_lock </span><span style="color: #6F42C1">lock</span><span style="color: #24292E">(counter_mutex);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> m_count; </span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> m_count </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::mutex counter_mutex;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  counter c;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> increase </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [](</span><span style="color: #6F42C1">counter</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">c</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    c.</span><span style="color: #6F42C1">inc</span><span style="color: #24292E">(</span><span style="color: #005CC5">1000000</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  };</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">th1</span><span style="color: #24292E">(increase, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">ref</span><span style="color: #24292E">(c));</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">th2</span><span style="color: #24292E">(increase, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">ref</span><span style="color: #24292E">(c));</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  th1.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  th2.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;Counter: &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> c.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">() </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<ul>
<li>timed_mutex：有等待时长的互斥
<ul>
<li>try_lock_for()：指定时长内获得mutex的所有权</li>
<li>try_lock_until()：指定时刻前获得mutex的所有权</li>
</ul></li>
</ul>
<p>​ 返回true表明获得mutex，否则返回false</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;mutex&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;thread&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;chrono&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;sstream&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">chrono_literals</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">TryDemo</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">print</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">10</span><span style="color: #24292E">; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::unique_lock </span><span style="color: #6F42C1">lock</span><span style="color: #24292E">(m_mutex, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::defer_lock);</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (lock.</span><span style="color: #6F42C1">try_lock_for</span><span style="color: #24292E">(</span><span style="color: #005CC5">100</span><span style="color: #D73A49">ms</span><span style="color: #24292E">)) {</span></span>
<span class="line"><span style="color: #24292E">        {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::lock_guard </span><span style="color: #6F42C1">guard</span><span style="color: #24292E">(cout_mutex);</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;[&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">this_thread</span><span style="color: #24292E">::</span><span style="color: #6F42C1">get_id</span><span style="color: #24292E">()</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;] &quot;</span></span>
<span class="line"><span style="color: #24292E">                  </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;Got the lock, printing &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> i </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">this_thread</span><span style="color: #24292E">::</span><span style="color: #6F42C1">sleep_for</span><span style="color: #24292E">(</span><span style="color: #005CC5">100</span><span style="color: #D73A49">ms</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">      }</span><span style="color: #6A737D"> // 尝试获取锁，</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">else</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::lock_guard </span><span style="color: #6F42C1">guard</span><span style="color: #24292E">(cout_mutex);</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;[&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">this_thread</span><span style="color: #24292E">::</span><span style="color: #6F42C1">get_id</span><span style="color: #24292E">()</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;] &quot;</span></span>
<span class="line"><span style="color: #24292E">                  </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;Failed to get the lock, skipping &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> i </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">this_thread</span><span style="color: #24292E">::</span><span style="color: #6F42C1">sleep_for</span><span style="color: #24292E">(</span><span style="color: #005CC5">100</span><span style="color: #D73A49">ms</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">       }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::timed_mutex m_mutex;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::mutex cout_mutex; </span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> m_count </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  TryDemo demo;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> print </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [](</span><span style="color: #6F42C1">TryDemo</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">demo</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    demo.</span><span style="color: #6F42C1">print</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  };</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">th1</span><span style="color: #24292E">(print, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">ref</span><span style="color: #24292E">(demo));</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">th2</span><span style="color: #24292E">(print, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">ref</span><span style="color: #24292E">(demo));</span></span>
<span class="line"><span style="color: #24292E">  th1.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  th2.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">[2] Got the lock, printing 0</span></span>
<span class="line"><span style="color: #24292e">[3] Failed to get the lock, skipping 0</span></span>
<span class="line"><span style="color: #24292e">[2] Got the lock, printing 1</span></span>
<span class="line"><span style="color: #24292e">[3] Failed to get the lock, skipping 1</span></span>
<span class="line"><span style="color: #24292e">[2] Got the lock, printing 2</span></span>
<span class="line"><span style="color: #24292e">[3] Failed to get the lock, skipping 2</span></span>
<span class="line"><span style="color: #24292e">[2] Got the lock, printing 3</span></span>
<span class="line"><span style="color: #24292e">[3] Failed to get the lock, skipping 3</span></span>
<span class="line"><span style="color: #24292e">[2] Got the lock, printing 4</span></span>
<span class="line"><span style="color: #24292e">[3] Failed to get the lock, skipping 4</span></span>
<span class="line"><span style="color: #24292e">[2] Got the lock, printing 5</span></span>
<span class="line"><span style="color: #24292e">[2] Got the lock, printing 6</span></span>
<span class="line"><span style="color: #24292e">[3] Failed to get the lock, skipping 5        </span></span>
<span class="line"><span style="color: #24292e">[3] Got the lock, printing 6</span></span>
<span class="line"><span style="color: #24292e">[3] Got the lock, printing 7</span></span>
<span class="line"><span style="color: #24292e">[2] Failed to get the lock, skipping 7        </span></span>
<span class="line"><span style="color: #24292e">[2] Got the lock, printing 8</span></span>
<span class="line"><span style="color: #24292e">[3] Failed to get the lock, skipping 8</span></span>
<span class="line"><span style="color: #24292e">[2] Got the lock, printing 9</span></span>
<span class="line"><span style="color: #24292e">[3] Failed to get the lock, skipping 9</span></span></code></pre></div></div></figure>
<h3 id="死锁">死锁</h3>
<p>单一线程中多次锁定同一个互斥量会导致死锁</p>
<p>常见死锁：</p>
<figure class="shiki C++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div><div class="code"><pre><code>#include<iostream>
#include<mutex>
#include<thread>

class dosome{
public:
  int f1(){
    std::lock_guard lock(mtx);
    count*=2;
    f2();
    return count;

  }
  void f2(){
    std::lock_guard(mtx); // 已经在外层被锁定过了
    count++;
  }
private:
  std::mutex mtx;
  int count=0;
};</code></pre></div></div></figure>
<p>此时所在线程会进入阻塞状态</p>
<p>我们使用`<code>recursive</code>的mutx优化</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;mutex&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;thread&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">dosome</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f1</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::lock_guard </span><span style="color: #6F42C1">lock</span><span style="color: #24292E">(mtx);</span></span>
<span class="line"><span style="color: #24292E">    count</span><span style="color: #D73A49">*=</span><span style="color: #005CC5">2</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">f2</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> count;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f2</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">lock_guard</span><span style="color: #24292E">(mtx);</span><span style="color: #6A737D"> // 已经在外层被锁定过了</span></span>
<span class="line"><span style="color: #24292E">    count</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::recursive_mutex mtx;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> count</span><span style="color: #D73A49">=</span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">};</span></span></code></pre></div></div></figure>
<p>当被锁定并获得互斥量后，当前线程再调用lock后仍会成功而不会阻塞，直到调用相同数量的unlock()才会被释放</p>
<h3 id="多线程中">多线程中</h3>
<p>多线程中，导致死锁原因较多</p>
<ol type="1">
<li>锁定一个互斥量后没有释放，导致后面的线程获取该互斥量时进入阻塞状态</li>
</ol>
<p>解决方法：使用<strong>RAII</strong>，即使用lock_guard等自动对象，在离开作用域后自动释放互斥量</p>
<ol start="2" type="1">
<li>同时对多个互斥量锁定解锁时，获得和释放顺序不同导致死锁</li>
</ol>
<p>如以下代码</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;mutex&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;thread&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;chrono&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">chrono_literals</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">dosome</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f1</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    {</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::lock_guard </span><span style="color: #6F42C1">lock1</span><span style="color: #24292E">(mtx1);</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::lock_guard </span><span style="color: #6F42C1">lock2</span><span style="color: #24292E">(cout_mtx);</span></span>
<span class="line"><span style="color: #24292E">      count</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;count: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">count</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">this_thread</span><span style="color: #24292E">::</span><span style="color: #6F42C1">sleep_for</span><span style="color: #24292E">(</span><span style="color: #005CC5">1</span><span style="color: #D73A49">ms</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">   </span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f2</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    {</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::lock_guard </span><span style="color: #6F42C1">lock1</span><span style="color: #24292E">(cout_mtx);</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::lock_guard </span><span style="color: #6F42C1">lock2</span><span style="color: #24292E">(mtx1); </span></span>
<span class="line"><span style="color: #24292E">      count</span><span style="color: #D73A49">--</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;count: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">count</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">this_thread</span><span style="color: #24292E">::</span><span style="color: #6F42C1">sleep_for</span><span style="color: #24292E">(</span><span style="color: #005CC5">1</span><span style="color: #D73A49">ms</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">calc</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">n</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (n</span><span style="color: #D73A49">%</span><span style="color: #005CC5">2</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">f2</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">else</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">f1</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::mutex mtx1;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::mutex cout_mtx;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> count</span><span style="color: #D73A49">=</span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  dosome d;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N1 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10000</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N2 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10001</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">th1</span><span style="color: #24292E">(</span><span style="color: #6F42C1">dosome</span><span style="color: #24292E">::calc, </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">d, N1);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">th2</span><span style="color: #24292E">(</span><span style="color: #6F42C1">dosome</span><span style="color: #24292E">::calc, </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">d, N2);</span></span>
<span class="line"><span style="color: #24292E">  th1.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  th2.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>这里f1与f2都对两个互斥量进行锁定，顺序不同</p>
<p>主函数设置两个线程分别为10000次，执行f1，10001次，执行f2</p>
<p>此时运行程序会在一定时间发生死锁：</p>
<p>线程1在某个时刻获得了mtx1，线程2在下一时刻获得了cout_mtx</p>
<p>接下来线程1需要获得cout_mtx，但已被2占有，需要进入阻塞等待资源释放</p>
<p>同时线程2需要获得mtx1，但已被1占有，需要进入阻塞等待资源释放</p>
<p>故整个程序进入阻塞，无法执行</p>
<figure>
<img src="并行编程/image-20250727151242766.png" alt="阻塞" />
<figcaption aria-hidden="true">阻塞</figcaption>
</figure>
<h3 id="活锁">活锁</h3>
<p>对于上述问题，解决方法之一是使用timed_mutex+try_lock_for</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;mutex&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;thread&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;chrono&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">chrono_literals</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">dosome</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f1</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E">(</span><span style="color: #005CC5">1</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::unique_lock </span><span style="color: #6F42C1">lock1</span><span style="color: #24292E">(mtx1, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::defer_lock);</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::unique_lock </span><span style="color: #6F42C1">lock2</span><span style="color: #24292E">(cout_mtx, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::defer_lock);</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">lock1.</span><span style="color: #6F42C1">try_lock_for</span><span style="color: #24292E">(</span><span style="color: #005CC5">100</span><span style="color: #D73A49">ms</span><span style="color: #24292E">)) </span><span style="color: #D73A49">continue</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">lock2.</span><span style="color: #6F42C1">try_lock_for</span><span style="color: #24292E">(</span><span style="color: #005CC5">100</span><span style="color: #D73A49">ms</span><span style="color: #24292E">)) </span><span style="color: #D73A49">continue</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">      count</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;count: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">count</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">break</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f2</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E">(</span><span style="color: #005CC5">1</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::unique_lock </span><span style="color: #6F42C1">lock1</span><span style="color: #24292E">(cout_mtx, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::defer_lock);</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::unique_lock </span><span style="color: #6F42C1">lock2</span><span style="color: #24292E">(mtx1, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::defer_lock);</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">lock1.</span><span style="color: #6F42C1">try_lock_for</span><span style="color: #24292E">(</span><span style="color: #005CC5">100</span><span style="color: #D73A49">ms</span><span style="color: #24292E">)) </span><span style="color: #D73A49">continue</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">lock2.</span><span style="color: #6F42C1">try_lock_for</span><span style="color: #24292E">(</span><span style="color: #005CC5">100</span><span style="color: #D73A49">ms</span><span style="color: #24292E">)) </span><span style="color: #D73A49">continue</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">      count</span><span style="color: #D73A49">--</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;count: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">count</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">break</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">calc</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">n</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (n</span><span style="color: #D73A49">%</span><span style="color: #005CC5">2</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">f2</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">else</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">f1</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::timed_mutex mtx1;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::timed_mutex cout_mtx;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> count</span><span style="color: #D73A49">=</span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  dosome d;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N1 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10000</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N2 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10001</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">th1</span><span style="color: #24292E">(</span><span style="color: #6F42C1">dosome</span><span style="color: #24292E">::calc, </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">d, N1);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">th2</span><span style="color: #24292E">(</span><span style="color: #6F42C1">dosome</span><span style="color: #24292E">::calc, </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">d, N2);</span></span>
<span class="line"><span style="color: #24292E">  th1.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  th2.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>但是运行起来会出现一顿一顿的情况</p>
<p>此时程序进入了一种<strong>活锁</strong>的状态，即</p>
<p>线程1锁定mtx1，线程2锁定cout_mtx</p>
<p>线程1试图锁定cout_mtx1失败，进入阻塞，超时后释放mtx1进入下个循环，</p>
<p>线程2试图锁定mtx1失败，进入阻塞，超时后释放cout_mtx进入下个循环</p>
<p>以此类推</p>
<p>防止该情况的发生，需要注意调用次序，注意保证按照顺序获得互斥量</p>
<p>更加方便的方法是使用std::lock()函数或scope_lock类统一管理多个互斥量</p>
<h3 id="lock函数">lock函数</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;mutex&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;thread&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;chrono&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">chrono_literals</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">dosome</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f1</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    {</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">lock</span><span style="color: #24292E">(mtx1, cout_mtx);</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::lock_guard </span><span style="color: #6F42C1">lock1</span><span style="color: #24292E">(mtx1, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::adopt_lock);</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::lock_guard </span><span style="color: #6F42C1">lock2</span><span style="color: #24292E">(cout_mtx, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::adopt_lock);</span></span>
<span class="line"><span style="color: #24292E">      count</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;count: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">count</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f2</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    {</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">lock</span><span style="color: #24292E">(mtx1, cout_mtx);</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::lock_guard </span><span style="color: #6F42C1">lock1</span><span style="color: #24292E">(cout_mtx, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::adopt_lock);</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::lock_guard </span><span style="color: #6F42C1">lock2</span><span style="color: #24292E">(mtx1, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::adopt_lock); </span></span>
<span class="line"><span style="color: #24292E">      count</span><span style="color: #D73A49">--</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;count: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">count</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">calc</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">n</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (n</span><span style="color: #D73A49">%</span><span style="color: #005CC5">2</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">f2</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">else</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">f1</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::mutex mtx1;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::mutex cout_mtx;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> count</span><span style="color: #D73A49">=</span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  dosome d;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N1 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10000</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N2 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10001</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">th1</span><span style="color: #24292E">(</span><span style="color: #6F42C1">dosome</span><span style="color: #24292E">::calc, </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">d, N1);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">th2</span><span style="color: #24292E">(</span><span style="color: #6F42C1">dosome</span><span style="color: #24292E">::calc, </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">d, N2);</span></span>
<span class="line"><span style="color: #24292E">  th1.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  th2.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>此时lock函数会接管下面的两个lock_guard，当他们被销毁时，析构函数中会自动释放两个互斥量</p>
<p>即使传入的两个互斥量顺序不同，lock的特殊算法也可避免死锁的发生</p>
<h3 id="scope_lock类">scope_lock类</h3>
<p>该类更加方便，使用多个类进行初始化</p>
<p>构造时可以自动调用lock函数，析构时自动释放</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;mutex&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;thread&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;chrono&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">chrono_literals</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">dosome</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f1</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    {</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::scoped_lock </span><span style="color: #6F42C1">lock</span><span style="color: #24292E">(mtx1, cout_mtx);</span></span>
<span class="line"><span style="color: #24292E">      count</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;count: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">count</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f2</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    {</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::scoped_lock </span><span style="color: #6F42C1">lock</span><span style="color: #24292E">(cout_mtx, mtx1);</span></span>
<span class="line"><span style="color: #24292E">      count</span><span style="color: #D73A49">--</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;count: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">count</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">calc</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">n</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (n</span><span style="color: #D73A49">%</span><span style="color: #005CC5">2</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">f2</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">else</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">f1</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::mutex mtx1;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::mutex cout_mtx;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> count</span><span style="color: #D73A49">=</span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  dosome d;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N1 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10000</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N2 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10001</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">th1</span><span style="color: #24292E">(</span><span style="color: #6F42C1">dosome</span><span style="color: #24292E">::calc, </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">d, N1);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">th2</span><span style="color: #24292E">(</span><span style="color: #6F42C1">dosome</span><span style="color: #24292E">::calc, </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">d, N2);</span></span>
<span class="line"><span style="color: #24292E">  th1.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  th2.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="读写锁">读写锁</h3>
<p>若存在三个线程读取数据、一个线程写入数据，若使用mutex互斥量进行操作，读写步骤几乎是排队进行的，导致了程序运行效率底下</p>
<p>我们又知道，在没有数据写入的情况下，多个线程同时读取数据是不会发生数据竞争的，不必独占资源</p>
<p>故我们可以规定：</p>
<ul>
<li>一个线程读取数据时，允许其他线程同时读取数据，不允许其他线程写数据</li>
<li>一个线程写数据时，不允许其他线程读写数据</li>
</ul>
<p>这样可以显著提高效率</p>
<p>C++14以上，这样的读写锁的功能由<code>shared_mutex</code>类、<code>shared_timed_mutex</code>提供</p>
<p>该类提供两个模式和两个锁：</p>
<ul>
<li>独占模式：仅有一个线程可以占有互斥量</li>
<li>独占锁：独占模式下，当一个线程获得独占锁，任何其他线程都不能获得独占锁和共享锁</li>
<li>共享模式：可以有多个线程分享互斥量</li>
<li>共享锁：共享模式下，当一个线程获得共享锁，其他线程可获得共享锁，不能获得独占锁</li>
</ul>
<p>读写锁广泛应用于读多写少的场景下，是一种重要的同步原语</p>
<h2 id="条件变量">条件变量</h2>
<p>条件变量是并发程序中经常用到的同步原语，可以实现在线程间发生通知以实现线程间的同步</p>
<h3 id="工作流">工作流</h3>
<blockquote>
<p>如提供两个线程，用于读取与写入数据，读取要在写入之后</p>
</blockquote>
<ol type="1">
<li>接收线程获得互斥量mutex，使用条件变量来等待发送线程的通知，等待时释放mutex</li>
<li>发送线程获得mutex，并对共享数据进行写入，完成后释放mutex</li>
<li>发送线程使用条件变量发送通知，接收线程接收到通知后重新获得mutex，结束阻塞继续运行</li>
<li>接收线程读取处理共享数据，处理完毕后释放mutex</li>
</ol>
<h3 id="使用">使用</h3>
<p>标准库conditional_variable实现条件变量原语，包含以下函数：</p>
<p>等待：</p>
<ul>
<li>wait：传入锁的引用以及解除阻塞的条件。进入等待状态时释放锁，结束后获得锁，且都是原子操作</li>
<li>wait_for：</li>
<li>wait_until：</li>
</ul>
<p>通知：</p>
<ul>
<li>notify_one：</li>
<li>notify_all：</li>
</ul>
<h3 id="例">例</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;thread&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;mutex&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;chrono&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;condition_variable&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">chrono_literals</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">channel</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">getData</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> tid </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">this_thread</span><span style="color: #24292E">::</span><span style="color: #6F42C1">get_id</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::unique_lock </span><span style="color: #6F42C1">lck</span><span style="color: #24292E">(mutex_);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;接收方[&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">tid</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;]等待数据&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">    condVar.</span><span style="color: #6F42C1">wait</span><span style="color: #24292E">(lck);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;接收方[&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">tid</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;]得到数据&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">sharedData</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">    sharedData.</span><span style="color: #6F42C1">clear</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">setData</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> id </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::stringstream ss;</span></span>
<span class="line"><span style="color: #24292E">    ss </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;hello #&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">id;</span></span>
<span class="line"><span style="color: #24292E">    {</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::unique_lock </span><span style="color: #6F42C1">lck</span><span style="color: #24292E">(mutex_);</span></span>
<span class="line"><span style="color: #24292E">      sharedData </span><span style="color: #D73A49">=</span><span style="color: #24292E"> ss.</span><span style="color: #6F42C1">str</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout  </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">\n</span><span style="color: #032F62">发送方：第&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">id</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;条数据写入完毕&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">      id</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    condVar.</span><span style="color: #6F42C1">notify_one</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">this_thread</span><span style="color: #24292E">::</span><span style="color: #6F42C1">sleep_for</span><span style="color: #24292E">(</span><span style="color: #005CC5">1</span><span style="color: #D73A49">ms</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::mutex mutex_;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::condition_variable condVar;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::string sharedData;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  channel c;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">write_th</span><span style="color: #24292E">(</span><span style="color: #6F42C1">channel</span><span style="color: #24292E">::setData, </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">c);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">read_th</span><span style="color: #24292E">(</span><span style="color: #6F42C1">channel</span><span style="color: #24292E">::getData, </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">c);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  read_th.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  write_th.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="丢失唤醒与虚假唤醒">丢失唤醒与虚假唤醒</h3>
<p>发现程序运行时，有时会出现死锁的状态</p>
<p>从输出发现，写线程在读线程进入等待前就准备好了数据并发出通知，而读线程进入状态后才</p>
<p>准备接受通知，于是错过了通知，一直等待，发生丢失唤醒</p>
<p>除了丢失唤醒，等待函数还会出现虚假唤醒：即等待线程在条件未满足的情况下被唤醒了</p>
<p>原因与底层硬件软件的异常有关</p>
<p>因此我们最好使用wait函数的重载版本，设置一个等待条件</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;thread&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;mutex&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;chrono&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;condition_variable&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">chrono_literals</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">channel</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">getData</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> tid </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">this_thread</span><span style="color: #24292E">::</span><span style="color: #6F42C1">get_id</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::unique_lock </span><span style="color: #6F42C1">lck</span><span style="color: #24292E">(mutex_);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;接收方[&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">tid</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;]等待数据&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">    condVar.</span><span style="color: #6F42C1">wait</span><span style="color: #24292E">(lck, [</span><span style="color: #005CC5">this</span><span style="color: #24292E">]{</span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">!</span><span style="color: #24292E">sharedData.</span><span style="color: #6F42C1">empty</span><span style="color: #24292E">();});</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (sharedData.</span><span style="color: #6F42C1">empty</span><span style="color: #24292E">()){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;接收方[&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">tid</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;] 虚假唤醒&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;接收方[&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">tid</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;]得到数据&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">sharedData</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">    sharedData.</span><span style="color: #6F42C1">clear</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">setData</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> id </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::stringstream ss;</span></span>
<span class="line"><span style="color: #24292E">    ss </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;hello #&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">id;</span></span>
<span class="line"><span style="color: #24292E">    {</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::unique_lock </span><span style="color: #6F42C1">lck</span><span style="color: #24292E">(mutex_);</span></span>
<span class="line"><span style="color: #24292E">      sharedData </span><span style="color: #D73A49">=</span><span style="color: #24292E"> ss.</span><span style="color: #6F42C1">str</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout  </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">\n</span><span style="color: #032F62">发送方：第&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">id</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;条数据写入完毕&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">      id</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    condVar.</span><span style="color: #6F42C1">notify_one</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">this_thread</span><span style="color: #24292E">::</span><span style="color: #6F42C1">sleep_for</span><span style="color: #24292E">(</span><span style="color: #005CC5">1</span><span style="color: #D73A49">ms</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::mutex mutex_;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::condition_variable condVar;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::string sharedData;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  channel c;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">write_th</span><span style="color: #24292E">(</span><span style="color: #6F42C1">channel</span><span style="color: #24292E">::setData, </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">c);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">read_th</span><span style="color: #24292E">(</span><span style="color: #6F42C1">channel</span><span style="color: #24292E">::getData, </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">c);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  read_th.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  write_th.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="信号量">信号量</h2>
<p>实现对有限资源的并发访问控制，内部有一个计数器，表示资源的可用数量</p>
<p>线程通过信号量来获得对资源的访问许可，若大于0，可以进行访问，计数器减一</p>
<p>信号量要与互斥量结合使用，用信号量来限制并发访问数量，用互斥量实现对具体数据同步</p>
<p>C++标准库中，有一个类模板<code>counting_semaphore</code>，其中参数<code>LeastMaxValue</code>规定了计数最大值不小于该值，还有他的特化版本<code>binary_semaphore</code>，值设定为1</p>
<p>函数：</p>
<ul>
<li>release：将计数值+1，是原子操作</li>
<li>acquire：若计数值大于1，则将计数值-1，如果为0，则该函数阻塞直到计数值大于1</li>
<li>try_acquire：成功时将计数值-1，返回true</li>
<li>try_acquire_for：阻塞时最多等待的时间</li>
<li>try_acquire_until：阻塞时最多等待到某个时刻</li>
</ul>
<p>例：循环读写buffer</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;thread&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;chrono&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;random&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;array&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;semaphore&gt;</span><span style="color: #24292E"> </span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;syncstream&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 简单的随机辅助类</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Random</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #6A737D">    // 构造 [l, r] 的整数随机</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">Random</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">l</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">r</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">      : </span><span style="color: #6F42C1">eng</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::random_device{}()),</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">dist</span><span style="color: #24292E">(l, r)</span></span>
<span class="line"><span style="color: #24292E">    {}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">()</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">dist</span><span style="color: #24292E">(eng);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::mt19937 eng;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::uniform_int_distribution</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> dist;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// RWBuffer 模板</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E"> &lt;</span><span style="color: #D73A49">size_t</span><span style="color: #24292E"> </span><span style="color: #6F42C1">BuffSize</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">6</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">RWBuffer</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">RWBuffer</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">        buff.</span><span style="color: #6F42C1">fill</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39; &#39;</span><span style="color: #24292E">);</span><span style="color: #6A737D">    // 填充空格</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">    // 模拟生产者准备数据</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">char</span><span style="color: #24292E"> </span><span style="color: #6F42C1">prepareData</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">this_thread</span><span style="color: #24292E">::</span><span style="color: #6F42C1">sleep_for</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">chrono</span><span style="color: #24292E">::</span><span style="color: #6F42C1">milliseconds</span><span style="color: #24292E">(</span><span style="color: #6F42C1">rgen</span><span style="color: #24292E">()));</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">chargen</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">    // 模拟消费者处理数据</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">processData</span><span style="color: #24292E">(</span><span style="color: #D73A49">char</span><span style="color: #6A737D"> /*ch*/</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">this_thread</span><span style="color: #24292E">::</span><span style="color: #6F42C1">sleep_for</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">chrono</span><span style="color: #24292E">::</span><span style="color: #6F42C1">milliseconds</span><span style="color: #24292E">(</span><span style="color: #6F42C1">rgen2</span><span style="color: #24292E">()));</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">    // 原子打印缓存区</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">printBuffer</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::osyncstream </span><span style="color: #6F42C1">sync</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout);</span></span>
<span class="line"><span style="color: #24292E">        sync </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;BUFFER: |&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">auto</span><span style="color: #24292E"> c : buff) {</span></span>
<span class="line"><span style="color: #24292E">            sync </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> c </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;|&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        sync </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">    // 写线程函数</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">writeToBuffer</span><span style="color: #24292E">(</span><span style="color: #D73A49">size_t</span><span style="color: #24292E"> </span><span style="color: #E36209">iterations</span><span style="color: #24292E">) {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">osyncstream</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout) </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;写线程就绪.</span><span style="color: #005CC5">\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">        // 总共写 iterations * BuffSize 次</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">size_t</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> iterations </span><span style="color: #D73A49">*</span><span style="color: #24292E"> BuffSize; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">char</span><span style="color: #24292E"> ch </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">prepareData</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">            sem_writer.</span><span style="color: #6F42C1">acquire</span><span style="color: #24292E">();</span><span style="color: #6A737D">        // 等待有空位</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">size_t</span><span style="color: #24292E"> idx </span><span style="color: #D73A49">=</span><span style="color: #24292E"> i </span><span style="color: #D73A49">%</span><span style="color: #24292E"> BuffSize;</span></span>
<span class="line"><span style="color: #24292E">            buff[idx] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> ch;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">osyncstream</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout) </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;写线程：写入 &#39;&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> ch </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;&#39; 到位置 &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> idx </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">\t</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #6F42C1">printBuffer</span><span style="color: #24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">            sem_reader.</span><span style="color: #6F42C1">release</span><span style="color: #24292E">();</span><span style="color: #6A737D">        // 通知读线程</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">    // 读线程函数</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">readFromBuffer</span><span style="color: #24292E">(</span><span style="color: #D73A49">size_t</span><span style="color: #24292E"> </span><span style="color: #E36209">iterations</span><span style="color: #24292E">) {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">osyncstream</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout) </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;读线程就绪.</span><span style="color: #005CC5">\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">size_t</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> iterations </span><span style="color: #D73A49">*</span><span style="color: #24292E"> BuffSize; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">            sem_reader.</span><span style="color: #6F42C1">acquire</span><span style="color: #24292E">();</span><span style="color: #6A737D">        // 等待有数据</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">size_t</span><span style="color: #24292E"> idx </span><span style="color: #D73A49">=</span><span style="color: #24292E"> i </span><span style="color: #D73A49">%</span><span style="color: #24292E"> BuffSize;</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">char</span><span style="color: #24292E"> ch </span><span style="color: #D73A49">=</span><span style="color: #24292E"> buff[idx];</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #6F42C1">processData</span><span style="color: #24292E">(ch);</span></span>
<span class="line"><span style="color: #24292E">            buff[idx] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39; &#39;</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">osyncstream</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout) </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;读线程：读取 &#39;&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> ch </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;&#39; 从位置 &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> idx </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">\t</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #6F42C1">printBuffer</span><span style="color: #24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">            sem_writer.</span><span style="color: #6F42C1">release</span><span style="color: #24292E">();</span><span style="color: #6A737D">        // 通知写线程</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">    Random rgen{</span><span style="color: #005CC5">500</span><span style="color: #24292E">,</span><span style="color: #005CC5">1000</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">    Random rgen2{</span><span style="color: #005CC5">800</span><span style="color: #24292E">,</span><span style="color: #005CC5">1500</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">    Random chargen{</span><span style="color: #032F62">&#39;A&#39;</span><span style="color: #24292E">,</span><span style="color: #032F62">&#39;Z&#39;</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::array</span><span style="color: #D73A49">&lt;char</span><span style="color: #24292E">, BuffSize</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> buff;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::counting_semaphore</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">BuffSize</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> sem_reader{</span><span style="color: #005CC5">0</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::counting_semaphore</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">BuffSize</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> sem_writer{BuffSize};</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">constexpr</span><span style="color: #24292E"> </span><span style="color: #D73A49">size_t</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">6</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">constexpr</span><span style="color: #24292E"> </span><span style="color: #D73A49">size_t</span><span style="color: #24292E"> ITERS </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">3</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    RWBuffer</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">N</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> buffer;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">    // 启动写线程和读线程</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">writer</span><span style="color: #24292E">(</span><span style="color: #D73A49">&amp;</span><span style="color: #6F42C1">RWBuffer</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">N</span><span style="color: #24292E">&gt;::writeToBuffer, </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">buffer, ITERS);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">reader</span><span style="color: #24292E">(</span><span style="color: #D73A49">&amp;</span><span style="color: #6F42C1">RWBuffer</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">N</span><span style="color: #24292E">&gt;::readFromBuffer, </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">buffer, ITERS);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    writer.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    reader.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="异步任务">异步任务</h2>
<p>将函数调用交给另一个线程异步执行，原有线程继续执行代码，在需要时再去获得执行结果</p>
<p>C++中提供了async与packaged_task进行异步任务</p>
<figure>
<img src="并行编程/image-20250728133257958.png" alt="异步" />
<figcaption aria-hidden="true">异步</figcaption>
</figure>
<h3 id="async">async</h3>
<p>语法：</p>
<p><code>std::future&lt;返回类型&gt; async(std::launch policy, F&amp; f, Args&amp;&amp;... args);</code></p>
<p><code>std::future&lt;返回类型&gt; async(F&amp; f, Args&amp;&amp;... args);</code>（默认策略）</p>
<p>执行策略（用整型不同bit位表示）：</p>
<ul>
<li><code>std::launch::async</code>：异步调用，00000001，相当于新建或使用线程池中的线程并在线程中调用函数</li>
<li><code>std::launch::deferred</code>：推迟调用，00000010，async返回的future对象用于存储函数指针、对象、实参拷贝，调用get函数时会同步调用存储的这个函数</li>
<li><code>std::launch::async|std::launch::deferred</code>：组合，00000011，同步还是异步执行根据具体实现决定</li>
</ul>
<h3 id="packaged_task">packaged_task</h3>
<p>方法</p>
<ul>
<li>get_future()：获得一个future对象，封装函数的返回结果存储在future对象的共享状态中</li>
<li><code>void operator()(ArgTypes... args)</code>：用于调用封装的函数，将返回结果存储在future中，此时会同步执行封装函数</li>
<li>reset()：用于重复使用packaged_task，清空状态获得一个新的future对象</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;thread&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;random&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;vector&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;future&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;syncstream&gt;</span></span>
<span class="line"><span style="color: #6A737D">// 简单的随机辅助类</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Random</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #6A737D">    // 构造 [l, r] 的整数随机</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">Random</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">l</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">r</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">      : </span><span style="color: #6F42C1">eng</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::random_device{}()),</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">dist</span><span style="color: #24292E">(l, r)</span></span>
<span class="line"><span style="color: #24292E">    {}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">()</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">dist</span><span style="color: #24292E">(eng);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::mt19937 eng;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::uniform_int_distribution</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> dist;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">float</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Compute</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">float</span><span style="color: #24292E">&gt; </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">v</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">this_thread</span><span style="color: #24292E">::</span><span style="color: #6F42C1">sleep_for</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">chrono</span><span style="color: #24292E">::</span><span style="color: #6F42C1">seconds</span><span style="color: #24292E">(</span><span style="color: #005CC5">2</span><span style="color: #24292E">));</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> r </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">accumulate</span><span style="color: #24292E">(v.</span><span style="color: #6F42C1">begin</span><span style="color: #24292E">(), v.</span><span style="color: #6F42C1">end</span><span style="color: #24292E">(), </span><span style="color: #005CC5">0.0</span><span style="color: #D73A49">f</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">osyncstream</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout)</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;执行任务的线程id=&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">this_thread</span><span style="color: #24292E">::</span><span style="color: #6F42C1">get_id</span><span style="color: #24292E">()</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> r;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> RN_MAX </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10000</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  Random </span><span style="color: #6F42C1">rgen</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">, RN_MAX);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::vector</span><span style="color: #D73A49">&lt;float&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">numbers</span><span style="color: #24292E">(</span><span style="color: #005CC5">100</span><span style="color: #24292E">, </span><span style="color: #005CC5">0.0</span><span style="color: #D73A49">f</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">generate</span><span style="color: #24292E">(numbers.</span><span style="color: #6F42C1">begin</span><span style="color: #24292E">(), numbers.</span><span style="color: #6F42C1">end</span><span style="color: #24292E">(), [</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">]{</span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">float</span><span style="color: #24292E">(</span><span style="color: #6F42C1">rgen</span><span style="color: #24292E">()</span><span style="color: #D73A49">/</span><span style="color: #24292E">RN_MAX);});</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;创建任务的线程id:&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">this_thread</span><span style="color: #24292E">::</span><span style="color: #6F42C1">get_id</span><span style="color: #24292E">()</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::packaged_task</span><span style="color: #D73A49">&lt;float</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::vector</span><span style="color: #D73A49">&lt;float&gt;&amp;</span><span style="color: #24292E">)</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">task</span><span style="color: #24292E">(Compute);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;直接调用&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::future</span><span style="color: #D73A49">&lt;float&gt;</span><span style="color: #24292E"> result </span><span style="color: #D73A49">=</span><span style="color: #24292E"> task.</span><span style="color: #6F42C1">get_future</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">task</span><span style="color: #24292E">(numbers);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;result=&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">result.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">()</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  task.</span><span style="color: #6F42C1">reset</span><span style="color: #24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;线程调用&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  result </span><span style="color: #D73A49">=</span><span style="color: #24292E"> task.</span><span style="color: #6F42C1">get_future</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">t</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">move</span><span style="color: #24292E">(task), </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">ref</span><span style="color: #24292E">(numbers));</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;result=&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">result.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">()</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  t.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="线程屏障">线程屏障</h2>
<p>线程屏障提供了一个计数器，每个参与任务的线程完成自己的任务后计数器-1，而需要同步的线程可以阻塞到计数器为0时再执行后面的代码</p>
<h3 id="latch">latch</h3>
<p>latch是一次性的计数，参数为作为计数器的初始值</p>
<ul>
<li>count_down(n=1)：将计数器减去传入的数值，默认为1，是原子操作</li>
<li>wait()：将线程阻塞到计数器为0后释放</li>
<li>try_wait()：检查计数器是否为0，返回true为0，返回false不一定为0</li>
<li>arrive_and_wait(n=1)：执行了count_down和wait</li>
</ul>
<p>e.g.模拟paobu</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;thread&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;latch&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;random&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;chrono&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Runner</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::string name;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> time </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">run</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">latch</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">start</span><span style="color: #24292E">, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">latch</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">end</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    start.</span><span style="color: #6F42C1">wait</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 等待发令枪响</span></span>
<span class="line"><span style="color: #6A737D">    // 模拟跑步过程</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> start_time </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">chrono</span><span style="color: #24292E">::</span><span style="color: #6F42C1">system_clock</span><span style="color: #24292E">::</span><span style="color: #6F42C1">now</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::mt19937 </span><span style="color: #6F42C1">rng</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::random_device{}());</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::uniform_int_distribution</span><span style="color: #D73A49">&lt;unsigned</span><span style="color: #24292E"> </span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">uniform_dist</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">, </span><span style="color: #005CC5">2000</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">this_thread</span><span style="color: #24292E">::</span><span style="color: #6F42C1">sleep_for</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">chrono</span><span style="color: #24292E">::</span><span style="color: #6F42C1">milliseconds</span><span style="color: #24292E">(</span><span style="color: #005CC5">9600</span><span style="color: #D73A49">+</span><span style="color: #6F42C1">uniform_dist</span><span style="color: #24292E">(rng)));</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> end_time </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">chrono</span><span style="color: #24292E">::</span><span style="color: #6F42C1">system_clock</span><span style="color: #24292E">::</span><span style="color: #6F42C1">now</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    time </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">chrono</span><span style="color: #24292E">::</span><span style="color: #6F42C1">duration_cast</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">chrono</span><span style="color: #24292E">::</span><span style="color: #6F42C1">milliseconds</span><span style="color: #24292E">&gt;(end_time </span><span style="color: #D73A49">-</span><span style="color: #24292E"> start_time).</span><span style="color: #6F42C1">count</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    end.</span><span style="color: #6F42C1">count_down</span><span style="color: #24292E">(</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span><span style="color: #6A737D"> // 跑完，计数器-1</span></span>
<span class="line"><span style="color: #24292E">  } </span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">bool</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">&lt;</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Runner</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">other</span><span style="color: #24292E">) </span><span style="color: #D73A49">const</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> time </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> other.time;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::vector</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">Runner</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> runners </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    {</span><span style="color: #032F62">&quot;Alice&quot;</span><span style="color: #24292E">}, {</span><span style="color: #032F62">&quot;Bob&quot;</span><span style="color: #24292E">}, {</span><span style="color: #032F62">&quot;Charlie&quot;</span><span style="color: #24292E">}, {</span><span style="color: #032F62">&quot;Diana&quot;</span><span style="color: #24292E">}, {</span><span style="color: #032F62">&quot;Eve&quot;</span><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #24292E">  };</span></span>
<span class="line"><span style="color: #6A737D">  // 等待阶段</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> runner_count </span><span style="color: #D73A49">=</span><span style="color: #24292E"> runners.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::latch </span><span style="color: #6F42C1">start</span><span style="color: #24292E">(</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span><span style="color: #6A737D"> // 代表发令枪，等到为0时执行后面代码</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::latch </span><span style="color: #6F42C1">finish</span><span style="color: #24292E">(runner_count);</span><span style="color: #6A737D"> // 代表完赛选手数量，有一个选手冲线则-1，直到为0时比赛结束</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::vector</span><span style="color: #D73A49">&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> threads;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">runner_count; </span><span style="color: #D73A49">++</span><span style="color: #24292E">i) {</span></span>
<span class="line"><span style="color: #24292E">    threads.</span><span style="color: #6F42C1">emplace_back</span><span style="color: #24292E">(</span><span style="color: #D73A49">&amp;</span><span style="color: #6F42C1">Runner</span><span style="color: #24292E">::run, </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">runners[i], </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">ref</span><span style="color: #24292E">(start), </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">ref</span><span style="color: #24292E">(finish));</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;发令枪响&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  start.</span><span style="color: #6F42C1">count_down</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 发令枪响，所有选手开始跑</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  finish.</span><span style="color: #6F42C1">wait</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 等待所有选手跑完，阻塞</span></span>
<span class="line"><span style="color: #6A737D">  // 结束后统计成绩</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;比赛结束&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">sort</span><span style="color: #24292E">(runners.</span><span style="color: #6F42C1">begin</span><span style="color: #24292E">(), runners.</span><span style="color: #6F42C1">end</span><span style="color: #24292E">());</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">auto&amp;</span><span style="color: #24292E"> runner : runners) {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> runner.name </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot; : &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #D73A49">float</span><span style="color: #24292E">(runner.time)</span><span style="color: #D73A49">/</span><span style="color: #005CC5">1000</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;秒&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">auto&amp;</span><span style="color: #24292E"> thread : threads) {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">      thread.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">发令枪响</span></span>
<span class="line"><span style="color: #24292e">比赛结束</span></span>
<span class="line"><span style="color: #24292e">Eve : 9.946秒</span></span>
<span class="line"><span style="color: #24292e">Bob : 10.034秒</span></span>
<span class="line"><span style="color: #24292e">Diana : 10.092秒</span></span>
<span class="line"><span style="color: #24292e">Alice : 10.842秒</span></span>
<span class="line"><span style="color: #24292e">Charlie : 11.621秒</span></span></code></pre></div></div></figure>
<h3 id="barrier">barrier</h3>
<p>barrier每次计数到0时，都会把初始值恢复，进行下一轮计数</p>
<p>barrier是个类模板，参数为计数器初始值</p>
<ul>
<li><p>arrive(n=1)：将计数器减去指定参数n</p></li>
<li><p>wait()：等待计数器为0</p></li>
<li><p>arrive_and_wait(n=1)：前两个结合</p></li>
<li><p>arrive_and_drop(n=1)：除了将本次-n，还将下一次的初始值-n</p></li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;thread&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;barrier&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;random&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;chrono&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;vector&gt;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">participant</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::string name;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">participant</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">string</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">name</span><span style="color: #24292E">) : </span><span style="color: #6F42C1">name</span><span style="color: #24292E">(name) {}</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">template</span><span style="color: #24292E"> &lt;</span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">BarrierType</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">run</span><span style="color: #24292E">(</span><span style="color: #6F42C1">BarrierType</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">finish</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #6A737D">    // 随机数确定是否能存货</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::mt19937 </span><span style="color: #6F42C1">rng</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::random_device{}());</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::uniform_int_distribution</span><span style="color: #D73A49">&lt;unsigned</span><span style="color: #24292E"> </span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">uniform_dist</span><span style="color: #24292E">(</span><span style="color: #005CC5">1000</span><span style="color: #24292E">, </span><span style="color: #005CC5">2000</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">5</span><span style="color: #24292E">;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> rnd </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">uniform_dist</span><span style="color: #24292E">(rng);</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">this_thread</span><span style="color: #24292E">::</span><span style="color: #6F42C1">sleep_for</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">chrono</span><span style="color: #24292E">::</span><span style="color: #6F42C1">milliseconds</span><span style="color: #24292E">(rnd));</span></span>
<span class="line"><span style="color: #24292E">      alive </span><span style="color: #D73A49">=</span><span style="color: #24292E"> rnd</span><span style="color: #D73A49">%</span><span style="color: #005CC5">3</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (alive){</span></span>
<span class="line"><span style="color: #24292E">        finish.</span><span style="color: #6F42C1">arrive_and_wait</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 到达终点，等待其他选手</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">else</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">        finish.</span><span style="color: #6F42C1">arrive_and_drop</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 选手掉队，直接结束</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">break</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">bool</span><span style="color: #24292E"> </span><span style="color: #6F42C1">is_alive</span><span style="color: #24292E">() </span><span style="color: #D73A49">const</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> alive;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">bool</span><span style="color: #24292E"> alive </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">true</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 选手是否存活</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::vector</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">participant</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> participants </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    {</span><span style="color: #032F62">&quot;Alice&quot;</span><span style="color: #24292E">}, {</span><span style="color: #032F62">&quot;Bob&quot;</span><span style="color: #24292E">}, {</span><span style="color: #032F62">&quot;Charlie&quot;</span><span style="color: #24292E">}, {</span><span style="color: #032F62">&quot;Diana&quot;</span><span style="color: #24292E">}, {</span><span style="color: #032F62">&quot;Eve&quot;</span><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #24292E">  };</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> participant_count </span><span style="color: #D73A49">=</span><span style="color: #24292E"> participants.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> round </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  // barrier每轮结束时的回调函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> on_complete </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [</span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">participants</span><span style="color: #24292E">, </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">round</span><span style="color: #24292E">](){</span></span>
<span class="line"><span style="color: #24292E">    round</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;第&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> round </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;轮幸存者:&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> count </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">auto</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> p : participants) {</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (p.</span><span style="color: #6F42C1">is_alive</span><span style="color: #24292E">()) {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p.name </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot; &quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        count</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (count</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;没有幸存者&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  };</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::barrier </span><span style="color: #6F42C1">finish</span><span style="color: #24292E">(participant_count, on_complete);</span><span style="color: #6A737D"> // 参赛者数量为初始值，oncomplete为每轮的回调</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::vector</span><span style="color: #D73A49">&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> threads;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">auto</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">p: participants) {</span></span>
<span class="line"><span style="color: #24292E">    threads.</span><span style="color: #6F42C1">emplace_back</span><span style="color: #24292E">([</span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">p</span><span style="color: #24292E">, </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">finish</span><span style="color: #24292E">](){p.</span><span style="color: #6F42C1">run</span><span style="color: #24292E">(finish);});</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">auto</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">thread : threads) {</span></span>
<span class="line"><span style="color: #24292E">    thread.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 等待所有线程结束</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p><strong>注：对计数器进行-n操作时，传入的n的值不能大于当前计数值，否则会导致未定义错误</strong></p>
<h2 id="原子操作">原子操作</h2>
<p>原子操作是不能被分割或中断的操作，其他线程只能看到开始与结束的状态</p>
<h3 id="类型">类型</h3>
<ul>
<li>Load 加载</li>
<li>Store 存储</li>
<li>Read Modify Write 读取-修改-写入（RMW）</li>
</ul>
<h3 id="atomic_flag">atomic_flag</h3>
<p>它只有true和false两个值，true表示标志被设置，false表示标志被清除</p>
<p>初始化可以使用<code>ATOMIC_FLAG_INIT</code>宏，也可以使用默认构造函数（C++20后）</p>
<ul>
<li><p>clear()：清除标志，是一个原子写操作，函数有一个参数<code>memory_order</code>，指定内存顺序，默认为memory
order sequentially consistent</p></li>
<li><p>test_and_set()：将标志设置为true，并返回原有值，是一个RMW操作</p></li>
</ul>
<p>（以下为C++20新增）</p>
<ul>
<li>test()：读取数据</li>
<li>wait(oldvalue)：等待条件达成</li>
<li>notify_one()：通知其中一个线程结束等待</li>
<li>notify_all()：通知所有线程结束等待</li>
</ul>
<h3 id="自旋锁">自旋锁</h3>
<p>自旋：持续监控变量以等待发生变化的过程</p>
<p>自旋锁消耗资源较高，常用于临界区代码耗时很少的场合</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">SpinLock</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">lock</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">while</span><span style="color: #24292E"> (flag.</span><span style="color: #6F42C1">test_and_set</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::memory_order_acquire)){}</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">unlock</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">        flag.</span><span style="color: #6F42C1">clear</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::memory_order_release);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::atomic_flag flag{ATOMIC_FLAG_INIT};</span></span>
<span class="line"><span style="color: #24292E">};</span></span></code></pre></div></div></figure>
<p>例：</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;atomic&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;thread&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;assert.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">SpinLock</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">lock</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">while</span><span style="color: #24292E"> (flag.</span><span style="color: #6F42C1">test_and_set</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::memory_order_acquire)){}</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">unlock</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">        flag.</span><span style="color: #6F42C1">clear</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::memory_order_release);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::atomic_flag flag{ATOMIC_FLAG_INIT};</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  SpinLock spin;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> count </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> inc </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">](){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">1000</span><span style="color: #24292E">;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::lock_guard</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">SpinLock</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">lock</span><span style="color: #24292E">(spin);</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">++</span><span style="color: #24292E">count;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  };</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">t1</span><span style="color: #24292E">(inc);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">t2</span><span style="color: #24292E">(inc);</span></span>
<span class="line"><span style="color: #24292E">  t1.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  t2.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;count = &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> count </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>这里由于自旋锁包含lock与unlock函数，符合C++中的基本锁类型，故可以使用lock_guard自动加锁解锁</p>
<h3 id="例-1">例</h3>
<p>实现了一个一次生产者与消费者的模拟</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;atomic&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;thread&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;assert.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Channel</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">getData</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;[Consumer] wait for data ready</span><span style="color: #005CC5">\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    dataReady.</span><span style="color: #6F42C1">wait</span><span style="color: #24292E">(</span><span style="color: #005CC5">false</span><span style="color: #24292E">);</span><span style="color: #6A737D"> // 等待数据准备好</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;[Consumer] data is:&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">data</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::endl;</span></span>
<span class="line"><span style="color: #24292E">    dataReady.</span><span style="color: #6F42C1">clear</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">setData</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">string</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">v</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">this_thread</span><span style="color: #24292E">::</span><span style="color: #6F42C1">sleep_for</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">chrono</span><span style="color: #24292E">::</span><span style="color: #6F42C1">milliseconds</span><span style="color: #24292E">(</span><span style="color: #005CC5">2000</span><span style="color: #24292E">));</span><span style="color: #6A737D"> // 模拟数据准备时间</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;&#39;[Producer] write data</span><span style="color: #005CC5">\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    data </span><span style="color: #D73A49">=</span><span style="color: #24292E"> v;</span></span>
<span class="line"><span style="color: #24292E">    dataReady.</span><span style="color: #6F42C1">test_and_set</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    dataReady.</span><span style="color: #6F42C1">notify_one</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::atomic_flag dataReady </span><span style="color: #D73A49">=</span><span style="color: #24292E"> ATOMIC_FLAG_INIT;</span><span style="color: #6A737D"> // 用于标记数据是否准备好</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::string data;</span><span style="color: #6A737D"> // 存储数据</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  Channel channel;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">consumer</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Channel</span><span style="color: #24292E">::getData, </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">channel);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">producer</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Channel</span><span style="color: #24292E">::setData, </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">channel, </span><span style="color: #032F62">&quot;Hello, World!&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  consumer.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  producer.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="特化版本">特化版本</h3>
<p>atomic除了主模板还有针对指针、智能指针与数据类型的特化版本</p>
<p><img src="并行编程/image-20250731104420865.png" alt="atomic" style="zoom:67%;" /></p>
<p>其中主模板中的T要求是可平凡拷贝的</p>
<h3 id="有无锁的判断">有无锁的判断</h3>
<p>我们可以通过atomic模板提供的<code>is_lock_free()</code>函数判断有无锁，若无锁（通过CPU的原子指令）则函数返回true，否则返回false</p>
<ul>
<li>基本类型和指针都是无锁的</li>
<li>自定义类型与类型大小与对齐有关：类型大小是<span
class="math inline">\(2^n\)</span>且小于最大对齐数（16字节）</li>
</ul>
<h3 id="主要的原子操作">主要的原子操作</h3>
<p><strong>加载操作：</strong>用于原子地获得当前变量的值</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #6F42C1">load</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">memory_order</span><span style="color: #24292E"> </span><span style="color: #E36209">order</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">memory_order_seq_cst</span><span style="color: #24292E">) </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">noexcept</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">operator</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">() </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">noexcept</span><span style="color: #24292E">;</span></span></code></pre></div></div></figure>
<p><strong>存储操作：</strong>用于将变量原子地修改为要更新的值</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">store</span><span style="color: #24292E">(</span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #E36209">desired</span><span style="color: #24292E">, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">memory_order</span><span style="color: #24292E"> </span><span style="color: #E36209">order</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">memory_order_seq_cst</span><span style="color: #24292E">) </span><span style="color: #D73A49">noexcept</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">=</span><span style="color: #24292E">(</span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #E36209">desired</span><span style="color: #24292E">) </span><span style="color: #D73A49">noexcept</span><span style="color: #24292E">;</span></span></code></pre></div></div></figure>
<p><strong>CAS（比较与交换函数）：</strong></p>
<p>通过compare_exchange函数完成</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">bool</span><span style="color: #24292E"> </span><span style="color: #6F42C1">compare_exchange_weak</span><span style="color: #24292E">(</span><span style="color: #6F42C1">T</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">expected</span><span style="color: #24292E">, </span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #E36209">desired</span><span style="color: #24292E">, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">memory_order</span><span style="color: #24292E"> </span><span style="color: #E36209">success</span><span style="color: #24292E">, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">memory_order</span><span style="color: #24292E"> </span><span style="color: #E36209">failure</span><span style="color: #24292E">) </span><span style="color: #D73A49">noexcept</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">bool</span><span style="color: #24292E"> </span><span style="color: #6F42C1">compare_exchange_strong</span><span style="color: #24292E">(</span><span style="color: #6F42C1">T</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">expected</span><span style="color: #24292E">, </span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #E36209">desired</span><span style="color: #24292E">, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">memory_order</span><span style="color: #24292E"> </span><span style="color: #E36209">success</span><span style="color: #24292E">, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">memory_order</span><span style="color: #24292E"> </span><span style="color: #E36209">failure</span><span style="color: #24292E">) </span><span style="color: #D73A49">noexcept</span><span style="color: #24292E">;</span></span></code></pre></div></div></figure>
<p>符合条件的CAS会直接使用CPU硬件指令来实现</p>
<p>其中weak版可能有虚假失败的情况</p>
<p><strong>例：CAS循环模式</strong></p>
<p>CAS是实现无锁算法的重要方式，经常使用CAS循环实现对原子值更改</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fetch_multiply</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">atomic</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt; </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">value</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">multiplier</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> oldValue </span><span style="color: #D73A49">=</span><span style="color: #24292E"> value.</span><span style="color: #6F42C1">load</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> desire;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">do</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">        desired </span><span style="color: #D73A49">=</span><span style="color: #24292E"> oldValue</span><span style="color: #D73A49">*</span><span style="color: #24292E">multiplier;</span></span>
<span class="line"><span style="color: #24292E">    }</span><span style="color: #D73A49">while</span><span style="color: #24292E">(</span><span style="color: #D73A49">!</span><span style="color: #24292E">value.</span><span style="color: #6F42C1">compare_exchange_strong</span><span style="color: #24292E">(oldValuem desired));</span></span>
<span class="line"><span style="color: #24292E">    </span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> oldValue;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>原理：加载当前值到oldValue，使用其来计算乘积并存储到本地变量desire，调用compare_exchange以原子方式更新value</p>
<p>若原value等于oldValue，说明没有并发线程修改过value，则更新为desired</p>
<p>若不等与则说明value被其他线程修改，那么将oldValue的值更新为当前value重试</p>
<h3
id="例使用atomic和cas实现无锁堆栈">例：使用atomic和CAS实现无锁堆栈</h3>
<p>在多线程模式下，将新节点的next指向原节点与将head节点指向新节点是两个独立操作，其中第二步的前提是链表头部节点没有变化</p>
<p>此时另一个线程的操作可能会导致链表头部发生变化</p>
<p><img src="并行编程/image-20250731135640991.png" alt="例1" style="zoom:67%;" /></p>
<p>如此时节点A向堆栈push了一个新节点A</p>
<p><img src="并行编程/image-20250731135804450.png" alt="例2" style="zoom:67%;" /></p>
<p>此时另一个线程又向堆栈push了一个新节点B，head指向了B</p>
<p>若第一个线程还将head更新为节点A，则会将节点B孤立</p>
<p><img src="并行编程/image-20250731140345785.png" alt="例3" style="zoom:67%;" /></p>
<p>此时我们在compare_exchange函数中将A与B节点的next节点进行比较，若相等，说明头部没有变化，那么可以将A作为新的节点，将head指向A</p>
<p>否则说明已经发生变化，就将A的next值更新为head当前值，并更新head</p>
<p>pop操作更简单，将head当前值存储在局部变量中，再把其next与当前值进行比较，若相等则说明头部未改变，将head更新为头节点next值，否则说明发生变化，将局部变量更新为head当前值，继续循环</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;atomic&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;thread&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;memory&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;syncstream&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">LockFreeStack</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Node</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    T data;</span></span>
<span class="line"><span style="color: #24292E">    Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">nullptr</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">Node</span><span style="color: #24292E">(</span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #E36209">d</span><span style="color: #24292E">):</span><span style="color: #6F42C1">data</span><span style="color: #24292E">(d){}</span></span>
<span class="line"><span style="color: #24292E">  };</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::atomic</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">Node</span><span style="color: #D73A49">*&gt;</span><span style="color: #24292E"> head;</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">LockFreeStack</span><span style="color: #24292E">() </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">default</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">LockFreeStack</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">LockFreeStack</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">) </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">delete</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">LockFreeStack</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">=</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">LockFreeStack</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">) </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">delete</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">push</span><span style="color: #24292E">(</span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #E36209">val</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E">newNode </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Node</span><span style="color: #24292E">(val);</span></span>
<span class="line"><span style="color: #6A737D">    //std::shared_ptr&lt;Node&gt; newNode = std::make_shared&lt;Node&gt;(val);</span></span>
<span class="line"><span style="color: #24292E">    newNode-&gt;next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> head.</span><span style="color: #6F42C1">load</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E">(</span><span style="color: #D73A49">!</span><span style="color: #24292E">head.</span><span style="color: #6F42C1">compare_exchange_strong</span><span style="color: #24292E">(newNode-&gt;next, newNode));</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">osyncstream</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout) </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot; Pushed: &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> val </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">bool</span><span style="color: #24292E"> </span><span style="color: #6F42C1">pop</span><span style="color: #24292E">(</span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">result</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> oldHead </span><span style="color: #D73A49">=</span><span style="color: #24292E"> head.</span><span style="color: #6F42C1">load</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">do</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (oldHead</span><span style="color: #D73A49">==</span><span style="color: #005CC5">nullptr</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">osyncstream</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout)</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot; Stack is empty, cannot pop.</span><span style="color: #005CC5">\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">    }</span><span style="color: #D73A49">while</span><span style="color: #24292E">(oldHead</span><span style="color: #D73A49">&amp;&amp;!</span><span style="color: #24292E">head.</span><span style="color: #6F42C1">compare_exchange_strong</span><span style="color: #24292E">(oldHead, oldHead-&gt;next));</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (oldHead){</span></span>
<span class="line"><span style="color: #24292E">      result </span><span style="color: #D73A49">=</span><span style="color: #24292E"> oldHead-&gt;data;</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">osyncstream</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::cout)</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot; Popped: &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> result </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">true</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">pushItems</span><span style="color: #24292E">(</span><span style="color: #6F42C1">LockFreeStack</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt; </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">stack</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">start</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">end</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> start; i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">end;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    stack.</span><span style="color: #6F42C1">push</span><span style="color: #24292E">(i);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">this_thread</span><span style="color: #24292E">::</span><span style="color: #6F42C1">sleep_for</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">chrono</span><span style="color: #24292E">::</span><span style="color: #6F42C1">milliseconds</span><span style="color: #24292E">(</span><span style="color: #005CC5">50</span><span style="color: #24292E">));</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">popItems</span><span style="color: #24292E">(</span><span style="color: #6F42C1">LockFreeStack</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt; </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">stack</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">count</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> value;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">count;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    stack.</span><span style="color: #6F42C1">pop</span><span style="color: #24292E">(value);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">this_thread</span><span style="color: #24292E">::</span><span style="color: #6F42C1">sleep_for</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">chrono</span><span style="color: #24292E">::</span><span style="color: #6F42C1">milliseconds</span><span style="color: #24292E">(</span><span style="color: #005CC5">30</span><span style="color: #24292E">));</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  LockFreeStack</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> stack;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">t1</span><span style="color: #24292E">(pushItems, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">ref</span><span style="color: #24292E">(stack), </span><span style="color: #005CC5">1</span><span style="color: #24292E">, </span><span style="color: #005CC5">10</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">t2</span><span style="color: #24292E">(popItems, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">ref</span><span style="color: #24292E">(stack),</span><span style="color: #005CC5">7</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">t3</span><span style="color: #24292E">(pushItems, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">ref</span><span style="color: #24292E">(stack), </span><span style="color: #005CC5">10</span><span style="color: #24292E">, </span><span style="color: #005CC5">20</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::thread </span><span style="color: #6F42C1">t4</span><span style="color: #24292E">(popItems, </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">ref</span><span style="color: #24292E">(stack),</span><span style="color: #005CC5">7</span><span style="color: #24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  t1.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  t2.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  t3.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  t4.</span><span style="color: #6F42C1">join</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>（这里shared_ptr不是平凡可复制类，故改为了裸指针，同时无法解决ABA问题）</p>
<h2 id="内存模型">内存模型</h2>
<h3 id="顺序一致性模型">顺序一致性模型</h3>
<p>程序按照代码编写顺序执行，并且所有线程都看到相同顺序的模型</p>
<p>枚举值名称为<code>memory_order_seq_cst</code></p>
<p>该模型顺序简单，不易出错，但可能无法充分使用系统和硬件的性能优化</p>
<h3 id="relaxed模型">Relaxed模型</h3>
<p>relaxed模型下，不对内存顺序作约束，可能出现顺序一致性模型中不会出现的结果</p>
<p>CPU和内存之间会有多级缓存</p>
<p>缓存、编译器的优化都可能改变同一线程不同语句的执行顺序</p>
<p>枚举值名称为<code>memory_order_relaxed</code></p>
<p>relaxed模型中，线程执行代码对值的更改首先保存在缓存中，当代码执行完毕，才会更新内存中的值</p>
<p><img src="并行编程/image-20250731161214818.png" alt="relaxed" style="zoom: 50%;" /></p>
<p>如该例子中，线程1与2执行了①和③代码，将缓存中的a与b修改为1，再执行②和④代码，读取内存中的a与b都为0</p>
<p>在代码执行完毕后，缓存中的值才会修改到内存中</p>
<h3 id="acquirerelease模型">Acquire/Release模型</h3>
<p>枚举值有如下三种：</p>
<ul>
<li><code>memory_order_acquire</code></li>
<li><code>memory_order_release</code></li>
<li><code>memory_order_acq_rel</code></li>
</ul>
<p>通常在原子操作中，</p>
<p>写入数据使用release，即将值写入后，将缓存中的数据发布到内存中，包括之前修改过的其他变量</p>
<p>获取数据使用acquire，即将值从内存中更新到缓存，并读取这个值</p>
<p>对于先加载在修改的，使用<code>acq_rel</code></p>
<p>在mutex锁中，<code>mutex.lock()</code>与acquire语义是等价的，<code>mutex.unlock()</code>与release语义是等价的，两者之间是临界区</p>
<p>临界区内的代码可以互相调换顺序，但不能移出临界区外</p>
<p>临界区上方的代码可以进入临界区，但不能移出临界区下方</p>
<p>临界区下方的代码可以进入临界区，但不能移出临界区上方</p>
<p>于此对应的<code>memory_order_acquire</code>与<code>memory_order_release</code>遵循同样的原则</p>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
      </tags>
  </entry>
  <entry>
    <title>【C++】常量表达式</title>
    <url>/C++/%E5%B8%B8%E9%87%8F%E8%A1%A8%E8%BE%BE%E5%BC%8F/</url>
    <content><![CDATA[<h1 id="常量表达式">常量表达式</h1>
<p>常量表达式指由字面量、常量、函数、运算符组成的表达式，值是一个固定值</p>
<p>编译器在编译时就会将它用结果值替换，而不需要运行时再去计算</p>
<h2 id="constexpr">constexpr</h2>
<p>使用constexpr修饰函数返回值、变量等，编译器可以在编译阶段计算其值，以便用于数组、模板非类型参数、枚举等</p>
<p>也可以提高程序运行效率</p>
<h3 id="constexpr修饰变量">constexpr修饰变量</h3>
<p><code>constexpr int a&#123;10&#125;;</code></p>
<p>这里变量必须初始化，初始值必须是一个常量表达式</p>
<h3 id="constexpr修饰函数">constexpr修饰函数</h3>
<p>这种函数被称为<strong>常量表达式函数</strong></p>
<p>若所有实参都是常量表达式，则该调用也是常量表达式</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">constexpr</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">mul</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">,</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> a</span><span style="color: #D73A49">*</span><span style="color: #24292E">b;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">constexpr</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> c </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">mul</span><span style="color: #24292E">(</span><span style="color: #005CC5">5</span><span style="color: #24292E">,</span><span style="color: #005CC5">3</span><span style="color: #24292E">);</span><span style="color: #6A737D"> //常</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> d </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">mul</span><span style="color: #24292E">(c,</span><span style="color: #005CC5">11</span><span style="color: #24292E">);</span><span style="color: #6A737D"> // 常</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> f </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">mul</span><span style="color: #24292E">(d, </span><span style="color: #005CC5">7</span><span style="color: #24292E">);</span><span style="color: #6A737D"> // 变</span></span></code></pre></div></div></figure>
<p>要求：</p>
<ul>
<li>返回值和传参都是字面类型</li>
<li>函数中不能调用非constexpr函数（<code>&lt;iostream&gt;</code>库,
<code>&lt;thread&gt;</code>库都不可以用）</li>
<li>不能抛出异常</li>
<li>对于递归，编译器有递归深度的限制，用参数<code>-fconstexpr-depth</code>控制，默认512</li>
</ul>
<h3 id="constexpr修饰自定义类型">constexpr修饰自定义类型</h3>
<p>若想定义自己的constexpr类，可以将<strong>类的构造函数</strong>定义为常量表达式函数</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">complex</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">constexpr</span><span style="color: #24292E"> </span><span style="color: #6F42C1">complex</span><span style="color: #24292E">(</span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">r</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">, </span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">i</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">):</span><span style="color: #6F42C1">_r</span><span style="color: #24292E">(r),</span><span style="color: #6F42C1">_i</span><span style="color: #24292E">(i){}</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">constexpr</span><span style="color: #24292E"> </span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #6F42C1">getreal</span><span style="color: #24292E">() </span><span style="color: #D73A49">const</span><span style="color: #24292E">{</span><span style="color: #D73A49">return</span><span style="color: #24292E"> _r;}</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">constexpr</span><span style="color: #24292E"> </span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #6F42C1">getimg</span><span style="color: #24292E">() </span><span style="color: #D73A49">const</span><span style="color: #24292E">{</span><span style="color: #D73A49">return</span><span style="color: #24292E"> _i;}</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">constexpr</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">setreal</span><span style="color: #24292E">(</span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">v</span><span style="color: #24292E">){_r </span><span style="color: #D73A49">=</span><span style="color: #24292E"> v;}</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">constexpr</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">setimg</span><span style="color: #24292E">(</span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">v</span><span style="color: #24292E">){_i</span><span style="color: #D73A49">=</span><span style="color: #24292E">v;}</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">double</span><span style="color: #24292E"> _r;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">double</span><span style="color: #24292E"> _i;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="const与constexpr">const与constexpr</h3>
<p>const与constexpr的效果相同，整型下可以混用</p>
<p>如这是合法的</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">12</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">constexpr</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a</span><span style="color: #D73A49">+</span><span style="color: #005CC5">3</span><span style="color: #24292E">;</span></span></code></pre></div></div></figure>
<p>这是非法的，需要统一使用constexpr</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">float</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">12</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">constexpr</span><span style="color: #24292E"> </span><span style="color: #D73A49">float</span><span style="color: #24292E"> b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a</span><span style="color: #D73A49">+</span><span style="color: #005CC5">3</span><span style="color: #24292E">;</span></span></code></pre></div></div></figure>
<p>因为const包含运行时的只读变量（多数情况）或编译时的常量（少数情况）</p>
<p>而constexpr指的是编译时的常量</p>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
      </tags>
  </entry>
  <entry>
    <title>【C++】文件操作</title>
    <url>/C++/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/</url>
    <content><![CDATA[<h1 id="文件操作">文件操作</h1>
<p>C++中提供了文件流来对文件进行操作</p>
<p>需要引入头文件<code>fstream</code></p>
<p>文件类型：</p>
<ul>
<li>文本文件：以ASCII码存储</li>
<li>二进制文件：以二进制形式存储</li>
</ul>
<p>操作文件三大类：</p>
<ul>
<li>ofstream：写</li>
<li>ifstream：读</li>
<li>fstream：读/写</li>
</ul>
<h2 id="文本文件">文本文件</h2>
<h3 id="写文件">写文件</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;fstream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    ofstream ofs;</span><span style="color: #6A737D"> // 创建流对象</span></span>
<span class="line"><span style="color: #24292E">    ofs.</span><span style="color: #6F42C1">open</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;路径&quot;</span><span style="color: #24292E">, </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">打开方式</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">)</span><span style="color: #6A737D"> // 指定打开方式</span></span>
<span class="line"><span style="color: #24292E">    ofs </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;写入的数据&quot;</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 写内容</span></span>
<span class="line"><span style="color: #24292E">    ofs.</span><span style="color: #6F42C1">close</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 关闭文件</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>其中打开方式有：</p>
<table>
<thead>
<tr>
<th>打开方式</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>ios::in</td>
<td>读文件而打开文件</td>
</tr>
<tr>
<td>ios::out</td>
<td>写文件而打开文件</td>
</tr>
<tr>
<td>ios::ate</td>
<td>文件打开时指针位于文件末尾，可以移动指针进行读写</td>
</tr>
<tr>
<td>ios::app</td>
<td>所有读写操作都会添加到文件末尾</td>
</tr>
<tr>
<td>ios::trunc</td>
<td>若文件存在则先删除再创建</td>
</tr>
<tr>
<td>ios::binary</td>
<td>二进制方式操作</td>
</tr>
</tbody>
</table>
<p>可以使用|操作符来配合使用多个文件操作</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;fstream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  // 创建流对象</span></span>
<span class="line"><span style="color: #24292E">  ofstream ofs;</span></span>
<span class="line"><span style="color: #6A737D">  // 指定打开方式</span></span>
<span class="line"><span style="color: #24292E">  ofs.</span><span style="color: #6F42C1">open</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;test.txt&quot;</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ios</span><span style="color: #24292E">::out);</span></span>
<span class="line"><span style="color: #6A737D">  // 写内容</span></span>
<span class="line"><span style="color: #24292E">  ofs </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;name: Li Hua&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  ofs </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;age: male&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #6A737D">  // 关闭文件</span></span>
<span class="line"><span style="color: #24292E">  ofs.</span><span style="color: #6F42C1">close</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="读文件">读文件</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;fstream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    ifstream ofs;</span><span style="color: #6A737D"> // 创建流对象</span></span>
<span class="line"><span style="color: #24292E">    ofs.</span><span style="color: #6F42C1">open</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;路径&quot;</span><span style="color: #24292E">, </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">打开方式</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">)</span><span style="color: #6A737D"> // 打开文件并判断是否成功</span></span>
<span class="line"><span style="color: #24292E">    ofs </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;写入的数据&quot;</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 读取数据</span></span>
<span class="line"><span style="color: #24292E">    ofs.</span><span style="color: #6F42C1">close</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 关闭文件</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>其中读取数据有多种方式：</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;fstream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;string&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  // 创建流对象</span></span>
<span class="line"><span style="color: #24292E">  ifstream ifs;</span></span>
<span class="line"><span style="color: #6A737D">  // 打开文件</span></span>
<span class="line"><span style="color: #24292E">  ifs.</span><span style="color: #6F42C1">open</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;test.txt&quot;</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ios</span><span style="color: #24292E">::in);</span></span>
<span class="line"><span style="color: #6A737D">  // 判断打开是否成功</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E">(</span><span style="color: #D73A49">!</span><span style="color: #24292E">ifs.</span><span style="color: #6F42C1">is_open</span><span style="color: #24292E">()){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;Open failed&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 读取数据</span></span>
<span class="line"><span style="color: #6A737D">  // 方式1: 使用字符数组，但遇到空格也会停下</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">char</span><span style="color: #24292E"> buf[</span><span style="color: #005CC5">1024</span><span style="color: #24292E">]</span><span style="color: #D73A49">=</span><span style="color: #24292E">{};</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">(ifs</span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E">buf){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> buf </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 方式2： 使用getline，只有遇到回车才会停下</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">char</span><span style="color: #24292E"> buf2[</span><span style="color: #005CC5">1024</span><span style="color: #24292E">]</span><span style="color: #D73A49">=</span><span style="color: #24292E">{};</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">(ifs.</span><span style="color: #6F42C1">getline</span><span style="color: #24292E">(buf2, sizeof buf2)){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> buf </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 方式3：使用string</span></span>
<span class="line"><span style="color: #24292E">  string bufs;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">(</span><span style="color: #6F42C1">getline</span><span style="color: #24292E">(ifs, bufs)){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> buf </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 方式4：使用char，一个个读取</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">char</span><span style="color: #24292E"> c;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">((c</span><span style="color: #D73A49">=</span><span style="color: #24292E">ifs.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">())</span><span style="color: #D73A49">!=</span><span style="color: #24292E">EOF){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> c;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  ifs.</span><span style="color: #6F42C1">close</span><span style="color: #24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="二进制文件">二进制文件</h2>
<p>二进制打开方式指定为<code>ios::binary</code></p>
<h3 id="写文件-1">写文件</h3>
<p>注意：写入二进制文件时，不建议使用string，会引发指针异常</p>
<p>使用write方式来写入文件，而不是用流式输入，对一个对象我们使用<code>const char*</code>这样一个常量指针类型取得对象实例地址后进行写入</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;fstream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">char</span><span style="color: #24292E"> name[</span><span style="color: #005CC5">64</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  ofstream ofs;</span></span>
<span class="line"><span style="color: #24292E">  ofs.</span><span style="color: #6F42C1">open</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;person.txt&quot;</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ios</span><span style="color: #24292E">::out</span><span style="color: #D73A49">|</span><span style="color: #6F42C1">ios</span><span style="color: #24292E">::binary);</span></span>
<span class="line"><span style="color: #24292E">  person p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span><span style="color: #032F62">&quot;Jack&quot;</span><span style="color: #24292E">, </span><span style="color: #005CC5">18</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">  ofs.</span><span style="color: #6F42C1">write</span><span style="color: #24292E">((</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">char*</span><span style="color: #24292E">)</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">p, </span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(person));</span></span>
<span class="line"><span style="color: #24292E">  ofs.</span><span style="color: #6F42C1">close</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="读文件-1">读文件</h3>
<p>使用read方式来读文件</p>
<p>参数原型：<code>istream&amp; read(char *buffer, int len);</code></p>
<p>即字符指针buffer指向内存中一段存储空间，len为读写的字节数</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;fstream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">char</span><span style="color: #24292E"> name[</span><span style="color: #005CC5">64</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  ifstream ifs;</span></span>
<span class="line"><span style="color: #24292E">  ifs.</span><span style="color: #6F42C1">open</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;person.txt&quot;</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ios</span><span style="color: #24292E">::in</span><span style="color: #D73A49">|</span><span style="color: #6F42C1">ios</span><span style="color: #24292E">::binary);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E">(</span><span style="color: #D73A49">!</span><span style="color: #24292E">ifs.</span><span style="color: #6F42C1">is_open</span><span style="color: #24292E">()){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;Open failed&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  person p;</span></span>
<span class="line"><span style="color: #24292E">  ifs.</span><span style="color: #6F42C1">read</span><span style="color: #24292E">((</span><span style="color: #D73A49">char</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E">)</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">p, </span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(person));</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;name: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">p.name</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;age: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">p.age</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  ifs.</span><span style="color: #6F42C1">close</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
      </tags>
  </entry>
  <entry>
    <title>【C++】模板与泛型编程</title>
    <url>/C++/%E6%A8%A1%E6%9D%BF%E4%B8%8E%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B/</url>
    <content><![CDATA[<h1 id="模板与泛型编程">模板与泛型编程</h1>
<h2 id="模板">模板</h2>
<p>概念：建立通用模具，大大提高复用性，利用模板进行编程的思想被称为泛型编程</p>
<p>机制：函数模板与类模板</p>
<h2 id="函数模板">函数模板</h2>
<p>建立一个通用函数，返回值类型与形参类型可以不具体指定，用虚拟类型代表</p>
<h3 id="语法">语法</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #6A737D">/*函数声明或定义*/</span></span></code></pre></div></div></figure>
<ul>
<li>template：声明创建模板</li>
<li>typename：表示后面的符号是一种数据类型</li>
<li>T：通用数据类型，名称可以替换，但通常是大写字母</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span><span style="color: #6A737D"> // 声明模板</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">swapt</span><span style="color: #24292E">(</span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  T temp </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">  a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> b;</span></span>
<span class="line"><span style="color: #24292E">  b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> temp;</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">20</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  // 方法一：自动类型推导</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">swapt</span><span style="color: #24292E">(a,b);</span></span>
<span class="line"><span style="color: #6A737D">  // 方法二：显式指定类型</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">swapt</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt;(a,b);</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> a </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot; &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> b;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="注意">注意</h3>
<ul>
<li><p>自动类型推导时，必须推导出一致的数据类型T才能使用</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #D73A49">char</span><span style="color: #24292E"> c;</span></span>
<span class="line"><span style="color: #6F42C1">swapt</span><span style="color: #24292E">(a,c);</span><span style="color: #6A737D"> // 出错</span></span></code></pre></div></div></figure></li>
<li><p>模板必须要确定出T的数据类型才能用</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6F42C1">f</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 报错</span></span></code></pre></div></div></figure></li>
<li><p>typename可以用class替换（class可以声明函数模板和类模板）</p></li>
</ul>
<h3 id="与普通函数的区别">与普通函数的区别</h3>
<ul>
<li>普通函数调用可以发生隐式类型转换</li>
<li>函数模板使用自动类型推导时不可以发生隐式类型转换</li>
<li>使用显式指定类型时可以发生隐式类型转换</li>
</ul>
<h3 id="调用规则">调用规则</h3>
<ul>
<li>普通函数与函数模板都可以实现时，优先调用普通函数</li>
<li>可以通过空模板参数列表来强制调用函数模板</li>
<li>函数模板也可以发生重载</li>
<li>如果函数模板可以产生更好的匹配，则优先调用函数模板</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">print</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;普通函数调用&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> a </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot; &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> b </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">print</span><span style="color: #24292E">(</span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;函数模板调用&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> a </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot; &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> b </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">print</span><span style="color: #24292E">(</span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">, </span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #E36209">c</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;重载函数模板调用&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> a </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot; &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> b </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot; &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">c </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">print</span><span style="color: #24292E">(a,b);</span></span>
<span class="line"><span style="color: #6A737D">  // 更好匹配</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">char</span><span style="color: #24292E"> c </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;1&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">char</span><span style="color: #24292E"> d </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;2&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">print</span><span style="color: #24292E">(c,d);</span></span>
<span class="line"><span style="color: #6A737D">  // 强制调用</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">print</span><span style="color: #24292E">&lt;&gt;(a,b);</span></span>
<span class="line"><span style="color: #6A737D">  //重载调用</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> e </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">print</span><span style="color: #24292E">(a, b, e);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="类模板">类模板</h2>
<p>建立一个通用类，类中的成员数据类型可以用虚拟类型代表</p>
<h3 id="语法-1">语法</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #6A737D">/*类*/</span></span></code></pre></div></div></figure>
<ul>
<li>template：声明创建模板</li>
<li>typename：表示后面的符号是一种数据类型</li>
<li>T：通用数据类型，名称可以替换，但通常是大写字母</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #6F42C1">NameType</span><span style="color: #24292E"> </span><span style="color: #E36209">name</span><span style="color: #24292E">, </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E"> </span><span style="color: #E36209">age</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;name </span><span style="color: #D73A49">=</span><span style="color: #24292E"> name;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">show</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;name: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;name</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;age: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;age</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  NameType name;</span></span>
<span class="line"><span style="color: #24292E">  AgeType age;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  // 使用模板参数列表指定类型</span></span>
<span class="line"><span style="color: #24292E">  person</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">string, </span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">p1</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Jack&quot;</span><span style="color: #24292E">, </span><span style="color: #005CC5">18</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  p1.</span><span style="color: #6F42C1">show</span><span style="color: #24292E">();</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="与函数模板的区别">与函数模板的区别</h3>
<ul>
<li><p>类模板没有自动类型推导的方式</p>
<p>不能写<code>person p("a", 1);</code>这种写法，只能显式指定</p></li>
<li><p>类模板在模板参数列表中可以有默认参数</p>
<p><code>template&lt;class NameType, class AgeType = int&gt;</code>可以指定默认的数据类型</p></li>
</ul>
<h3 id="创建时机">创建时机</h3>
<ul>
<li>普通类中的成员函数一开始就可以创建</li>
<li>类模板中的成员函数在调用时才创建，因为调用时才能确定数据类型</li>
</ul>
<h3 id="类模板对象做函数参数">类模板对象做函数参数</h3>
<p>传入方式：</p>
<ul>
<li>指定传入类型：直接显示对象的数据类型</li>
<li>参数模板化：将对象中的参数变为模板进行传递</li>
<li>整个类模板化：将这个对象类型模板化进行传递</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #6F42C1">NameType</span><span style="color: #24292E"> </span><span style="color: #E36209">name</span><span style="color: #24292E">, </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E"> </span><span style="color: #E36209">age</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;name </span><span style="color: #D73A49">=</span><span style="color: #24292E"> name;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">show</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;name: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;name</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;age: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;age</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  NameType name;</span></span>
<span class="line"><span style="color: #24292E">  AgeType age;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #6A737D">// 指定传入类型</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">printp1</span><span style="color: #24292E">(</span><span style="color: #6F42C1">person</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">string</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt; </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  p.</span><span style="color: #6F42C1">show</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6A737D">// 参数模板化</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T1</span><span style="color: #24292E">, </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T2</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">printp2</span><span style="color: #24292E">(</span><span style="color: #6F42C1">person</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">T1</span><span style="color: #24292E">, </span><span style="color: #6F42C1">T2</span><span style="color: #24292E">&gt; </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;T1: &quot;</span><span style="color: #D73A49">&lt;&lt;typeid</span><span style="color: #24292E">(T1).</span><span style="color: #6F42C1">name</span><span style="color: #24292E">()</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;T2: &quot;</span><span style="color: #D73A49">&lt;&lt;typeid</span><span style="color: #24292E">(T2).</span><span style="color: #6F42C1">name</span><span style="color: #24292E">()</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  p.</span><span style="color: #6F42C1">show</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6A737D">// 整个类模板化</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">printp3</span><span style="color: #24292E">(</span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;T: &quot;</span><span style="color: #D73A49">&lt;&lt;typeid</span><span style="color: #24292E">(T).</span><span style="color: #6F42C1">name</span><span style="color: #24292E">()</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  p.</span><span style="color: #6F42C1">show</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">string, </span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">p</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Jack&quot;</span><span style="color: #24292E">, </span><span style="color: #005CC5">18</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printp1</span><span style="color: #24292E">(p);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printp2</span><span style="color: #24292E">(p);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printp3</span><span style="color: #24292E">(p);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="类模板与继承">类模板与继承</h3>
<ul>
<li><p>当子类继承的父类是一个类模板时，子类在声明的时候，要指定出父类中T的类型</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">base</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  T m;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">son</span><span style="color: #24292E">:</span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">base</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt;{</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">};</span></span></code></pre></div></div></figure></li>
<li><p>若想灵活指定父类中的T类型，子类也需要变成类模板</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">base</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  T m;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T1</span><span style="color: #24292E">, </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T2</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">son</span><span style="color: #24292E">:</span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">base</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">T2</span><span style="color: #24292E">&gt;{</span></span>
<span class="line"><span style="color: #24292E">  T1 obj;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  son</span><span style="color: #D73A49">&lt;int</span><span style="color: #24292E">, </span><span style="color: #D73A49">char&gt;</span><span style="color: #24292E"> s1;</span><span style="color: #6A737D"> // 此时int为T1对应的obj的类型，char为T2对应父类中T的类型</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure></li>
</ul>
<h2 id="模板特化">模板特化</h2>
<p>有些特定数据类型需要一些特定的实现方式，需要具体化实现</p>
<h3 id="函数模板特化">函数模板特化</h3>
<p>在需要特化的函数前添加<code>template&lt;&gt;</code></p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">name</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">age</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;name </span><span style="color: #D73A49">=</span><span style="color: #24292E"> name;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  string name;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">bool</span><span style="color: #24292E"> </span><span style="color: #6F42C1">cmp</span><span style="color: #24292E">(</span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (a</span><span style="color: #D73A49">==</span><span style="color: #24292E">b){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">true</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">else</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6A737D">// 使用具体化person的版本实现代码，具体化优先调用</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;&gt; </span><span style="color: #D73A49">bool</span><span style="color: #24292E"> </span><span style="color: #6F42C1">cmp</span><span style="color: #24292E">(</span><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">p1</span><span style="color: #24292E">, </span><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">p2</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (p1.name</span><span style="color: #D73A49">==</span><span style="color: #24292E">p2.name</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E">p1.age </span><span style="color: #D73A49">==</span><span style="color: #24292E">p2.age) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">true</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #6F42C1">p1</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Jack&quot;</span><span style="color: #24292E">, </span><span style="color: #005CC5">10</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #6F42C1">p2</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Jack&quot;</span><span style="color: #24292E">, </span><span style="color: #005CC5">10</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #6F42C1">cmp</span><span style="color: #24292E">(p1,p2)){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;a==b&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;a!=b&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="类模板成员函数类外实现">类模板成员函数类外实现</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #6F42C1">NameType</span><span style="color: #24292E"> </span><span style="color: #E36209">name</span><span style="color: #24292E">, </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E"> </span><span style="color: #E36209">age</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">show</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  NameType name;</span></span>
<span class="line"><span style="color: #24292E">  AgeType age;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 类外实现</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #6F42C1">person</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt;::</span><span style="color: #6F42C1">person</span><span style="color: #24292E">(NameType name, AgeType age){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;name </span><span style="color: #D73A49">=</span><span style="color: #24292E"> name;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt;::</span><span style="color: #6F42C1">show</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;name: &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;name </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;age: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;age</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">string, </span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">p</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Jack&quot;</span><span style="color: #24292E">, </span><span style="color: #005CC5">18</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  p.</span><span style="color: #6F42C1">show</span><span style="color: #24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="类模板分文件编写">类模板分文件编写</h3>
<p>由于类模板中成员函数在调用时才创建，这导致了分文件编写时链接不到，有两个方法</p>
<ul>
<li><p>直接引入.cpp文件</p></li>
<li><p>将声明和实现写在同一个文件中，改后缀名为.hpp</p></li>
</ul>
<p>常用第二种</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#pragma</span><span style="color: #24292E"> </span><span style="color: #6F42C1">once</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #6F42C1">NameType</span><span style="color: #24292E"> </span><span style="color: #E36209">name</span><span style="color: #24292E">, </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E"> </span><span style="color: #E36209">age</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">show</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  NameType name;</span></span>
<span class="line"><span style="color: #24292E">  AgeType age;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 类外实现</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #6F42C1">person</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt;::</span><span style="color: #6F42C1">person</span><span style="color: #24292E">(NameType name, AgeType age){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;name </span><span style="color: #D73A49">=</span><span style="color: #24292E"> name;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt;::</span><span style="color: #6F42C1">show</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;name: &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;name </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;age: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;age</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>（hpp文件）</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;person.hpp&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">string, </span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">p</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Jack&quot;</span><span style="color: #24292E">, </span><span style="color: #005CC5">18</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  p.</span><span style="color: #6F42C1">show</span><span style="color: #24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>（调用文件）</p>
<h3 id="类模板与友元">类模板与友元</h3>
<p>使用场景</p>
<ul>
<li>全局函数类内实现：直接类内声明友元</li>
<li>全局函数类外实现：需要提前让编译器知道全局函数的存在</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">// 前向声明 类与模板函数</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">printPerson2</span><span style="color: #24292E">(</span><span style="color: #6F42C1">person</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt; </span><span style="color: #E36209">p</span><span style="color: #24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #6A737D">  // 类内实现</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">friend</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">printPerson</span><span style="color: #24292E">(</span><span style="color: #6F42C1">person</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt; </span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;name: &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">p.name </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;age: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">p.age</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 类外实现 需要让编译器提前知道这个函数的存在</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">friend</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">printPerson2</span><span style="color: #24292E">&lt;&gt;(person</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">NameType, AgeType</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> p);</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #6F42C1">NameType</span><span style="color: #24292E"> </span><span style="color: #E36209">name</span><span style="color: #24292E">, </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E"> </span><span style="color: #E36209">age</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;name </span><span style="color: #D73A49">=</span><span style="color: #24292E"> name;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  NameType name;</span></span>
<span class="line"><span style="color: #24292E">  AgeType age;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 类外实现</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">printPerson2</span><span style="color: #24292E">(</span><span style="color: #6F42C1">person</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">NameType</span><span style="color: #24292E">, </span><span style="color: #6F42C1">AgeType</span><span style="color: #24292E">&gt; </span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;name: &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p.name </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;age: &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p.age </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">string, </span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">p</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Jack&quot;</span><span style="color: #24292E">, </span><span style="color: #005CC5">18</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printPerson</span><span style="color: #24292E">(p);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printPerson2</span><span style="color: #24292E">(p);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
      </tags>
  </entry>
  <entry>
    <title>【C/C++】指针</title>
    <url>/C++/%E6%8C%87%E9%92%88/</url>
    <content><![CDATA[<h1 id="指针">指针</h1>
<h2 id="数据在内存中的存储">数据在内存中的存储</h2>
<img src="/C++/%E6%8C%87%E9%92%88/%E5%86%85%E5%AD%98.png" class="" title="一段内存">
<p>这是一段内存，他被分成了许多段，每段一个byte</p>
<p>当我们声明一个变量<code>int a</code>，计算机会给该变量分配一块空间，分配取决于<strong>数据类型与编译器</strong></p>
<p>如：int 与float占4bytes，char占1bytes</p>
<p>当我们给变量a赋值<code>a=5</code>，计算机会去寻找该变量，去到他的地址，以二进制写入数据</p>
<h2 id="指针的基础使用">指针的基础使用</h2>
<p>指针是一种变量，它可以存储变量的地址</p>
<p>使用<strong>数据类型*
变量名</strong>创建一个指针：<code>int *p</code>
<code>char *c</code></p>
<p>使用<strong>取地址符&amp;获取一个变量的地址</strong>，并可以将指针指向该变量地址：<code>p=&amp;a</code></p>
<blockquote>
<p>print p，print &amp;a，print
&amp;p分别对应打印p指向(a)的地址，a的地址，p的地址</p>
</blockquote>
<p>将一个*放在指针变量前，可以对指针进行<strong>解引用</strong>，即获取p指向地址的值</p>
<p>则<code>print *p</code>会返回a的值，<code>*p = 8</code>会更改a的值到8</p>
<h3 id="实例代码">实例代码：</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;stdio.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a</span><span style="color: #D73A49">=</span><span style="color: #005CC5">5</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int*</span><span style="color: #24292E"> p;</span><span style="color: #6A737D">  // 若该指针p没有被初始化，p会变成一个野指针，会因为指向任意位置而报错</span></span>
<span class="line"><span style="color: #24292E">    p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">a;</span><span style="color: #6A737D">  // 储存a的地址</span></span>
<span class="line"><span style="color: #6A737D">    // 上两行等同于int* p = &amp;a;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;A:</span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,p);</span><span style="color: #6A737D"> // a的地址</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;V:</span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,</span><span style="color: #D73A49">*</span><span style="color: #24292E">p);</span><span style="color: #6A737D"> // a的值</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;A:</span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">a);</span><span style="color: #6A737D"> // a的地址</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">*</span><span style="color: #24292E">p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">12</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 更改p指向地址(a)的元素值</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;A:</span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,a);</span><span style="color: #6A737D"> // 更改后的a值</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">20</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">*</span><span style="color: #24292E">p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> b;</span><span style="color: #6A737D"> // p不会指向b，只会将b的值赋给a</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;A:</span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,p);</span><span style="color: #6A737D"> // 还是a的地址</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;V:</span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,</span><span style="color: #D73A49">*</span><span style="color: #24292E">p);</span><span style="color: #6A737D"> // b的值</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="指针类型">指针类型</h2>
<p>不同的数据类型占据不同的内存：</p>
<p>int：4bytes</p>
<p>char：1byte</p>
<p>float：4bytes</p>
<p><strong>void指针</strong>：</p>
<ol type="1">
<li>可以存放任意类型的指针，且无需强制类型转换</li>
<li>需要进行显式转换后才能赋值给其他类型</li>
<li>可以与其他类型指针直接比较地址值</li>
<li>只有强制类型转换后才能操作（解引用、算术运算等）</li>
<li>可以和普通指针一样传入NULL或nullptr表示空指针</li>
<li>作为函数输入输出时，表示可以接受任意类型和输出任意类型的指针</li>
</ol>
<h3 id="指针类型间的转换">指针类型间的转换</h3>
<p>定义一个变量int a=1025：</p>
<p>他在内存中的布局为（从右到左分别为第0 1 2
3个字节，他们的地址也是连续的）：</p>
<img src="/C++/%E6%8C%87%E9%92%88/%E4%B8%80%E4%B8%AA%E6%95%B4%E6%95%B0%E5%9C%A8%E5%86%85%E5%AD%98%E4%B8%AD%E7%9A%84%E5%AD%98%E5%82%A8.png" class="" title="一个整数在内存中的存储">
<p>其中，最左边的一位为符号位，0为整数1为负数</p>
<p>若我们定义一个字符指针c指向a，由于字符只占一个字节，故c只会指向a的第一个字节：</p>
<p>对c进行算术运算(+1)会让他指向下一个字节 以至于得到4</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;stdio.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  // 一个整形指针</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1025</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 在二进制中为四字节:00000000 00000000 00000100 00000001</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int*</span><span style="color: #24292E"> p;</span></span>
<span class="line"><span style="color: #24292E">  p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">a;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;size of integer is </span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">, </span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E">));</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Address = </span><span style="color: #005CC5">%d</span><span style="color: #032F62">, value = </span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,p,</span><span style="color: #D73A49">*</span><span style="color: #24292E">p);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 一个字符指针</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">char</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E">c;</span></span>
<span class="line"><span style="color: #24292E">  c </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #D73A49">char*</span><span style="color: #24292E">)p;</span><span style="color: #6A737D"> // 进行强制类型转换</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;size of integer is </span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">, </span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(</span><span style="color: #D73A49">char</span><span style="color: #24292E">));</span></span>
<span class="line"><span style="color: #6A737D">  // 由于char指针只有一个字节,则机器只看从右边开始的一个字节 即00000001</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Address = </span><span style="color: #005CC5">%d</span><span style="color: #032F62">, value = </span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,c,</span><span style="color: #D73A49">*</span><span style="color: #24292E">c);</span></span>
<span class="line"><span style="color: #6A737D">  // 增加一个字节,则指针指向从右边开始的第一个字节 即00000100</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Address = </span><span style="color: #005CC5">%d</span><span style="color: #032F62">, value = </span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,c</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #D73A49">*</span><span style="color: #24292E">(c</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">));</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 一个void指针</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E">p0;</span></span>
<span class="line"><span style="color: #24292E">  p0 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p;</span><span style="color: #6A737D">  // 不需要显式的类型转换</span></span>
<span class="line"><span style="color: #6A737D">  // 当p0没指向任何特定类型时,不能解引用</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Address = </span><span style="color: #005CC5">%d</span><span style="color: #032F62">, value = </span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,p0,</span><span style="color: #D73A49">*</span><span style="color: #24292E">p0);</span></span>
<span class="line"><span style="color: #6A737D">  // 也不要进行算术运算</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Address = </span><span style="color: #005CC5">%d</span><span style="color: #032F62"> </span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,p0,p0</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="指针算术运算">指针算术运算</h2>
<p>对一个指针进行加1操作，相当于将该指针增加一个该指针数据类型所占字节数的字节数</p>
<p>例如对<code>int *p=&amp;a; p++;</code>得到p的值为a的地址加4</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;stdio.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E">p;</span></span>
<span class="line"><span style="color: #24292E">  p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">a;</span></span>
<span class="line"><span style="color: #6A737D">  // 指针加法 : +1代表增加一个数据类型的字节数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Address p is </span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,p);</span><span style="color: #6A737D"> // p的地址</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Value at address p is </span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,</span><span style="color: #D73A49">*</span><span style="color: #24292E">p);</span><span style="color: #6A737D"> // p指向的值</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;size of integer is </span><span style="color: #005CC5">%d</span><span style="color: #032F62"> bytes</span><span style="color: #005CC5">\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">, </span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E">));</span><span style="color: #6A737D"> // int类型所占的字节数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Address p+1 is </span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,p</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span><span style="color: #6A737D"> // p+1指向的地址</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Value at address p+1 is </span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,</span><span style="color: #D73A49">*</span><span style="color: #24292E">(p</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">));</span><span style="color: #6A737D"> // p+1指向的值(垃圾值)</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<img src="/C++/%E6%8C%87%E9%92%88/%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C.png" class="" title="输出结果">
<h2 id="指向指针的指针">指向指针的指针</h2>
<p>假设定义了一个数据<code>int x = 5;</code></p>
<p>我们定义一个指针指向x <code>int *p = &amp;x</code></p>
<p>此时我们可以再定义一个指针指向指针p <code>int **q = &amp;p</code></p>
<p>甚至还可以定义一个指针指向指针q <code>int ***r = &amp;q</code></p>
<img src="/C++/%E6%8C%87%E9%92%88/%E6%8C%87%E5%90%91%E6%8C%87%E9%92%88%E7%9A%84%E6%8C%87%E9%92%88.png" class="" title="指向指针的指针示意">
<p>(r是205)</p>
<h3 id="示例代码">示例代码</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;stdio.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> x </span><span style="color: #D73A49">=</span><span style="color: #005CC5">5</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int*</span><span style="color: #24292E"> p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">x;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">*</span><span style="color: #24292E">p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">6</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int**</span><span style="color: #24292E"> q </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">p;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int***</span><span style="color: #24292E"> r </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">q;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,</span><span style="color: #D73A49">*</span><span style="color: #24292E">p);</span><span style="color: #6A737D"> // p指向x的值</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,</span><span style="color: #D73A49">*</span><span style="color: #24292E">q);</span><span style="color: #6A737D"> // q指向p的值(x的地址)</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,</span><span style="color: #D73A49">*</span><span style="color: #24292E">(</span><span style="color: #D73A49">*</span><span style="color: #24292E">q));</span><span style="color: #6A737D"> // q指向p的值指向x的值</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,</span><span style="color: #D73A49">*</span><span style="color: #24292E">(</span><span style="color: #D73A49">*</span><span style="color: #24292E">r));</span><span style="color: #6A737D"> // r指向q的值,q指向p的值</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,</span><span style="color: #D73A49">*</span><span style="color: #24292E">(</span><span style="color: #D73A49">*</span><span style="color: #24292E">(</span><span style="color: #D73A49">*</span><span style="color: #24292E">r)));</span><span style="color: #6A737D"> // r指向q的值,q指向p的值,p指向x的值</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #6A737D">  // 更改x的值</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">***</span><span style="color: #24292E">r </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">print</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;x = </span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">, x);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // **q与*p都指向x的值,则相当于x自加2</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">**</span><span style="color: #24292E">q </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E">p </span><span style="color: #D73A49">+</span><span style="color: #005CC5">2</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">print</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;x = </span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">, x);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="指针用例函数传引用-or-传值">指针用例—函数传引用 or 传值？</h2>
<h3 id="e.g.-局部变量与全局变量">e.g. 局部变量与全局变量：</h3>
<p>有以下代码</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;stdio.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    x</span><span style="color: #D73A49">=</span><span style="color: #24292E">x</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> x</span><span style="color: #D73A49">=</span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">	</span><span style="color: #6F42C1">f</span><span style="color: #24292E">(x);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,x);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>该代码中的函数想让变量+1，但输出的结果显然还是10，这是为什么呢？</p>
<p>看以下代码：</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;stdio.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Address of x in f is:</span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">x);</span></span>
<span class="line"><span style="color: #24292E">    x</span><span style="color: #D73A49">=</span><span style="color: #24292E">x</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> x</span><span style="color: #D73A49">=</span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">	  </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(x);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Address of x in main is:</span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">x);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>你会惊奇的发现，f函数中的x与main函数中的x的地址不一样，这也就说明了为什么+1不成立</p>
<p>当程序运行时，计算机会预留一部分内存给程序，他们被分为四个部分：<strong>栈、堆、数据区、代码区</strong></p>
<ul>
<li>栈：非静态局部变量（函数参数等）。栈是向下生长的</li>
<li>堆：用于动态内存分配。堆是向上生长的</li>
<li>数据区：存储全局变量和静态变量</li>
<li>代码区：可执行的代码与常量</li>
</ul>
<p>当一个程序进行时，main函数被调用，关于这个函数的信息（如参数，局部变量，返回地址）会存在栈上，栈便为该函数开辟一块空间，称为<strong>栈帧</strong>(stack
frame)，每个函数都会有一个栈帧</p>
<p>让一个函数调用另一个函数时，两个函数分别称为主调函数与被调函数，在主调函数中调用其他函数用到的参数称为实际参数，被调函数中的函数称为形式参数，实参会被映射到形参。这个操作即传值</p>
<p>当main函数调用f函数时，一块它的栈帧会被创建，其中的参数会被分配到对应空间，执行+1操作后，这个函数的栈帧中的变量执行了+1，但不影响其他地方的变量。</p>
<p>当f函数执行完毕，程序回到main函数，此时f的栈帧会被清除，main函数会被继续执行，故局部变量的生命周期只是<strong>函数执行期间</strong>。</p>
<p>接下来进行的函数是printf函数，这是一个库函数，在栈中创建它的栈帧并指型。这一个结构被称为<strong>(函数)调用栈</strong>，即：是将一个个函数的<strong>栈帧</strong>，按照调用的顺序依次压入栈中，等最上层的函数执行完了，就弹出相应的栈帧的过程</p>
<p><strong>注意：栈是有大小的，如果因为无限递归等原因导致栈帧一直被创建而不清除，程序会因为栈溢出而终止</strong></p>
<h4 id="那传引用能否实现">那传引用能否实现？</h4>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;stdio.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">*</span><span style="color: #24292E">p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #D73A49">*</span><span style="color: #24292E">p)</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">    a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">a);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;a = </span><span style="color: #005CC5">%d</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">, a);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>该函数传的是地址</p>
<p>当调用main函数，它的栈帧被创建，a=10进入栈。</p>
<p>调用f函数，它的栈帧被创建，则p接收到a的地址，入栈，此时p指向a。</p>
<p>在函数中解引用p，并执行操作，p指向的内存(a)的值就会增加，即a的值增加1</p>
<p>回到main函数，a的值就是11</p>
<p>这就是传引用，它可以节省很多内存空间，也可以处理一些复杂数据类型以节省内存</p>
<h2 id="指针与数组">指针与数组</h2>
<p>让我们声明一个数组 <code>int a[5]</code></p>
<p>即我们创建了五个整型变量，在内存中连续存在(int
占四个字节)，则整个数组占的大小为20bytes，作为一个连续的块</p>
<img src="/C++/%E6%8C%87%E9%92%88/%E6%8C%87%E9%92%88%E4%B8%8E%E6%95%B0%E7%BB%84.png" class="" title="指针与一维数组">
<p>我们定义一个指针<code>int* p</code>，将p指向a的第一个元素，则p解引用后打印的是a[0]的值</p>
<p>回忆之前说的指针算术，若我们将p+1，则p会往前移动四个字节，**此时*(p+1)即a[0]后四个字节的值，即a[1]**</p>
<p>与之前不同，一个值它的地址+1后会移动到一个未知内容的地址，而数组a中+1后p指向的值是已知的</p>
<p><strong>若直接将数组名赋值给p，则p默认接收到的是数组a首元素的地址，称为数组的基地址</strong></p>
<p>若想获得数组某个值的地址，可以使用<code>&amp;a[i]</code>或者<code>a+i</code></p>
<p>若想获得数组某个值，可以使用<code>a[i]</code>或者<code>*(a+i)</code></p>
<p><strong>注意：对数组名（常量
）自加是非法的，可以定义一个指针指向数组名让该指针自加</strong></p>
<h4 id="实例代码-1">实例代码：</h4>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;stdio.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a[]</span><span style="color: #D73A49">=</span><span style="color: #24292E">{</span><span style="color: #005CC5">2</span><span style="color: #24292E">,</span><span style="color: #005CC5">4</span><span style="color: #24292E">,</span><span style="color: #005CC5">5</span><span style="color: #24292E">,</span><span style="color: #005CC5">8</span><span style="color: #24292E">,</span><span style="color: #005CC5">1</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">5</span><span style="color: #24292E">;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Address = </span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">a[i]);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Address = </span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,a</span><span style="color: #D73A49">+</span><span style="color: #24292E">i);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Value = </span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,a[i]);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Value = </span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">, </span><span style="color: #D73A49">*</span><span style="color: #24292E">(a</span><span style="color: #D73A49">+</span><span style="color: #24292E">i));</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="指针用例数组传参">指针用例—数组传参</h2>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;stdio.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">suma</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">[],</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">size</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> sum </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">size;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    sum</span><span style="color: #D73A49">+=</span><span style="color: #24292E">a[i];</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> sum;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">sumb</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">[]){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> sum </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> size </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(a)</span><span style="color: #D73A49">/sizeof</span><span style="color: #24292E">(a[</span><span style="color: #005CC5">0</span><span style="color: #24292E">]);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;In sumb - size of a = </span><span style="color: #005CC5">%d</span><span style="color: #032F62">, size of a[0] = </span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,</span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(a),</span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(a[</span><span style="color: #005CC5">0</span><span style="color: #24292E">]));</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">size;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    sum</span><span style="color: #D73A49">+=</span><span style="color: #24292E">a[i];</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> sum;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a[]</span><span style="color: #D73A49">=</span><span style="color: #24292E">{</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">2</span><span style="color: #24292E">,</span><span style="color: #005CC5">3</span><span style="color: #24292E">,</span><span style="color: #005CC5">4</span><span style="color: #24292E">,</span><span style="color: #005CC5">5</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #6A737D">  // 计算数组大小</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;In main - size of a = </span><span style="color: #005CC5">%d</span><span style="color: #032F62">, size of a[0] = </span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,</span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(a),</span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(a[</span><span style="color: #005CC5">0</span><span style="color: #24292E">]));</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> size </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(a)</span><span style="color: #D73A49">/sizeof</span><span style="color: #24292E">(a[</span><span style="color: #005CC5">0</span><span style="color: #24292E">]);</span></span>
<span class="line"><span style="color: #6A737D">  // 传入数组大小后进行加和</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> tot </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">suma</span><span style="color: #24292E">(a,size);</span></span>
<span class="line"><span style="color: #6A737D">  // 在函数中计算数组大小并加和</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> tot2 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">sumb</span><span style="color: #24292E">(a);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;tot = </span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">, tot);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;tot2 = </span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">, tot2);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>以上代码会出现一些问题：</p>
<img src="/C++/%E6%8C%87%E9%92%88/%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C2.png" class="" title="输出结果">
<p>在调用main与sumb函数时，它们的栈帧会被创建</p>
<p>调用sumb函数时，编译器只会创建一个同名的指针在sumb的栈帧中，即它只指向main函数中数组a的首元素地址（<strong>即<code>int a[]</code>等同于<code>int *a</code></strong>）</p>
<p>因此函数中的sizeof a是一个8字节的指针。</p>
<h2 id="指针与字符数组">指针与字符数组</h2>
<h3 id="字符数组">字符数组</h3>
<p><strong>C中的字符串存储在数组中，必须以’\0’结束</strong></p>
<p>字符数组赋值：</p>
<p>可以指定每一位进行赋值，</p>
<p>或者使用字符串字面值（用双引号括起来的字符串）赋值，该方法会隐式地添加一个’\0’</p>
<p>或者使用大括号初始化每一位，以逗号间隔并在结尾加上’\0’</p>
<p><strong>注意：只能在声明同时用字符串字面值赋值</strong></p>
<h3 id="使用指针">使用指针</h3>
<p>字符数组中数组名代表的是数组首元素的地址，可以用一个指针变量指向它，该变量也可以对字符数组进行操作</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;stdio.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">char</span><span style="color: #24292E"> c1[</span><span style="color: #005CC5">6</span><span style="color: #24292E">]</span><span style="color: #D73A49">=</span><span style="color: #032F62">&quot;Hello&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">char</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E">c2;</span></span>
<span class="line"><span style="color: #24292E">    c2 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> c1;</span></span>
<span class="line"><span style="color: #24292E">    c2[</span><span style="color: #005CC5">0</span><span style="color: #24292E">]</span><span style="color: #D73A49">=</span><span style="color: #032F62">&#39;A&#39;</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // equal to c1[0]=&#39;A&#39;;</span></span>
<span class="line"><span style="color: #24292E">    </span></span>
<span class="line"><span style="color: #24292E">    c2</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 指向下一个元素</span></span>
<span class="line"><span style="color: #24292E">    c1</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 非法</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>有等价关系：</p>
<p><code>c2[i]</code>等同于<code>*(c2+i)</code>
<code>c1[i]</code>等同于<code>*(c1+i)</code></p>
<h3 id="函数传参">函数传参</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;stdio.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">print</span><span style="color: #24292E">(</span><span style="color: #D73A49">char</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">c</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  // while (c[i]!=&#39;\0&#39;){ // *(c+i)也可以</span></span>
<span class="line"><span style="color: #6A737D">  //   printf(&quot;%c&quot;,c[i]);</span></span>
<span class="line"><span style="color: #6A737D">  //   i++;</span></span>
<span class="line"><span style="color: #6A737D">  // }</span></span>
<span class="line"><span style="color: #6A737D">  // 由于c是指针，故可以通过自增与解引用来进行访问</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">(</span><span style="color: #D73A49">*</span><span style="color: #24292E">c</span><span style="color: #D73A49">!=</span><span style="color: #032F62">&#39;</span><span style="color: #005CC5">\0</span><span style="color: #032F62">&#39;</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">%c</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,</span><span style="color: #D73A49">*</span><span style="color: #24292E">c);</span></span>
<span class="line"><span style="color: #24292E">    c</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">char</span><span style="color: #24292E"> c[</span><span style="color: #005CC5">20</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;Hello&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">print</span><span style="color: #24292E">(c);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="指针与二维数组">指针与二维数组</h2>
<p>如果我们要创建一个二维数组<code>b[2][3]</code></p>
<p>此时，<code>b[0]</code>与<code>b[1]</code>表示三个整数的一维数组，在内存中占用3*4=12个字节，是按行存储的</p>
<p>故<code>int *p=b;</code>指代的是返回一个指向一维数组的指针，此时不能指针运算或解引用，故不能这么用</p>
<p>故应使用<code>int (*p)[3]</code>来创建一个二维指针数组，其中3表示三个指向一维数组的指针</p>
<p>这时<code>print b or &amp;b[0]</code>都指代第一个元素的地址</p>
<p>​
<code>print *b or b[0] or &amp;b[0][0]</code>都指代第一个元素地址的值</p>
<p>​
<code>print b+1 or &amp;b[1]</code>会跳到下一个数组的首地址（+12）</p>
<p>使用<code>print *(b+ 1)</code>or
<code>b[i]</code>or<code>&amp;b[1][0]</code>指代下一个指向一维数组的并返回
值</p>
<p>解引用时，需要一步步解</p>
<blockquote>
<p>例 <code>*(*b+1)</code></p>
</blockquote>
<p>*b
为b[0]，一个一维数组的首元素地址，<code>*b+1</code>会让指针移动四个字节带到下一个整型变量，</p>
<p>相当于<code>&amp;b[0][1]</code></p>
<p>我们解引用后，<code>*(*b+1)</code>就相当于<code>b[0][1]</code></p>
<p><strong>指针运算：<code>b[i][j]</code>=<code>*(b[i]+j)</code>=<code>*(*(b+i)+j)</code></strong></p>
<h2 id="指针与多维数组">指针与多维数组</h2>
<h3 id="原理">原理</h3>
<p>与二维数组类似</p>
<p>假如我们有一个int数组<code>c[3][2][2]</code>，在内存中的存储如下</p>
<img src="/C++/%E6%8C%87%E9%92%88/%E6%8C%87%E9%92%88%E4%B8%8E%E5%A4%9A%E7%BB%B4%E6%95%B0%E7%BB%84.png" class="" title="指针与多维数组">
<p>简化为三个二维数组线性存储，每个二维数组内两个一维数组线性存储</p>
<p>故我们可以声明一个指针<code>int (*p)[2][2] = c;</code>，指向2*2的二维数组</p>
<p>这时<code>print c</code>，<code>print *c</code>，<code>print c[0]</code>，<code>print &amp;c[0][0]</code>均输出第一个一维数组的地址</p>
<p><strong>指针运算：<code>c[i][j][k]=*(c[i][j]+k)=*(*(c[i]+j)+k)=*(*(*(c+i)+j)+k)</code></strong></p>
<p>可以理解为解引用一次就脱一层[]</p>
<p>e.g.</p>
<p><code>print *(c[0][1]+1)</code>指向的是<code>c[0][1][1]</code></p>
<p><code>print *(c[1]+1)</code>指向的是<code>c[1][1]</code>，即<code>c[1][1][0]</code></p>
<h3 id="用于函数传参">用于函数传参</h3>
<p>如一维数组传参，我们可以通过传值或传引用两种方法传参</p>
<p><strong>注意：传值时除了最高维度，其他维度必须要指定偏移量（即形参定义时必须和传入数组长度一样）</strong></p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">two_dim</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">[][</span><span style="color: #005CC5">3</span><span style="color: #24292E">]){</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">three_dim</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">[][</span><span style="color: #005CC5">2</span><span style="color: #24292E">][</span><span style="color: #005CC5">2</span><span style="color: #24292E">]){</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>而根据数组名就是指向第一个元素的指针，我们可以直接传引用来实现降维度</p>
<p><strong>注意：只能降到次一级维度，且其余的必须指定偏移量</strong></p>
<p><figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">int two_dim(int (*a)[3]){</span></span>
<span class="line"><span style="color: #24292e"></span></span>
<span class="line"><span style="color: #24292e">}</span></span>
<span class="line"><span style="color: #24292e">int three_dim(int (*a)[2][2]){</span></span>
<span class="line"><span style="color: #24292e"></span></span>
<span class="line"><span style="color: #24292e">}</span></span></code></pre></div></div></figure></p>
<h2 id="指针与动态内存">指针与动态内存</h2>
<h3 id="内存的分配">内存的分配</h3>
<p>在一个典型架构中，分配给应用程序的内存分为四个区段：<strong>栈、堆、数据区、代码区</strong></p>
<ul>
<li>栈：非静态局部变量（函数参数等），函数调用信息。栈是向下生长的</li>
<li>堆：用于动态内存分配。堆是向上生长的</li>
<li>数据区：存储全局变量和静态变量</li>
<li>代码区：可执行的代码与常量</li>
</ul>
<h3 id="栈">栈</h3>
<p>当一个程序进行时，main函数被调用，关于这个函数的信息（如参数，局部变量，返回地址）会存在栈上，栈便为该函数开辟一块空间，称为<strong>栈帧</strong>(stack
frame)，每个函数都会有一个栈帧，大小在编译期间决定</p>
<p>所有函数从下往上开辟栈帧后，在执行时总是栈顶的函数在执行，其余函数暂停，等待上方函数返回值等。当上方函数返回后，它占用栈的内存也会被清除，下一个函数运行。<strong>任何时候正在执行的函数都是栈顶的那个函数</strong></p>
<p>预留给栈的空间在运行期间并不会增长，也不能请求更多内存。如果运行时的栈增长超过了程序预留的栈内存大小，那么会造成<strong>栈溢出(stack
overflow)</strong></p>
<p>因此栈有两个限制：</p>
<ol type="1">
<li>在栈上的变量无法操作骑作用域</li>
<li>当声明一个很大的数据类型，可能会造成溢出；且只能在编译时分配他的大小，无法在程序运行时分配它的大小</li>
</ol>
<h3 id="堆动态内存">堆(动态内存)</h3>
<p>这时我们需要用到<strong>堆</strong>来分配或销毁或内存。我们可以任意使用堆上的内存，只要不超过系统内存限制。</p>
<p>堆又称为<strong>动态内存</strong>，使用堆内存称为<strong>动态内存分配</strong>
(注意这里的堆并不是数据结构)</p>
<h4 id="c风格">C风格：</h4>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;stdio.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;stdlib.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a;</span><span style="color: #6A737D"> // 分配到栈上</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E">p;</span><span style="color: #6A737D"> // 指向堆内存的指针</span></span>
<span class="line"><span style="color: #24292E">  p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int*</span><span style="color: #24292E">)</span><span style="color: #6F42C1">malloc</span><span style="color: #24292E">(</span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E">));</span><span style="color: #6A737D"> // 在堆上开辟一块四字节的内存，让指针p指向其地址</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">*</span><span style="color: #24292E">p</span><span style="color: #D73A49">=</span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 解引用将值存入堆</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">free</span><span style="color: #24292E">(p);</span><span style="color: #6A737D"> // 释放内存</span></span>
<span class="line"><span style="color: #24292E">  p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int*</span><span style="color: #24292E">)</span><span style="color: #6F42C1">malloc</span><span style="color: #24292E">(</span><span style="color: #005CC5">20</span><span style="color: #D73A49">*sizeof</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E">));</span><span style="color: #6A737D"> // 在堆上再开辟一块20个四字节的内存作为数组，让指针p指向其首元素地址</span></span>
<span class="line"><span style="color: #6A737D">  // 可以用以下两种方式访问</span></span>
<span class="line"><span style="color: #24292E">  p[</span><span style="color: #005CC5">0</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">; </span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">*</span><span style="color: #24292E">(p</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">) </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>定义一个指针变量p，它被存储在栈中，指向堆中分配的内存地址</p>
<p>通过malloc在堆上分配一块四字节的内存，malloc会返回一个指向这块内存起始地址的指针，<strong>void类型</strong>。故我们需要进行一个强制类型转换，并赋给指针变量p</p>
<p>使用堆上内存的唯一方式是通过<strong>引用</strong>，自己维护一个指针指向这块内存。我们通过对指针变量p解引用并赋值来使用。</p>
<p>若我们再以同样方式分配一块四字节内存，让p指向它，并赋值为20，p此时指向的便是堆中的另一块内存。而之前那块内存仍在堆上，并不会被自动回收，此时称为<strong>内存泄漏</strong>，因此我们<strong>需要在用完一块内存后，及时调用free()释放内存。</strong></p>
<p>如果要分配一个数组内存，我们只需要传入数组大小字节数即可，返回的是内存的初始地址</p>
<p>若malloc无法在堆上成功分配内存，会返回<strong>NULL</strong></p>
<h4 id="c风格-1">C++风格：</h4>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;stdio.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;stdlib.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E">p;</span><span style="color: #6A737D"> // 指向堆内存的指针</span></span>
<span class="line"><span style="color: #24292E">  p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 在堆上开辟一块int大小的内存(四字节)</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">*</span><span style="color: #24292E">p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 解引用并赋值</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">delete</span><span style="color: #24292E"> p;</span><span style="color: #6A737D"> // 释放内存</span></span>
<span class="line"><span style="color: #24292E">  p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E">[</span><span style="color: #005CC5">20</span><span style="color: #24292E">];</span><span style="color: #6A737D"> // 在堆上开辟一个20大小的int数组</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">delete[]</span><span style="color: #24292E"> p;</span><span style="color: #6A737D"> // 释放数组内存</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>c++中使用关键字new与delete开辟与释放内存，不需要类型转换</p>
<h3 id="相关函数">相关函数</h3>
<h4 id="malloc">malloc</h4>
<p>定义：<code>void* malloc(size_t size)</code>(size_t相当于无符号整数)</p>
<p>用法：<code>int *p = (int*)malloc(分配空间大小)</code></p>
<ul>
<li>分配空间大小一般习惯通过sizeof计算，如想要开辟一个存储三个int变量的数组，我们可以用<code>3*sizeof(int)</code>来计算大小，一般不直接写。</li>
<li>由于malloc返回的是void指针，指向其初始地址，而void指针无法解引用，因此我们一般在前面进行强制类型转换来转化成int指针以方便操作</li>
<li>malloc不会将分配的空间初始化，建议使用<code>memset(p,0x00,sizeof(p))</code>初始化</li>
</ul>
<h4 id="calloc">calloc</h4>
<p>定义：<code>void* calloc(size_t num, size_t size)</code></p>
<p>用法：<code>int *p = (int*)calloc(分配元素个数, 每个元素空间大小)</code></p>
<ul>
<li>calloc可以指定分配的元素个数</li>
<li>calloc在分配空间后会自动将其初始化为0</li>
</ul>
<h4 id="realloc">realloc</h4>
<p>定义：<code>void* realloc(void* ptr, size_t size)</code></p>
<p>用法：<code>realloc(已指向某处内存的指针, 修改空间大小)</code></p>
<ul>
<li>realloc用于修改分配的内存大小</li>
<li>若需要的新内存块比原来大，程序会创建一块新内存并将内容复制过去</li>
<li>若之前的内存的相邻部分还有可用内存，程序会直接拓展原空间</li>
<li>若需要的新内存块比原来小，则多余部分的内存会被释放掉</li>
</ul>
<p>注意以下用法：</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E">a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int*</span><span style="color: #24292E">)</span><span style="color: #6F42C1">realloc</span><span style="color: #24292E">(a,</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span><span style="color: #6A737D"> // 相当于free(a)</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E">b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int*</span><span style="color: #24292E">)</span><span style="color: #6F42C1">realloc</span><span style="color: #24292E">(</span><span style="color: #005CC5">NULL</span><span style="color: #24292E">,n</span><span style="color: #D73A49">*sizeof</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E">));</span><span style="color: #6A737D"> // 相当于malloc</span></span></code></pre></div></div></figure>
<h3 id="内存泄漏">内存泄漏</h3>
<p>当我们动态申请了内存后，忘记去释放，此时程序占用了一些未使用的内存，称为内存泄露</p>
<p>对于栈：由于栈帧在使用完后会被自动销毁，故不会发生内存泄漏</p>
<p>对于堆：在开辟空间后，堆上的内存必须要被显式地释放掉，否则会一直存在</p>
<p><strong>注意：任何未使用和未引用的堆上内存都是垃圾，程序员要确保不要浪费内存</strong></p>
<h2 id="函数返回指针">函数返回指针</h2>
<p>我们可以在函数类型处加上*来声明函数返回值是一个指针。</p>
<p>注意以下情况：</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;stdio.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;stdlib.h&gt;</span></span>
<span class="line"><span style="color: #6A737D">// 现在该函数返回的是一个int类型的指针，即c的地址</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">print</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;hello world&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">add</span><span style="color: #24292E">(</span><span style="color: #D73A49">int*</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">,</span><span style="color: #D73A49">int*</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> c </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #D73A49">*</span><span style="color: #24292E">a)</span><span style="color: #D73A49">+</span><span style="color: #24292E">(</span><span style="color: #D73A49">*</span><span style="color: #24292E">b);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">c;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> x </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #24292E">,y</span><span style="color: #D73A49">=</span><span style="color: #005CC5">4</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int*</span><span style="color: #24292E"> p </span><span style="color: #D73A49">=</span><span style="color: #6F42C1">add</span><span style="color: #24292E">(</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">x,</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">y);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">print</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;sum=</span><span style="color: #005CC5">%d</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,</span><span style="color: #D73A49">*</span><span style="color: #24292E">p);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>该程序对print的输出正常，而输出sum时出现了异常，从底层原理分析：</p>
<p>执行main函数，开辟栈帧，执行add函数，在main函数上再开辟栈帧，main函数会等待add返回</p>
<p>此时add中a与b存储了main函数中x与y的地址，c存储了<code>*a</code>与<code>*b</code>的和，返回的是c的地址，故main函数中的p指针存储的是c的地址</p>
<p>add执行完毕，占用空间被清除。但注意，<strong>此时p指向的内存仍未变化，即此时它指向了被释放掉的内存空间，值是随机的</strong></p>
<p>现在执行print函数，开辟栈帧，原空间被覆盖，因此p存储的地址对应的值已经不是c的值了，因此输出异常。</p>
<p>还有一种情况：若不执行print函数，输出的值可能会正确。因为此时程序还没重写或清除那个空间上的数据（虽然已经释放空间）</p>
<p>而对于main与add函数，由于<strong>被调函数的栈空间总是在主调函数之上</strong>，因此被调函数执行时主调函数仍在栈内存中，因此add可以访问main函数中的变量。但若我们想要返回被调函数的一个局部变量给主调函数，当被调函数结束后，内存已被释放，因此会出问题。</p>
<p>因此<strong>可以从栈底向上传局部变量或局部变量的地址，但不能从栈顶向下传局部变量或局部变量的地址</strong></p>
<p>因此我们可以修改：</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;stdio.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;stdlib.h&gt;</span></span>
<span class="line"><span style="color: #6A737D">// 现在该函数返回的是一个int类型的指针，即c的地址</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">print</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;hello world&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">add</span><span style="color: #24292E">(</span><span style="color: #D73A49">int*</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">,</span><span style="color: #D73A49">int*</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E">c </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int*</span><span style="color: #24292E">)</span><span style="color: #6F42C1">malloc</span><span style="color: #24292E">(</span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E">));</span><span style="color: #6A737D"> // 在堆上开辟内存</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">*</span><span style="color: #24292E">c </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #D73A49">*</span><span style="color: #24292E">a)</span><span style="color: #D73A49">+</span><span style="color: #24292E">(</span><span style="color: #D73A49">*</span><span style="color: #24292E">b);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> c;</span><span style="color: #6A737D"> // 返回的是堆上的指针</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> x </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #24292E">,y</span><span style="color: #D73A49">=</span><span style="color: #005CC5">4</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int*</span><span style="color: #24292E"> p </span><span style="color: #D73A49">=</span><span style="color: #6F42C1">add</span><span style="color: #24292E">(</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">x,</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">y);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">print</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;sum=</span><span style="color: #005CC5">%d</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,</span><span style="color: #D73A49">*</span><span style="color: #24292E">p);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>我们将c开辟在堆上，此时就不会被清除了，返回c是安全的</p>
<h2 id="函数指针">函数指针</h2>
<p>我们可以用指针指向函数地址，即指向函数的指针。我们可以用这种指针解引用和调用函数。</p>
<h3 id="函数的地址">函数的地址</h3>
<p>在内存中，一个函数就是一块连续的内存。</p>
<p>一般程序执行指令会按照地址依次执行，而函数调用可以让程序跳到某一个地址开始执行其中的指令。</p>
<p>此时对应的函数地址可以称为函数的入口点，即函数第一条指令的地址</p>
<h3 id="函数指针的使用">函数指针的使用</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;stdio.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;stdlib.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">print</span><span style="color: #24292E">(</span><span style="color: #D73A49">char</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">name</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;hello&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">add</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> a</span><span style="color: #D73A49">+</span><span style="color: #24292E">b;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> c;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> (*p)(</span><span style="color: #D73A49">int</span><span style="color: #24292E">,</span><span style="color: #D73A49">int</span><span style="color: #24292E">);</span><span style="color: #6A737D"> // 函数指针</span></span>
<span class="line"><span style="color: #24292E">  p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">add;</span><span style="color: #6A737D"> // 指针指向add函数的地址(不用&amp;也可)</span></span>
<span class="line"><span style="color: #24292E">  c </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #D73A49">*</span><span style="color: #24292E">p)(</span><span style="color: #005CC5">2</span><span style="color: #24292E">,</span><span style="color: #005CC5">3</span><span style="color: #24292E">);</span><span style="color: #6A737D"> // 解引用，并传入参数执行函数(不用解引用也行)</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,c);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> (*ptr)(</span><span style="color: #D73A49">char*</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  ptr </span><span style="color: #D73A49">=</span><span style="color: #24292E"> print;</span><span style="color: #6A737D"> // 不用&amp;的情况</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">ptr</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;mixbp&quot;</span><span style="color: #24292E">);</span><span style="color: #6A737D"> // 不用解引用的情况</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>由于单纯的函数名代表函数入口点，故不用&amp;与解引用也可以</p>
<p><strong>注意：为了指向一个函数，函数指针的类型必须是正确的</strong></p>
<h3 id="回调函数">回调函数</h3>
<p>将函数指针作为函数参数传入，并在函数内部通过该函数指针调用函数，被调用的函数即为回调函数</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;stdio.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;stdlib.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">print</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;hello&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">b</span><span style="color: #24292E">(</span><span style="color: #D73A49">void</span><span style="color: #24292E"> (*</span><span style="color: #E36209">ptr</span><span style="color: #24292E">)()){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">ptr</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 用ptr回调传进来的函数</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> (*p)() </span><span style="color: #D73A49">=</span><span style="color: #24292E"> print;</span><span style="color: #6A737D"> // 定义一个指针指向print</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">b</span><span style="color: #24292E">(p);</span><span style="color: #6A737D"> // 传入该函数指针</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">b</span><span style="color: #24292E">(print);</span><span style="color: #6A737D"> // 这样也可以传</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>代码中，函数b可以通过函数指针来回调函数print</p>
<p>可以定义一个指向print函数的指针传入，也可以直接传入print，此时指代的是print函数的首地址</p>
<h3 id="应用排序">应用：排序</h3>
<p>设计一个排序函数，并可以按照不同逻辑进行排序</p>
<p>我们可以在普通排序函数中添加一个函数指针参数(比较函数)，通过设计<del>蚂蚁</del>比较逻辑并传入排序函数，可以灵活实现不同情景的比较，而不用每次都根据不同逻辑重新写一遍排序函数</p>
<p>如实现正序、逆序、按绝对值排序</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;stdio.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;math.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">compare</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">,</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (a</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">b) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">r_compare</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (a</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">b) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">abs_compare</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #6F42C1">abs</span><span style="color: #24292E">(a)</span><span style="color: #D73A49">&gt;</span><span style="color: #6F42C1">abs</span><span style="color: #24292E">(b)) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">sort</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">n</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> (*</span><span style="color: #E36209">cmp</span><span style="color: #24292E">)(</span><span style="color: #D73A49">int</span><span style="color: #24292E">,</span><span style="color: #D73A49">int</span><span style="color: #24292E">)){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> tep;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;j</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">n</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">;j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #6F42C1">cmp</span><span style="color: #24292E">(a[j],a[j</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">])</span><span style="color: #D73A49">&gt;</span><span style="color: #005CC5">0</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        tep </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a[j];</span></span>
<span class="line"><span style="color: #24292E">        a[j] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a[j</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #24292E">        a[j</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">]</span><span style="color: #D73A49">=</span><span style="color: #24292E">tep;</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a[]</span><span style="color: #D73A49">=</span><span style="color: #24292E">{</span><span style="color: #005CC5">3</span><span style="color: #24292E">,</span><span style="color: #005CC5">2</span><span style="color: #24292E">,</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">5</span><span style="color: #24292E">,</span><span style="color: #005CC5">6</span><span style="color: #24292E">,</span><span style="color: #005CC5">4</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> b[]</span><span style="color: #D73A49">=</span><span style="color: #24292E">{</span><span style="color: #D73A49">-</span><span style="color: #005CC5">2</span><span style="color: #24292E">,</span><span style="color: #D73A49">-</span><span style="color: #005CC5">3</span><span style="color: #24292E">,</span><span style="color: #005CC5">5</span><span style="color: #24292E">,</span><span style="color: #005CC5">4</span><span style="color: #24292E">,</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #D73A49">-</span><span style="color: #005CC5">6</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">sort</span><span style="color: #24292E">(a,</span><span style="color: #005CC5">6</span><span style="color: #24292E">,compare);</span><span style="color: #6A737D"> // 正序排序</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">6</span><span style="color: #24292E">;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">%d</span><span style="color: #032F62"> &quot;</span><span style="color: #24292E">,a[i]);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">sort</span><span style="color: #24292E">(a,</span><span style="color: #005CC5">6</span><span style="color: #24292E">,r_compare);</span><span style="color: #6A737D"> // 逆序排序</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">6</span><span style="color: #24292E">;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">%d</span><span style="color: #032F62"> &quot;</span><span style="color: #24292E">,a[i]);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">sort</span><span style="color: #24292E">(b,</span><span style="color: #005CC5">6</span><span style="color: #24292E">,abs_compare);</span><span style="color: #6A737D"> // 绝对值排序</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">6</span><span style="color: #24292E">;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">%d</span><span style="color: #032F62"> &quot;</span><span style="color: #24292E">,b[i]);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>同样的逻辑，在c的stdlib.h库中有一个qsort函数，只要给予它排序逻辑并传入就可以对任意数组排序</p>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
      </tags>
  </entry>
  <entry>
    <title>【C++】概念与约束</title>
    <url>/C++/%E6%A6%82%E5%BF%B5%E4%B8%8E%E7%BA%A6%E6%9D%9F/</url>
    <content><![CDATA[<h1 id="概念与约束">概念与约束</h1>
<p>C++20引入了概念和约束的概念，用于限定模板类型实参的范围</p>
<p>新增了两个关键字concept与requires用于实现要求</p>
<h2 id="requires">requires</h2>
<h3 id="requires表达式">requires表达式</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">requires</span><span style="color: #24292E">(Type1 para1, Type2 para2, ...){</span></span>
<span class="line"><span style="color: #24292E">    要求1;</span></span>
<span class="line"><span style="color: #24292E">    要求2;</span></span>
<span class="line"><span style="color: #24292E">    ...</span></span>
<span class="line"><span style="color: #24292E">    要求n;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>require可以有0-n个参数，大括号内有0-n个表达式</p>
<p>require表达式是常量表达式，编译时求值，依次对要求进行判断，遇到第一个无效表达式时返回false，若所有表达式都是有效或良构的，返回true</p>
<p><strong>注意：每条要求不会被实例化或求值，仅用于判断有效</strong></p>
<p>例1：</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E"> &lt;</span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">bool</span><span style="color: #24292E"> </span><span style="color: #6F42C1">isAddable</span><span style="color: #24292E">(</span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">bool</span><span style="color: #24292E"> result </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">requires</span><span style="color: #24292E">(T a, T b){</span></span>
<span class="line"><span style="color: #24292E">        a</span><span style="color: #D73A49">+</span><span style="color: #24292E">b;</span></span>
<span class="line"><span style="color: #24292E">        a</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        a</span><span style="color: #D73A49">+=</span><span style="color: #24292E">b;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">++</span><span style="color: #24292E">a;</span></span>
<span class="line"><span style="color: #24292E">        {a</span><span style="color: #D73A49">*</span><span style="color: #005CC5">1</span><span style="color: #24292E">}</span><span style="color: #D73A49">-&gt;</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::convertible_to</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">T</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    };</span></span>
<span class="line"><span style="color: #24292E">   	</span><span style="color: #D73A49">return</span><span style="color: #24292E"> result;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>其中最后一条为<strong>复合要求</strong>：</p>
<p>大括号里用于判断是否是有效的表达式，右箭头后面判断表达式的值是否符合某些条件</p>
<p>当T为int时，要求都可以成立，表达式的值为true</p>
<p>当T为string时，a++是无效的，表达式的值为false</p>
<p>例2：</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">constexpr</span><span style="color: #24292E"> </span><span style="color: #D73A49">bool</span><span style="color: #24292E"> </span><span style="color: #6F42C1">isIteratable</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">bool</span><span style="color: #24292E"> result </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">requires</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">        	</span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">::</span><span style="color: #6F42C1">iterator</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    	};</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> result;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>这个例子中，还有一种要求为<strong>条件要求</strong>：</p>
<p>格式为<code>typename 表达式</code>，判断类型是否有效</p>
<p>当T为int时，int内没有迭代器，表达式的值为false</p>
<p>当T为string时，string内嵌了迭代器，表达式的值为true</p>
<h3 id="嵌套要求">嵌套要求</h3>
<p>语法：<code>require 约束表达式</code></p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">constexpr</span><span style="color: #24292E"> </span><span style="color: #D73A49">bool</span><span style="color: #24292E"> </span><span style="color: #6F42C1">isFloat</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">bool</span><span style="color: #24292E"> result </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">requires</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">        	</span><span style="color: #D73A49">requires</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::is_floating_point_v</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">T</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    };</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> result;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>此处约束表达式用于判断是否是浮点数</p>
<h3 id="requires子句">requires子句</h3>
<p>语法：<code>requires 常量表达式（约束）</code></p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">requires</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">is_integral</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;::value</span></span>
<span class="line"><span style="color: #D73A49">bool</span><span style="color: #24292E"> </span><span style="color: #6F42C1">is_even</span><span style="color: #24292E">(</span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #E36209">i</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> i</span><span style="color: #D73A49">%</span><span style="color: #005CC5">2</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>该函数模板设定了一个requires子句，判断传参是否为整型，只有满足该子句函数模板才能实例化，否则编译会报错</p>
<p>requires子句中的表达式也可以使用requires表达式</p>
<p>requires子句中也可以使用&amp;&amp;与||，前者需要满足所有约束，后者需要至少满足一项约束</p>
<h2 id="concept">concept</h2>
<p>以上例子中的约束条件即为匿名概念，我们可以将约束条件定义为一个概念</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;模板参数列表&gt;</span></span>
<span class="line"><span style="color: #D73A49">concept</span><span style="color: #24292E"> ConcentName </span><span style="color: #D73A49">=</span><span style="color: #24292E"> 约束表达式;</span></span></code></pre></div></div></figure>
<p>定义后我们可以直接使用概念</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">requires</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">::integral</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">T</span><span style="color: #D73A49">&gt;</span></span>
<span class="line"><span style="color: #D73A49">bool</span><span style="color: #24292E"> </span><span style="color: #6F42C1">is_odd</span><span style="color: #24292E">(</span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #E36209">i</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> i</span><span style="color: #D73A49">%</span><span style="color: #005CC5">2</span><span style="color: #D73A49">!=</span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>这里requires子句中使用了预定义的概念integral，定义如下：</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">_Tp</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">concept</span><span style="color: #24292E"> integral </span><span style="color: #D73A49">=</span><span style="color: #24292E"> is_integral_v</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">_Tp</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">;</span></span></code></pre></div></div></figure>
<p>或将模板中typename替换为概念</p>
<p>或使用概念+auto来定义形参</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">bool</span><span style="color: #24292E"> </span><span style="color: #6F42C1">is_odd</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::</span><span style="color: #6F42C1">integral</span><span style="color: #24292E"> </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> </span><span style="color: #E36209">i</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> i</span><span style="color: #D73A49">%</span><span style="color: #005CC5">2</span><span style="color: #D73A49">!=</span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>通常定义概念时，概念应该有明确语义</p>
<p><code>&lt;concept&gt;</code>头文件中也提供了许多预定义概念，大部分类型特征都有对应概念定义</p>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
      </tags>
  </entry>
  <entry>
    <title>【C++】正则表达式</title>
    <url>/C++/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/</url>
    <content><![CDATA[<h1 id="正则表达式">正则表达式</h1>
<p>正则表达式是一个用于表示特定规则的字符串，程序中通常使用模式来表示</p>
<p>一个正则表达式代表了符合这个模式的所有字符串</p>
<h2 id="字符">字符</h2>
<p>正则表达式中包含元字符与字面字符</p>
<h3 id="字面字符">字面字符</h3>
<p>纯由字面字符组成的正则表达式，用于查找字符串中是否包含该字符串</p>
<p>regex: cat</p>
<p>test: where’s my <strong>cat</strong></p>
<h3 id="转义符">转义符</h3>
<p>若想表示元字符或特殊字符，需要在前面加上转义符<br />
</p>
<p>regex: <code>1\+2=\?</code></p>
<p>test: result: <strong>1+2=?</strong></p>
<h3 id="字符集合">字符集合</h3>
<p>用方括号表示一个字符集合，表示方括号中字符的任意一个字符</p>
<p>对于连续的字符可以使用<code>-</code>来表示</p>
<p>快捷表示方式：(若对以下字母大写则表示对应集合的补集)</p>
<ul>
<li><code>\d</code>表示阿拉伯数字集合，等价于<code>[0-9]</code></li>
<li><code>\w</code>表示单词字符集合，等价于<code>[a-zA-Z0-9_]</code></li>
<li><code>\s</code>表示空白字符集合，等价于<code>[\r\n\t\f\v]</code></li>
<li><code>.</code>代表换行符以外的任意字符</li>
</ul>
<p>regex: <code>[abcde]</code></p>
<p>test: this is <strong>a</strong> t<strong>e</strong>st</p>
<p>regex: <code>[a-e1-3]</code></p>
<p>test: <strong>abcde</strong>fg<strong>123</strong>45</p>
<h3 id="重复">重复</h3>
<img src="/C++/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/image-20250805153216688.png" class="" title="重复">
<p>也可以使用大括号指定重复的次数</p>
<p>如<code>&#123;2&#125;</code>表示重复两次，<code>&#123;2,&#125;</code>表示重复至少两次，<code>&#123;3-5&#125;</code>表示重复3-5次</p>
<p>对于字符集合的重复，只要求字符属于这个集合，而不是重复相同字符</p>
<p>regex: <code>dog*</code> 表示do与0到多个g</p>
<p>test: <strong>do dog dogg doggg</strong></p>
<p>regex: <code>#[\da-f]+</code>
表示以#开头，中间为阿拉伯数字或a-f的字母，且至少出现一次的字符集合</p>
<p>test: The RGB code of pink color is <strong>#ffc0cb</strong></p>
<p>regex: <code>\w&#123;3-5&#125;</code>
表示由单词字符组成，长度在3-5之间的字符集合</p>
<p>test: It is <strong>very</strong> <strong>impor</strong>
<strong>tant</strong></p>
<h3 id="单词边界符">单词边界符</h3>
<p>，存在于单词于非单词字符间以及开头结尾</p>
<p>regex: <code>\b\w&#123;3-5&#125;\b</code>
表示由单词字符组成，长度在3-5之间的单词</p>
<p>test: It is <strong>very</strong> important</p>
<h3 id="插入符">插入符</h3>
<p>^是插入符</p>
<ul>
<li>跟在[后，表示取反，如<code>[^0-9]</code>表示非数字字符</li>
<li>当不在[后面，表示一行的起始位置，如<code>^he\w*\b</code>表示以he在一行开头的单词</li>
</ul>
<h3 id="结尾符">结尾符</h3>
<p>$是结尾符，表示一行的结尾</p>
<p>如<code>pdf$</code>表示以pdf结尾，如a.pdf，但a.pdf.doc不可以</p>
<h3 id="分组">分组</h3>
<p>()用于分组，作用</p>
<ul>
<li>将一个表达式看作一个整体</li>
<li>对分组中表达式中匹配结果在后续进行引用，或在程序中获取每个分组的匹配结果</li>
</ul>
<p>其中，<code>(?:)</code>表示这是一个非捕获分组，不能后续引用或获得匹配结果</p>
<p>如<code>(dog)+</code> 表示dog连续出现至少1次 如dogdog dog</p>
<h3 id="可选项">可选项</h3>
<p>|表示可选项，常与小括号分组结合使用</p>
<p>如<code>(dog|cat)-\1</code> 表示捕获的第一个分组为dog或cat 如dog-dog
cat-cat</p>
<h3 id="零宽断言">零宽断言</h3>
<ul>
<li>正向先行断言：<code>(?=表达式)</code>，用于匹配后面跟着特定表达式的语句</li>
<li>负向先行断言：<code>(?!表达式)</code>，用于匹配不在特定表达式之前的字符串</li>
<li>正向后行断言：<code>(?&lt;=表达式)</code>，用于匹配出现在特定表达式之后的表达式</li>
<li>负向后行断言：<code>(?&lt;!表达式)</code>，用于匹配不在特定表达式之后的字符串</li>
</ul>
<h2 id="c标准库regex">C++标准库regex</h2>
<p>C++中正则表达式位于<code>&lt;regex&gt;</code>库中</p>
<p>使用<code>std::regex 名称(字符串)</code>来初始化一个正则表达式</p>
<p><strong>注意：转义符++中还需要再转义一次</strong></p>
<p>或者使用原始字符串字面值<code>R"(字符串)"</code>，转义字符不起作用</p>
<ul>
<li>使用<code>regex_match(检查字符串, 匹配结果, 正则表达式)</code>判断是否完整匹配正则表达式</li>
</ul>
<p>​
返回true则表示匹配，结果存放在匹配结果中，下标0为完整结果，下标1为第一个分组，以此类推</p>
<ul>
<li><p>使用<code>regex_search</code>查找第一个匹配值，使用方法与match一致</p></li>
<li><p>使用<code>sregex_iterator(起始位置, 结束位置, 正则表达式)</code>查找所有匹配值，并将结果存储到<code>smatch</code>对象中，调用size()获得匹配数量，str(i)获得第i个匹配项，position(i)获得匹配项的位置，length(i)获得匹配项的长度</p></li>
<li><p>使用<code>regex_replace(待替换字符, 正则表达式, 用于替换的格式字符串)</code>符合表达式的进行替换，使用<code>$+数字</code>作占位符，<code>$0</code>表示完整匹配结果，<code>$1</code>表示第一个分组，以此类推</p></li>
</ul>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
      </tags>
  </entry>
  <entry>
    <title>【C++】引用</title>
    <url>/C++/%E5%BC%95%E7%94%A8/</url>
    <content><![CDATA[<h1 id="引用">引用</h1>
<h2 id="语法">语法</h2>
<p>本质：引用在内部的实现是一个<strong>指针常量</strong>（指针指向不可修改，但指针指向的值可修改）</p>
<p>作用：即给变量起别名，即两者操作同一块内存</p>
<p>语法：<code>&lt;数据类型&gt; &amp;&lt;别名&gt; = &lt;原名&gt;</code></p>
<p>注意：</p>
<ul>
<li>引用必须初始化</li>
<li>引用在初始化后不可改变</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a;</span><span style="color: #6A737D"> // b 是 a 的引用</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;a: &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> a </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl; </span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;b: &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> b </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">20</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 修改 b 的值, a 的值也会改变</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;a: &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> a </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;b: &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> b </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="引用作为函数参数">引用作为函数参数</h2>
<p>作用：函数传参时可以让形参修饰实参</p>
<p>优点：简化指针修改实参</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Swap</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">b</span><span style="color: #24292E">){</span><span style="color: #6A737D"> // 使用形参修饰实参</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> temp </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">  a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> b;</span></span>
<span class="line"><span style="color: #24292E">  b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> temp;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">20</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">Swap</span><span style="color: #24292E">(a, b);</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;a: &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> a </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;b: &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> b </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="引用作为函数返回值">引用作为函数返回值</h2>
<p>作用：</p>
<ul>
<li>引用可以作为函数的返回值存在</li>
<li>函数的调用可以作为左值</li>
</ul>
<p><strong>不要返回局部变量引用</strong></p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">// 函数返回引用</span></span>
<span class="line"><span style="color: #6A737D">// 注意：返回局部变量的引用是危险的，因为局部变量在函数结束后会被销毁</span></span>
<span class="line"><span style="color: #D73A49">int&amp;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">test</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span><span style="color: #6A737D"> //静态变量，存在全局区</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> a;</span><span style="color: #6A737D"> // 返回局部变量的引用</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">ref </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">test</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;ref: &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> ref </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span><span style="color: #6A737D"> // 输出 10</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">test</span><span style="color: #24292E">() </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">20</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 返回引用的函数的调用可以作为左值, 相当于直接对a赋值</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;ref: &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> ref </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span><span style="color: #6A737D"> // 输出 20</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>## 常量引用</p>
<p>常量引用常用来修饰形参，防止误操作</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">print</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">val</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #6A737D">  // 由于此处是引用，在函数内部对val进行修改，外部的b也会改变</span></span>
<span class="line"><span style="color: #6A737D">  // 形参前加const后，val变成了一个常量引用，内部val就不允许修改了</span></span>
<span class="line"><span style="color: #6A737D">  // val = 1000; </span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> val;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  // 常量引用，相当于编译器自动创建了一个临时空间，并将ref指向该空间</span></span>
<span class="line"><span style="color: #6A737D">  // 此时不许修改</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int&amp;</span><span style="color: #24292E"> ref </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">; </span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #6A737D">  // 实际应用</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">100</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">print</span><span style="color: #24292E">(b);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
      </tags>
  </entry>
  <entry>
    <title>【C++】类型特性</title>
    <url>/C++/%E7%B1%BB%E5%9E%8B%E7%89%B9%E6%80%A7/</url>
    <content><![CDATA[<h1 id="类型特性">类型特性</h1>
<p><code>&lt;type_traits&gt;</code>库用于判断某个类型是否具有某些特征、改变、比较类型间的特征</p>
<p>常用于函数模板类</p>
<p>结合<code>if constexpr(常量表达式)</code>可以实现条件编译(C++=17)</p>
<p><code>if constexpr</code>是编译时的条件语句，当表达式条件为真时，该分支代码才会编译，否则舍弃</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #6F42C1">length</span><span style="color: #24292E">(</span><span style="color: #6F42C1">T</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">t</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> </span><span style="color: #D73A49">constexpr</span><span style="color: #24292E"> (</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::is_arithmetic_v</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">T</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (t</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">0</span><span style="color: #24292E">) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #24292E">t;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> t;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">if</span><span style="color: #24292E"> </span><span style="color: #D73A49">constexpr</span><span style="color: #24292E"> (</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::is_base_of_v</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">IMeasurable, T</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> t.</span><span style="color: #6F42C1">length</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>结合<code>static_assert</code></p>
<p><code>static_assert</code>用于判断编译阶段条件是否为真，若为假则会终止编译，并产生静态断言错误</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #6F42C1">length</span><span style="color: #24292E">(</span><span style="color: #6F42C1">T</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">t</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">static_assert</span><span style="color: #24292E">(</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::is_arithmetic_v</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">T</span><span style="color: #D73A49">&gt;||</span><span style="color: #6F42C1">Std</span><span style="color: #24292E">::is_base_of_v</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">IMeasurable, T&gt;, </span><span style="color: #032F62">&quot;使用了不支持计算长度的类型&quot;</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> </span><span style="color: #D73A49">constexpr</span><span style="color: #24292E"> (</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::is_arithmetic_v</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">T</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (t</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">0</span><span style="color: #24292E">) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #24292E">t;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> t;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">if</span><span style="color: #24292E"> </span><span style="color: #D73A49">constexpr</span><span style="color: #24292E"> (</span><span style="color: #6F42C1">std</span><span style="color: #24292E">::is_base_of_v</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">IMeasurable, T</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> t.</span><span style="color: #6F42C1">length</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
      </tags>
  </entry>
  <entry>
    <title>【C++】模块</title>
    <url>/C++/%E6%A8%A1%E5%9D%97/</url>
    <content><![CDATA[<h1 id="模块">模块</h1>
<h2 id="拓展名">拓展名</h2>
<ul>
<li>msvc：.ixx</li>
<li>gcc：.cxx</li>
</ul>
<h2 id="全局模块片段">全局模块片段</h2>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">module</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">PI</span><span style="color: #24292E"> 3.1415</span></span>
<span class="line"><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">module</span><span style="color: #24292E"> math;</span></span></code></pre></div></div></figure>
<p>像这样从module到export module之间的代码称为全局模块片段</p>
<p>包含头文件、定义宏等，用于模块内部，对外不可见</p>
<p><code>export module 模块名</code>用于声明导出一个模块，最好用一样的名字</p>
<h2 id="export">export</h2>
<p>在后面编写代码时，若在函数等前面添加了export关键字，表示将该函数导出，在其他源文件中便可导入该函数使用，若没有export关键字，表示该函数对外不可见</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #6F42C1">add</span><span style="color: #24292E">(</span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> a</span><span style="color: #D73A49">+</span><span style="color: #24292E">b;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #6F42C1">circle</span><span style="color: #24292E">(</span><span style="color: #D73A49">double</span><span style="color: #24292E"> r){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> PI</span><span style="color: #D73A49">*</span><span style="color: #24292E">r</span><span style="color: #D73A49">*</span><span style="color: #24292E">r;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #6F42C1">mul</span><span style="color: #24292E">(</span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> a</span><span style="color: #D73A49">*</span><span style="color: #24292E">b;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="import">import</h2>
<p>其他源文件中，使用<code>import 模块名</code>声明来导入模块，可以使用被导出的函数</p>
<p><strong>与include的区别：</strong></p>
<ul>
<li>import是C++的一个声明，在编译和链接后才进行处理</li>
<li>#include是一个预处理指令，预处理后会被替换为C++语句</li>
</ul>
<h2 id="编译">编译</h2>
<p>如上面的代码</p>
<p>首先需要编译iostream模块，然后就可以编译主程序与math模块</p>
<figure class="shiki cmd"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">g</span><span style="color: #D73A49">++</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #24292E">std</span><span style="color: #D73A49">=</span><span style="color: #24292E">c</span><span style="color: #D73A49">++</span><span style="color: #005CC5">20</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #24292E">fmodules</span><span style="color: #D73A49">-</span><span style="color: #24292E">ts </span><span style="color: #D73A49">-</span><span style="color: #24292E">xc</span><span style="color: #D73A49">++-</span><span style="color: #24292E">system</span><span style="color: #D73A49">-</span><span style="color: #24292E">header iostream</span></span>
<span class="line"><span style="color: #24292E">g</span><span style="color: #D73A49">++</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #24292E">std</span><span style="color: #D73A49">=</span><span style="color: #24292E">c</span><span style="color: #D73A49">++</span><span style="color: #005CC5">20</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #24292E">fmodules</span><span style="color: #D73A49">-</span><span style="color: #24292E">ts 路径 </span><span style="color: #D73A49">-</span><span style="color: #24292E">o 输出文件名</span></span></code></pre></div></div></figure>
<p>CMake中，在target_sources中使用FILE_SET CXX_MODULES即可编译</p>
<h2 id="分区">分区</h2>
<p>我们可以通过分区将一个模块分为多个模块单元</p>
<p>例：</p>
<p>接口文件Geometry.cpp</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">module</span><span style="color: #24292E"> Geometry;</span></span>
<span class="line"><span style="color: #D73A49">export</span><span style="color: #24292E"> import :Rectangle;</span></span>
<span class="line"><span style="color: #D73A49">export</span><span style="color: #24292E"> import :Circle;</span></span>
<span class="line"><span style="color: #D73A49">export</span><span style="color: #24292E"> import :Shape;</span></span></code></pre></div></div></figure>
<p>文件中导出模块Geometry，导入并导出三个子模块</p>
<p>Geometry-Shape.cpp文件，实现了Shape模块</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">module</span><span style="color: #24292E"> Geometry:Shape;</span></span>
<span class="line"><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Shape</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    ...</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>这里需要使用<code>主模块名:分区名</code>的形式导出接口类</p>
<p>Geometry-Rectangle.cpp文件，实现了Rectangle模块</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">module</span><span style="color: #24292E"> Geometry:Rectangle;</span></span>
<span class="line"><span style="color: #24292E">import :Shape;</span></span>
<span class="line"><span style="color: #D73A49">export</span><span style="color: #24292E"> classs Rectangle: public Shape{</span></span>
<span class="line"><span style="color: #24292E">    ...</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>这里Rectangle继承自Shape类，故需要导入Shape模块，而他们都是Geometry模块下的分区，故使用冒号</p>
<p>使用模块时，我们只要导入主模块，分区模块会被自动导入</p>
<p>编译时，最好要按照依赖顺序编译，否则可能编译错误</p>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
      </tags>
  </entry>
  <entry>
    <title>【C++】类与对象</title>
    <url>/C++/%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/</url>
    <content><![CDATA[<h1 id="类与对象">类与对象</h1>
<p>C++面向对象的三大特性：<strong>封装、继承、多态</strong></p>
<p>C++中，<strong>任何事物都为对象</strong>，对象有其属性和行为</p>
<p>具有<strong>相同性质</strong>的对象，我们可以抽象称为类</p>
<h2 id="封装">封装</h2>
<h3 id="封装的实现">封装的实现</h3>
<p>意义：</p>
<ul>
<li>将属性和行为作为一个整体，表现生活中的事物</li>
<li>将属性和行为加以权限控制</li>
</ul>
<p>语法：<code>class &lt;类名&gt;&#123; &lt;访问权限&gt;: &lt;属性/行为&gt;&#125;</code></p>
<p>一些名词：</p>
<ul>
<li>成员：类中的属性和行为的统称</li>
<li>成员属性（成员变量）：类中的属性</li>
<li>成员函数（成员方法）：类中的函数</li>
</ul>
<p>e.g.1 设计一个圆类，求其周长</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">// 设计一个圆类，求其周长</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">double</span><span style="color: #24292E"> PI </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">3.14</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">circle</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #6A737D">// 访问权限: 公共权限</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #6A737D">  // 属性：半径</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> r;</span></span>
<span class="line"><span style="color: #6A737D">  // 行为：获取周长</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #6F42C1">calC</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #D73A49">*</span><span style="color: #24292E">PI</span><span style="color: #D73A49">*</span><span style="color: #24292E">r;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  // 通过类创建一个对象——实例化</span></span>
<span class="line"><span style="color: #24292E">  circle c1;</span></span>
<span class="line"><span style="color: #6A737D">  // 给对象的属性进行赋值，使用.</span></span>
<span class="line"><span style="color: #24292E">  c1.r </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  // 调用行为</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;r=&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> c1.</span><span style="color: #6F42C1">calC</span><span style="color: #24292E">()</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>e.g.2 设计一个学生类，属性有姓名和学号，可以赋值并显示姓名和学号</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;string&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">// 设计一个学生类，有姓名和学号，可以赋值并显示</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">student</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #6A737D">  //属性</span></span>
<span class="line"><span style="color: #24292E">  string name;</span><span style="color: #6A737D"> // 姓名</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> id;</span><span style="color: #6A737D"> // 学号</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 行为</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">display</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;name:&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> name</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;id:&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> id </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">set_info</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">s_name</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">s_id</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    name </span><span style="color: #D73A49">=</span><span style="color: #24292E"> s_name;</span></span>
<span class="line"><span style="color: #24292E">    id </span><span style="color: #D73A49">=</span><span style="color: #24292E"> s_id;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  student stu1;</span><span style="color: #6A737D">// 实例化</span></span>
<span class="line"><span style="color: #24292E">  student stu2;</span></span>
<span class="line"><span style="color: #6A737D">  // 一般赋值</span></span>
<span class="line"><span style="color: #24292E">  stu1.name </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;Jack&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  stu1.id </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  stu1.</span><span style="color: #6F42C1">display</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #6A737D">  // 通过行为赋值</span></span>
<span class="line"><span style="color: #24292E">  stu2.</span><span style="color: #6F42C1">set_info</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Mary&quot;</span><span style="color: #24292E">, </span><span style="color: #005CC5">2</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  stu2.</span><span style="color: #6F42C1">display</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="权限">权限</h3>
<p>类可以将属性和方法放在不同权限下：</p>
<ul>
<li>public：公共权限，成员类内可以访问，类外也可以访问</li>
<li>protected：保护权限，成员类内可以访问，类外不可以访问，子类可以访问父类的保护成员</li>
<li>private：私有权限，成员类内可以访问，类外不可以访问，
子类不可访问父类的私有成员</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;string&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span><span style="color: #6A737D"> //公共权限</span></span>
<span class="line"><span style="color: #24292E">  string name;</span></span>
<span class="line"><span style="color: #D73A49">protected:</span><span style="color: #6A737D"> // 保护权限</span></span>
<span class="line"><span style="color: #24292E">  string car;</span></span>
<span class="line"><span style="color: #D73A49">private:</span><span style="color: #6A737D"> // 私有权限</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> password;</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #6A737D"> // 类内可以访问</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    name </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;Jack&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    car </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;xiaomisu7&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    password </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">123456</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person p;</span></span>
<span class="line"><span style="color: #24292E">  p.name </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;Mary&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  //p.car = &quot;?&quot; // protected 类外不可访问</span></span>
<span class="line"><span style="color: #6A737D">  //p.password = 123 // private 类外不可访问</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="struct与class的区别">struct与class的区别</h3>
<p>C++中class与struct的唯一区别在于<strong>默认的访问权限不同</strong></p>
<ul>
<li>class默认权限私有</li>
<li>struct默认权限公共</li>
</ul>
<h3 id="成员属性私有化">成员属性私有化</h3>
<p>优点：</p>
<ul>
<li>可以自己控制读写权限</li>
<li>可以检测数据有效性</li>
</ul>
<p>基本思路：<strong>用公有方法对私有属性进行操作</strong></p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;string&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #6A737D">// 属性私有</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  string name;</span><span style="color: #6A737D"> // 姓名：可读可写</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">18</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 年龄：只读</span></span>
<span class="line"><span style="color: #24292E">  string hobby;</span><span style="color: #6A737D"> // 爱好：只写</span></span>
<span class="line"><span style="color: #6A737D">// 方法公有</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #6A737D">  // 设置姓名</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">setName</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    name </span><span style="color: #D73A49">=</span><span style="color: #24292E"> s;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 获取姓名</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">getName</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;name:&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">name</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 获取年龄</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">getAge</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;age:&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">age</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 设置爱好</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">setHobby</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    hobby </span><span style="color: #D73A49">=</span><span style="color: #24292E"> s;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person p;</span></span>
<span class="line"><span style="color: #24292E">  p.</span><span style="color: #6F42C1">setName</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Jack&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  p.</span><span style="color: #6F42C1">getAge</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  p.</span><span style="color: #6F42C1">setHobby</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;jerk&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="对象的初始化和清理">对象的初始化和清理</h2>
<p>对象的初始化和清理是很重要的安全问题：</p>
<ul>
<li>一个对象或变量没有初始状态，对其使用后果未知</li>
<li>使用完一个对象或变量，没有及时清理，也会造成安全问题</li>
</ul>
<h3 id="构造函数与析构函数">构造函数与析构函数</h3>
<p>C++提供了这两种函数，被编译器自动调用，完成对象初始化与清理工作</p>
<p>这两个工作是强制执行的，若我们不提供，编译器会提供自己的构造函数与析构函数，他们是<strong>空实现</strong></p>
<p><strong>构造函数：</strong>用于创建对象时为对象成员赋值</p>
<ul>
<li><p>语法：<code>&lt;类名&gt;()&#123;&#125;</code></p></li>
<li><p>无返回值，不用写void</p></li>
<li><p>函数名与类名相同</p></li>
<li><p>构造函数可以有参数，可以发生重载</p></li>
<li><p>调用对象时会自动调用构造，只会调用一次</p></li>
</ul>
<p>析构函数：用于对象销毁前自动调用，执行清理操作</p>
<ul>
<li>语法：<code>~&lt;类名&gt;()&#123;&#125;</code></li>
<li>无返回值，不用写void</li>
<li>函数名与类名相同，名前面加~</li>
<li>析构函数不可以有参数，不可发生重载</li>
<li>程序在对象销毁前会自动调用析构。只会调用一次</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #6A737D">  // 构造函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;构造函数被调用&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 析构函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">~person</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;析构函数被调用&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person p;</span><span style="color: #6A737D"> // 栈上的数据，执行完后会被释放，故执行析构函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="构造函数的分类与调用">构造函数的分类与调用</h3>
<p>分类：</p>
<ul>
<li>参数分：有参构造与无参构造（默认构造）</li>
<li>类型分：普通构造与拷贝构造</li>
</ul>
<p>调用：</p>
<ul>
<li>括号法</li>
<li>显式法</li>
<li>隐式转换法</li>
</ul>
<p><strong>注意：</strong></p>
<ul>
<li><strong>无参构造时不需要加括号，否则编译器会认为是一个函数声明</strong></li>
<li>显式声明中，单纯调用对象<code>&lt;类名&gt;([值])</code>称为<strong>匿名对象</strong>，特点是当前行执行后就会被立即回收</li>
<li><strong>不要利用拷贝构造函数初始化匿名对象</strong></li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #6A737D">  // 无参构造(默认构造)</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;无参构造函数被调用&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 有参构造</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;有参构造函数被调用&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 拷贝构造 </span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p.age;</span><span style="color: #6A737D"> // 将传入数据拷贝到当前对象</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;拷贝构造函数被调用&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 析构函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">~person</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;析构函数被调用&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  // 括号法</span></span>
<span class="line"><span style="color: #24292E">  person p;</span><span style="color: #6A737D"> // 默认构造函数被调用(不加括号)</span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #6F42C1">p1</span><span style="color: #24292E">(</span><span style="color: #005CC5">10</span><span style="color: #24292E">);</span><span style="color: #6A737D"> // 有参构造函数被调用</span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #6F42C1">p2</span><span style="color: #24292E">(p1);</span><span style="color: #6A737D"> // 拷贝构造函数被调用</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;age of p1:&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p1.age </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;age of p2:&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p2.age </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #6A737D">  // 显式法</span></span>
<span class="line"><span style="color: #24292E">  person p3 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #005CC5">20</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  person p4 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(p3);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 隐式转换法</span></span>
<span class="line"><span style="color: #24292E">  person p5 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 相当于 person p5 = person(10);</span></span>
<span class="line"><span style="color: #24292E">  person p6 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p5;</span><span style="color: #6A737D"> // 相当于 person p6 = person(p5);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="拷贝构造函数调用时机">拷贝构造函数调用时机</h3>
<p>拷贝构造调用的三种情况：</p>
<ul>
<li>使用一个已经创建完毕的对象来初始化一个新对象</li>
<li>值传递的方式给函数参数传值</li>
<li>以值方式返回局部对象</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #6A737D">  // 无参构造(默认构造)</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;无参构造函数被调用&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 有参构造</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;有参构造函数被调用&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 拷贝构造  </span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p.age;</span><span style="color: #6A737D"> // 将传入数据拷贝到当前对象</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;拷贝构造函数被调用&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 析构函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">~person</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;析构函数被调用&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 使用已经创建完毕的对象来初始化一个新对象</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">test1</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #6F42C1">p1</span><span style="color: #24292E">(</span><span style="color: #005CC5">20</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #6F42C1">p2</span><span style="color: #24292E">(p1);</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6A737D">// 值传递方式给函数参数传值</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">test2</span><span style="color: #24292E">(</span><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6A737D">// 值传递返回局部对象</span></span>
<span class="line"><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #6F42C1">test3</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person p1;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> p1;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person p1;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">test1</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">test2</span><span style="color: #24292E">(p1);</span></span>
<span class="line"><span style="color: #24292E">  person p2 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">test3</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">无参构造函数被调用</span></span>
<span class="line"><span style="color: #24292e">----------------</span></span>
<span class="line"><span style="color: #24292e">有参构造函数被调用</span></span>
<span class="line"><span style="color: #24292e">拷贝构造函数被调用</span></span>
<span class="line"><span style="color: #24292e">析构函数被调用</span></span>
<span class="line"><span style="color: #24292e">析构函数被调用</span></span>
<span class="line"><span style="color: #24292e">----------------</span></span>
<span class="line"><span style="color: #24292e">拷贝构造函数被调用</span></span>
<span class="line"><span style="color: #24292e">析构函数被调用</span></span>
<span class="line"><span style="color: #24292e">----------------</span></span>
<span class="line"><span style="color: #24292e">无参构造函数被调用</span></span>
<span class="line"><span style="color: #24292e">析构函数被调用</span></span>
<span class="line"><span style="color: #24292e">析构函数被调用</span></span></code></pre></div></div></figure>
<h3 id="构造函数调用规则">构造函数调用规则</h3>
<p>默认下，编译器至少给一个类添加三个函数：</p>
<ul>
<li>默认构造函数（无参，函数体为空）</li>
<li>默认析构函数（无参，函数体为空）</li>
<li>默认拷贝构造函数，对属性值拷贝</li>
</ul>
<p>调用规则：</p>
<ul>
<li>若用户定义有参构造函数，C++不再提供默认无参构造，但是会提供默认拷贝构造</li>
<li>如果用户定义拷贝构造函数 ，C++不再提供其他构造函数</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #6A737D">  // 无参构造(默认构造)</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;无参构造函数被调用&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 有参构造</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;有参构造函数被调用&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // // 拷贝构造 </span></span>
<span class="line"><span style="color: #6A737D">  // person(const person &amp;p){</span></span>
<span class="line"><span style="color: #6A737D">  //   age = p.age; // 将传入数据拷贝到当前对象</span></span>
<span class="line"><span style="color: #6A737D">  //   cout &lt;&lt; &quot;拷贝构造函数被调用&quot; &lt;&lt; endl;</span></span>
<span class="line"><span style="color: #6A737D">  // }</span></span>
<span class="line"><span style="color: #6A737D">  // 析构函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">~person</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;析构函数被调用&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person p;</span></span>
<span class="line"><span style="color: #24292E">  p.age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">18</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #6F42C1">p2</span><span style="color: #24292E">(p);</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;p2的年龄是:&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p2.age </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">```</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">此种情况下，编译器使用了默认拷贝构造，进行了值传递</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">```c</span><span style="color: #D73A49">++</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #6A737D">  // // 无参构造(默认构造)</span></span>
<span class="line"><span style="color: #6A737D">  // person(){</span></span>
<span class="line"><span style="color: #6A737D">  //   cout &lt;&lt; &quot;无参构造函数被调用&quot; &lt;&lt; endl;</span></span>
<span class="line"><span style="color: #6A737D">  // }</span></span>
<span class="line"><span style="color: #6A737D">  // 有参构造</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;有参构造函数被调用&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 析构函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">~person</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;析构函数被调用&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person p;</span></span>
<span class="line"><span style="color: #24292E">  p.age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">18</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #6F42C1">p2</span><span style="color: #24292E">(p);</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;p2的年龄是:&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p2.age </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">```</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">此种情况下，由于有有参函数，编译器不会提供默认无参函数，同时会报错没有默认无参函数</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">```c</span><span style="color: #D73A49">++</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #6A737D">  // // 无参构造(默认构造)</span></span>
<span class="line"><span style="color: #6A737D">  // person(){</span></span>
<span class="line"><span style="color: #6A737D">  //   cout &lt;&lt; &quot;无参构造函数被调用&quot; &lt;&lt; endl;</span></span>
<span class="line"><span style="color: #6A737D">  // }</span></span>
<span class="line"><span style="color: #6A737D">  // // 有参构造</span></span>
<span class="line"><span style="color: #6A737D">  // person(int a){</span></span>
<span class="line"><span style="color: #6A737D">  //   age = a;</span></span>
<span class="line"><span style="color: #6A737D">  //   cout &lt;&lt; &quot;有参构造函数被调用&quot; &lt;&lt; endl;</span></span>
<span class="line"><span style="color: #6A737D">  // }</span></span>
<span class="line"><span style="color: #6A737D">  // 拷贝构造 </span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p.age;</span><span style="color: #6A737D"> // 将传入数据拷贝到当前对象</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;拷贝构造函数被调用&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 析构函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">~person</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;析构函数被调用&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person p;</span></span>
<span class="line"><span style="color: #24292E">  p.age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">18</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #6F42C1">p2</span><span style="color: #24292E">(p);</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;p2的年龄是:&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p2.age </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>此种情况下，提供了拷贝函数，则编译器不再提供任何构造函数，同时报错没有默认构造函数</p>
<h3 id="深拷贝与浅拷贝">深拷贝与浅拷贝</h3>
<ul>
<li>浅拷贝：简单的赋值操作（默认拷贝构造即为浅拷贝 ）</li>
<li>深拷贝：在堆区重新申请空间，进行拷贝操作</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #6A737D">  // 无参构造(默认构造)</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;无参构造函数被调用&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 有参构造</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">iheight</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">    height </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E">(iheight);</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;有参构造函数被调用&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // // 拷贝构造 </span></span>
<span class="line"><span style="color: #6A737D">  // person(const person &amp;p){</span></span>
<span class="line"><span style="color: #6A737D">  //   age = p.age; // 将传入数据拷贝到当前对象</span></span>
<span class="line"><span style="color: #6A737D">  //   cout &lt;&lt; &quot;拷贝构造函数被调用&quot; &lt;&lt; endl;</span></span>
<span class="line"><span style="color: #6A737D">  // }</span></span>
<span class="line"><span style="color: #6A737D">  // 析构函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">~person</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">    // 在析构函数中进行堆区数据释放</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (height</span><span style="color: #D73A49">!=</span><span style="color: #005CC5">NULL</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">delete</span><span style="color: #24292E"> height;</span></span>
<span class="line"><span style="color: #24292E">      height </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">NULL</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;析构函数被调用&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int*</span><span style="color: #24292E"> height;</span><span style="color: #6A737D"> // 身高，使用指针将数据创建在堆区</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #6F42C1">p1</span><span style="color: #24292E">(</span><span style="color: #005CC5">18</span><span style="color: #24292E">,</span><span style="color: #005CC5">160</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;p1的年龄是:&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p1.age </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;p1的身高是:&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E">p1.height </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #6F42C1">p2</span><span style="color: #24292E">(p1);</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;p2的年龄是:&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p2.age </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;p2的身高是:&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E">p2.height </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>该代码会卡住，原因是利用拷贝构造只进行了值传递，p1与p2执行完毕后，均执行析构函数，对height指向的空间进行释放，但是其中一个已经执行释放后，另一个再次释放会产生非法操作，故出错</p>
<p>这也就是浅拷贝的缺点：只进行了值传递，我们需要利用深拷贝来结局</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 拷贝构造 </span></span>
<span class="line"><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> person </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">p){</span></span>
<span class="line"><span style="color: #24292E">  age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p.age;</span><span style="color: #6A737D"> // 将传入数据拷贝到当前对象</span></span>
<span class="line"><span style="color: #6A737D">  // 深拷贝，在堆区开辟新的空间</span></span>
<span class="line"><span style="color: #24292E">  height </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E">(</span><span style="color: #D73A49">*</span><span style="color: #24292E">p.height);</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;拷贝构造函数被调用&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>即在拷贝构造中，重新给拷贝的指针变量申请一块空间</p>
<p><strong>如果属性有在堆区开辟的，一定要自己提供拷贝构造函数，防止浅拷贝出现问题</strong></p>
<h3 id="初始化列表">初始化列表</h3>
<p>C++提供了初始化列表来初始化属性</p>
<p>语法：<code>&lt;构造函数&gt;(): &lt;属性1&gt;(&lt;值1&gt;), &lt;属性2&gt;(&lt;值2&gt;) ... &#123;&#125;</code></p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> b;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> c;</span></span>
<span class="line"><span style="color: #6A737D">  // 初始化列表赋值</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">c</span><span style="color: #24292E">):</span><span style="color: #6F42C1">a</span><span style="color: #24292E">(</span><span style="color: #005CC5">10</span><span style="color: #24292E">), </span><span style="color: #6F42C1">b</span><span style="color: #24292E">(</span><span style="color: #005CC5">20</span><span style="color: #24292E">), </span><span style="color: #6F42C1">c</span><span style="color: #24292E">(</span><span style="color: #005CC5">30</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person p;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;a:&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p.a </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;b:&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p.b </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;c:&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p.c </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="类对象作为类成员">类对象作为类成员</h3>
<p>C++中的成员可以是另一个类的对象，称为<strong>对象成员</strong></p>
<p>如</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">A</span><span style="color: #24292E">{};</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">B</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    A a;</span></span>
<span class="line"><span style="color: #24292E">};</span></span></code></pre></div></div></figure>
<p>该B类中有对象A作为成员，则A为对象成员</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;string&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">phone</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  string brand;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">float</span><span style="color: #24292E"> price;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">phone</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">pname</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    brand </span><span style="color: #D73A49">=</span><span style="color: #24292E"> pname;</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;phone构造函数被调用&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">~phone</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;phone析构函数被调用&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  string name;</span></span>
<span class="line"><span style="color: #24292E">  phone iphone;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">pname</span><span style="color: #24292E">, </span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">pbrand</span><span style="color: #24292E">):</span><span style="color: #6F42C1">name</span><span style="color: #24292E">(pname),</span><span style="color: #6F42C1">iphone</span><span style="color: #24292E">(pbrand){</span></span>
<span class="line"><span style="color: #6A737D">    //相当于phone iphone = pname;的隐式转换</span></span>
<span class="line"><span style="color: #24292E">    cout</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;person构造函数被调用&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">~person</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;person析构函数被调用&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #6F42C1">p</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;小明&quot;</span><span style="color: #24292E">,</span><span style="color: #032F62">&quot;苹果&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;姓名:&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p.name </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;手机品牌:&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p.iphone.brand </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">phone构造函数被调用</span></span>
<span class="line"><span style="color: #24292e">person构造函数被调用</span></span>
<span class="line"><span style="color: #24292e">姓名:小明</span></span>
<span class="line"><span style="color: #24292e">手机品牌:苹果</span></span>
<span class="line"><span style="color: #24292e">person析构函数被调用</span></span>
<span class="line"><span style="color: #24292e">phone析构函数被调用</span></span></code></pre></div></div></figure>
<p>注意构造函数的调用顺序：</p>
<ul>
<li>当其他类对象作为本类成员，构造时先构造类对象，在构造自身</li>
<li>当其他类对象作为本类成员，析构时先析构自身，再析构类对象</li>
</ul>
<h3 id="静态成员">静态成员</h3>
<p>在成员变量与成员函数前加上关键字static，称为静态成员</p>
<p>分类：</p>
<ul>
<li>静态成员变量
<ul>
<li>不属于某个对象，所有对象共享一份数据</li>
<li>编译阶段分配内存</li>
<li>类内声明，类外初始化</li>
</ul></li>
<li>静态成员函数
<ul>
<li>所有成员共享同一个函数</li>
<li>静态成员函数只能访问静态成员变量</li>
</ul></li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a;</span><span style="color: #6A737D"> // 需要类内声明，类外初始化</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> c;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;静态成员函数f调用&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">    a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">100</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">    // c = 200; // 静态成员函数不可以访问非静态成员变量</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> b;</span><span style="color: #6A737D"> // 静态成员变量也有权限</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">::a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">100</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 在类外初始化，需要指定作用域</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">::b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">100</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 也需要在类外初始化</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person p;</span><span style="color: #6A737D"> // 栈上的数据，执行完后会被释放，故执行析构函数</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p.a</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  person p2;</span></span>
<span class="line"><span style="color: #24292E">  p2.a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">200</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 数据共享，此处改变即一起改变</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p.a</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span><span style="color: #6A737D"> // 通过对象进行访问</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">::a</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span><span style="color: #6A737D"> // 通过类名进行访问</span></span>
<span class="line"><span style="color: #6A737D">  // cout &lt;&lt; p.b&lt;&lt;endl; // 不可访问</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 同样两种访问模式</span></span>
<span class="line"><span style="color: #24292E">  p.</span><span style="color: #6F42C1">f</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">::</span><span style="color: #6F42C1">f</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>应用：实现单例对象，即一个类只有一个类对象</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Singleton</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">static</span><span style="color: #24292E"> Singleton</span><span style="color: #D73A49">*</span><span style="color: #24292E"> m_insntance;</span><span style="color: #6A737D"> // 存储该类的唯一实例</span></span>
<span class="line"><span style="color: #6A737D">  // 将构造与析构设为私有</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">Singleton</span><span style="color: #24292E">(){}</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">~Singleton</span><span style="color: #24292E">(){}</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #6A737D">  // 删除拷贝构造与赋值运算符构造</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">Singleton</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Singleton</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">obj</span><span style="color: #24292E">) </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">delete</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">Singleton</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">=</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Singleton</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">) </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">delete</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 创建该唯一实例, 只能通过该方法创建获得对象</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Singleton</span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">getInstance</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">m_insntance){</span></span>
<span class="line"><span style="color: #24292E">      m_insntance </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Singleton</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> m_insntance;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  string m_name;</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">setName</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">string</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">name</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    m_name </span><span style="color: #D73A49">=</span><span style="color: #24292E"> name;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">string</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">getName</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> m_name;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">Singleton</span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Singleton</span><span style="color: #24292E">::m_insntance </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">NULL</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  // 第一次调用创建实例</span></span>
<span class="line"><span style="color: #24292E">  Singleton</span><span style="color: #D73A49">*</span><span style="color: #24292E"> s1 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Singleton</span><span style="color: #24292E">::</span><span style="color: #6F42C1">getInstance</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> s1-&gt;</span><span style="color: #6F42C1">getName</span><span style="color: #24292E">()</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #6A737D">  // 第二次调用使用已经创建的实例</span></span>
<span class="line"><span style="color: #24292E">  Singleton</span><span style="color: #D73A49">*</span><span style="color: #24292E"> s2 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Singleton</span><span style="color: #24292E">::</span><span style="color: #6F42C1">getInstance</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> s1-&gt;</span><span style="color: #6F42C1">getName</span><span style="color: #24292E">()</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="c对象模型与this指针">C++对象模型与this指针</h2>
<h3 id="成员变量与成员函数分开存储">成员变量与成员函数分开存储</h3>
<p>c++中，类内成员变量与成员函数分开存储</p>
<p>只有非静态成员变量才属于类的对象上</p>
<p>对于空对象，编译器会给每个空对象分配一个字节空间，是为了区分空对象占内存的位置</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person2</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person3</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> b;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(){}</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person p;</span></span>
<span class="line"><span style="color: #24292E">  person2 p2;</span></span>
<span class="line"><span style="color: #24292E">  person3 p3;</span></span>
<span class="line"><span style="color: #6A737D">  // 占用内存为1</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;size of empty class: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(p)</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 占用内存为4</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;size of class person2: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(p2)</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 静态成员与非静态成员函数不属于类的对象上，故占用内存也为4</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;size of class person3: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(p3)</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="this指针">this指针</h3>
<p>C++通过提供this指针解决了区分多个对象调用同一块代码分不清的问题</p>
<p><strong>this指针指向被调用的成员函数所属的对象</strong>，不需要定义，直接使用</p>
<p>用途：</p>
<ul>
<li>形参和成员变量同名时，可以用this指针来区分</li>
<li>在类的非静态成员函数中返回对象本身，可使用<code>retrun *this</code></li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">age</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #6A737D">    // 当形参和成员变量同名时,this 指针指向被调用成员函数所属对象</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> age;</span><span style="color: #6A737D"> // 此时this-&gt;age和定义的成员变量age是同一个</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 成员函数返回对象本身</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">addage</span><span style="color: #24292E">(</span><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;age</span><span style="color: #D73A49">+=</span><span style="color: #24292E">p.age;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #005CC5">this</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  // 解决名称冲突</span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #6F42C1">p</span><span style="color: #24292E">(</span><span style="color: #005CC5">18</span><span style="color: #24292E">); </span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #6F42C1">p2</span><span style="color: #24292E">(</span><span style="color: #005CC5">10</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;age:&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">p.age</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 返回对象本身可以实现链式调用</span></span>
<span class="line"><span style="color: #24292E">  p2.</span><span style="color: #6F42C1">addage</span><span style="color: #24292E">(p).</span><span style="color: #6F42C1">addage</span><span style="color: #24292E">(p).</span><span style="color: #6F42C1">addage</span><span style="color: #24292E">(p);</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;age of p2:&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">p2.age</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="空指针访问成员函数">空指针访问成员函数</h3>
<p>C++允许空指针调用成员函数，但是要注意有没有用到this指针</p>
<p>如果用到this指针，要注意保证代码的鲁棒性</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">show</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;this is person class&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">showage</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">    // 防止指向空 </span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #005CC5">this</span><span style="color: #D73A49">==</span><span style="color: #005CC5">NULL</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #6A737D">    // 调用成员变量时，默认在前面加this-&gt;,但此时p是空指针，故指向的是空对象，this没有指向数据</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;age = &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">age </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #D73A49">*</span><span style="color: #24292E">p </span><span style="color: #D73A49">=</span><span style="color: #24292E">  </span><span style="color: #005CC5">NULL</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  p-&gt;</span><span style="color: #6F42C1">show</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  p-&gt;</span><span style="color: #6F42C1">showage</span><span style="color: #24292E">(); </span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="const修饰成员函数">const修饰成员函数</h3>
<p><strong>常函数：</strong></p>
<ul>
<li>成员函数后加const称该函数为常函数</li>
<li>常函数内不可以修改成员属性</li>
<li>成员属性声明时加关键字mutable后，在常函数内依然可以修改</li>
</ul>
<p><strong>常对象：</strong></p>
<ul>
<li>声明对象前加const称该对象为常对象</li>
<li>常对象构造时需要对内部成员变量初始化（构造函数）</li>
<li>常对象只能调用常函数</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">mutable</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> b;</span><span style="color: #6A737D"> // 加上mutable也可以在常函数中修改</span></span>
<span class="line"><span style="color: #6A737D">  // this指针本身是指针常量，指针指向是不可修改的，指针指向的值是可以修改的</span></span>
<span class="line"><span style="color: #6A737D">  // 而加上const修饰后，修饰的是this指向的值，让指向的值也不可修改</span></span>
<span class="line"><span style="color: #6A737D">  // 相当于const person * const this;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">show</span><span style="color: #24292E">() </span><span style="color: #D73A49">const</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #6A737D">    //this-&gt;age = 100; // 此时不可修改 </span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">100</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(){}</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(){</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  // 常对象</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> person p;</span></span>
<span class="line"><span style="color: #6A737D">  // p.age = 100; // 常对象下不能修改值</span></span>
<span class="line"><span style="color: #24292E">  p.b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">100</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 但有mutable的可以修改</span></span>
<span class="line"><span style="color: #6A737D">  // p.f() // 常对象只能调用常函数</span></span>
<span class="line"><span style="color: #24292E">  p.</span><span style="color: #6F42C1">show</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="类的特殊成员函数">类的特殊成员函数</h3>
<p>特殊成员函数包括默认构造函数、拷贝构造函数、拷贝赋值运算符、移动构造函数、移动赋值运算符、析构函数，他们均可以用以下两个关键字修饰</p>
<ul>
<li><p><code>=delete</code>：</p>
<p>可以在函数声明后添加
<code>=delete</code>来删除当前函数，如删除构造函数、删除不需要的传参类型</p></li>
<li><p><code>=default</code>：</p>
<p>加在特殊函数后，可以用来声明一个默认特殊函数，还可以自动使用默认值初始化变量</p></li>
</ul>
<h3 id="可平凡复制类">可平凡复制类</h3>
<p>C++中，各种数据类型及他们的数组、指针、枚举等在内存中是连续存储的，可以使用memcpy()函数进行拷贝，称为可平凡复制类型</p>
<p>一个类若满足以下条件，被称为可平凡复制类，也是一种可平凡复制类型</p>
<ul>
<li>没有虚函数</li>
<li>没有用户自定义的特殊成员函数</li>
<li>有自动生成的析构函数</li>
<li>所有非静态成员变量也是可平凡复制类型</li>
<li>拷贝、移动构造函数，拷贝、移动赋值运算符中至少有一个是未被删除的</li>
<li>对于继承类，其父类要满足上述条件</li>
</ul>
<p>可以使用<code>&lt;type_traits&gt;</code>库中的<code>is_trivially_copyable&lt;类&gt;::value</code>来判断是否可拷贝</p>
<h3 id="标准布局类">标准布局类</h3>
<p>C++中，所有标量类型都是标准布局类型</p>
<p>对一个非继承类，满足以下条件被称为标准布局类</p>
<ul>
<li>没有虚函数</li>
<li>所有类成员都具有相同访问属性</li>
<li>所有类成员都是标准布局类型</li>
<li>若类是继承类，则满足该类和父类中只有一个类有非静态数据成员，且类型与访问控制满足上述条件</li>
</ul>
<p>可以使用<code>&lt;type_traits&gt;</code>库中的<code>is_standard_;leyout&lt;类&gt;::value</code>来判断是否可拷贝</p>
<h2 id="友元">友元</h2>
<p>友元可以让一个函数或者类访问另一个类中的私有成员</p>
<p>友元的关键字为<code>friend</code></p>
<h3 id="全局函数做友元">全局函数做友元</h3>
<p>在class中声明对应全局函数，并在最前面加<code>friend</code>关键词，可以声明友元</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">building</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">friend</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fir</span><span style="color: #24292E">(</span><span style="color: #6F42C1">building</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">building</span><span style="color: #24292E">);</span><span style="color: #6A737D"> // 声明该全局函数为building类的友元</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  string sitting_room;</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  string bedroom;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">building</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    sitting_room </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;客厅&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    bedroom </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;卧室&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fir</span><span style="color: #24292E">(</span><span style="color: #6F42C1">building</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">building</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;访问公共属性:&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">building.sitting_room</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;访问私有属性:&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">building.bedroom</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  building b;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">fir</span><span style="color: #24292E">(b);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="类做友元">类做友元</h3>
<p>在class中声明对应类，并在最前面加<code>friend</code>关键词，可以声明友元，被声明的类可以访问原类中的私有属性</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">buildings</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fri</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  buildings</span><span style="color: #D73A49">*</span><span style="color: #24292E"> building;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">fri</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">visit</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">buildings</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">friend</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fri</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 声明fri类是building类的友元</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  string sitting_room;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">buildings</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  string bedroom;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 在类外写成员函数</span></span>
<span class="line"><span style="color: #6F42C1">buildings</span><span style="color: #24292E">::</span><span style="color: #6F42C1">buildings</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  sitting_room </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;客厅&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  bedroom </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;卧室&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6F42C1">fri</span><span style="color: #24292E">::</span><span style="color: #6F42C1">fri</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  building </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> buildings;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fri</span><span style="color: #24292E">::</span><span style="color: #6F42C1">visit</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;访问公共属性:&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">building-&gt;sitting_room</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;访问私有属性:&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">building-&gt;bedroom</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span><span style="color: #6A737D"> // 友元可以访问类中的私有属性</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  fri f;</span></span>
<span class="line"><span style="color: #24292E">  f.</span><span style="color: #6F42C1">visit</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="成员函数做友元">成员函数做友元</h3>
<p>在class中声明对应类中的成员函数，并在最前面加<code>friend</code>关键词，可以声明友元，被声明的成员函数可以访问原类中的私有属性</p>
<p><figure class="shiki C++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></div><div class="code"><pre><code>#include <iostream>
using namespace std;
class buildings;
class fri{
public:
  buildings* building;
  fri(){
    building = new buildings;
  }
  void visit(); // 让visit可以访问buildings中的私有属性
};

class buildings{
  friend void fri::visit(); // 声明fri类下的visit成员函数是building类的友元
public:
  string sitting_room;
  buildings(){
    sitting_room = "客厅";
    bedroom = "卧室";
  }
private:
  string bedroom;
};

void fri::visit(){
  cout <<"访问公共属性:" <<building->sitting_room<<endl;
  cout <<"访问私有属性:" <<building->bedroom<<endl; // 友元可以访问类中的私有属性
}

int main(){
  fri f;
  f.visit();
}</code></pre></div></div></figure></p>
<h2 id="运算符重载">运算符重载</h2>
<p>运算符重载可以对已有的运算符重新定义，赋予另一种功能以适用于不同的数据类型</p>
<p>如我们通过写成员函数来实现两个类相加属性后返回新的对象</p>
<p>可以通过编译器提供的通用名称<code>operator</code>来重载运算符以简化运算</p>
<p>重载的本质调用为（以person类为例）：</p>
<ul>
<li>成员函数：<code>person p3 = p1.operator&lt;运算符&gt;(p2)</code></li>
<li>全局函数：<code>person p3 = p1.operator&lt;运算符&gt;(p1, p2)</code></li>
</ul>
<p>注意：</p>
<ul>
<li>运算符重载也可以实现函数重载</li>
<li>对于内置数据类型的表达式的运算符是不可以重载的</li>
<li>不要滥用运算符重载</li>
</ul>
<h3 id="加号运算符重载">加号运算符重载</h3>
<p>成员函数：</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">+</span><span style="color: #24292E">(</span><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    person temp;</span></span>
<span class="line"><span style="color: #24292E">    temp.a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;a</span><span style="color: #D73A49">+</span><span style="color: #24292E">p.a;</span></span>
<span class="line"><span style="color: #24292E">    temp.b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;b</span><span style="color: #D73A49">+</span><span style="color: #24292E">p.b;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> temp;</span></span>
<span class="line"><span style="color: #24292E"> }</span></span></code></pre></div></div></figure>
<p>全局函数：</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">+</span><span style="color: #24292E">(</span><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">p1</span><span style="color: #24292E">, </span><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">p2</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  person temp;</span></span>
<span class="line"><span style="color: #24292E">    temp.a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p1.a</span><span style="color: #D73A49">+</span><span style="color: #24292E">p2.a;</span></span>
<span class="line"><span style="color: #24292E">    temp.b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p1.b</span><span style="color: #D73A49">+</span><span style="color: #24292E">p2.b;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> temp;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="左移运算符重载">左移运算符重载</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 只能全局重载左移运算符</span></span>
<span class="line"><span style="color: #6A737D">// 若在类内重载会称为p.operator&lt;&lt;(cout) 即p&lt;&lt;cout (cout是ostream流中的对象)</span></span>
<span class="line"><span style="color: #6A737D">// 这里先写cout即可实现cout在左边p在右边</span></span>
<span class="line"><span style="color: #6A737D">// 返回值作为cout本身的引用，可以实现链式编程</span></span>
<span class="line"><span style="color: #6F42C1">ostream</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">&lt;&lt;</span><span style="color: #24292E">(</span><span style="color: #6F42C1">ostream</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">cout</span><span style="color: #24292E">, </span><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;a=&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p.a </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;b=&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p.b;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> cout;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="递增运算符重载">递增运算符重载</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 前置++</span></span>
<span class="line"><span style="color: #6A737D">// 这里返回引用是为了确保只对同一个数据进行操作</span></span>
<span class="line"><span style="color: #6F42C1">myint</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">++</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  num</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 先进行自增运算</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #005CC5">this</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 再返回自身</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 后置++</span></span>
<span class="line"><span style="color: #6A737D">// 这里为了防止重复，添加一个int占位符来实现函数重载以区分前后置</span></span>
<span class="line"><span style="color: #6F42C1">myint</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">++</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  myint temp </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #005CC5">this</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  num</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> temp;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="赋值运算符重载">赋值运算符重载</h3>
<p>C++编译器会额外给一个类添加赋值运算符的重载函数</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E">age;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">person</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">age</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E">(age);</span><span style="color: #6A737D"> // 年龄放在堆区</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 将age内存释放</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">~person</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (age</span><span style="color: #D73A49">!=</span><span style="color: #005CC5">NULL</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">delete</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">      age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">NULL</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #6F42C1">p1</span><span style="color: #24292E">(</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;p1&#39;s age:&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E">p1.age </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  person </span><span style="color: #6F42C1">p2</span><span style="color: #24292E">(</span><span style="color: #005CC5">2</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  p2 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p1;</span><span style="color: #6A737D"> // 赋值操作</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;p2&#39;s age:&quot;</span><span style="color: #D73A49">&lt;&lt;*</span><span style="color: #24292E">p2.age</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>该代码出错，由于age开到了同一块堆区内存，故在p1赋值给p2时，两者的age指针都指向同一块区域</p>
<p>则当p2执行完毕，执行析构函数时，将该堆区内存释放；再等p1执行完毕，执行析构函数时，将已经释放的内存重复释放了，故报错</p>
<p>我们需要通过重载赋值运算符来实现深拷贝</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 重载赋值运算符</span></span>
<span class="line"><span style="color: #6F42C1">person</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">=</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #6A737D">  // 首先判断是否有属性在堆区，若有先释放，再深拷贝</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (age</span><span style="color: #D73A49">!=</span><span style="color: #005CC5">NULL</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">delete</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">    age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">NULL</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E">(</span><span style="color: #D73A49">*</span><span style="color: #24292E">p.age);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #005CC5">this</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="关系运算符重载">关系运算符重载</h3>
<p>实现自定义数据类型的比较</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 重载==运算符</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">bool</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">==</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;name</span><span style="color: #D73A49">==</span><span style="color: #24292E">p.name </span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E"> </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;age</span><span style="color: #D73A49">==</span><span style="color: #24292E">p.age){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">true</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 重载!=运算符</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">bool</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">!=</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">person</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;name</span><span style="color: #D73A49">==</span><span style="color: #24292E">p.name </span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E"> </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;age</span><span style="color: #D73A49">==</span><span style="color: #24292E">p.age){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">true</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span></code></pre></div></div></figure>
<p>大于小于类似</p>
<h3 id="函数调用运算符重载">函数调用运算符重载</h3>
<ul>
<li>函数调用运算符即()</li>
<li>重载后的使用方式很像函数的调用，故也称为仿函数</li>
<li>仿函数没有固定写法</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">print</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #6A737D">  //重载函数调用运算符</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">()</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> s </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">add</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">()</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">n1</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">n2</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> n1</span><span style="color: #D73A49">+</span><span style="color: #24292E">n2;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span></code></pre></div></div></figure>
<p>也可以用匿名函数对象进行调用</p>
<h2 id="继承">继承</h2>
<p>有些类与其他类之间除了有共性，还有自己的特性，我们可以用继承的技术来减少重复代码优点：减少重复代码</p>
<p>语法：<code>&lt;子类&gt;: &lt;继承方式&gt; &lt;父类&gt;</code></p>
<p>其中子类也称作派生类，父类也称基类</p>
<p>子类中的成员包含两部分：</p>
<p>一类是从基类继承过来的，一类是自己增加的成员</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">page</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f1</span><span style="color: #24292E">()</span></span>
<span class="line"><span style="color: #24292E">  {</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;f1&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f2</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;f2&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f3</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;f3&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">page2</span><span style="color: #24292E">:</span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">page</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">s1</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;s1&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span></code></pre></div></div></figure>
<h3 id="继承方式">继承方式</h3>
<img src="/C++/%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/image-20250602151243297.png" class="" title="继承方式">
<p>即：</p>
<ul>
<li>私有成员子类均不可访问</li>
<li>公共继承下：各成员权限不变</li>
<li>保护继承下：public变为protected</li>
<li>私有继承下：public与protected变为private</li>
</ul>
<h3 id="继承中的对象模型">继承中的对象模型</h3>
<p>父类中所有非静态成员属性都会被子类继承</p>
<p>而私有属性被编译器隐藏，故访问不到</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fa</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">protected:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> b;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> c;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">son</span><span style="color: #24292E">:</span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fa</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> d;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  // 结果为16，即父类中所有属性都会被继承</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(son)</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="继承中的构造与析构顺序">继承中的构造与析构顺序</h3>
<p>子类继承父类后，创建子类对象时，也会调用父类的构造函数</p>
<p>顺序：先构造父类，再构造子类，析构相反</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">base</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">base</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;base构造函数&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">~base</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;base析构函数&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">son</span><span style="color: #24292E">:</span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">base</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">son</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;son构造函数&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">~son</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;son析构函数&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  son s;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">base构造函数</span></span>
<span class="line"><span style="color: #24292e">son构造函数</span></span>
<span class="line"><span style="color: #24292e">son析构函数</span></span>
<span class="line"><span style="color: #24292e">base析构函数</span></span></code></pre></div></div></figure>
<h3 id="同名成员处理方式">同名成员处理方式</h3>
<p>当子类和父类出现同名成员：子类的同名成员会隐藏掉所有父类中同名成员（函数重载也会被隐藏）</p>
<ul>
<li>访问子类同名成员：直接访问</li>
<li>访问父类同名成员：加作用域</li>
</ul>
<p>静态与非静态处理方式一样</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fa</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> b; </span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">fa</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">100</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;f in fa&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ff</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;ff in fa&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">son</span><span style="color: #24292E">:</span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fa</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> b;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">son</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">200</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;f in son&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ff</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;ff in son&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fa</span><span style="color: #24292E">::b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">son</span><span style="color: #24292E">::b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">20</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  son s;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;a in son:&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">s.a</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #6A737D">  // 加作用域访问父类中的同名成员变量</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;a in fa:&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">s.fa::a</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  s.</span><span style="color: #6F42C1">f</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #6A737D">  // 加作用域调用父类中的同名成员函数</span></span>
<span class="line"><span style="color: #24292E">  s.fa::</span><span style="color: #6F42C1">f</span><span style="color: #24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 非静态同名成员访问：通过对象</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;static b in son:&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">s.b</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;static b in fa:&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">s.fa::b</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  s.</span><span style="color: #6F42C1">ff</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  s.fa::</span><span style="color: #6F42C1">ff</span><span style="color: #24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 非静态同名成员访问：通过类名</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;static b in son:&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">son</span><span style="color: #24292E">::b </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl; </span></span>
<span class="line"><span style="color: #6A737D">  // 第一个::代表通过类名访问，第二个::代表访问父类作用域下</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;static b in fa:&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #6F42C1">son</span><span style="color: #24292E">::</span><span style="color: #6F42C1">fa</span><span style="color: #24292E">::b</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">son</span><span style="color: #24292E">::</span><span style="color: #6F42C1">ff</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">son</span><span style="color: #24292E">::</span><span style="color: #6F42C1">fa</span><span style="color: #24292E">::</span><span style="color: #6F42C1">ff</span><span style="color: #24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="多继承">多继承</h3>
<p>C++允许一个类继承多个类</p>
<p>语法：<code>&lt;子类&gt;: &lt;继承方式&gt; &lt;父类1&gt;, &lt;继承方式&gt; &lt;父类2&gt;...</code></p>
<p>同名成员出现时需要加作用域区分</p>
<p><strong>实际开发时不建议使用多继承</strong></p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fa</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">fa</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">100</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;f in fa&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fa2</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">fa2</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    a</span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">200</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;f in fa&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">son</span><span style="color: #24292E">:</span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fa</span><span style="color: #24292E">, </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fa2</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> c;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> d;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">son</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    c </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">300</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    d </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">400</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  // 多继承子类空间</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;size of son:&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;sizeof</span><span style="color: #24292E">(son)</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  son s;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;a in fa:&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">s.fa::a</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;a in fa2:&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">s.fa2::a</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="菱形继承">菱形继承</h3>
<p>概念：两个派生类继承同一个基类，又有某个类同时继承两个派生类</p>
<p>菱形继承时，两个父类拥有相同数据，需要加作用域区分</p>
<p>但该数据对于最后的子类来说存在两份，会浪费空间，需要利用<strong>虚继承</strong>来解决问题</p>
<p>在需要虚继承的部分的访问权限前添加关键字<code>vritual</code>即可，此时对应父类称为<strong>虚基类</strong></p>
<p>原理：此时的父类继承的是虚基类指针(vbptr)，指向一个虚基类表，该表存储了指针位置以及对应偏移量，根据偏移量便可以找到继承的那唯一一份数据</p>
<p>缺点：虚继承占用内存很大</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">animal</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> age;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// sheep 继承了 animal</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">sheep</span><span style="color: #24292E">: </span><span style="color: #D73A49">virtual</span><span style="color: #24292E"> </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">animal</span><span style="color: #24292E">{};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// camel 继承了 animal</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">camel</span><span style="color: #24292E">: </span><span style="color: #D73A49">virtual</span><span style="color: #24292E"> </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">animal</span><span style="color: #24292E">{};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// alpaca 继承了 sheep和camel</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">alpaca</span><span style="color: #24292E">: </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">sheep</span><span style="color: #24292E">, </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">camel</span><span style="color: #24292E">{};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  alpaca st;</span></span>
<span class="line"><span style="color: #6A737D">  // 菱形继承时，两个父类有相同数据，需要加作用域区分</span></span>
<span class="line"><span style="color: #24292E">  st.sheep::age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">18</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  st.camel::age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">20</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;age of sheep: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">st.sheep::age</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;age of camel: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">st.camel::age</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;age of alpaca: &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">st.alpaca::age</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="多态">多态</h2>
<h3 id="分类">分类</h3>
<ul>
<li>静态多态：函数和运算符重载属于静态多态，复用函数名；函数地址在编译阶段确定</li>
<li>动态多态：派生类和虚函数实现运行时多态；函数地址在运行阶段确定</li>
</ul>
<p>### 动态多态</p>
<p>满足条件：</p>
<ul>
<li><p>存在继承关系</p></li>
<li><p>子类要重写父类的虚函数</p>
<p>（重写即函数返回值类型、函数名、参数列表完全相同）</p></li>
</ul>
<p>使用：父类的指针或者引用指向子类对象</p>
<p>原理：父类记录的也是虚基类指针，指向对应虚基类表。当子类重写后，对应指向的虚基类表被现子类覆盖，得到对应参数</p>
<p>优点：</p>
<ul>
<li>组织结构清晰</li>
<li>可读性强</li>
<li>前期后期拓展以及维护性高</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">animal</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #6A737D">  // 虚函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">virtual</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">speak</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;speaking&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">cat</span><span style="color: #24292E">: </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">animal</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">speak</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;cat is speaking&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 地址在编译阶段确定函数地址，但为了让多个类输出对应，需要在运行时确定</span></span>
<span class="line"><span style="color: #6A737D">// 当给animal中的speak变为虚函数后，便可以实现子类重写父类</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">dospeak</span><span style="color: #24292E">(</span><span style="color: #6F42C1">animal</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">ani</span><span style="color: #24292E">){</span><span style="color: #6A737D"> // 父类引用</span></span>
<span class="line"><span style="color: #24292E">  ani.</span><span style="color: #6F42C1">speak</span><span style="color: #24292E">();</span><span style="color: #6A737D"> // 但调用的是animal中的speak函数</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  cat cat;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">dospeak</span><span style="color: #24292E">(cat);</span><span style="color: #6A737D"> // 父类引用指向了子类</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>在开发时，提倡开闭原则：即对扩展进行开放，对修改进行关闭</p>
<h3 id="纯虚函数与抽象类">纯虚函数与抽象类</h3>
<p>多态中，通常父类中的虚函数实现是毫无意义的，都是调用子类中的重写内容</p>
<p>因此可以将虚函数改为纯虚函数</p>
<p>语法：<code>virtual &lt;返回值类型&gt; &lt;函数名&gt;([参数列表]) = 0;</code></p>
<p>此时这个类称为<strong>抽象类</strong></p>
<ul>
<li>抽象类无法实例化对象</li>
<li>子类必须重写抽象类中的纯虚函数，否则也属于抽象类</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">base</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">virtual</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">func</span><span style="color: #24292E">() </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 纯虚函数</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">son</span><span style="color: #24292E"> :</span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">base</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #6A737D">// 子类必须重写父类中的纯虚函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">virtual</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">func</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;func调用&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  // base b; 不允许实例化抽象类</span></span>
<span class="line"><span style="color: #24292E">  base </span><span style="color: #D73A49">*</span><span style="color: #24292E">b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> son;</span></span>
<span class="line"><span style="color: #24292E">  b-&gt;</span><span style="color: #6F42C1">func</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="虚析构与纯虚析构">虚析构与纯虚析构</h3>
<p>多态使用时，如果子类中有属性开辟到堆区，则父类指针在释放时就无法调用到子类的虚构代码，此时需要将父类中的析构函数改为<strong>虚析构或纯虚析构</strong></p>
<ul>
<li>可以解决父类指针释放子类对象</li>
<li>都需要有函数具体实现</li>
</ul>
<p>其中，纯虚析构需要类外实现</p>
<p>有纯虚析构后该类便成为了抽象类</p>
<p>语法：<code>virtual ~&lt;类名&gt;()&#123;&#125;</code>或<code>virtual ~&lt;类名&gt;()=0;</code></p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">animal</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">virtual</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">speak</span><span style="color: #24292E">() </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  // 用虚析构解决父类指针释放子类对象时释放不完全的问题</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">virtual</span><span style="color: #24292E"> </span><span style="color: #6F42C1">~animal</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;animal析构调用&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">cat</span><span style="color: #24292E">: </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">animal</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">cat</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">name</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    cname </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">string</span><span style="color: #24292E">(name);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">virtual</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">speak</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;*</span><span style="color: #24292E">cname</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;&#39;s speaking&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">~cat</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (cname </span><span style="color: #D73A49">!=</span><span style="color: #005CC5">NULL</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;cat析构调用&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">delete</span><span style="color: #24292E"> cname;</span></span>
<span class="line"><span style="color: #24292E">      cname </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">NULL</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  string </span><span style="color: #D73A49">*</span><span style="color: #24292E">cname;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  animal </span><span style="color: #D73A49">*</span><span style="color: #24292E"> ani </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">cat</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Tom&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  ani-&gt;</span><span style="color: #6F42C1">speak</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #6A737D">  // 父类指针析构时不会调用子类析构函数，导致若子类有析构属性时不会被释放</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">delete</span><span style="color: #24292E"> ani;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="杂项">杂项</h2>
<h3 id="override与final限定符">override与final限定符</h3>
<p>在基类是虚函数的情况下，子类对该虚函数进行重写，在要重写的函数后面加上<code>override</code>可以防止因为子类的拼写错误，数据类型错误等问题，导致无法调用到子类而直接调用了基类</p>
<p>（若不相同会直接报错）</p>
<p>在虚函数声明的结尾加上<code>final</code>可以防止该虚函数被子类重写，在类声明的后面加上<code>final</code>可以防止该类被继承</p>
<p>注意这两个限定符不是保留关键字</p>
<h3 id="const成员函数">const成员函数</h3>
<p>在成员函数声明和定义的后面加上关键字<code>const</code></p>
<p>const成员函数不能修改其成员变量，不能调用非const成员函数，不能通过const类型的对象调用非const成员函数</p>
<p><strong>即常量对象只可以调用常量方法</strong></p>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
        <tag>OOP</tag>
      </tags>
  </entry>
  <entry>
    <title>【C++】类型转换</title>
    <url>/C++/%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/</url>
    <content><![CDATA[<h1 id="类型转换">类型转换</h1>
<h2 id="隐式转换">隐式转换</h2>
<p><strong>要求：相互转换的类型兼容</strong></p>
<p>当一个值被赋值到另一个兼容类型时，会自动发生隐式转换</p>
<p>但这样会造成精度损失</p>
<p>类对象之间也可以发生隐式转换</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">SubClass</span><span style="color: #D73A49">*</span><span style="color: #24292E"> pSub </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">SubClass</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">BaseClass</span><span style="color: #D73A49">*</span><span style="color: #24292E"> pBase </span><span style="color: #D73A49">=</span><span style="color: #24292E"> pSub;</span></span></code></pre></div></div></figure>
<p>如上是将子类指针转换为了基类指针，这是常用的类指针间的隐式转换</p>
<p>若上方<code>SubClass</code>与<code>BaseClass</code>之间没有继承关系，他们的指针是无法进行隐式转换的</p>
<p>除非重载运算符或构造函数</p>
<figure class="shiki C++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre><code>class classA{};
class classB{
    public: ClassB (const ClassA& a){}
};</code></pre></div></div></figure>
<p>这种方法类似于拷贝构造，但参数类型不同，我们称这种为<strong>转换构造函数</strong></p>
<h2 id="显式转换">显式转换</h2>
<h3 id="使用变量类型运算符">使用变量类型运算符</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">float</span><span style="color: #24292E"> b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #D73A49">float</span><span style="color: #24292E">)a</span><span style="color: #6A737D"> // 或float(a)</span></span></code></pre></div></div></figure>
<p>以上将整型a转化为了浮点数</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">SubClass obj;</span></span>
<span class="line"><span style="color: #24292E">BaseClass</span><span style="color: #D73A49">*</span><span style="color: #24292E"> pBase </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (BaseClass</span><span style="color: #D73A49">*</span><span style="color: #24292E">) </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">obj;</span></span></code></pre></div></div></figure>
<p>以上将子类对象obj的地址转换成了基类的指针，但若两者没有继承关系，则转换时可能会访问到奇怪的位置</p>
<h3 id="动态转换">动态转换</h3>
<p>语法：<code>dynamic_cast &lt;转换类型&gt; (表达式)</code></p>
<p>只能用于对象的指针和引用的转换</p>
<p>用于多态类的向下转换（向上转换一定可以成功，故可以直接使用普通类型转换）</p>
<p>dynamic_cast进行两个阶段的检查：</p>
<ul>
<li>编译阶段：检查基类是否是多态类，不是会报错</li>
<li>运行阶段：检查转换对象是派生类对象，不是会返回空指针</li>
</ul>
<p>动态转换需要RTTI</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">CBase</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">CDerive</span><span style="color: #24292E">: </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">CBase</span><span style="color: #24292E">{};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">CBase obj;</span></span>
<span class="line"><span style="color: #6A737D">// 基类不是多态类，无法转换</span></span>
<span class="line"><span style="color: #24292E">CDerive </span><span style="color: #D73A49">*</span><span style="color: #24292E">ptr </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">dynamic_cast&lt;</span><span style="color: #24292E">CDerived</span><span style="color: #D73A49">*&gt;</span><span style="color: #24292E">(</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">obj);</span></span></code></pre></div></div></figure>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">CBase</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">virtual</span><span style="color: #24292E"> </span><span style="color: #6F42C1">~CBase</span><span style="color: #24292E">(){}</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">CDerive</span><span style="color: #24292E">: </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">CBase</span><span style="color: #24292E">{};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">CBase obj;</span></span>
<span class="line"><span style="color: #6A737D">// 不是派生类对象，转换失败</span></span>
<span class="line"><span style="color: #24292E">CDerive </span><span style="color: #D73A49">*</span><span style="color: #24292E">ptr </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">dynamic_cast&lt;</span><span style="color: #24292E">CDerived</span><span style="color: #D73A49">*&gt;</span><span style="color: #24292E">(</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">obj);</span></span></code></pre></div></div></figure>
<h3 id="静态转换">静态转换</h3>
<p>语法：<code>static_cast &lt;转换类型&gt; (表达式)</code></p>
<p>可用于基类到派生类的向下转换与派生类到基类的向上转换</p>
<p>static_cast只进行编译阶段的检查：检查两个类是否兼容（不要求基类是多态类）</p>
<p>静态转换可以替代隐式转换</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">CBase</span><span style="color: #24292E">{};</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">CDerive</span><span style="color: #24292E">: </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">CBase</span><span style="color: #24292E">{};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">COther</span><span style="color: #24292E">{};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">CBase </span><span style="color: #D73A49">*</span><span style="color: #24292E">p;</span></span>
<span class="line"><span style="color: #24292E">CDerive </span><span style="color: #D73A49">*</span><span style="color: #24292E">p1;</span></span>
<span class="line"><span style="color: #24292E">COther other;</span></span>
<span class="line"><span style="color: #24292E">CDerive obj;</span></span>
<span class="line"><span style="color: #6A737D">// </span></span>
<span class="line"><span style="color: #24292E">p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">static_cast&lt;</span><span style="color: #24292E">CBase</span><span style="color: #D73A49">*&gt;</span><span style="color: #24292E">(</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">obj);</span></span>
<span class="line"><span style="color: #24292E">p1 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">static_cast&lt;</span><span style="color: #24292E">CDerive</span><span style="color: #D73A49">*&gt;</span><span style="color: #24292E">(</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">obj);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 会提示类型转换无效</span></span>
<span class="line"><span style="color: #24292E">p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">static_cast&lt;</span><span style="color: #24292E">CBase</span><span style="color: #D73A49">*&gt;</span><span style="color: #24292E">(</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">other);</span></span>
<span class="line"><span style="color: #24292E">p1 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">static_cast&lt;</span><span style="color: #24292E">CDerive</span><span style="color: #D73A49">*&gt;</span><span style="color: #24292E">(</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">other);</span></span></code></pre></div></div></figure>
<h3 id="重解释转换">重解释转换</h3>
<p>语法：<code>reinterpret_cast &lt;转换类型&gt; (表达式)</code></p>
<p>用于类指针之间的转换，而不会检查类型是否有效</p>
<p>也可用于整型与指针间的转换（注意整型的数据范围能容纳指针数值）</p>
<p>应用：</p>
<ul>
<li>与内存和硬件直接交互的底层与接口程序</li>
<li>与操作系统组件交互</li>
<li>处理网络或多媒体数据</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">CBase</span><span style="color: #24292E">{};</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">CDerive</span><span style="color: #24292E">: </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">CBase</span><span style="color: #24292E">{};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">COther</span><span style="color: #24292E">{};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">CBase </span><span style="color: #D73A49">*</span><span style="color: #24292E">p;</span></span>
<span class="line"><span style="color: #24292E">CDerive </span><span style="color: #D73A49">*</span><span style="color: #24292E">p1;</span></span>
<span class="line"><span style="color: #24292E">COther other;</span></span>
<span class="line"><span style="color: #24292E">p1 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">reinterpret_cast&lt;</span><span style="color: #24292E">CDerive</span><span style="color: #D73A49">*&gt;</span><span style="color: #24292E">(</span><span style="color: #D73A49">0x</span><span style="color: #005CC5">EF</span><span style="color: #D73A49">L</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> address </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">reinterpret_cast&lt;long</span><span style="color: #24292E"> </span><span style="color: #D73A49">long&gt;</span><span style="color: #24292E">(</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">other);</span></span></code></pre></div></div></figure>
<h3 id="常量转换">常量转换</h3>
<p>语法：<code>const_cast &amp;lt;转换类型&amp;gt; (表达式)</code></p>
<p>用于常量与非常量之间的转换，转换类型必须是指针或引用</p>
<p>应用：</p>
<ul>
<li>在调用不修改对象但未声明常量参数的函数时，暂时取消对象的常量类型</li>
<li>临时取消对象中的const属性，以便调用成员函数修改其中成员</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">hello</span><span style="color: #24292E">(</span><span style="color: #D73A49">char*</span><span style="color: #24292E"> </span><span style="color: #E36209">str</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">str</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">char*</span><span style="color: #24292E"> str </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;world!&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6F42C1">hello</span><span style="color: #24292E">(</span><span style="color: #D73A49">const_cast&lt;char*&gt;</span><span style="color: #24292E">(str));</span></span></code></pre></div></div></figure>
<p>注意，进行转换不意味着可以进行修改</p>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
      </tags>
  </entry>
  <entry>
    <title>【C++】智能指针</title>
    <url>/C++/%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88/</url>
    <content><![CDATA[<h1 id="智能指针">智能指针</h1>
<h2 id="普通指针出现的错误">普通指针出现的错误</h2>
<ul>
<li>内存泄漏：一个指针指向一块动态分配的内存，当该指针离开了所在的作用域，且程序结束后不进行释放，则会导致内存泄漏</li>
<li>悬空指针：指针指向了已经被释放的区域</li>
<li>野指针：指针未初始化使其指向有效内存区域</li>
</ul>
<h2 id="智能指针-1">智能指针</h2>
<p>智能指针是一个对象，封装了多态对象指针，可以有效避免上述情况</p>
<p>智能指针会自动申请内存，并在使用结束后释放内存</p>
<p>C++中存在封装了三种智能指针</p>
<ul>
<li>unique_ptr</li>
<li>shared_ptr</li>
<li>weak+ptr</li>
</ul>
<h2 id="unique_ptr">unique_ptr</h2>
<p><code>unique_ptr</code>与管理对象是一对一的关系</p>
<h3 id="创建">创建</h3>
<p><code>unique_ptr(A) ptr1(new A(参数))</code></p>
<p><code>unique_ptr(A) ptr1 =make_unique&lt;A&gt;(参数)</code>（该方法较为安全）</p>
<p>其中A为类名</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;memory&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">rectangle</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">rectangle</span><span style="color: #24292E">(</span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">w</span><span style="color: #24292E">, </span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">h</span><span style="color: #24292E">): </span><span style="color: #6F42C1">width</span><span style="color: #24292E">(w), </span><span style="color: #6F42C1">height</span><span style="color: #24292E">(h){}</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">~rectangle</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;对象被释放&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #6F42C1">area</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> width</span><span style="color: #D73A49">*</span><span style="color: #24292E">height;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #D73A49">private:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">double</span><span style="color: #24292E"> width;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">double</span><span style="color: #24292E"> height;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  unique_ptr</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">rectangle</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">p</span><span style="color: #24292E">(</span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">rectangle</span><span style="color: #24292E">(</span><span style="color: #005CC5">3.5</span><span style="color: #24292E">, </span><span style="color: #005CC5">4.1</span><span style="color: #24292E">));</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> p-&gt;</span><span style="color: #6F42C1">area</span><span style="color: #24292E">()</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">14.35</span></span>
<span class="line"><span style="color: #24292e">对象被释放</span></span></code></pre></div></div></figure>
<p>这里智能指针可以像普通指针一样使用，直接调用成员</p>
<p>离开作用域后，会自动销毁，调用析构函数释放指向的对象</p>
<p><strong>注意：<code>unique_ptr</code>不能使用拷贝构造，也不能被赋值</strong></p>
<h3 id="成员函数">成员函数</h3>
<ul>
<li><code>T* get();</code>：获得所管理对象的指针</li>
<li><code>T* operator-&gt;();</code>：重载间接成员运算符，调用get()函数，返回所管理对象指针</li>
<li><code>T&amp; operator*();</code>：重载解引用运算符，返回所管理对象的引用</li>
<li><code>T* release();</code>：解除对封装对象的管理，返回对象指针</li>
<li><code>void reset(T* newObj)</code>：删除原有对象，接管新对象</li>
<li><code>void swap(unique_ptr&lt;T&gt;&amp; other)</code>：与其他<code>unique_ptr</code>对象交换所管理的对象</li>
<li><code>move()</code>：转移指针所管理对象的所有权（转移后先前的指针就是野指针了）</li>
</ul>
<h3 id="优点">优点</h3>
<p>安全，且开销（时间与空间）与普通指针差距不大，成员函数带来的额外开销也不大，符合RAII</p>
<h3 id="应用">应用</h3>
<p>适用于使用普通指针的地方，如容器</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Packet</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">Packet</span><span style="color: #24292E">(</span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #E36209">id</span><span style="color: #24292E">):</span><span style="color: #6F42C1">m_id</span><span style="color: #24292E">(id){};</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">long</span><span style="color: #24292E"> m_id;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">char</span><span style="color: #24292E"> Data[</span><span style="color: #005CC5">1000</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Compare</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">	</span><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">typename</span><span style="color: #24292E">&gt; </span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">SmartPtr</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">bool</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #6F42C1">()</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">SmartPtr</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">Packet</span><span style="color: #24292E">&gt;</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">pA</span><span style="color: #24292E">, </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">SmartPtr</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">Packet</span><span style="color: #24292E">&gt;</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #E36209">pB</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> pA-&gt;m_id</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">pB-&gt;m_id;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">typename</span><span style="color: #24292E"> </span><span style="color: #6F42C1">SmartPtr</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">sortSmartPtrVector</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">n</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    vector</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">SmartPtr</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> vecPacket;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i</span><span style="color: #D73A49">=</span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">n; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    vecPacket.</span><span style="color: #6F42C1">push_back</span><span style="color: #24292E">(</span><span style="color: #6F42C1">SmartPtr</span><span style="color: #24292E">(</span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Packet</span><span style="color: #24292E">(</span><span style="color: #6F42C1">rand</span><span style="color: #24292E">()</span><span style="color: #D73A49">%</span><span style="color: #24292E">n)));</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">sort</span><span style="color: #24292E">(vecPacket.</span><span style="color: #6F42C1">begin</span><span style="color: #24292E">(), vecPacket.</span><span style="color: #6F42C1">end</span><span style="color: #24292E">(),</span><span style="color: #6F42C1">Compare</span><span style="color: #24292E">());</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="shared_ptr">shared_ptr</h2>
<p>多个<code>shared_ptr</code>通过一个共同的引用计数器来管理同一个对象</p>
<h3 id="创建-1">创建</h3>
<p><code>shared_ptr(A) ptr1(new A(参数))</code></p>
<p><code>shared_ptr(A) ptr1 =make_shared&lt;A&gt;(参数)</code>（该方法较为安全）</p>
<p>其中A为类名</p>
<h3 id="控制块">控制块</h3>
<p><code>shared_ptr</code>需要分配另一块内存用来存储引用计数</p>
<p>当引用计数为0，即所有指向当前引用的指针都消失后，当前类才会被删除</p>
<h3 id="成员函数-1">成员函数</h3>
<p><code>shared_ptr</code>没有release方法</p>
<ul>
<li><code>long use_count()</code>：获取有多少指针管理同一个对象</li>
<li><code>bool unique()</code>：返回use_count()是否为1</li>
</ul>
<h3 id="类型转换">类型转换</h3>
<ul>
<li><code>dynamic_pointer_cast&lt;&gt;()</code></li>
<li><code>static_pointer_cast&lt;&gt;()</code></li>
<li><code>const_pointer_cast&lt;&gt;()</code></li>
</ul>
<h3 id="循环引用">循环引用</h3>
<p>使用<code>shared_ptr</code>时可能会出现循环引用的情况，如在使用容器时</p>
<p>此时的引用计数会变为2，但当某个指针离开时只会见一，导致无法自动删除对象导致内存泄漏</p>
<p>我们可以使用<code>weak_ptr</code>来避免这种情况</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;memory&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">c</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">c</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;构造函数被调用&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">~c</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;析构函数被调用&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  {</span></span>
<span class="line"><span style="color: #24292E">    shared_ptr</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">c</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> spo;</span></span>
<span class="line"><span style="color: #24292E">    {</span></span>
<span class="line"><span style="color: #24292E">      cout</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;进入作用域&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">      shared_ptr</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">c</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> spi </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">make_shared</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">c</span><span style="color: #24292E">&gt;();</span></span>
<span class="line"><span style="color: #24292E">      spo </span><span style="color: #D73A49">=</span><span style="color: #24292E"> spi;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    cout</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;离开作用域&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="weak_ptr">weak_ptr</h2>
<p><code>weak_ptr</code>需要结合<code>shared_ptr</code>来使用</p>
<p>可以将一个<code>shared_ptr</code>对象作为构造函数参数初始化，或直接赋值</p>
<p><code>weak_ptr</code>只对<code>shared_ptr</code>管理的对象进行观测，不改变对象的引用计数</p>
<p>可以通过对<code>weak_ptr</code>使用lock()函数，来获得一个<code>shared_ptr</code>以获得封装对象的控制权</p>
<p>若该<code>shared_ptr</code>非空，说明可用，且增加一次引用计数，在离开作用域前可以保证所管理对象是有效的</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;memory&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">rectangle</span><span style="color: #24292E">{};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  weak_ptr</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">rectangle</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> wp1;</span></span>
<span class="line"><span style="color: #24292E">  {</span></span>
<span class="line"><span style="color: #24292E">    shared_ptr</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">rectangle</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">sp1</span><span style="color: #24292E">(</span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">rectangle</span><span style="color: #24292E">());</span></span>
<span class="line"><span style="color: #24292E">    shared_ptr</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">rectangle</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> sp2 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> sp1;</span></span>
<span class="line"><span style="color: #24292E">    wp1 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> sp2;</span></span>
<span class="line"><span style="color: #24292E">    shared_ptr</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">rectangle</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> sp3 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> wp1.</span><span style="color: #6F42C1">lock</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;作用域内sp3=&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">sp3</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  shared_ptr</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">rectangle</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> sp3 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> wp1.</span><span style="color: #6F42C1">lock</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;作用域外sp3=&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">sp3</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>离开内部作用域后，对象的引用计数变为0，此时被析构，故wp1指向了空位置，可以判断对象有效性</p>
<p>使用<code>expired()</code>方法可以询问一个<code>weak_ptr</code>是否有效</p>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
      </tags>
  </entry>
  <entry>
    <title>【C++】高阶函数</title>
    <url>/C++/%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0/</url>
    <content><![CDATA[<h1 id="高阶函数">高阶函数</h1>
<h2 id="函数的默认参数">函数的默认参数</h2>
<p>C++中，形参是可以有缺省值的</p>
<p>注：</p>
<ul>
<li>若某个位置已经有了缺省值，则从该位置之后往后都必须要有缺省值</li>
<li>若函数声明有缺省值，则函数实现就不能有缺省值 （二义性）</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">20</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">c</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">30</span><span style="color: #24292E">){</span><span style="color: #6A737D"> // 形参有缺省值</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> a</span><span style="color: #D73A49">+</span><span style="color: #24292E">b</span><span style="color: #D73A49">+</span><span style="color: #24292E">c;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #005CC5">10</span><span style="color: #24292E">)</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span><span style="color: #6A737D"> // 有缺省值时可以不传参</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #005CC5">10</span><span style="color: #24292E">, </span><span style="color: #005CC5">30</span><span style="color: #24292E">)</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span><span style="color: #6A737D"> // 若传参则会覆盖缺省值</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; </span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="函数的占位参数">函数的占位参数</h2>
<p>C++中函数的形参列表中可以有占位参数，调用时必须填补该位置</p>
<p>语法：<code>&lt;返回值类型&gt; &lt;函数名&gt;([数据类型])&#123;&#125;</code></p>
<p>注：</p>
<ul>
<li>目前占位参数传入的参数无法使用</li>
<li>占位参数可以有缺省值</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> a </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot; occupation&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #005CC5">10</span><span style="color: #24292E">, </span><span style="color: #005CC5">10</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="函数重载">函数重载</h2>
<p>作用：函数名可以相同，用于提高复用性</p>
<p>满足条件：</p>
<ul>
<li>同一个作用域下</li>
<li>函数名相同</li>
<li>函数参数类型，个数，顺序不同</li>
</ul>
<p><strong>函数返回值类型不可以做为函数重载的条件</strong></p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(){</span><span style="color: #6A737D"> // 两函数参数不同，实现重载</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;invoke f&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;invoke f(int &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">a</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&#39;)&#39;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">){</span><span style="color: #6A737D"> // 两函数参数类型不同，实现重载</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;invoke f(double &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">a</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&#39;)&#39;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span><span style="color: #6A737D"> // 两函数参数顺序不同，实现重载</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;invoke f(double &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">a</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;, int &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">b </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;)&#39;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">double</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span><span style="color: #6A737D"> // 两函数参数顺序不同，实现重载</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;invoke f(int &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">a</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;, double &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">b </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;)&#39;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  // 根据传入的参数执行对应函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">f</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #005CC5">10</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #005CC5">3.14</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #005CC5">10</span><span style="color: #24292E">,</span><span style="color: #005CC5">3.14</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(</span><span style="color: #005CC5">3.14</span><span style="color: #24292E">,</span><span style="color: #005CC5">10</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">invoke f</span></span>
<span class="line"><span style="color: #24292e">invoke f(int 10)</span></span>
<span class="line"><span style="color: #24292e">invoke f(double 3.14)</span></span>
<span class="line"><span style="color: #24292e">invoke f(int 10, double 3.14)</span></span>
<span class="line"><span style="color: #24292e">invoke f(double 3.14, int 10)</span></span></code></pre></div></div></figure>
<h3 id="引用作为重载条件">引用作为重载条件</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 引用作为函数重载条件</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f2</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">a</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;invoke f(int &amp;&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">a</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;)&#39;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f2</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">a</span><span style="color: #24292E">){</span><span style="color: #6A737D"> // const int 与int 类型不同</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;invoke f(const int &amp;&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">a</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;)&#39;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  // 根据传入的参数执行对应函数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">f2</span><span style="color: #24292E">(a);</span><span style="color: #6A737D"> // 调用了无const的</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">f2</span><span style="color: #24292E">(</span><span style="color: #005CC5">10</span><span style="color: #24292E">);</span><span style="color: #6A737D"> // 调用了有const的</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<ul>
<li>11行相当于实现<code>int &amp;b = a</code>，是合法的</li>
<li>但若只传值，则11行相当于<code>int &amp;a = 10</code>，
是不合法的，此时12行相当于<code>const int &amp;a = 10</code>，是合法的</li>
</ul>
<h3 id="缺省值与函数重载">缺省值与函数重载</h3>
<p>当存在缺省值，使得调用函数传入参数个数和被重载的函数的传入参数个数一样时，会出现二义性，故报错</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 函数重载与默认参数</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f3</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;invoke f3(int &amp;&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">a</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;)&#39;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f3</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;invoke f3(int &amp;&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">a</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;) with b = 10&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  //f3(10); // 会出错，出现二义性</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
      </tags>
  </entry>
  <entry>
    <title>【数学】Catalan数</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/Catalan%E6%95%B0/</url>
    <content><![CDATA[<h1 id="catalan数">Catalan数</h1>
<p>该数列经常出现在计数问题中</p>
<h2 id="特征">特征</h2>
<h3 id="递推关系">递推关系</h3>
<p><span class="math display">\[
C_n = \begin{cases}
1, &amp; n = 0, \\
\sum_{i=0}^{n-1} C_{i}C_{n-1-i}, &amp; n &gt; 0.
\end{cases}
\]</span> 前几项为<span
class="math inline">\(1,1,2,5,14,42,132,429,1430,\cdots\)</span></p>
<h3 id="常见表达式">常见表达式</h3>
<p>$C_n = = ,~ n. $</p>
<p>$ C_n = - ,~n .$</p>
<p>$ C_n = C_{n-1},~ n &gt; 0,~ C_0 = 1.$</p>
<p>前两个形式将它转换为阶乘和组合数的计算问题，第三个形式则提供了顺次计算的递推公式</p>
<h2 id="应用">应用</h2>
<p>规模为<span class="math inline">\(n\)</span>的计数问题<span
class="math inline">\(C_n\)</span>，可以通过枚举分界点，拆分为两个规模分别为<span
class="math inline">\(i\)</span>和<span
class="math inline">\((n-1-i)\)</span>的子问题</p>
<p>因此Catalan数广泛用于各类具有类似<strong>递归结构</strong>的问题中</p>
<h3 id="路径计数问题">路径计数问题</h3>
<p>有一个大小为<span class="math inline">\(n\times
n\)</span>的方格图，左下角为<span
class="math inline">\((0,0)\)</span>，右上角为<span
class="math inline">\((n,n)\)</span>，从左下角开始，每次向右或向上走一单位，不走到<span
class="math inline">\(y=x\)</span>上方（但可以触碰）的情况下，到达右上角的路径总数为<span
class="math inline">\(C_n\)</span></p>
<blockquote>
<p>总的路径数为 <span
class="math inline">\(\binom{2n}{n}\)</span>。不合法的路径恰好可以与到
<span class="math inline">\((n,n+1)\)</span>
的路径建立一一对应，从而得到不合法路径数为 <span
class="math inline">\(\binom{2n}{n+1}\)</span>，所以合法的为二者之差。</p>
</blockquote>
<h3
id="圆内不相交弦计数圆上点配对问题">圆内不相交弦计数/圆上点配对问题</h3>
<p>圆上有<span
class="math inline">\(2n\)</span>个点，将这些点成对连接起来且使得所得到的<span
class="math inline">\(n\)</span>条线段两两不相交的方案数是<span
class="math inline">\(C_n\)</span></p>
<blockquote>
<p>将点按顺序编号，考虑与编号1配对的点k，将圆分成两部分，每部分再独立配对，得到递推</p>
</blockquote>
<h3 id="多边形剖分三角计数问题">多边形剖分三角计数问题</h3>
<p>对角线不相交的情况下，将一个凸<span
class="math inline">\(n+2\)</span>边形区域分为三角形区域的方法数为<span
class="math inline">\(C_n\)</span></p>
<blockquote>
<p>固定某个顶点，把与该顶点连成三角形的另一顶点作为切点，分割成左右两个子问题，变为递推形式</p>
</blockquote>
<h3 id="二叉树计数问题">二叉树计数问题</h3>
<p>含有<span
class="math inline">\(n\)</span>个结点的形态不同的二叉树数目为<span
class="math inline">\(C_n\)</span>。等价的，含有<span
class="math inline">\(n\)</span>个非叶结点的形态不同的满二叉树数目为<span
class="math inline">\(C_n\)</span>。</p>
<p>含有<span
class="math inline">\(n\)</span>内部结点的满二叉树个数为<span
class="math inline">\(C_n\)</span></p>
<blockquote>
<p>选择某个元素作根，左子树大小为 <span
class="math inline">\(i\)</span>，右子树大小为 <span
class="math inline">\(n−1−i\)</span>，左右子树独立，乘法得到递推。</p>
</blockquote>
<h3 id="括号序列计数问题">括号序列计数问题</h3>
<p>由<span
class="math inline">\(n\)</span>对括号构成的合法括号序列数为<span
class="math inline">\(C_n\)</span>。</p>
<blockquote>
<p>可以映射为路径问题</p>
</blockquote>
<h3
id="出栈序列计数问题避免模式排列问题">出栈序列计数问题/避免模式排列问题</h3>
<p>一个栈进栈序列为<span
class="math inline">\(1,2,3,\cdots,n\)</span>，合法出栈序列数目为<span
class="math inline">\(C_n\)</span></p>
<blockquote>
<p>可以映射为括号序列问题</p>
</blockquote>
<h3 id="数列计数问题">数列计数问题</h3>
<p>由<span class="math inline">\(n\)</span>个<span
class="math inline">\(+1\)</span>与<span
class="math inline">\(n\)</span>个<span
class="math inline">\(-1\)</span>组成的数列<span
class="math inline">\(a_1,a_2, \ldots ,a_{2n}\)</span>，部分和满足<span
class="math inline">\(a_1+a_2+ \ldots +a_k \geq 0~(k=1,2,3, \ldots
,2n)\)</span>的数列数目为<span class="math inline">\(C_n\)</span></p>
<blockquote>
<p>可以映射为括号序列问题</p>
</blockquote>
<p>e.g. <a href="https://www.luogu.com.cn/problem/P1044">P1044
栈</a></p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">ll</span><span style="color: #24292E">&gt; </span><span style="color: #6F42C1">cat</span><span style="color: #24292E">(</span><span style="color: #005CC5">20</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">init</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  cat[</span><span style="color: #005CC5">0</span><span style="color: #24292E">]</span><span style="color: #D73A49">=</span><span style="color: #24292E">cat[</span><span style="color: #005CC5">1</span><span style="color: #24292E">]</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">20</span><span style="color: #24292E">;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    cat[i] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> cat[i</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">]</span><span style="color: #D73A49">*</span><span style="color: #24292E">(</span><span style="color: #005CC5">4</span><span style="color: #D73A49">*</span><span style="color: #24292E">i</span><span style="color: #D73A49">-</span><span style="color: #005CC5">2</span><span style="color: #24292E">)</span><span style="color: #D73A49">/</span><span style="color: #24292E">(i</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">solve</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> n;</span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> cat[n]</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>数学</category>
      </categories>
      <tags>
        <tag>数学</tag>
        <tag>组合数学</tag>
      </tags>
  </entry>
  <entry>
    <title>【数据结构】BFS</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/st%E8%A1%A8/</url>
    <content><![CDATA[<h1 id="st表">ST表</h1>
<blockquote>
<p>给n个数，进行m次询问，每次寻找区间[l,r]中的最大值</p>
</blockquote>
<h2 id="dp打表">DP打表</h2>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> arr[N];</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> ans[N][N];</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> n, m;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> m;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> arr[i];</span></span>
<span class="line"><span style="color: #24292E">    </span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> i;j</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">n;j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (i</span><span style="color: #D73A49">==</span><span style="color: #24292E">j) ans[i][j]</span><span style="color: #D73A49">=</span><span style="color: #24292E">arr[j];</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">else</span><span style="color: #24292E"> ans[i][j]</span><span style="color: #D73A49">=</span><span style="color: #6F42C1">max</span><span style="color: #24292E">(ans[i][j</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">],arr[j]);</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> l,r;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E">(m</span><span style="color: #D73A49">--</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> l </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> r;</span></span>
<span class="line"><span style="color: #24292E">        cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> ans[l][r]</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&#39; &#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>时间复杂度：<span class="math inline">\(O(n^2+m)\)</span></p>
<p>这种打表方式会很紧凑，用到了许多不用的空间</p>
<h2 id="st表-1">ST表</h2>
<p>基于动态规划与倍增思想，是一种更稀疏的表</p>
<h3 id="定义">定义</h3>
<p><code>dp[i][j]</code>为一个从<span
class="math inline">\(i\)</span>开始，长度为<span
class="math inline">\(2^j\)</span>的区间最值</p>
<h3 id="询问">询问</h3>
<p>e.g.询问[0,5]</p>
<p>使用<code>max(dp[0][2],dp[4][1])</code>，即询问区间从0开始，长度为<span
class="math inline">\(2^2=4\)</span>，即[0,3]，与区间从4开始，长度为<span
class="math inline">\(2^1=2\)</span>即[4,5]两个区间中的max值</p>
<p>e.g.询问[0,13]</p>
<p>使用<code>max(dp[0][3],dp[8][2]),dp[12][1])</code>即询问区间[0,7],[8,11],[12,13]三个区间中的max值</p>
<p>对于任意区间都可以分解为若干个小区间求max值</p>
<p>因为根据二进制，任意一个整数都可以分解为若干个2的n次幂的和</p>
<p>因此我们可以将任意区间划分为n个长度为<span
class="math inline">\(\log_2len\)</span>不相交的区间并多次求max</p>
<p>若区间发生重叠，我们可以取重叠区间的max</p>
<p>因此询问步骤如下</p>
<ol type="1">
<li>求出区间长度<span class="math inline">\(len=r-l+1\)</span></li>
<li>计算dp数组中的<span class="math inline">\(j=\lfloor
\log_2len\rfloor\)</span></li>
<li>计算最值<span
class="math inline">\(ans=max(dp[l][j],dp[r-2^j-1][j])\)</span></li>
</ol>
<h3 id="预处理">预处理</h3>
<p>将一个区间分成两半，则每一半的长度均为<span
class="math inline">\(2^{j-1}\)</span>，后半第一个元素下标即为<span
class="math inline">\(i+2^{j-1}\)</span></p>
<ol type="1">
<li>处理第一个<span class="math inline">\(dp[i][0]=arr[i]\)</span></li>
<li>处理后面的<span
class="math inline">\(dp[i][j]=max(dp[i][j-1],dp[i+2^{i-1}][j-1])\)</span></li>
</ol>
<p>时间复杂度：<span class="math inline">\(O(n\log n)\)</span></p>
<p><strong>注意：st表是一个静态表，适用于离线处理</strong></p>
<h2 id="板子">板子</h2>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits\stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">vector</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">vector</span><span style="color: #D73A49">&lt;int&gt;&gt;</span><span style="color: #24292E"> dp;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">query</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">l</span><span style="color: #24292E">,</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">r</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E">)</span><span style="color: #6F42C1">log2</span><span style="color: #24292E">(r</span><span style="color: #D73A49">-</span><span style="color: #24292E">l</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">max</span><span style="color: #24292E">(dp[l][j],dp[r</span><span style="color: #D73A49">-</span><span style="color: #24292E">(</span><span style="color: #005CC5">1</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">j)</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">][j]);</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> arr </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span><span style="color: #005CC5">9</span><span style="color: #24292E">,</span><span style="color: #005CC5">3</span><span style="color: #24292E">,</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">7</span><span style="color: #24292E">,</span><span style="color: #005CC5">5</span><span style="color: #24292E">,</span><span style="color: #005CC5">6</span><span style="color: #24292E">,</span><span style="color: #005CC5">0</span><span style="color: #24292E">,</span><span style="color: #005CC5">8</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">8</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  // 预处理</span></span>
<span class="line"><span style="color: #24292E">  dp </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt;&gt; (N,</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt;((</span><span style="color: #D73A49">int</span><span style="color: #24292E">)</span><span style="color: #6F42C1">log2</span><span style="color: #24292E">(N)</span><span style="color: #D73A49">+</span><span style="color: #005CC5">5</span><span style="color: #24292E">,</span><span style="color: #005CC5">0</span><span style="color: #24292E">));</span><span style="color: #6A737D"> // 初始化dp数组</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> N;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) dp[i][</span><span style="color: #005CC5">0</span><span style="color: #24292E">]</span><span style="color: #D73A49">=</span><span style="color: #24292E">arr[i];</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j</span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;j</span><span style="color: #D73A49">&lt;=</span><span style="color: #6F42C1">log2</span><span style="color: #24292E">(N);j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i</span><span style="color: #D73A49">+</span><span style="color: #24292E">(</span><span style="color: #005CC5">1</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">j)</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">N;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      dp[i][j]</span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">max</span><span style="color: #24292E">(dp[i][j</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">], dp[i</span><span style="color: #D73A49">+</span><span style="color: #24292E">(</span><span style="color: #005CC5">1</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">(j</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">))][j</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">]);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  // 询问</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> l, r;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">(cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> l </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> r){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">query</span><span style="color: #24292E">(l,r) </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>时间复杂度：<span class="math inline">\(O(n\log n+m)\)</span></p>
]]></content>
      <categories>
        <category>算法与数据结构</category>
      </categories>
      <tags>
        <tag>数据结构</tag>
      </tags>
  </entry>
  <entry>
    <title>【数学】位运算的骚操作</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E4%BD%8D%E8%BF%90%E7%AE%97%E7%9A%84%E5%B0%8F%E6%93%8D%E4%BD%9C/</url>
    <content><![CDATA[<h1 id="位运算的骚操作">位运算的骚操作</h1>
<h2 id="异或">异或</h2>
<h3 id="性质">性质</h3>
<ul>
<li><p>异或的本质是无进位相加</p></li>
<li><p>异或满足交换结合律</p></li>
<li><p>异或的自反性：<span class="math inline">\(a\oplus b\oplus b =
a\)</span></p></li>
<li><p>与0相关</p>
<ul>
<li><p>任何数与0异或结果为原数：<span class="math inline">\(0 \oplus
n=n\)</span></p></li>
<li><p>任何数和自己异或结果为0：<span class="math inline">\(n\oplus
n=0\)</span></p></li>
<li><p>整体异或和如果是x，整体中某个部分的异或和如果是y，那么剩下部分的异或和为x^y:</p>
<p>即<span class="math inline">\(a\oplus b=c \Rightarrow a=c\oplus b,
b=c \oplus a\)</span></p></li>
</ul></li>
</ul>
<h3 id="应用">应用</h3>
<p><strong>交换两个数的值：</strong></p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 交换两个数的值</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a</span><span style="color: #D73A49">^</span><span style="color: #24292E">b;</span></span>
<span class="line"><span style="color: #24292E">b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a</span><span style="color: #D73A49">^</span><span style="color: #24292E">b;</span></span>
<span class="line"><span style="color: #24292E">a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a</span><span style="color: #D73A49">^</span><span style="color: #24292E">b;</span></span>
<span class="line"><span style="color: #24292E">cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> a </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot; &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> b </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span></code></pre></div></div></figure>
<p><strong>应满足a要与b有不同的内存空间</strong></p>
<p><strong>返回两个数的最大值：</strong></p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 反转1与0</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">flip</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">n</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> (n</span><span style="color: #D73A49">^</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6A737D">// 获取二进制符号位，非负数返回1，负数返回0</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">sign</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">n</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">flip</span><span style="color: #24292E">(n</span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #005CC5">31</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6A737D">// 返回两个数的最大值</span></span>
<span class="line"><span style="color: #24292E">  a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> c </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a</span><span style="color: #D73A49">-</span><span style="color: #24292E">b;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> sa </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">sign</span><span style="color: #24292E">(a);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> sb </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">sign</span><span style="color: #24292E">(b);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> sc </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">sign</span><span style="color: #24292E">(c);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> diff </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (sa</span><span style="color: #D73A49">^</span><span style="color: #24292E">sb);</span><span style="color: #6A737D"> // 判断a与b符号是否不同，不同为1</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> same </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">flip</span><span style="color: #24292E">(diff);</span><span style="color: #6A737D"> // 判断a与b符号是否相同，相同为1</span></span>
<span class="line"><span style="color: #6A737D">  // return a的条件：ab符号不同且a非负，ab符号相同且c非负</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> returna </span><span style="color: #D73A49">=</span><span style="color: #24292E"> diff</span><span style="color: #D73A49">*</span><span style="color: #24292E">sa</span><span style="color: #D73A49">+</span><span style="color: #24292E">same</span><span style="color: #D73A49">*</span><span style="color: #24292E">sc;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> returnb </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">flip</span><span style="color: #24292E">(returna);</span></span>
<span class="line"><span style="color: #24292E">  cout</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">a</span><span style="color: #D73A49">*</span><span style="color: #24292E">returna</span><span style="color: #D73A49">+</span><span style="color: #24292E">b</span><span style="color: #D73A49">*</span><span style="color: #24292E">returnb</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span></code></pre></div></div></figure>
<p><strong>找到缺失的数字：</strong></p>
<p>将不缺时的所有数字异或和与缺时的所有数字异或和求异或，得到的即为缺失的数字</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 找到缺失的数字</span></span>
<span class="line"><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> all </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> has </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> nums[]</span><span style="color: #D73A49">=</span><span style="color: #24292E">{</span><span style="color: #005CC5">0</span><span style="color: #24292E">,</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">2</span><span style="color: #24292E">,</span><span style="color: #005CC5">3</span><span style="color: #24292E">,</span><span style="color: #005CC5">4</span><span style="color: #24292E">,</span><span style="color: #005CC5">5</span><span style="color: #24292E">,</span><span style="color: #005CC5">6</span><span style="color: #24292E">,</span><span style="color: #005CC5">7</span><span style="color: #24292E">,</span><span style="color: #005CC5">8</span><span style="color: #24292E">,</span><span style="color: #005CC5">0</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> length </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E"> </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">length;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">   all </span><span style="color: #D73A49">^=</span><span style="color: #24292E">i;</span></span>
<span class="line"><span style="color: #24292E">   has </span><span style="color: #D73A49">^=</span><span style="color: #24292E">nums[i];</span></span>
<span class="line"><span style="color: #24292E"> }</span></span>
<span class="line"><span style="color: #24292E"> cout</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> (all</span><span style="color: #D73A49">^</span><span style="color: #24292E">has) </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span></code></pre></div></div></figure>
<p><strong>找唯一出现奇数次的数：</strong></p>
<p>使用eor变量存储异或，将所有数异或入eor，最后eor即为唯一出现奇数次的数</p>
<p>因为<span class="math inline">\(n\oplus n=0\)</span></p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 找唯一出现奇数次的数：</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> eor </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> num2[]</span><span style="color: #D73A49">=</span><span style="color: #24292E">{</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">2</span><span style="color: #24292E">,</span><span style="color: #005CC5">2</span><span style="color: #24292E">,</span><span style="color: #005CC5">3</span><span style="color: #24292E">,</span><span style="color: #005CC5">3</span><span style="color: #24292E">,</span><span style="color: #005CC5">3</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">7</span><span style="color: #24292E">;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  eor</span><span style="color: #D73A49">^=</span><span style="color: #24292E">num2[i];</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #24292E">cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> eor</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span></code></pre></div></div></figure>
<p><strong>找唯二出现奇数次的数：</strong></p>
<p>若a与b出现了奇数次，我们计算数组中所有数的异或（此时出现偶数次的数都变成了0），用eor1记录，并取结果的lowbit</p>
<p>取eor2变量，只对数组中上面求出位置不为1的数求异或</p>
<p>则此时a与b根据该位置是否为1分到了eor1与eor2两个部分</p>
<p>故eor2为其中一个，eor1^eor2为另一个</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 找唯二出现奇数次的数：</span></span>
<span class="line"><span style="color: #24292E">vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> nums;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> eor1 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">auto</span><span style="color: #24292E"> num:nums){</span></span>
<span class="line"><span style="color: #24292E">  eor1 </span><span style="color: #D73A49">^=</span><span style="color: #24292E">num;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> right </span><span style="color: #D73A49">=</span><span style="color: #24292E"> eor1</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">(</span><span style="color: #D73A49">-</span><span style="color: #24292E">eor1);</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> eor2 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">auto</span><span style="color: #24292E"> num:nums){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E">((num</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">right)</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">)eor2</span><span style="color: #D73A49">^</span><span style="color: #24292E">num;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #24292E">cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> eor2 </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&#39; &#39;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">(eor1</span><span style="color: #D73A49">^</span><span style="color: #24292E">eor2);</span></span></code></pre></div></div></figure>
<p><strong>找唯一出现次数小于m次的数：</strong></p>
<p>若有一个数不够m次，则二进制每一位的1的数量不为m的整数倍</p>
<p>求出每位模完的余数，若余数为0则在该位为0，否则为1</p>
<p>记录可以使用一个长32的数组</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 找唯一出现小于m次的数</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> arr[]</span><span style="color: #D73A49">=</span><span style="color: #24292E">{</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">2</span><span style="color: #24292E">,</span><span style="color: #005CC5">2</span><span style="color: #24292E">,</span><span style="color: #005CC5">3</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> cnts[</span><span style="color: #005CC5">32</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> m </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">5</span><span style="color: #24292E">;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; j</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">32</span><span style="color: #24292E">;j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    cnts[j]</span><span style="color: #D73A49">+=</span><span style="color: #24292E"> (i</span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E">j)</span><span style="color: #D73A49">&amp;</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> ans </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">32</span><span style="color: #24292E">;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (cnts[i]</span><span style="color: #D73A49">%</span><span style="color: #24292E">m</span><span style="color: #D73A49">!=</span><span style="color: #005CC5">0</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    ans</span><span style="color: #D73A49">|=</span><span style="color: #005CC5">1</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">i;</span><span style="color: #6A737D"> // 将1左移i为并或到结果中</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #24292E">cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> ans</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span></code></pre></div></div></figure>
<h2 id="判断整数是不是2的幂">判断整数是不是2的幂</h2>
<p>2的幂次的二进制只有一个1</p>
<p>我们用lowbit取出二进制最右侧的1，此时若与n相等，则n为2的幂</p>
<p>即满足<code>n&gt;0&amp;&amp;n==(n&amp;-n)</code>或<code>n&gt;0&amp;&amp;(x&amp;(x-1))==0</code>即为2的幂</p>
<h2 id="判断整数是不是3的幂">判断整数是不是3的幂</h2>
<p>如果某个数字是3的幂次，则该数一定含有3这个质数因子</p>
<p><strong>1162261467</strong>是int类型范围内最大的3的幂(<span
class="math inline">\(3^{19}\)</span>)</p>
<p>该数只含有3这个质数因子，若n也只含有3这个质数因子，则让该数被上面的数模，若为0则是3的某次幂</p>
<p>即满足<code>return (n&gt;0 &amp;&amp; 1162261467%n==0)</code></p>
<h2 id="返回大于等于n的最小的2的幂">返回大于等于n的最小的2的幂</h2>
<p>n&lt;=0时，结果均为1</p>
<p>n&gt;0时，让n–，让最左边的1右移一位（避免n刚好是2的幂的情况）</p>
<p>然后将后面的0通过右移与或运算全部刷为1（n为2的幂的时候，右边已经变为全1），得到的结果+1即为结果</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">nearsquare</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">n</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (n</span><span style="color: #D73A49">&lt;=</span><span style="color: #005CC5">0</span><span style="color: #24292E">) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  n</span><span style="color: #D73A49">--</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  n</span><span style="color: #D73A49">|=</span><span style="color: #24292E">n</span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  n</span><span style="color: #D73A49">|=</span><span style="color: #24292E">n</span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #005CC5">2</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  n</span><span style="color: #D73A49">|=</span><span style="color: #24292E">n</span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #005CC5">4</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  n</span><span style="color: #D73A49">|=</span><span style="color: #24292E">n</span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #005CC5">8</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  n</span><span style="color: #D73A49">|=</span><span style="color: #24292E">n</span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #005CC5">16</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> n</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="求区间所有数的与">求区间所有数的与</h2>
<p>每次减掉right的二进制最右侧的1，如果仍大于left，证明最右侧仍存在不能留下的1</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">alland</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">l</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">r</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">(r</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">l){</span></span>
<span class="line"><span style="color: #24292E">    r</span><span style="color: #D73A49">-=</span><span style="color: #24292E">(r</span><span style="color: #D73A49">&amp;-</span><span style="color: #24292E">r);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> r;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="逆序二进制的状态">逆序二进制的状态</h2>
<p>首先每两位内部互相交换，然后交换后的每四位内部两位两位的交换，依次类推</p>
<p>如：</p>
<p>abcdefgh -&gt; ba dc fe hg</p>
<p>ba dc fe hg -&gt; dc ba hg fe</p>
<p>dc ba hg fe -&gt; hg fe dc ba</p>
<p>故我们可以采取如下逻辑进行交换：</p>
<p>abcdefgh与10101010(aa)或运算，得到a0c0e0g0</p>
<p>abcdefgh与01010101(55)或运算，得到0b0d0f0h</p>
<p>然后将a0c0e0g0右移一位得到0a0c0e0g，0b0d0f0h左移一位得到b0d0f0h0</p>
<p>两者进行或运算，得到badcfehg</p>
<p>同理，第二次用11001100(cc)，00110011(33)进行运算，左移右移两位，再进行或运算</p>
<p>第三次用 11110000(f0)，00001111(0f
)进行运算，左移右移四位，再进行或运算</p>
<p>第四次用1111111100000000(ff00)，0000000011111111(00ff)进行运算，左移右移八位，再进行或运算</p>
]]></content>
      <categories>
        <category>数学</category>
      </categories>
      <tags>
        <tag>数学</tag>
        <tag>位运算</tag>
      </tags>
  </entry>
  <entry>
    <title>【算法】DFS</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/DFS/</url>
    <content><![CDATA[<h1 id="dfs">DFS</h1>
<blockquote>
<p><a
href="https://www.bilibili.com/video/BV1hH4y1L7yz/?share_source=copy_web&amp;vd_source=d51bc147506d4e930a5fca5c791cb3d8">参考视频</a></p>
</blockquote>
<h2 id="前置知识二叉树的遍历">前置知识：二叉树的遍历</h2>
<h3 id="三种遍历">三种遍历</h3>
<ol type="1">
<li>先根遍历（根左右）</li>
<li>中根遍历（左根右）</li>
<li>后根遍历（左右根）</li>
</ol>
<p><strong>注意：这里的左右为左右子树</strong></p>
<p>e.g.</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/DFS/image-20241110095017456.png" class="" title="树的遍历">
<pre><code>1. 先根遍历：271653894
1. 中根遍历：175632849
1. 后根遍历：153674982</code></pre>
<h3 id="二叉树的确定">二叉树的确定</h3>
<ol type="1">
<li><p>给定先根和中根、中根和后根遍历结果，可以唯一确定二叉树</p>
<p>e.g. 上面，在先根中确定2为根，在中根中找到2，则2前后分别为其左右子树；再在先根中找到7，在中根中找到7，则7前后为其左右子树，以此类推。中根后根与前根后根是对称的。</p></li>
<li><p>给定先根和后根遍历结果，不能唯一确定二叉树</p>
<p>只知道根数量而不知道左右子树数量</p></li>
</ol>
<h2 id="递归">递归</h2>
<p>递归特征：大问题与子问题除了规模其他都一样</p>
<blockquote>
<p>斐波那契数列的递归实现</p>
</blockquote>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fi</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (a</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #D73A49">||</span><span style="color: #24292E">a</span><span style="color: #D73A49">==</span><span style="color: #005CC5">1</span><span style="color: #24292E">) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fi</span><span style="color: #24292E">(a</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">)</span><span style="color: #D73A49">+</span><span style="color: #6F42C1">fi</span><span style="color: #24292E">(a</span><span style="color: #D73A49">-</span><span style="color: #005CC5">2</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>即有一个特定模板：</p>
<p><strong>即先写程序出口（不需要递归的特殊情况），再写普通情况（递归）</strong></p>
<h2 id="全排列问题">全排列问题</h2>
<blockquote>
<p>输入一个正整数n，按字典序输出n-1的全排列</p>
</blockquote>
<h3 id="递归特征">递归特征</h3>
<ul>
<li>若第一个数确定，剩余的问题就是其余n-1个数的全排列</li>
<li>若前k个数已经排好，剩余问题就是其余n-k个数的全排列</li>
</ul>
<h3 id="代码实现">代码实现</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> n;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> num[</span><span style="color: #005CC5">10</span><span style="color: #24292E">], vis[</span><span style="color: #005CC5">10</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">dfs</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">step</span><span style="color: #24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E"> (</span><span style="color: #6F42C1">scanf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">%d</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">n)</span><span style="color: #D73A49">==</span><span style="color: #005CC5">1</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">memset</span><span style="color: #24292E">(vis,</span><span style="color: #005CC5">0</span><span style="color: #24292E">,sizeof vis);</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">dfs</span><span style="color: #24292E">(</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span><span style="color: #6A737D"> // 从第一位开始处理</span></span>
<span class="line"><span style="color: #24292E">        </span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">dfs</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">step</span><span style="color: #24292E">){</span><span style="color: #6A737D">  // 接下来准备处理第step位</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (step</span><span style="color: #D73A49">==</span><span style="color: #24292E">n</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">){</span><span style="color: #6A737D">  // 前n位都放好了，进行输出</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">; i </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">%d</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">, num[i]);</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E"> n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (vis[i]</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">){</span><span style="color: #6A737D">  // 第i位数没用过</span></span>
<span class="line"><span style="color: #24292E">            num[step]</span><span style="color: #D73A49">=</span><span style="color: #24292E">i;</span><span style="color: #6A737D">  // nun中当前这一位保存一个i</span></span>
<span class="line"><span style="color: #24292E">            vis[i]</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span><span style="color: #6A737D">  // i被用过了，做标记1</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #6F42C1">dfs</span><span style="color: #24292E">(step</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">); </span></span>
<span class="line"><span style="color: #24292E">            vis[i]</span><span style="color: #D73A49">=</span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>若n==3：</p>
<p>vis：0 0 0 0 step==1</p>
<p>​ 进入for循环: vis[1]==0</p>
<p>​ 使num[1]=1 vis[1] = 1</p>
<p>​ num： 0 1 0 0 0</p>
<p>​ vis：0 1 0 0 表示1用过了</p>
<p>vis： 0 1 0 0 step==2</p>
<p>​ 进入for循环: vis[2]==0</p>
<p>​ num[2]=2 vis[2] = 1</p>
<p>​ num： 0 1 2 0 0</p>
<p>​ vis：0 1 1 0 表示1,2用过了</p>
<p>vis：0 1 1 0 step==3</p>
<p>​ 进入for循环: vis[3]==0</p>
<p>​ num[3]=3 vis[3] = 1</p>
<p>​ num： 0 1 2 3 0</p>
<p>​ vis：0 1 1 1 表示1,2,3用过了</p>
<p>vis：0 1 1 1 step==4</p>
<p>​ step == 3+1成立，到达边界，则输出num[1]到num[n] 123</p>
<p>​ return 到dfs(3)中（<strong>谁调用的返回谁</strong>）</p>
<p>dfs(3)：vis[3]=0 vis：0 1 1 0 程序结束返回dfs(2)</p>
<p>dfs(2)：vis[2]=0 vis：0 1 0 0</p>
<p>​ 此时进行下一次循环 i==3，vis[3]==0</p>
<p>​ num[2]=3,vis[3]=1</p>
<p>​ num： 0 1 3 0</p>
<p>​ vis：0 1 0 1 表示1,3用过了</p>
<p>​ 再进入dfs(3)，重复上述操作后</p>
<p>​ num：0 1 3 2</p>
<p>​ vis：0 1 1 1</p>
<p>​ 进入dfs(4)到达边界输出 132</p>
<p>​ return 到dfs(3)中重复上述过程</p>
<p><strong>若没有vis[i]=0的回溯，则第一遍return后vis仍保持全标记1状态，则无法再输出其他排列直接结束</strong></p>
<h2 id="基本模型">基本模型</h2>
<p>关键在于<strong>着眼于当下如何做</strong>，下一步的做法与当前一样，只是参数不同</p>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">void dfs(int step){</span></span>
<span class="line"><span style="color: #24292e">特殊情况处理(结束递归情况)</span></span>
<span class="line"><span style="color: #24292e">枚举当前每一种可能for(int i=1;i&lt;=;i++)</span></span>
<span class="line"><span style="color: #24292e">	在枚举的每一种可能中，递归dfs(step+1);</span></span>
<span class="line"><span style="color: #24292e">	回溯</span></span>
<span class="line"><span style="color: #24292e">}</span></span></code></pre></div></div></figure>
<h2 id="例迷宫搜索">例：迷宫搜索</h2>
<blockquote>
<h3 id="tempter-of-the-bone">Tempter of the Bone</h3>
<p>Problem Description</p>
<p>The doggie found a bone in an ancient maze, which fascinated him a
lot. However, when he picked it up, the maze began to shake, and the
doggie could feel the ground sinking. He realized that the bone was a
trap, and he tried desperately to get out of this maze.</p>
<p>The maze was a rectangle with sizes N by M. There was a door in the
maze. At the beginning, the door was closed and it would open at the
T-th second for a short period of time (less than 1 second). Therefore
the doggie had to arrive at the door on exactly the T-th second. In
every second, he could move one block to one of the upper, lower, left
and right neighboring blocks. Once he entered a block, the ground of
this block would start to sink and disappear in the next second. He
could not stay at one block for more than one second, nor could he move
into a visited block. Can the poor doggie survive? Please help him.</p>
<p>Input</p>
<p>The input consists of multiple test cases. The first line of each
test case contains three integers N, M, and T (1 &lt; N, M &lt; 7; 0
&lt; T &lt; 50), which denote the sizes of the maze and the time at
which the door will open, respectively. The next N lines give the maze
layout, with each line containing M characters. A character is one of
the following:</p>
<p>‘X’: a block of wall, which the doggie cannot enter; ‘S’: the start
point of the doggie; ‘D’: the Door; or ‘.’: an empty block.</p>
<p>The input is terminated with three 0’s. This test case is not to be
processed.</p>
<p>Output</p>
<p>For each test case, print in one line “YES” if the doggie can
survive, or “NO” otherwise.</p>
<p>Sample Input</p>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">4 4 5</span></span>
<span class="line"><span style="color: #24292e">S.X.</span></span>
<span class="line"><span style="color: #24292e">..X.</span></span>
<span class="line"><span style="color: #24292e">..XD</span></span>
<span class="line"><span style="color: #24292e">....</span></span>
<span class="line"><span style="color: #24292e">3 4 5</span></span>
<span class="line"><span style="color: #24292e">S.X.</span></span>
<span class="line"><span style="color: #24292e">..X.</span></span>
<span class="line"><span style="color: #24292e">...D</span></span>
<span class="line"><span style="color: #24292e">0 0 0</span></span></code></pre></div></div></figure>
<p>Sample Output</p>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">NO</span></span>
<span class="line"><span style="color: #24292e">YES</span></span></code></pre></div></div></figure>
</blockquote>
<p>分析：</p>
<ul>
<li><p>每个block只能走一次</p></li>
<li><p>恰好给定时间到达出口</p></li>
<li><p>剪枝条件：</p>
<ul>
<li><p>若可走的block总数小于时间：全走完都开不了门，肯定NO</p></li>
<li><p>若起点在左上角，门在右下角，没有障碍物且最短路径（曼哈顿距离：行坐标差减列坐标差）都比时间长，肯定NO</p></li>
<li><p><strong>奇偶性剪枝</strong>（应用条件：每个格子只能等一秒）：</p>
<p>使行列坐标相加为偶数的标为0，为奇数的标为1，发现1的下一步一定为0，0的下一步一定为1</p>
<p>那么<strong>如果从0走到1或从1走到0，所需时间为奇数；如果从1走到1或从0走到0，所需时间为偶数</strong></p>
<p>那么如果规定时间为偶数，则从0到1或从1到0肯定NO，反之亦然。</p></li>
</ul></li>
</ul>
<h3 id="代码">代码</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;algorithm&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;string&gt;</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ios</span><span style="color: #24292E"> ios::sync_with_stdio(0); cin.tie(0);</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">endl</span><span style="color: #24292E"> &#39;\n&#39;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">char</span><span style="color: #24292E"> mmap[</span><span style="color: #005CC5">9</span><span style="color: #24292E">][</span><span style="color: #005CC5">9</span><span style="color: #24292E">];</span><span style="color: #6A737D">  // 存储地图 注意地图要比数据范围大一点</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> n,m,t,escape;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> si,sj,di,dj;</span><span style="color: #6A737D">  // 记录起始与结束点坐标</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> dir[</span><span style="color: #005CC5">4</span><span style="color: #24292E">][</span><span style="color: #005CC5">2</span><span style="color: #24292E">]</span><span style="color: #D73A49">=</span><span style="color: #24292E">{{</span><span style="color: #005CC5">0</span><span style="color: #24292E">,</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">},{</span><span style="color: #005CC5">0</span><span style="color: #24292E">,</span><span style="color: #005CC5">1</span><span style="color: #24292E">},{</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">0</span><span style="color: #24292E">},{</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">0</span><span style="color: #24292E">}};</span><span style="color: #6A737D">  // 进行上下左右四个方向的行走</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">dfs</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">y</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">cnt</span><span style="color: #24292E">){</span><span style="color: #6A737D">  // 行列坐标，已经花的时间</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (x</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">n</span><span style="color: #D73A49">||</span><span style="color: #24292E">y</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">m</span><span style="color: #D73A49">||</span><span style="color: #24292E">x</span><span style="color: #D73A49">&lt;=</span><span style="color: #005CC5">0</span><span style="color: #D73A49">||</span><span style="color: #24292E">y</span><span style="color: #D73A49">&lt;=</span><span style="color: #005CC5">0</span><span style="color: #24292E">) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ;</span><span style="color: #6A737D">  // 越过边界，跳过</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (cnt</span><span style="color: #D73A49">==</span><span style="color: #24292E">t</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E">x</span><span style="color: #D73A49">==</span><span style="color: #24292E">di</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E">y</span><span style="color: #D73A49">==</span><span style="color: #24292E">dj) {</span><span style="color: #6A737D">  // 在开门时间到达出口</span></span>
<span class="line"><span style="color: #24292E">    escape</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span><span style="color: #6A737D">  // 标记逃离成功</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (escape) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ;</span></span>
<span class="line"><span style="color: #6A737D">  // t-cnt:剩余时间 两abs:剩余距离</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> tmp</span><span style="color: #D73A49">=</span><span style="color: #24292E">((t</span><span style="color: #D73A49">-</span><span style="color: #24292E">cnt)</span><span style="color: #D73A49">-</span><span style="color: #6F42C1">abs</span><span style="color: #24292E">(di</span><span style="color: #D73A49">-</span><span style="color: #24292E">x)</span><span style="color: #D73A49">-</span><span style="color: #6F42C1">abs</span><span style="color: #24292E">(dj</span><span style="color: #D73A49">-</span><span style="color: #24292E">y));</span></span>
<span class="line"><span style="color: #6A737D">  // 小于零：剩余时间内走不到终点</span></span>
<span class="line"><span style="color: #6A737D">  /* 是奇数：为了到达门口，剩余时间与剩余距离的奇偶性一定要相同</span></span>
<span class="line"><span style="color: #6A737D">  奇数-奇数=偶数   偶数-偶数=偶数</span></span>
<span class="line"><span style="color: #6A737D">  故tmp一定要是偶数才能保证走到门口，否则包走不到</span></span>
<span class="line"><span style="color: #6A737D">  即奇偶性剪枝</span></span>
<span class="line"><span style="color: #6A737D">  */</span></span>
<span class="line"><span style="color: #6A737D"> // 该奇偶性剪枝可以在主函数里写，因为时间和距离是同步进行的</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (tmp</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">0</span><span style="color: #24292E">) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ;</span></span>
<span class="line"><span style="color: #6A737D">  // 四个方向遍历</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E"> ;i </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">4</span><span style="color: #24292E">;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (mmap[x</span><span style="color: #D73A49">+</span><span style="color: #24292E">dir[i][</span><span style="color: #005CC5">0</span><span style="color: #24292E">]][y</span><span style="color: #D73A49">+</span><span style="color: #24292E">dir[i][</span><span style="color: #005CC5">1</span><span style="color: #24292E">]]</span><span style="color: #D73A49">!=</span><span style="color: #032F62">&#39;X&#39;</span><span style="color: #24292E">){</span><span style="color: #6A737D">  // 不是障碍物</span></span>
<span class="line"><span style="color: #24292E">      mmap[x</span><span style="color: #D73A49">+</span><span style="color: #24292E">dir[i][</span><span style="color: #005CC5">0</span><span style="color: #24292E">]][y</span><span style="color: #D73A49">+</span><span style="color: #24292E">dir[i][</span><span style="color: #005CC5">1</span><span style="color: #24292E">]]</span><span style="color: #D73A49">=</span><span style="color: #032F62">&#39;X&#39;</span><span style="color: #24292E">;</span><span style="color: #6A737D">  //修改</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">dfs</span><span style="color: #24292E">(x</span><span style="color: #D73A49">+</span><span style="color: #24292E">dir[i][</span><span style="color: #005CC5">0</span><span style="color: #24292E">],y</span><span style="color: #D73A49">+</span><span style="color: #24292E">dir[i][</span><span style="color: #005CC5">1</span><span style="color: #24292E">],cnt</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span><span style="color: #6A737D">  //递归</span></span>
<span class="line"><span style="color: #24292E">      mmap[x</span><span style="color: #D73A49">+</span><span style="color: #24292E">dir[i][</span><span style="color: #005CC5">0</span><span style="color: #24292E">]][y</span><span style="color: #D73A49">+</span><span style="color: #24292E">dir[i][</span><span style="color: #005CC5">1</span><span style="color: #24292E">]]</span><span style="color: #D73A49">=</span><span style="color: #032F62">&#39;.&#39;</span><span style="color: #24292E">;</span><span style="color: #6A737D">  //回溯，这样可以回到上一步换一条路走</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">(cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> m </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E">t){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (n</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E">m</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E">t</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">) </span><span style="color: #D73A49">break</span><span style="color: #24292E">;</span><span style="color: #6A737D">  // 结束条件</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> block </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span><span style="color: #6A737D">  // 障碍物数量：用来剪枝</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">; j</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">m;j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> mmap[i][j];</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (mmap[i][j]</span><span style="color: #D73A49">==</span><span style="color: #032F62">&#39;S&#39;</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">          si</span><span style="color: #D73A49">=</span><span style="color: #24292E">i;</span></span>
<span class="line"><span style="color: #24292E">          sj</span><span style="color: #D73A49">=</span><span style="color: #24292E">j;</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (mmap[i][j]</span><span style="color: #D73A49">==</span><span style="color: #032F62">&#39;D&#39;</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">          di</span><span style="color: #D73A49">=</span><span style="color: #24292E">i;</span></span>
<span class="line"><span style="color: #24292E">          dj</span><span style="color: #D73A49">=</span><span style="color: #24292E">j;</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (mmap[i][j]</span><span style="color: #D73A49">==</span><span style="color: #032F62">&#39;X&#39;</span><span style="color: #24292E">) block</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #6A737D">    // 剪枝1：迷宫格子数量减去障碍物数量小于等于开门时间，一定出不去</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (n</span><span style="color: #D73A49">*</span><span style="color: #24292E">m</span><span style="color: #D73A49">-</span><span style="color: #24292E">block</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">t) {</span></span>
<span class="line"><span style="color: #24292E">      cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;NO&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">continue</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #6A737D">    // 剪枝2：见dfs里的解释</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> ((t</span><span style="color: #D73A49">-</span><span style="color: #24292E">(</span><span style="color: #6F42C1">abs</span><span style="color: #24292E">(di</span><span style="color: #D73A49">-</span><span style="color: #24292E">si)</span><span style="color: #D73A49">+</span><span style="color: #6F42C1">abs</span><span style="color: #24292E">(dj</span><span style="color: #D73A49">-</span><span style="color: #24292E">sj)))</span><span style="color: #D73A49">%</span><span style="color: #005CC5">2</span><span style="color: #D73A49">==</span><span style="color: #005CC5">1</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;NO&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">continue</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #6A737D">    // escape标记是否成功，把起点标为障碍物，确保不会再回来</span></span>
<span class="line"><span style="color: #24292E">    escape </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">, mmap[si][sj]</span><span style="color: #D73A49">=</span><span style="color: #032F62">&#39;X&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">dfs</span><span style="color: #24292E">(si,sj,</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #6A737D">    // 判断是否能逃离</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (escape) cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;YES&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E"> cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;NO&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>算法与数据结构</category>
      </categories>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>【算法】KMP</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/KMP/</url>
    <content><![CDATA[<h1 id="kmp">KMP</h1>
<blockquote>
<p>给予主串S与模式串P，寻找模式串在主串中是否出现过以及出现位置</p>
</blockquote>
<h2 id="匹配过程">匹配过程</h2>
<p>设主串S：abcxabcdabxabcdabcdabcy，模式串P：abcdabcy</p>
<h3 id="构建next数组">构建Next数组</h3>
<p>针对模式串P，我们有一个Next数组，Next[i]指P[0…i]的最长公共前后缀的长度</p>
<p>如例子中P的Next数组为0 0 0 0 1 2 3 0 ，如下表</p>
<table>
<colgroup>
<col style="width: 21%" />
<col style="width: 4%" />
<col style="width: 4%" />
<col style="width: 4%" />
<col style="width: 4%" />
<col style="width: 15%" />
<col style="width: 16%" />
<col style="width: 17%" />
<col style="width: 9%" />
</colgroup>
<thead>
<tr>
<th>下标</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>字符串</strong></td>
<td>a</td>
<td>b</td>
<td>c</td>
<td>d</td>
<td>a</td>
<td>b</td>
<td>c</td>
<td>y</td>
</tr>
<tr>
<td><strong>前后缀</strong></td>
<td>a</td>
<td>ab</td>
<td>abc</td>
<td>abcd</td>
<td><strong>a</strong>bcd<strong>a</strong></td>
<td><strong>ab</strong>cd<strong>ab</strong></td>
<td><strong>abc</strong>d<strong>abc</strong></td>
<td>abcdabcy</td>
</tr>
<tr>
<td><strong>最长公共前后缀</strong></td>
<td>/</td>
<td>/</td>
<td>/</td>
<td>/</td>
<td>a</td>
<td>ab</td>
<td>abc</td>
<td>/</td>
</tr>
<tr>
<td><strong>Next[i]</strong></td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>让两个指针j，i指向P头，让i逐个移动，与j所指的比较，若不同，则j跳转到该位的前一位Next数组值对应的下标，该位Next数组值为0；若相同，则j向右移动一位，该位Next数组值为移动后的j值（即Next[i]=++j）</p>
<p><strong>性质：<code>i+1-Next[i]</code>为前缀循环节的大小</strong></p>
<p>或把P与S合并成一个串，算出Next数组值，若某位值n等于P的长度，说明找到了和P匹配的字串，因为该处合并串的前后缀相同，该位置向前n长度的字串即为P</p>
<p>在构造Next数组时，假如需要计算Next[i]的值，此时前Next[i-1]位相等，记为len-1，若两侧字串加上第len与第i位，字串仍相等，则Next[i]=len+1，若不相等，则寻找第二长的Next，重复判断直到找到最小的Next(len=0)</p>
<h3 id="搜索模式串">搜索模式串</h3>
<p>用两个指针指向两串头，逐个匹配，当遇到不同字符时，查看该字符前一个字符对应next数组中的值，让模式串指针跳到该值对应的P的下标位置，继续与主串指针逐个匹配</p>
<p>当找到对应模式串在主串出现时，通过<code>i-len(p)+1</code>计算起始位置</p>
<p><strong>注意：整个匹配过程中主串指针不会后退，只会停留；而模式串指针根据next数组反复横条</strong></p>
<h2 id="板子-1">板子-1</h2>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Next_pre</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">p</span><span style="color: #24292E">, </span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt; </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">Next</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">,j</span><span style="color: #D73A49">=</span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">p.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span><span style="color: #6A737D"> // i是当前遍历到的后缀</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E">(j</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E">p[i]</span><span style="color: #D73A49">!=</span><span style="color: #24292E">p[j]) j</span><span style="color: #D73A49">=</span><span style="color: #24292E">Next[j</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">];</span><span style="color: #6A737D"> // 两指针指向不同时按Next中值跳转直到跳到0</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E">(p[i]</span><span style="color: #D73A49">==</span><span style="color: #24292E">p[j])j</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 前后缀一样时，前缀向后移动</span></span>
<span class="line"><span style="color: #24292E">    Next[i]</span><span style="color: #D73A49">=</span><span style="color: #24292E">j;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">kmp</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">,</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">p</span><span style="color: #24292E">,</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">begin</span><span style="color: #24292E">){</span><span style="color: #6A737D"> // begin表示从哪里开始匹配</span></span>
<span class="line"><span style="color: #24292E">  vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Next</span><span style="color: #24292E">(p.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">());</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">Next_pre</span><span style="color: #24292E">(p,Next);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> begin,j</span><span style="color: #D73A49">=</span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">s.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E">(j</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E">s[i]</span><span style="color: #D73A49">!=</span><span style="color: #24292E">p[j]) j</span><span style="color: #D73A49">=</span><span style="color: #24292E">Next[j</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">];</span><span style="color: #6A737D"> // 两指针指向不同时按Next中值跳转直到跳到0</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (s[i]</span><span style="color: #D73A49">==</span><span style="color: #24292E">p[j])j</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 前后缀一样时，前缀向后移动</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (j</span><span style="color: #D73A49">==</span><span style="color: #24292E">p.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">()){</span><span style="color: #6A737D"> // 匹配成功后的操作</span></span>
<span class="line"><span style="color: #6A737D">    // 该部分操作按题目要求</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> i</span><span style="color: #D73A49">-</span><span style="color: #24292E">p.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">()</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  string s,p;</span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> s </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> p;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">kmp</span><span style="color: #24292E">(s,p,</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="板子-2">板子-2</h2>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">kmp</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">,</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> n </span><span style="color: #D73A49">=</span><span style="color: #24292E"> s.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> m </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  string mer </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p</span><span style="color: #D73A49">+</span><span style="color: #032F62">&#39;#&#39;</span><span style="color: #D73A49">+</span><span style="color: #24292E">s;</span></span>
<span class="line"><span style="color: #24292E">  vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Next</span><span style="color: #24292E">(mer.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">());</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">mer.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> len </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Next[i</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E">(len</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E">mer[i]</span><span style="color: #D73A49">!=</span><span style="color: #24292E">mer[len]) len </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Next[len</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (mer[i]</span><span style="color: #D73A49">==</span><span style="color: #24292E">mer[len]){</span></span>
<span class="line"><span style="color: #24292E">      Next[i]</span><span style="color: #D73A49">=</span><span style="color: #24292E">len</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (Next[i]</span><span style="color: #D73A49">==</span><span style="color: #24292E">m){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> i</span><span style="color: #D73A49">-</span><span style="color: #24292E">m</span><span style="color: #D73A49">*</span><span style="color: #005CC5">2</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  string s,p;</span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> s</span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E">p;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">kmp</span><span style="color: #24292E">(s,p);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>算法与数据结构</category>
      </categories>
      <tags>
        <tag>算法</tag>
        <tag>字符串</tag>
      </tags>
  </entry>
  <entry>
    <title>【算法】前缀和与差分</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%89%8D%E7%BC%80%E5%92%8C%E4%B8%8E%E5%B7%AE%E5%88%86/</url>
    <content><![CDATA[<h1 id="前缀和与差分">前缀和与差分</h1>
<h2 id="一维前缀和">一维前缀和</h2>
<blockquote>
<p>e.g. 给定长度为n的数组arr, 求q次询问中每次arr在[l,r]的区间和</p>
</blockquote>
<p>暴力枚举的时间复杂度为O(qn) 容易TLE</p>
<p>使用前缀和可以极大减少运行时间</p>
<h3 id="前缀和数组">前缀和数组</h3>
<p><strong>定义一个前缀和数组<code>prefix[i]=prefix[i-1]+arr[i]</code>，其中i&gt;0</strong></p>
<p><strong>i=0时sum[0]=arr[0]</strong></p>
<p>则对于数a1,a2,a3,a4,a5….</p>
<p>prefix[1]=a1</p>
<p>prefix[2]=a1+a2</p>
<p>prefix[3]=a1+a2+a3</p>
<p>…</p>
<p>可以看出，<strong>prefix[i]为区间[0,i]的和</strong></p>
<p>在求区间的和时，如2-4，就可以使用<code>prefix[4]-prefix[1]</code>,通式为<strong><code>prefix[r]-prefix[l-1]</code></strong>,
l=0时为prefix[r]</p>
<p>其中，求前缀和的过程成为预处理</p>
<h3 id="板子">板子</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #6A737D">//#define get_sum(l, r) ((l)?(sum[r]-sum[l]):(sum[r]))</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10000</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> a[N], prefix[</span><span style="color: #005CC5">10000</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get_sum</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">l</span><span style="color: #24292E"> , </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">r</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (l) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> prefix[r]</span><span style="color: #D73A49">-</span><span style="color: #24292E">prefix[l</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">return</span><span style="color: #24292E"> prefix[r];</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">ios</span><span style="color: #24292E">::</span><span style="color: #6F42C1">sync_with_stdio</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">), cin.</span><span style="color: #6F42C1">tie</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">), cout.</span><span style="color: #6F42C1">tie</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> n;</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">; i </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n ; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">    {</span></span>
<span class="line"><span style="color: #24292E">        cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> a[i];</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #6A737D">    // 预处理，一般以1开始为下标</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">; i </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E"> n; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">    {</span></span>
<span class="line"><span style="color: #24292E">        prefix[i] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> prefix[i</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">]</span><span style="color: #D73A49">+</span><span style="color: #24292E">a[i];</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #6A737D">    // 访问</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> q;</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> q;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E"> (q</span><span style="color: #D73A49">--</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">int</span><span style="color: #24292E"> l, r ;</span></span>
<span class="line"><span style="color: #24292E">        cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> l </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> r;</span></span>
<span class="line"><span style="color: #6A737D">        //cout &lt;&lt; prefix[r]-prefix[l-1];</span></span>
<span class="line"><span style="color: #24292E">        cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get_sum</span><span style="color: #24292E">(l,r);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="二维前缀和">二维前缀和</h2>
<blockquote>
<p>给定一个长n,宽m的矩阵:</p>
<p>求矩阵任意两点间矩形的数字之和</p>
</blockquote>
<h3 id="二维前缀和数组">二维前缀和数组</h3>
<p><strong>定义一个二维前缀和数组<code>prefix[i][j] =prefix[i-1][j]+prefix[i][j-1]-prefix[i-1][j-1]+a[i][j]</code>，其中i&gt;0</strong></p>
<p>其中，<strong><code>prefix[i][j]</code>为从(0,0)到(i,j)的和</strong></p>
<ul>
<li>当i=0且j=0时，<code>prefix[0][0]=a[0][0]</code></li>
<li>当i=0且j!=0时，<code>prefix[0][j]=prefix[0][j-i]+a[0][j]</code></li>
<li>当i!=0且j=0时，<code>prefix[i][0]=prefix[i-1][0]+a[i][0]</code></li>
</ul>
<p>如下图：</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%89%8D%E7%BC%80%E5%92%8C%E4%B8%8E%E5%B7%AE%E5%88%86/%E4%BA%8C%E4%BD%8D%E5%89%8D%E7%BC%80%E5%92%8C.png" class="" title="二维前缀和">
<p>即<code>prefix[i][j]</code>是由<code>a[i][j],prefix[i-1][j],prefix[i][j-1]</code>组成的，但两块加多了一块<code>prefix[i-1][j-1]</code>，故减去</p>
<p>若要求解某部分矩形，就可以进行以上的逆过程</p>
<p><strong><code>a[i][j]=prefix[i][j]-prefix[i-1][j]-prefix[i][j-1]+prefix[i-1][j-1]</code></strong></p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%89%8D%E7%BC%80%E5%92%8C%E4%B8%8E%E5%B7%AE%E5%88%86/%E4%BA%8C%E4%BD%8D%E5%89%8D%E7%BC%80%E5%92%8C2.png" class="" title="二维前缀和2">
<p>从<code>prefix[i][j]</code>开始，求<code>a[i][j]</code>，则可以依次减去<code>prefix[i-1][j],prefix[i][j-1]</code>，但会多减一块<code>prefix[i-1][j-1]</code>，故加上</p>
<h3 id="板子-1">板子</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10000</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> n,m;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> a[N][N];</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> prefix[N][N];</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">pre_sum</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  /*以下代码是当for循环从0开始时的初始化</span></span>
<span class="line"><span style="color: #6A737D">  prefix[0][0]=a[0][0];</span></span>
<span class="line"><span style="color: #6A737D">  for (int i = 1;i &lt;n;i++) prefix[i][0] = prefix[i-1][0]+a[i][0];</span></span>
<span class="line"><span style="color: #6A737D">  for (int j = 1;j &lt;m;j++) prefix[0][j] = prefix[0][j-1]+a[0][j];</span></span>
<span class="line"><span style="color: #6A737D">  */</span></span>
<span class="line"><span style="color: #24292E"> </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;j</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">m;j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    prefix[i][j] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> prefix[i</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">][j]</span><span style="color: #D73A49">+</span><span style="color: #24292E">prefix[i][j</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">]</span><span style="color: #D73A49">-</span><span style="color: #24292E">prefix[i</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">][j</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">]</span><span style="color: #D73A49">+</span><span style="color: #24292E">a[i][j];</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E"> }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get_sum</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">x1</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">y1</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">x2</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">y2</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #6A737D">  /*以下为从0开始时的特殊情况</span></span>
<span class="line"><span style="color: #6A737D">  // 从0,0开始加</span></span>
<span class="line"><span style="color: #6A737D">  if (!x1 &amp;&amp; !y1) return prefix[x2][y2];</span></span>
<span class="line"><span style="color: #6A737D">  // 成行相加</span></span>
<span class="line"><span style="color: #6A737D">  if (!x1) return prefix[x2][y2]-prefix[x2][y1-1];</span></span>
<span class="line"><span style="color: #6A737D">  // 成列相加</span></span>
<span class="line"><span style="color: #6A737D">  if (!y1) return prefix[x2][y2]-prefix[x1-1][y2];</span></span>
<span class="line"><span style="color: #6A737D">  */</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> prefix[x2][y2]</span><span style="color: #D73A49">-</span><span style="color: #24292E">prefix[x1</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">][y2]</span><span style="color: #D73A49">-</span><span style="color: #24292E">prefix[x2][y1</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">]</span><span style="color: #D73A49">+</span><span style="color: #24292E">prefix[x1</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">][y1</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> x1,y1,x2,y2;</span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E">m;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">; i </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;j </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">m; j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> a[i][j];</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> x1 </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> y1 </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> x2 </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> y2;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">pre_sum</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get_sum</span><span style="color: #24292E">(x1,y1,x2,y2);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="一维差分">一维差分</h2>
<blockquote>
<p>给定长度为n的数组arr，进行m个操作，使[l,r]区间内的值都加一个value，操作结束后，询问arr</p>
</blockquote>
<p>暴力解法：每次遍历数组[l,r]执行加value操作，遍历m次，时间复杂度O(n*m)</p>
<blockquote>
<p>例如 arr中有五个数 1 3 7 5 2</p>
<p>对[2,4] +5 [1,3] +2 [0,2] -3</p>
<p>对于下标为2的数分析，7+5+2-3=11. 若不管中间，则相当于7+4=11.
则我们的目的即为让中间的步骤省略，最后只+4.</p>
</blockquote>
<h3 id="差分数组">差分数组</h3>
<p><strong>定义一个差分数组<code>d[i]=arr[i]-arr[i-1]</code></strong></p>
<p>则对d进行前缀和，得到前缀和数组sum，我们可以发现：</p>
<p>​ <u><strong>差分数组可以通过前缀和得到原数组</strong></u></p>
<p>​ 即<strong><code>d[i]+=d[i-1]</code></strong></p>
<h3 id="差分标记">差分标记</h3>
<p>对于一位差分区间修改：<strong><code>[l,r]+value</code><span
class="math inline">\(\iff\)</span><code>d[l]+value, d[r+1]-value</code></strong></p>
<blockquote>
<p>对于以上arr 对应差分数组d为1 2 4 -2 -3</p>
<p>第一次操作等价于d[2]+5 结果为1 2 9 -2 -3</p>
<p>第二次等价于d[1]+2,d[4]-2 结果为1 4 9 -2 -5</p>
<p>第三次：-2 4 9 1 -5</p>
<p>进行前缀和得到sum -2 2 11 12 7</p>
</blockquote>
<p>注意：</p>
<ul>
<li>把标记后的差分数组进行一次前缀和操作</li>
<li>每进行m次操作后都要进行一次前缀和</li>
<li>即适用于多次操作单次询问（单次操作单次询问不适用）</li>
</ul>
<p>原理：
<strong>差分数组中，标记位加了一个数，还原成原数组的时候，后面的数都会累加，然后再r+1位在减去这个数停止累加</strong></p>
<p>最终实现的效果为：<code>sum[l,r]+value</code>,
<code>sum[r+1,n-1] +value - value</code></p>
<blockquote>
<p>如：对于差分数组d 0 1 0 0 0，进行一次前缀和后其sum为 0 1 1 1
1，即标记位加的数会作用与该标记之后每一位，即<strong>d[i]+value <span
class="math inline">\(\iff\)</span> sum[i,n-1]+value</strong></p>
<p>若想在某位置停止累加，在该位置+1处减掉value即可，如 d 0 1 0 0
-1，前缀和后sum为 0 1 1 1 0，加一减一抵消为0，即<strong>d[r+1]-value
<span class="math inline">\(\iff\)</span>
sum[r+1,n-1]-value</strong></p>
</blockquote>
<h3 id="板子-2">板子</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a[</span><span style="color: #005CC5">10000</span><span style="color: #24292E">]</span><span style="color: #D73A49">=</span><span style="color: #24292E">{</span><span style="color: #005CC5">0</span><span style="color: #24292E">}, diff[</span><span style="color: #005CC5">10000</span><span style="color: #24292E">]</span><span style="color: #D73A49">=</span><span style="color: #24292E">{</span><span style="color: #005CC5">0</span><span style="color: #24292E">}, prefix[</span><span style="color: #005CC5">10000</span><span style="color: #24292E">]</span><span style="color: #D73A49">=</span><span style="color: #24292E">{</span><span style="color: #005CC5">0</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> n;</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">; i </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n ; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">    {</span></span>
<span class="line"><span style="color: #24292E">        cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> a[i];</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #6A737D">    // 预处理，得到差分数组，一般以1开始为下标</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">; i </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E"> n; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">    {</span></span>
<span class="line"><span style="color: #24292E">        diff[i] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a[i]</span><span style="color: #D73A49">-</span><span style="color: #24292E">a[i</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #6A737D">    // 对区间元素处理</span></span>
<span class="line"><span style="color: #6A737D">    // 想让区间元素都+x，则可以让l右边都加x，再r右边都-x</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> m;</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> m;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E">(m</span><span style="color: #D73A49">--</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">int</span><span style="color: #24292E"> l, r, x;</span></span>
<span class="line"><span style="color: #24292E">        cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> l</span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> r</span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> x;</span></span>
<span class="line"><span style="color: #6A737D">        // 进行差分标记</span></span>
<span class="line"><span style="color: #24292E">        diff[l]</span><span style="color: #D73A49">+=</span><span style="color: #24292E">x, diff[r</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">]</span><span style="color: #D73A49">-=</span><span style="color: #24292E">x;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #6A737D">    // 对差分数组进行前缀和得出结果</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">; i </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">    {</span></span>
<span class="line"><span style="color: #24292E">        a[i] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a[i</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">] </span><span style="color: #D73A49">+</span><span style="color: #24292E">diff[i];</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #6A737D">    // 再进行前缀和以应对接下来的访问</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">; i </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E"> n; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">    {</span></span>
<span class="line"><span style="color: #24292E">        prefix[i] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> prefix[i</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">]</span><span style="color: #D73A49">+</span><span style="color: #24292E">a[i];</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #6A737D">    // 访问</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> q;</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> q;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E"> (q</span><span style="color: #D73A49">--</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">int</span><span style="color: #24292E"> l, r ;</span></span>
<span class="line"><span style="color: #24292E">        cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> l </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> r;</span></span>
<span class="line"><span style="color: #24292E">        cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> prefix[r]</span><span style="color: #D73A49">-</span><span style="color: #24292E">prefix[l</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="二维差分">二维差分</h2>
<blockquote>
<p>给定长n,宽m的矩阵，从(xi,yi)到(xj,yj)执行m次操作，使两点间矩形中的值都加一个value，操作结束后，询问矩阵</p>
</blockquote>
<p>大体思路与一维差分差不多</p>
<h3 id="差分矩阵">差分矩阵</h3>
<p>定义一个差分矩阵：<strong><code>d[i][j]=a[i][j]-a[i-1][j]-a[i][j-1]+a[i-1][j-1]</code></strong></p>
<p>或者可以将差分矩阵中的元素一个个插入：</p>
<p>即若原矩阵(x,y)处值为value，则相当于从左上角(x,y)
到右下角(x,y)都加value,也可以使用差分标记实现</p>
<h3 id="差分标记-1">差分标记</h3>
<p>对于二位差分区间修改：<strong><code>[(xi,yi),(xj,yj)]+value</code><span
class="math inline">\(\iff\)</span><code>d[xi][yi]+value, d[xj+1][yi]-value, d[xi][yj+1]-value, d[xj+1][yj+1]+value</code></strong></p>
<p>原理如图：</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%89%8D%E7%BC%80%E5%92%8C%E4%B8%8E%E5%B7%AE%E5%88%86/%E4%BA%8C%E4%BD%8D%E5%B7%AE%E5%88%86%E5%8F%AF%E8%A7%86%E5%8C%96.png" class="" title="二位差分可视化">
<h3 id="板子-3">板子</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10000</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> n,m,cnt</span><span style="color: #D73A49">=</span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> a[N][N];</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> prefix[N][N];</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> d[N][N];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 差分标记 &amp;&amp;初始化差分矩阵</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">add</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">x1</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">y1</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">x2</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">y2</span><span style="color: #24292E">,</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">value</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  d[x1][y1]</span><span style="color: #D73A49">+=</span><span style="color: #24292E">value;</span></span>
<span class="line"><span style="color: #24292E">  d[x2</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">][y1]</span><span style="color: #D73A49">-=</span><span style="color: #24292E">value;</span></span>
<span class="line"><span style="color: #24292E">  d[x1][y2</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">]</span><span style="color: #D73A49">-=</span><span style="color: #24292E">value;</span></span>
<span class="line"><span style="color: #24292E">  d[x2</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">][y2</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">]</span><span style="color: #D73A49">+=</span><span style="color: #24292E">value;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E">m </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> cnt;</span></span>
<span class="line"><span style="color: #6A737D">  // 输入每个数并计算差分矩阵</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">; i </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;j </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">m; j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> a[i][j];</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">add</span><span style="color: #24292E">(i,j,i,j,a[i][j]);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 进行差分标记</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">; i </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">cnt;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> x1,y1,x2,y2,value;</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> x1 </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> y1 </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> x2 </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> y2</span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E">value;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">add</span><span style="color: #24292E">(x1,y1,x2,y2,value);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 对差分数组进行一次前缀和得到结果</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E"> ;i </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;j </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">m;j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      a[i][j] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a[i</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">][j] </span><span style="color: #D73A49">+</span><span style="color: #24292E"> a[i][j</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">] </span><span style="color: #D73A49">-</span><span style="color: #24292E"> a[i</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">][j</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">] </span><span style="color: #D73A49">+</span><span style="color: #24292E"> d[i][j];</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E"> n; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">; j </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E"> m; j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> a[i][j] </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39; &#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>算法与数据结构</category>
      </categories>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>【数据结构】优先队列</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E4%BC%98%E5%85%88%E9%98%9F%E5%88%97(priority_queue)/</url>
    <content><![CDATA[<h1 id="优先队列priority_queue">优先队列(priority_queue)</h1>
<p>优先队列可以用来存储具有优先级的元素，队头的元素都是当前队列中优先级最高(或最低)的元素</p>
<p>STL中的优先队列默认为最大堆，即优先级最高的先出队</p>
<h2 id="结构">结构</h2>
<figure>
<img src="优先队列(priority_queue)/image-20250122213521412.png"
alt="优先队列的结构" />
<figcaption aria-hidden="true">优先队列的结构</figcaption>
</figure>
<p>优先队列仅维护堆顶(top)，其余元素优先级都比堆顶小</p>
<h2 id="初始化">初始化</h2>
<p>优先队列使用需要引入头文件queue</p>
<p>如下代码可以声明一个优先队列，其中T为数据类型，<strong>优先队列中的数据数据类型都相同</strong></p>
<p><strong>注意：使用结构体时，需要重载小于号或声明一个比较类并重载()运算符</strong></p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits\stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">node</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> x, y;</span></span>
<span class="line"><span style="color: #6A737D">  // 使用结构体需要重载小于号</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">bool</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #24292E"> </span><span style="color: #6F42C1">&lt;</span><span style="color: #24292E"> (</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">node</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">u</span><span style="color: #24292E">)</span><span style="color: #D73A49">const</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> x </span><span style="color: #D73A49">==</span><span style="color: #24292E"> u.x</span><span style="color: #D73A49">?</span><span style="color: #24292E"> y</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">u.y </span><span style="color: #D73A49">:</span><span style="color: #24292E"> x</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">u.x;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #6A737D">// 或重载()运算符实现比较</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">cmp</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">bool</span><span style="color: #24292E"> </span><span style="color: #D73A49">operator</span><span style="color: #24292E"> </span><span style="color: #6F42C1">()</span><span style="color: #24292E">(</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">u</span><span style="color: #24292E">, </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">v</span><span style="color: #24292E">)</span><span style="color: #D73A49">const</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> u</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">v;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">    // 声明优先队列，整型，默认大顶堆(最大元素在顶上)</span></span>
<span class="line"><span style="color: #6A737D">    // 一般声明一个空优先队列  </span></span>
<span class="line"><span style="color: #24292E">    priority_queue</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">T</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> pque;</span></span>
<span class="line"><span style="color: #6A737D">    // 声明一个小顶堆,传入仿函数, 第二个参数表示优先队列底层储存容器为vector</span></span>
<span class="line"><span style="color: #24292E">    priority_queue</span><span style="color: #D73A49">&lt;int</span><span style="color: #24292E">, vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E">, greater</span><span style="color: #D73A49">&lt;int&gt;&gt;</span><span style="color: #24292E"> pque;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="基本操作">基本操作</h2>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 取出堆顶</span></span>
<span class="line"><span style="color: #24292E">cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> pque.</span><span style="color: #6F42C1">top</span><span style="color: #24292E">() </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #6A737D">// 插入元素到队尾并执行上浮操作</span></span>
<span class="line"><span style="color: #24292E">pque.</span><span style="color: #6F42C1">push</span><span style="color: #24292E">(</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #6A737D">// 弹出堆顶</span></span>
<span class="line"><span style="color: #24292E">pque.</span><span style="color: #6F42C1">pop</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #6A737D">// 返回队列元素个数</span></span>
<span class="line"><span style="color: #24292E">cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> pque.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">() </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #6A737D">// 判断队列是否为空</span></span>
<span class="line"><span style="color: #24292E">cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> pque.</span><span style="color: #6F42C1">empty</span><span style="color: #24292E">() </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #6A737D">//间接修改堆顶元素</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> x </span><span style="color: #D73A49">=</span><span style="color: #24292E"> pque.</span><span style="color: #6F42C1">top</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">pque.</span><span style="color: #6F42C1">pop</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">pque.</span><span style="color: #6F42C1">push</span><span style="color: #24292E">(x</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span></code></pre></div></div></figure>
<p><strong>注意：priority_queue没有迭代器，不能用begin()，end()，auto等遍历，也不能直接修改队列中的元素</strong></p>
]]></content>
      <categories>
        <category>算法与数据结构</category>
      </categories>
      <tags>
        <tag>STL</tag>
      </tags>
  </entry>
  <entry>
    <title>【算法】倍增</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%80%8D%E5%A2%9E/</url>
    <content><![CDATA[<h1 id="倍增">倍增</h1>
<h2 id="问题引入">问题引入</h2>
<blockquote>
<p>Q1:
给定一个正数x，已知x一定可用m个二进制位表示，从高位到低位打印x每一位的状态</p>
</blockquote>
<p>从数二进制位左往右第i位计算<code>1&lt;&lt;i</code>，让原数与其相减，若结果小于0则不减，并将该位状态标记为0，若大于0则减去，并将该位状态标记为1</p>
<p>如数101，二进制为0001100101，</p>
<p><code>1&lt;&lt;9</code>为512&gt;101，不减，第九位状态为0</p>
<p><code>1&lt;&lt;8</code>为256&gt;101，不减，第八位状态为0</p>
<p><code>1&lt;&lt;7</code>为128&gt;101，不减，第七位状态为0</p>
<p><code>1&lt;&lt;6</code>为64&lt;101，减成37，第六位状态为1</p>
<p><code>1&lt;&lt;5</code>为25&lt;32，减成5，第五位状态为1</p>
<p>以此类推</p>
<blockquote>
<p>Q2: 给定一个正数x，打印&lt;=x的最大的2的幂是2的几次方，注意防溢出</p>
</blockquote>
<p>若x=13，则<span
class="math inline">\(2^3=8\)</span>最接近13，输出3</p>
<p>若x=16，则<span
class="math inline">\(2^4=16\)</span>最接近16，输出4</p>
<p>溢出：若x非常接近INT_MAX，则每次从<span
class="math inline">\(2^{p-1}\leq x\leq2^p\)</span>时很有可能溢出</p>
<p>解决方案：当<span class="math inline">\(2^p\leq
\frac{x}{2}\)</span>时就让p++</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">q2</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> power </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E">(</span><span style="color: #005CC5">1</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">power)</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">(x</span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #005CC5">1</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        power</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> power;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="倍增算法">倍增算法</h2>
<blockquote>
<p>线段上有n个点，给定每个点i往右边跳1步能最远覆盖的点jump[i]</p>
<p>已知从任意点出发都能到达最后的点，并且在i&lt;j时，必定有jump[i]&lt;=jump[j]</p>
<ol type="1">
<li>如何构建一张表可以查询从任意点i出发，任意跳<span
class="math inline">\(2^p\)</span>步，最远能到达的点</li>
<li>如何快速计算任意两点之间，最少跳几步能到达</li>
</ol>
</blockquote>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%80%8D%E5%A2%9E/image-20250430100833228.png" class="" title="图解">
<ol type="1">
<li></li>
</ol>
<p>如该表，行代表p，表示<span
class="math inline">\(2^p\)</span>次方内对应点是否能到达，列代表点i</p>
<p>初始jump[i]填入第一列，即<code>st[i][0]=jump[i]</code>，后面列的填充满足转移方程<code>st[i][p]=st[st[i][p-1]][p-1]</code>，即跳<span
class="math inline">\(2^p\)</span>内能到达的可以转化为从<span
class="math inline">\(2^{p-1}\)</span>跳<span
class="math inline">\(2^{p-1}\)</span>内能到达</p>
<p>该表列最多<span class="math inline">\(\log_2n\)</span>列</p>
<p>这就是<strong>ST表</strong>，我们利用ST表从x到y跳跃的过程中，先从最大步长开始，每次减少一半尝试，最后得到答案</p>
<ol start="2" type="1">
<li></li>
</ol>
<p>假设计算17到77至少要多少步</p>
<p>我们知道至多需要60步，而60可以用六个二进制位表示</p>
<p>从左往右，让17往右跳<span
class="math inline">\(2^i\)</span>步，看对应数值大于还是小于77，大于则该位标0，小于则标1，且将步数转为49</p>
<p>最后需要的是逼近77的结果，如最后到达了73，再加一步就能到达77</p>
<h2 id="例-倍增跳跃">例-倍增跳跃</h2>
<blockquote>
<p><strong>P4155 [SCOI2015] 国旗计划</strong></p>
</blockquote>
<p>题意：给定m个点，编号1-m，所有点围城一个环，i号点顺时针到达i+1号点，最终m号点顺时针回到1号点</p>
<p>给定n条线段，每条线段(a,b)表示线段顺时针从a到b</p>
<p>保证所有线段可以把整个环覆盖，且线段间可能重合但一定互不包含</p>
<p>返回长度为n的结果数组ans，ans[x]表示一定选x号线段下，至少选几条线段能覆盖整个环</p>
<p><img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%80%8D%E5%A2%9E/image-20250430113318806.png" class="" title="例"></p>
<p>我们将环展开成条进行计算，即每次寻找包含在内且尽量靠右的线段跳跃，寻找离转一圈后的起始点所在的最近的线段</p>
<p>如从A开始，需要经过A-&gt;B-&gt;D才能到达10(2)点，故需要三条线段覆盖</p>
<p>构建时只需要看第i个点所在线段的末尾是哪个即可，表示一步内从i可以跳到末尾</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">endl</span><span style="color: #24292E"> &#39;\n&#39;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> ll;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> pair</span><span style="color: #D73A49">&lt;int</span><span style="color: #24292E">,</span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> PII;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #D73A49">e</span><span style="color: #005CC5">5</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> mod </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #D73A49">e</span><span style="color: #005CC5">9</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">7</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">node</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> idx;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> s,e;</span></span>
<span class="line"><span style="color: #24292E">}line[</span><span style="color: #005CC5">2</span><span style="color: #D73A49">*</span><span style="color: #24292E">N];</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> n, m, power;</span></span>
<span class="line"><span style="color: #24292E">vector</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">vector</span><span style="color: #D73A49">&lt;int&gt;&gt;</span><span style="color: #24292E"> st;</span></span>
<span class="line"><span style="color: #24292E">vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> ans;</span></span>
<span class="line"><span style="color: #6A737D">// 将环状展开为线性</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">lgp</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">n</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> ans </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">((</span><span style="color: #005CC5">1</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">ans)</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">(n</span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #005CC5">1</span><span style="color: #24292E">)){</span></span>
<span class="line"><span style="color: #24292E">    ans</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ans;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">build</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #6A737D">  /*如C(6,1),m=8</span></span>
<span class="line"><span style="color: #6A737D">  * 有1 2 3 4 5 6 7 8 9 10 11 ...</span></span>
<span class="line"><span style="color: #6A737D">                      1  2  3...</span></span>
<span class="line"><span style="color: #6A737D">    故转化后的C是(6,9)</span></span>
<span class="line"><span style="color: #6A737D">  */</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (line[i].s</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">line[i].e){</span></span>
<span class="line"><span style="color: #24292E">      line[i].e</span><span style="color: #D73A49">+=</span><span style="color: #24292E">m;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 按起始点排序</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">sort</span><span style="color: #24292E">(line</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">,line</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #D73A49">+</span><span style="color: #24292E">n,[</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">](</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">node</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">node</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span><span style="color: #D73A49">return</span><span style="color: #24292E"> a.s</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">b.s;});</span></span>
<span class="line"><span style="color: #6A737D">  // 对点在线性上进行复制即 A B C D A&#39; B&#39; C&#39; D&#39;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    line[i</span><span style="color: #D73A49">+</span><span style="color: #24292E">n].idx </span><span style="color: #D73A49">=</span><span style="color: #24292E"> line[i].idx;</span></span>
<span class="line"><span style="color: #24292E">    line[i</span><span style="color: #D73A49">+</span><span style="color: #24292E">n].s </span><span style="color: #D73A49">=</span><span style="color: #24292E"> line[i].s</span><span style="color: #D73A49">+</span><span style="color: #24292E">m;</span></span>
<span class="line"><span style="color: #24292E">    line[i</span><span style="color: #D73A49">+</span><span style="color: #24292E">n].e </span><span style="color: #D73A49">=</span><span style="color: #24292E"> line[i].e</span><span style="color: #D73A49">+</span><span style="color: #24292E">m;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 新线段数量</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> e </span><span style="color: #D73A49">=</span><span style="color: #24292E"> n</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  // 寻找跳一步的最大值, 应满足下一条线段开头&lt;=当前线段结尾</span></span>
<span class="line"><span style="color: #6A737D">  /*如线段开头如下</span></span>
<span class="line"><span style="color: #6A737D">  3</span></span>
<span class="line"><span style="color: #6A737D">    34 </span></span>
<span class="line"><span style="color: #6A737D">      56</span></span>
<span class="line"><span style="color: #6A737D">        89</span></span>
<span class="line"><span style="color: #6A737D">          102</span></span>
<span class="line"><span style="color: #6A737D">  到102就超过了结尾，故选择到89</span></span>
<span class="line"><span style="color: #6A737D">  */</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">, j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">e;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E">(j</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">e</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E">line[j</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">].s</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">line[i].e){</span></span>
<span class="line"><span style="color: #24292E">      j</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    st[i][</span><span style="color: #005CC5">0</span><span style="color: #24292E">]</span><span style="color: #D73A49">=</span><span style="color: #24292E">j;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 倍增</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">; p</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">power; p</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">e;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      st[i][p]</span><span style="color: #D73A49">=</span><span style="color: #24292E">st[st[i][p</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">]][p</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">jump</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">i</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #6A737D">  // i号线段的目标点是line[i].s+m</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> tar </span><span style="color: #D73A49">=</span><span style="color: #24292E"> line[i].s</span><span style="color: #D73A49">+</span><span style="color: #24292E">m,cur </span><span style="color: #D73A49">=</span><span style="color: #24292E"> i, next, ans </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> power; p</span><span style="color: #D73A49">&gt;=</span><span style="color: #005CC5">0</span><span style="color: #24292E">;p</span><span style="color: #D73A49">--</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> st[cur][p];</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (next</span><span style="color: #D73A49">!=</span><span style="color: #005CC5">0</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E">line[next].e</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">tar){</span></span>
<span class="line"><span style="color: #24292E">      ans</span><span style="color: #D73A49">+=</span><span style="color: #005CC5">1</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">p;</span></span>
<span class="line"><span style="color: #24292E">      cur </span><span style="color: #D73A49">=</span><span style="color: #24292E"> next;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ans</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 计算的是小于目标点，+1即为到达 </span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">solve</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> m;</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    line[i].idx </span><span style="color: #D73A49">=</span><span style="color: #24292E"> i; </span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> line[i].s </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> line[i].e;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  power </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">lgp</span><span style="color: #24292E">(n);</span></span>
<span class="line"><span style="color: #24292E">  st </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt;&gt;(</span><span style="color: #005CC5">2</span><span style="color: #D73A49">*</span><span style="color: #24292E">n</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">, </span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt;(power</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">0</span><span style="color: #24292E">));</span></span>
<span class="line"><span style="color: #24292E">  ans </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt;(n</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">build</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    ans[line[i].idx] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">jump</span><span style="color: #24292E">(i);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> ans[i]</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&#39; &#39;</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">()</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">ios</span><span style="color: #24292E">::</span><span style="color: #6F42C1">sync_with_stdio</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">); cin.</span><span style="color: #6F42C1">tie</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">); cout.</span><span style="color: #6F42C1">tie</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> tomorin</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  //cin &gt;&gt; tomorin;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E"> (tomorin</span><span style="color: #D73A49">--</span><span style="color: #24292E">) </span><span style="color: #6F42C1">solve</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="例-rmq问题">例-RMQ问题</h2>
<blockquote>
<p><strong>P2880 [USACO07JAN] Balanced Lineup G</strong></p>
</blockquote>
<p>仍然构造一个st表，表示覆盖范围内对应的最大值</p>
<p>对于状态转移，每次的最大值一定在前一个区间(<span
class="math inline">\(i\to2^{p-1}\)</span>)与当前区间(<span
class="math inline">\(i+2^{p-1}\to2^{p-1}\)</span>)</p>
<p>对于查询，寻找最接近区间长度的一个2的p次幂，取从起点往后跳<span
class="math inline">\(2^p\)</span>长度与从终点往前跳<span
class="math inline">\(2^p\)</span>长度两者最大值的最大值</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ios</span><span style="color: #24292E"> ios::sync_with_stdio(0); cin.tie(0); cout.tie(0);</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">endl</span><span style="color: #24292E"> &#39;\n&#39;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> ll;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">unsigned</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> ull;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">double</span><span style="color: #24292E"> ld;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> pair</span><span style="color: #D73A49">&lt;int</span><span style="color: #24292E">,</span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> PII;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #D73A49">e</span><span style="color: #005CC5">5</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">double</span><span style="color: #24292E"> pi </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">acos</span><span style="color: #24292E">(</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1.0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> mod </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #D73A49">e</span><span style="color: #005CC5">9</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">7</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> INF </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">0x</span><span style="color: #005CC5">3f3f3f3f</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">double</span><span style="color: #24292E"> eps </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #D73A49">e-</span><span style="color: #005CC5">6</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> n,m;</span></span>
<span class="line"><span style="color: #24292E">vector</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">vector</span><span style="color: #D73A49">&lt;int&gt;&gt;</span><span style="color: #24292E"> dp1;</span></span>
<span class="line"><span style="color: #24292E">vector</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">vector</span><span style="color: #D73A49">&lt;int&gt;&gt;</span><span style="color: #24292E"> dp2;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">query1</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">l</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">r</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E">)</span><span style="color: #6F42C1">log2</span><span style="color: #24292E">(r</span><span style="color: #D73A49">-</span><span style="color: #24292E">l</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">max</span><span style="color: #24292E">(dp1[l][j],dp1[r</span><span style="color: #D73A49">-</span><span style="color: #24292E">(</span><span style="color: #005CC5">1</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">j)</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">][j]);</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">query2</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">l</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">r</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E">)</span><span style="color: #6F42C1">log2</span><span style="color: #24292E">(r</span><span style="color: #D73A49">-</span><span style="color: #24292E">l</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">min</span><span style="color: #24292E">(dp2[l][j],dp2[r</span><span style="color: #D73A49">-</span><span style="color: #24292E">(</span><span style="color: #005CC5">1</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">j)</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">][j]);</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">()</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  ios</span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> m;</span></span>
<span class="line"><span style="color: #24292E">  dp1 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt;&gt; (n,</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt;(</span><span style="color: #6F42C1">log2</span><span style="color: #24292E">(n)</span><span style="color: #D73A49">+</span><span style="color: #005CC5">5</span><span style="color: #24292E">,</span><span style="color: #005CC5">0</span><span style="color: #24292E">));</span></span>
<span class="line"><span style="color: #24292E">  dp2 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt;&gt; (n,</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt;(</span><span style="color: #6F42C1">log2</span><span style="color: #24292E">(n)</span><span style="color: #D73A49">+</span><span style="color: #005CC5">5</span><span style="color: #24292E">,</span><span style="color: #005CC5">0</span><span style="color: #24292E">));</span></span>
<span class="line"><span style="color: #24292E">  vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">arr</span><span style="color: #24292E">(n);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> arr[i];</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">    dp1[i][</span><span style="color: #005CC5">0</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> arr[i];</span></span>
<span class="line"><span style="color: #24292E">    dp2[i][</span><span style="color: #005CC5">0</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> arr[i];</span></span>
<span class="line"><span style="color: #24292E">  } </span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;j</span><span style="color: #D73A49">&lt;=</span><span style="color: #6F42C1">log2</span><span style="color: #24292E">(n);j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i</span><span style="color: #D73A49">+</span><span style="color: #24292E">(</span><span style="color: #005CC5">1</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">j)</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      dp1[i][j] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">max</span><span style="color: #24292E">(dp1[i][j</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">],dp1[i</span><span style="color: #D73A49">+</span><span style="color: #24292E">(</span><span style="color: #005CC5">1</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">(j</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">))][j</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">]);</span></span>
<span class="line"><span style="color: #24292E">      dp2[i][j] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">min</span><span style="color: #24292E">(dp2[i][j</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">],dp2[i</span><span style="color: #D73A49">+</span><span style="color: #24292E">(</span><span style="color: #005CC5">1</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">(j</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">))][j</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> l,r ;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E"> (m</span><span style="color: #D73A49">--</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> l </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> r;</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">query1</span><span style="color: #24292E">(l</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">,r</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">)</span><span style="color: #D73A49">-</span><span style="color: #6F42C1">query2</span><span style="color: #24292E">(l</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">,r</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">)</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="树上倍增">树上倍增</h2>
<p>在树结构中也可以实现倍增查找某节点任意层祖先</p>
<p>建立每个节点的深度表</p>
<p>使用<code>st[i][p]</code>指代节点i往上走<span
class="math inline">\(2^p\)</span>步来到哪个祖先，其中<code>st[i][0]</code>是i的父节点</p>
<p>则倍增思想可得<code>st[i][p]=st[st[i][p-1]][p-1]</code></p>
<p>此时给定任意节点，就可以快速查询i节点的祖先中位于第s层的祖先节点编号</p>
<h2 id="适用范围">适用范围</h2>
<p>适用于<strong>可重复贡献问题</strong></p>
<p>即若A与B区间有可能重叠的部分，但不影响A+B区间的答案</p>
<p>如RMQ，gcd，按位与，按位或等都可以使用st表高效解决</p>
<p>优势：构建过程复杂度<span class="math inline">\(O(n\log
n)\)</span>，单次查询<span class="math inline">\(O(1)\)</span></p>
<p>劣势：静态维护，需要空间大，维护信息有限</p>
]]></content>
      <categories>
        <category>算法与数据结构</category>
      </categories>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>【算法】双向搜索</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%8F%8C%E5%90%91%E6%90%9C%E7%B4%A2/</url>
    <content><![CDATA[<h1 id="双向搜索">双向搜索</h1>
<h2 id="双向同时搜索">双向同时搜索</h2>
<p>即从起点与终点同时进行bfs或dfs，如果发现搜索两端相遇，则可以认为是获得了可行解</p>
<h3 id="双向广搜">双向广搜</h3>
<p>双向广搜维护两个队列，并轮流拓展；或者维护一个并给不同标记</p>
<p>同时用数组或哈希表记录搜索情况，给从两个方向拓展的节点以不同标记，当某点被两种标记同时标记时，搜索结束</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">将开始结点和目标结点加入队列 q</span></span>
<span class="line"><span style="color: #24292E">标记开始结点为 </span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">标记目标结点为 </span><span style="color: #005CC5">2</span></span>
<span class="line"><span style="color: #D73A49">while</span><span style="color: #24292E"> (队列 q 不为空)</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  从 q.</span><span style="color: #6F42C1">front</span><span style="color: #24292E">() 扩展出新的 s 个结点</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  如果 新扩展出的结点已经被其他数字标记过</span></span>
<span class="line"><span style="color: #24292E">    那么 表示搜索的两端碰撞</span></span>
<span class="line"><span style="color: #24292E">    那么 循环结束</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  如果 新的 s 个结点是从开始结点扩展来的</span></span>
<span class="line"><span style="color: #24292E">    那么 将这个 s 个结点标记为 </span><span style="color: #005CC5">1</span><span style="color: #24292E"> 并且入队 q </span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  如果 新的 s 个结点是从目标结点扩展来的</span></span>
<span class="line"><span style="color: #24292E">    那么 将这个 s 个结点标记为 </span><span style="color: #005CC5">2</span><span style="color: #24292E"> 并且入队 q</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="双向迭代加深">双向迭代加深</h3>
<p>迭代加深：控制dfs的最大深度，若深度超过最大深度就返回，某个深度搜完没得到答案就令最大深度+1，重新开始搜索</p>
<p>双向迭代加深就是从两个方向迭代加深搜索</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> D;</span></span>
<span class="line"><span style="color: #D73A49">bool</span><span style="color: #24292E"> found;</span></span>
<span class="line"><span style="color: #D73A49">template</span><span style="color: #24292E"> &lt;</span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">dfs</span><span style="color: #24292E">(</span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">d</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">dir</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (H[x] </span><span style="color: #D73A49">+</span><span style="color: #24292E"> dir </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">3</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">        found </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">true</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    H[x] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> dir;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (d </span><span style="color: #D73A49">==</span><span style="color: #24292E"> D)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">    // 这里需要递归搜索当前状态能够转移到的新状态</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 在main函数中...</span></span>
<span class="line"><span style="color: #D73A49">while</span><span style="color: #24292E"> (D </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E"> MAXD </span><span style="color: #D73A49">/</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #24292E">)</span><span style="color: #6A737D"> // MAXD为题中要求的最大深度</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">dfs</span><span style="color: #24292E">(st, </span><span style="color: #005CC5">0</span><span style="color: #24292E">, </span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span><span style="color: #6A737D"> // st为起始状态</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (found)</span></span>
<span class="line"><span style="color: #6A737D">        // ...</span></span>
<span class="line"><span style="color: #6A737D">        // 题中所给最大深度为奇数时这里要判断一下</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">dfs</span><span style="color: #24292E">(ed, </span><span style="color: #005CC5">0</span><span style="color: #24292E">, </span><span style="color: #005CC5">2</span><span style="color: #24292E">);</span><span style="color: #6A737D"> // ed为终止状态</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (found)</span></span>
<span class="line"><span style="color: #6A737D">        // ...</span></span>
<span class="line"><span style="color: #24292E">    D</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="meet-in-the-middle">Meet In the Middle</h2>
<p>思想：将整个搜索过程分成两半分别搜索，最后合并</p>
<p>方法：分别搜索前一半，把状态放入a数组，搜索后一半，把状态放入b数组，最后统计答案</p>
<p>合并时可以通过排序使一部分有序，再通过二分等合并答案</p>
<p>解决问题：可以解决一些统计方案，但暴搜会TLE的题</p>
<blockquote>
<p>模板 P4799 世界冰球锦标赛</p>
</blockquote>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">endl</span><span style="color: #24292E"> &#39;\n&#39;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> ll;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> pair</span><span style="color: #D73A49">&lt;int</span><span style="color: #24292E">,</span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> PII;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #D73A49">e</span><span style="color: #005CC5">5</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> mod </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #D73A49">e</span><span style="color: #005CC5">9</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">7</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">vector</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">ll</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> arr, a, b;</span></span>
<span class="line"><span style="color: #24292E">ll n, m;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">dfs</span><span style="color: #24292E">(</span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #E36209">l</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #E36209">r</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #E36209">sum</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #E36209">sign</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E">(sum</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">m){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 搜索到达另一半</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E">(l</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">r){</span></span>
<span class="line"><span style="color: #6A737D">    // 结果放入左边</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E">(sign</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      a.</span><span style="color: #6F42C1">push_back</span><span style="color: #24292E">(sum);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #6A737D">    // 结果放入右边</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (sign</span><span style="color: #D73A49">==</span><span style="color: #005CC5">1</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      b.</span><span style="color: #6F42C1">push_back</span><span style="color: #24292E">(sum);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">dfs</span><span style="color: #24292E">(l</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">,r,sum</span><span style="color: #D73A49">+</span><span style="color: #24292E">arr[l],sign);</span><span style="color: #6A737D"> // 选</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">dfs</span><span style="color: #24292E">(l</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">,r,sum,sign);</span><span style="color: #6A737D"> // 不选</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">solve</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> m;</span></span>
<span class="line"><span style="color: #24292E">  arr </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">ll</span><span style="color: #24292E">&gt; (n</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i</span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> arr[i];</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">dfs</span><span style="color: #24292E">(</span><span style="color: #005CC5">1</span><span style="color: #24292E">, n</span><span style="color: #D73A49">/</span><span style="color: #005CC5">2</span><span style="color: #24292E">, </span><span style="color: #005CC5">0</span><span style="color: #24292E">, </span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span><span style="color: #6A737D"> // 搜前半</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">dfs</span><span style="color: #24292E">(n</span><span style="color: #D73A49">/</span><span style="color: #005CC5">2</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">, n, </span><span style="color: #005CC5">0</span><span style="color: #24292E">, </span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span><span style="color: #6A737D"> // 搜后半</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">sort</span><span style="color: #24292E">(a.</span><span style="color: #6F42C1">begin</span><span style="color: #24292E">(), a.</span><span style="color: #6F42C1">end</span><span style="color: #24292E">());</span><span style="color: #6A737D"> // 对前半排序，以便后面的upperbound</span></span>
<span class="line"><span style="color: #24292E">  ll ans </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  // 按一边的状态进行二分，找减去的另一半，由于相等也取，故upperbound</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">b.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    ans </span><span style="color: #D73A49">+=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">upper_bound</span><span style="color: #24292E">(a.</span><span style="color: #6F42C1">begin</span><span style="color: #24292E">(), a.</span><span style="color: #6F42C1">end</span><span style="color: #24292E">(), m</span><span style="color: #D73A49">-</span><span style="color: #24292E">b[i]) </span><span style="color: #D73A49">-</span><span style="color: #24292E"> a.</span><span style="color: #6F42C1">begin</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> ans;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">()</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">ios</span><span style="color: #24292E">::</span><span style="color: #6F42C1">sync_with_stdio</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">); cin.</span><span style="color: #6F42C1">tie</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">); cout.</span><span style="color: #6F42C1">tie</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> tomorin</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  //cin &gt;&gt; tomorin;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E"> (tomorin</span><span style="color: #D73A49">--</span><span style="color: #24292E">) </span><span style="color: #6F42C1">solve</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>算法与数据结构</category>
      </categories>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>【数学】多模检验</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%A4%9A%E6%A8%A1%E6%A3%80%E9%AA%8C/</url>
    <content><![CDATA[<h1 id="多模检验">多模检验</h1>
<h2 id="问题">问题</h2>
<blockquote>
<p>给你七个整数<span
class="math inline">\(a,b,c,d,e,f,g\)</span>，计算<span
class="math inline">\(a^d+b^e+c^f=g\)</span>是否成立</p>
</blockquote>
<p>若给予数据范围过大，直接计算会超过数据范围，这时通常想到的是取模</p>
<ul>
<li>若式子在某个模<span
class="math inline">\(p\)</span>上不成立，则原式必定不成立<strong>（必要条件）</strong></li>
<li>但如果两个数在一个模上同余，不能保证两个整数相等，因为两个不同整数也在同一模下同余</li>
</ul>
<p>为了尽可能降低这种情况，我们需要用多个<strong>互质的大模数</strong>同时检验，选若干个大模数<span
class="math inline">\(p\)</span>，要使得<span
class="math inline">\(a^d+b^e+c^f-g=0\)</span>在这些模数上都为0，就必须被这些模的乘积整除，因此若我们选的模较大且个数够多，要求被他们整除的可能性就极小，可以有效避免上面的情况</p>
<h2 id="解决方法">解决方法</h2>
<p>实际竞赛时，我们可以选择3-5个大素数进行测试，若都可以则通过检验</p>
<p>更保险的，我们可以使用64位<code>usigned int</code>自然溢出作为哈希取模，再加上一两个大模数</p>
<h2 id="常见大素数选择">常见大素数选择</h2>
<ul>
<li><p>998244353:这是一个质数,它恰好是2的23次方加一,可以用来处理多项式的求逆、求
导、快速幂等操作。</p></li>
<li><p>1000000007:这也是一个质数,它恰好是<code>1e9+7</code>,经常用来解决组合数学、排
列组合等问题。</p></li>
<li><p>1000000009:与上一个配对，用于双模哈希</p></li>
<li><p>19260817:这也是一个质数,它是个比较大的质数,经常用来构造哈希表。</p></li>
<li><p>998244352:这是一个2的23次方,是一个比较小的2的幂次方,可以用来处理多项式的
快速幂、NTT等操作。</p></li>
<li><p>104857601:这是一个2的20次方加一,是一个比较小的2的幂次方,可以用来做NTT
等操作。</p></li>
</ul>
]]></content>
      <categories>
        <category>数学</category>
      </categories>
      <tags>
        <tag>数学</tag>
        <tag>数论</tag>
      </tags>
  </entry>
  <entry>
    <title>【算法】BFS</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/BFS/</url>
    <content><![CDATA[<h1 id="bfs">BFS</h1>
<blockquote>
<p><a
href="https://www.bilibili.com/video/BV1aY411k7DB/?share_source=copy_web&amp;vd_source=d51bc147506d4e930a5fca5c791cb3d8">参考视频1</a>_
<a
href="https://www.bilibili.com/video/BV1sC4y1k74R/?share_source=copy_web&amp;vd_source=d51bc147506d4e930a5fca5c791cb3d8">参考视频2</a></p>
</blockquote>
<h2 id="预备知识队列">预备知识：队列</h2>
<ul>
<li><p>特点：先进先出（FIFO），队头删除元素，队尾插入元素</p></li>
<li><p>基本用法：见文件</p></li>
<li><p>对于bfs，我们需要一层一层遍历所有节点，那么相邻节点的访问顺序该如何确定？因此我们需要队列去存储和操作，需要使先遍历到的结点先被存储，直到当前层都被存储之后，按存储的先后顺序，先被存储的节点也会先被取出，继续遍历子节点。符合队列的FIFO特点</p></li>
</ul>
<h2 id="基本思想">基本思想</h2>
<h3 id="解决问题">解决问题</h3>
<ol type="1">
<li>从A出发是否存在到达B的路径（DFS也行）</li>
<li>从A出发到达B的最短路径（DFS+剪枝也行，容易TLE）</li>
</ol>
<h3 id="基本思想-1">基本思想</h3>
<ul>
<li><p>从初始状态s（图上某个节点出发）开始利用规律，生成所有可能状态，构成树的下一层节点</p></li>
<li><p>检查是否出现目标状态g，若未出现则对该层所有状态节点分别利用规则，生成在下一层的所有状态节点</p></li>
<li><p>对新一层继续检查重复上述操作直到出现目标状态</p></li>
<li><p>注意：BFS实际上是传回经过边数最少的解，因此对于所有边长度（边权）相同的情况，此时就一定是从根节点到目标节点最短的路径，BFS先找到的就一定是最短的，但如果是加权边，BFS传回的就不一定最短了。<strong>对于加权路径的最短路，我们使用Dijkstra算法求解。</strong></p></li>
</ul>
<h3 id="基本步骤">基本步骤</h3>
<ol type="1">
<li>起始：将起点（根节点）放入队列中</li>
<li>扩散：从队列中取出队头结点，将其相邻节点放入队列，不断重复</li>
<li>终止：当队列为空是，说明遍历完了所有节点</li>
</ol>
<h3 id="空间复杂度">空间复杂度</h3>
<p><span
class="math inline">\(S(b^n)\)</span>：b为最大分支系数，n为树高</p>
<h3 id="板子">板子</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6F42C1">Node</span><span style="color: #24292E"> </span><span style="color: #6F42C1">bfs</span><span style="color: #24292E">(</span><span style="color: #6F42C1">node</span><span style="color: #24292E"> </span><span style="color: #E36209">source</span><span style="color: #24292E">, </span><span style="color: #6F42C1">node</span><span style="color: #24292E"> </span><span style="color: #E36209">target</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">memset</span><span style="color: #24292E">(visit, </span><span style="color: #005CC5">0</span><span style="color: #24292E"> , </span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(visit));</span></span>
<span class="line"><span style="color: #24292E">    queue</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">node</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> q;</span></span>
<span class="line"><span style="color: #24292E">    q.</span><span style="color: #6F42C1">push</span><span style="color: #24292E">(source);</span></span>
<span class="line"><span style="color: #24292E">    visit[source] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E">(</span><span style="color: #D73A49">!</span><span style="color: #24292E">q.</span><span style="color: #6F42C1">empty</span><span style="color: #24292E">()){</span></span>
<span class="line"><span style="color: #24292E">        Node a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> q.</span><span style="color: #6F42C1">front</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">        q.</span><span style="color: #6F42C1">pop</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (a</span><span style="color: #D73A49">==</span><span style="color: #24292E">target) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #6A737D">/*对于a所有的后继节点b*/</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (visit[b]) </span><span style="color: #D73A49">continue</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">            q.</span><span style="color: #6F42C1">push</span><span style="color: #24292E">(b);</span></span>
<span class="line"><span style="color: #24292E">            visit[b]</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 剪枝,保证节点只进队列一次</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">NULL</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2
id="例二叉树的层次遍历-queue的实现解释">例：二叉树的层次遍历-queue的实现解释</h2>
<ul>
<li><p>层次遍历：从上到下，从左到右进行遍历</p>
<h3 id="思想">思想</h3>
<p>维护队列，用于存放节点信息，当访问到一个节点时，先访问该节点，然后将该节点的左右儿子分别入队列</p>
<h3 id="伪代码">伪代码</h3>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">bfs(int root){</span></span>
<span class="line"><span style="color: #24292e">	queue&lt;int&gt; q;</span></span>
<span class="line"><span style="color: #24292e">	q.push(root);</span></span>
<span class="line"><span style="color: #24292e">	while q不为空：</span></span>
<span class="line"><span style="color: #24292e">		获得队首元素</span></span>
<span class="line"><span style="color: #24292e">		队首元素出队</span></span>
<span class="line"><span style="color: #24292e">		输出当前节点值</span></span>
<span class="line"><span style="color: #24292e">		if 该节点左儿子不为空：将左儿子加入队列</span></span>
<span class="line"><span style="color: #24292e">		else if 该节点右儿子不为空：将右儿子加入队列</span></span>
<span class="line"><span style="color: #24292e">}</span></span></code></pre></div></div></figure>
<blockquote>
<p>例：对于一个层次遍历：5172463的树</p>
</blockquote></li>
</ul>
<p>​ 队列q：<empty></p>
<p>​ 放入root节点：q：5</p>
<p>​ 队列空否？ 不空，输出5并删除，q：<empty></p>
<p>​ 有孩子否？有，放入5的左右孩子1 7，q：1 7</p>
<p>​ 队列空否？ 不空，输出1并删除，q：7</p>
<p>​ 有孩子否？有，放入1的左右孩子2 4，q：7 2 4</p>
<p>​ 队列空否？ 不空，输出7并删除，q：2 4</p>
<p>​ 有孩子否？有，放入7的左右孩子6 3，q：2 4 6 3</p>
<p>​ 队列空否？ 不空，输出2并删除，q：4 6 3</p>
<p>​ 有孩子否？无，继续，q：4 6 3</p>
<p>​ 剩下三个相同 q：6 3 q：6 q：<empty></p>
<p>​</p>
<h2 id="例图的bfs">例：图的bfs</h2>
<figure>
<img
src="C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20241112203528097.png"
alt="image-20241112203528097" />
<figcaption aria-hidden="true">image-20241112203528097</figcaption>
</figure>
<ul>
<li>图与树类似，但图任何两点间都可以有边，故方法相似</li>
<li>但图没有层次关系，访问的是某点的邻接点，若一个点已经访问过就没必要在访问了：如B的邻接点AEC，若想要放进去子节点，则AE没有必要再入队列</li>
<li>步骤：放入起始节点，循环判断队列空不空，若不空则放入相邻节点</li>
<li><strong>BFS最适合的：寻找最少几步能达到目标（特殊的最短路问题）</strong></li>
</ul>
<h2 id="例奇怪的电梯">例：奇怪的电梯</h2>
<blockquote>
<h2 id="奇怪的电梯">奇怪的电梯</h2>
<h3 id="题目描述">题目描述</h3>
<p>呵呵，有一天我做了一个梦，梦见了一种很奇怪的电梯。大楼的每一层楼都可以停电梯，而且第
<span class="math inline">\(i\)</span> 层楼（<span
class="math inline">\(1 \le i \le N\)</span>）上有一个数字 <span
class="math inline">\(K_i\)</span>（<span class="math inline">\(0 \le
K_i \le
N\)</span>）。电梯只有四个按钮：开，关，上，下。上下的层数等于当前楼层上的那个数字。当然，如果不能满足要求，相应的按钮就会失灵。例如：
<span class="math inline">\(3, 3, 1, 2, 5\)</span> 代表了 <span
class="math inline">\(K_i\)</span>（<span
class="math inline">\(K_1=3\)</span>，<span
class="math inline">\(K_2=3\)</span>，……），从 <span
class="math inline">\(1\)</span> 楼开始。在 <span
class="math inline">\(1\)</span> 楼，按“上”可以到 <span
class="math inline">\(4\)</span> 楼，按“下”是不起作用的，因为没有 <span
class="math inline">\(-2\)</span> 楼。那么，从 <span
class="math inline">\(A\)</span> 楼到 <span
class="math inline">\(B\)</span> 楼至少要按几次按钮呢？</p>
<h3 id="输入格式">输入格式</h3>
<p>共二行。</p>
<p>第一行为三个用空格隔开的正整数，表示 <span class="math inline">\(N,
A, B\)</span>（<span class="math inline">\(1 \le N \le
200\)</span>，<span class="math inline">\(1 \le A, B \le
N\)</span>）。</p>
<p>第二行为 <span class="math inline">\(N\)</span>
个用空格隔开的非负整数，表示 <span
class="math inline">\(K_i\)</span>。</p>
<h3 id="输出格式">输出格式</h3>
<p>一行，即最少按键次数，若无法到达，则输出 <code>-1</code>。</p>
<h2 id="样例-1">样例 #1</h2>
<h3 id="样例输入-1">样例输入 #1</h3>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">5 1 5</span></span>
<span class="line"><span style="color: #24292e">3 3 1 2 5</span></span></code></pre></div></div></figure>
<h3 id="样例输出-1">样例输出 #1</h3>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">3</span></span></code></pre></div></div></figure>
<h2 id="提示">提示</h2>
<p>对于 <span class="math inline">\(100 \%\)</span> 的数据，<span
class="math inline">\(1 \le N \le 200\)</span>，<span
class="math inline">\(1 \le A, B \le N\)</span>，<span
class="math inline">\(0 \le K_i \le N\)</span>。</p>
<p>本题共 <span class="math inline">\(16\)</span> 个测试点，前 <span
class="math inline">\(15\)</span> 个每个测试点 <span
class="math inline">\(6\)</span> 分，最后一个测试点 <span
class="math inline">\(10\)</span> 分。</p>
</blockquote>
<ul>
<li><p>如样例：从1楼到5楼，可以从1-&gt;4-&gt;2-&gt;5 按三次按钮</p></li>
<li><p>搜索状态：从一个状态出发，根据题目不断转移状态直到到达目标状态，对实例如图：</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/BFS/image-20241112205230552.png" class="" title="状态">
<p>如题：从1楼开始</p>
<p>1楼只能往上到4楼，四楼只能往下到2楼，二楼只能往上到五楼</p></li>
</ul>
<p>​
所以这是一个<strong>典型的二叉树</strong>，起始状态为起点，目标状态为样例输入的楼层</p>
<ul>
<li>记录按按钮次数：使用结构体将楼层和按钮次数封装</li>
</ul>
<h3 id="代码">代码</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;algorithm&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;queue&gt;</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ios</span><span style="color: #24292E"> ios::sync_with_stdio(0); cin.tie(0);</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">endl</span><span style="color: #24292E"> &#39;\n&#39;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">300</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">node</span><span style="color: #24292E">{</span><span style="color: #6A737D">  // 保存按钮次数</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> level;</span><span style="color: #6A737D">  // 当前楼层</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> steps;</span><span style="color: #6A737D">  // 走到当前楼层所需要步数</span></span>
<span class="line"><span style="color: #24292E">}floors[N];</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> n,st,ed;</span><span style="color: #6A737D">  // 总楼层数,起始楼层,目标楼层</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> a[N], vis[N];</span><span style="color: #6A737D">  // 分别保存每个楼层可以移动几层, 该楼层是否来过</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">bfs</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  queue</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">node</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> q;</span></span>
<span class="line"><span style="color: #24292E">  node cur, net;</span><span style="color: #6A737D"> // 记录当前状态与下一状态</span></span>
<span class="line"><span style="color: #24292E">  cur.level </span><span style="color: #D73A49">=</span><span style="color: #24292E"> st;</span><span style="color: #6A737D">  // 当前位于起点，楼层为起始楼层</span></span>
<span class="line"><span style="color: #24292E">  cur.steps </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span><span style="color: #6A737D">  // 所需步数为0</span></span>
<span class="line"><span style="color: #24292E">  q.</span><span style="color: #6F42C1">push</span><span style="color: #24292E">(cur);</span><span style="color: #6A737D">  // 存入根节点</span></span>
<span class="line"><span style="color: #24292E">  vis[st]</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span><span style="color: #6A737D">  // 起始已经走过，设为1；因为过去以后无需返回，返回得到的值一定更大</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">(</span><span style="color: #D73A49">!</span><span style="color: #24292E">q.</span><span style="color: #6F42C1">empty</span><span style="color: #24292E">()){</span><span style="color: #6A737D">  // 队列非空</span></span>
<span class="line"><span style="color: #24292E">    cur </span><span style="color: #D73A49">=</span><span style="color: #24292E"> q.</span><span style="color: #6F42C1">front</span><span style="color: #24292E">();</span><span style="color: #6A737D">  // 取出队首</span></span>
<span class="line"><span style="color: #24292E">    q.</span><span style="color: #6F42C1">pop</span><span style="color: #24292E">();</span><span style="color: #6A737D">  // 删掉</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (cur.level </span><span style="color: #D73A49">==</span><span style="color: #24292E"> ed){</span><span style="color: #6A737D">  // 如果取出的对手即为目标楼层，则可以结束</span></span>
<span class="line"><span style="color: #24292E">      cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> cur.steps;</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #6A737D">    // 向上扩展</span></span>
<span class="line"><span style="color: #24292E">    net.level </span><span style="color: #D73A49">=</span><span style="color: #24292E"> cur.level </span><span style="color: #D73A49">+</span><span style="color: #24292E"> a[cur.level] ;</span><span style="color: #6A737D">  // 下一步可以走到哪个楼层</span></span>
<span class="line"><span style="color: #24292E">    net.steps </span><span style="color: #D73A49">=</span><span style="color: #24292E"> cur.steps</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span><span style="color: #6A737D">  //  步数加1</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (net.level</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n){</span><span style="color: #6A737D">  // 不超最高楼层</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (vis[net.level]</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">){</span><span style="color: #6A737D">  // 若没有来过</span></span>
<span class="line"><span style="color: #24292E">        vis[net.level] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 可以去 去完标记已来过</span></span>
<span class="line"><span style="color: #24292E">        q.</span><span style="color: #6F42C1">push</span><span style="color: #24292E">(net);</span><span style="color: #6A737D"> // 将子节点放到队列里</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #6A737D">    // 向下扩展</span></span>
<span class="line"><span style="color: #24292E">    net.level </span><span style="color: #D73A49">=</span><span style="color: #24292E"> cur.level </span><span style="color: #D73A49">-</span><span style="color: #24292E"> a[cur.level];</span></span>
<span class="line"><span style="color: #24292E">    net.steps </span><span style="color: #D73A49">=</span><span style="color: #24292E"> cur.steps</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (net.level</span><span style="color: #D73A49">&gt;=</span><span style="color: #005CC5">1</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (vis[net.level]</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        vis[net.level] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        q.</span><span style="color: #6F42C1">push</span><span style="color: #24292E">(net);</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span><span style="color: #6A737D">  // 找不到咯</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  ios;</span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> st </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> ed;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">; i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E"> n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> a[i];</span></span>
<span class="line"><span style="color: #24292E">    vis[i]</span><span style="color: #D73A49">=</span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span><span style="color: #6A737D">  // 初始化</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">bfs</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="例非常可乐">例：非常可乐</h2>
<blockquote>
<p>大家一定觉的运动以后喝可乐是一件很惬意的事情，但是seeyou却不这么认为。因为每次当seeyou买了可乐以后，阿牛就要求和seeyou一起分享这一瓶可乐，而且一定要喝的和seeyou一样多。但seeyou的手中只有两个杯子，它们的容量分别是N
毫升和M 毫升 可乐的体积为S （S&lt;101）毫升　(正好装满一瓶)
，它们三个之间可以相互倒可乐 (都是没有刻度的，且
S==N+M，101＞S＞0，N＞0，M＞0)
。聪明的ACMER你们说他们能平分吗？如果能请输出倒可乐的最少的次数，如果不能输出”NO”。</p>
<h3 id="input">Input</h3>
<p>三个整数 : S 可乐的体积 , N 和 M是两个杯子的容量，以”0 0 0”结束。</p>
<h3 id="output">Output</h3>
<p>如果能平分的话请输出最少要倒的次数，否则输出”NO”。</p>
<h3 id="sample">Sample</h3>
<h4 id="输入">输入</h4>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #005CC5">7</span><span style="color: #24292E"> </span><span style="color: #005CC5">4</span><span style="color: #24292E"> </span><span style="color: #005CC5">3</span></span>
<span class="line"><span style="color: #005CC5">4</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E"> </span><span style="color: #005CC5">3</span></span>
<span class="line"><span style="color: #005CC5">0</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span></code></pre></div></div></figure>
<h4 id="输出">输出</h4>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">No</span></span>
<span class="line"><span style="color: #24292e">3</span></span></code></pre></div></div></figure>
</blockquote>
<ul>
<li><p>看似找不出图的一个搜索：只要根据信息能表示出状态，且状态能根据规则进行转移就可以用搜索</p></li>
<li><p>定义节点状态：<strong>三杯水量+当前状态最少倒水次数</strong></p></li>
<li><p>状态转移如图（以4 1 3为例，最后一位是次数）：</p></li>
</ul>
<figure>
<img
src="C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20241112220340957.png"
alt="image-20241112220340957" />
<figcaption aria-hidden="true">image-20241112220340957</figcaption>
</figure>
<ul>
<li>目标状态：达到两个量相等一个量为0</li>
<li>倒水要求：只能倒满或者倒空</li>
<li>这种题目称为<strong>隐式图</strong></li>
<li>如何剪枝：访问过的节点不在访问</li>
</ul>
<h2 id="例离开中山路">例：离开中山路</h2>
<blockquote>
<h2 id="离开中山路">离开中山路</h2>
<h2 id="题目背景">题目背景</h2>
<p>《爱与愁的故事第三弹·shopping》最终章。</p>
<h2 id="题目描述-1">题目描述</h2>
<p>爱与愁大神买完东西后，打算坐车离开中山路。现在爱与愁大神在 <span
class="math inline">\(x_1,y_1\)</span> 处，车站在 <span
class="math inline">\(x_2,y_2\)</span> 处。现在给出一个 <span
class="math inline">\(n \times n(n \le 1000)\)</span> 的地图，<span
class="math inline">\(0\)</span> 表示马路，<span
class="math inline">\(1\)</span>
表示店铺（不能从店铺穿过），爱与愁大神只能垂直或水平着在马路上行进。爱与愁大神为了节省时间，他要求最短到达目的地距离（每两个相邻坐标间距离为
<span class="math inline">\(1\)</span>）。你能帮他解决吗？</p>
<h2 id="输入格式-1">输入格式</h2>
<p>第 <span class="math inline">\(1\)</span> 行包含一个数 <span
class="math inline">\(n\)</span>。</p>
<p>第 <span class="math inline">\(2\)</span> 行到第 <span
class="math inline">\(n+1\)</span> 行：整个地图描述（<span
class="math inline">\(0\)</span> 表示马路，<span
class="math inline">\(1\)</span>
表示店铺，注意两个数之间没有空格）。</p>
<p>第 <span class="math inline">\(n+2\)</span> 行：四个数 <span
class="math inline">\(x_1,y_1,x_2,y_2\)</span>。</p>
<h2 id="输出格式-1">输出格式</h2>
<p>只有 <span class="math inline">\(1\)</span>
行，即最短到达目的地距离。</p>
<h2 id="样例-1-1">样例 #1</h2>
<h3 id="样例输入-1-1">样例输入 #1</h3>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">3</span></span>
<span class="line"><span style="color: #24292e">001</span></span>
<span class="line"><span style="color: #24292e">101</span></span>
<span class="line"><span style="color: #24292e">100</span></span>
<span class="line"><span style="color: #24292e">1 1 3 3</span></span></code></pre></div></div></figure>
<h3 id="样例输出-1-1">样例输出 #1</h3>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">4</span></span></code></pre></div></div></figure>
<h2 id="提示-1">提示</h2>
<p>对于 <span class="math inline">\(20\%\)</span> 数据，满足 <span
class="math inline">\(1\leq n \le 100\)</span>。</p>
<p>对于 <span class="math inline">\(100\%\)</span> 数据，满足 <span
class="math inline">\(1\leq n \le 1000\)</span>。</p>
</blockquote>
<ul>
<li><p>可以使用方向数组来转移状态:</p>
<p>对于网格地图,可以定义一个二维数组
<code>int dir[4][2]=&#123;&#123;0,-1&#125;,&#123;0,1&#125;,&#123;1,0&#125;,&#123;-1,0&#125;&#125;;</code></p>
<p>则遍历四个方向可以</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i </span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">4</span><span style="color: #24292E">; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    x2 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> x1</span><span style="color: #D73A49">+</span><span style="color: #24292E">dir[i][</span><span style="color: #005CC5">0</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #24292E">    y2 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> y1</span><span style="color: #D73A49">+</span><span style="color: #24292E">dir[i][</span><span style="color: #005CC5">1</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure></li>
<li><p><strong>坑点</strong>：输入中间无空格，是一起输入的，需要用字符串转换为某行某列（ascii转化，<code>char - 'a'</code>）存入数组</p></li>
</ul>
<h3 id="代码-1">代码</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">/*迷宫问题如果要求最短路径（权值为1）相关，则可以选用bfs</span></span>
<span class="line"><span style="color: #6A737D">这里可以将迷宫看作图，详见markdown中图的遍历</span></span>
<span class="line"><span style="color: #6A737D">*/</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;algorithm&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;queue&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;utility&gt;</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ios</span><span style="color: #24292E"> ios::sync_with_stdio(0); cin.tie(0);</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">endl</span><span style="color: #24292E"> &#39;\n&#39;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1010</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> pair</span><span style="color: #D73A49">&lt;int</span><span style="color: #24292E">,</span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> PII;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> n,sx,sy,ex,ey;</span><span style="color: #6A737D">  // 记录地图大小，起点终点</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> mmap[N][N], vis[N][N];</span><span style="color: #6A737D">  //  记录地图和是否走过（走过不用再往回走，不然步数一定更长）</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> dx[]</span><span style="color: #D73A49">=</span><span style="color: #24292E">{</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">0</span><span style="color: #24292E">,</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">0</span><span style="color: #24292E">};</span><span style="color: #6A737D">  // 方向数组x</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> dy[]</span><span style="color: #D73A49">=</span><span style="color: #24292E">{</span><span style="color: #005CC5">0</span><span style="color: #24292E">,</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">0</span><span style="color: #24292E">,</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">};</span><span style="color: #6A737D">  // 方向数组y</span></span>
<span class="line"><span style="color: #6A737D">// 结构体记录坐标与步数</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">node</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> first;</span><span style="color: #6A737D">  // 当前x坐标</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> second;</span><span style="color: #6A737D">  // 当前y坐标</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> steps;</span><span style="color: #6A737D">  // 当前步数</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">bfs</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  queue</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">node</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> q;</span><span style="color: #6A737D">  // 队列</span></span>
<span class="line"><span style="color: #24292E">  node cur, net;</span><span style="color: #6A737D">  // 记录当前状态与下一状态</span></span>
<span class="line"><span style="color: #24292E">  cur.first </span><span style="color: #D73A49">=</span><span style="color: #24292E"> sx, cur.second </span><span style="color: #D73A49">=</span><span style="color: #24292E"> sy, cur.steps </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span><span style="color: #6A737D">  // 初始化为起始坐标，步数为0</span></span>
<span class="line"><span style="color: #24292E">  vis[sx][sy] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span><span style="color: #6A737D">  // 不要忘了起始坐标设为1</span></span>
<span class="line"><span style="color: #24292E">  q.</span><span style="color: #6F42C1">push</span><span style="color: #24292E">(cur);</span><span style="color: #6A737D">  // 根节点入队</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">(</span><span style="color: #D73A49">!</span><span style="color: #24292E">q.</span><span style="color: #6F42C1">empty</span><span style="color: #24292E">()){</span><span style="color: #6A737D">  // 队列变空时搜索完毕</span></span>
<span class="line"><span style="color: #24292E">    cur </span><span style="color: #D73A49">=</span><span style="color: #24292E"> q.</span><span style="color: #6F42C1">front</span><span style="color: #24292E">();</span><span style="color: #6A737D">  // 取出队首</span></span>
<span class="line"><span style="color: #24292E">    q.</span><span style="color: #6F42C1">pop</span><span style="color: #24292E">();</span><span style="color: #6A737D">  // 删除队首</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (cur.first </span><span style="color: #D73A49">==</span><span style="color: #24292E"> ex </span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E"> cur.second </span><span style="color: #D73A49">==</span><span style="color: #24292E"> ey){</span><span style="color: #6A737D">  // 到达终点</span></span>
<span class="line"><span style="color: #24292E">      cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> cur.steps;</span><span style="color: #6A737D">  //输出步数</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ;</span><span style="color: #6A737D">  // 跳出</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i </span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">4</span><span style="color: #24292E">; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span></span>
<span class="line"><span style="color: #24292E">      net.first </span><span style="color: #D73A49">=</span><span style="color: #24292E"> cur.first</span><span style="color: #D73A49">+</span><span style="color: #24292E">dx[i];</span><span style="color: #6A737D">  // 下一步的x坐标</span></span>
<span class="line"><span style="color: #24292E">      net.second </span><span style="color: #D73A49">=</span><span style="color: #24292E"> cur.second</span><span style="color: #D73A49">+</span><span style="color: #24292E">dy[i];</span><span style="color: #6A737D">  // 下一步的y坐标</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (net.first</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">1</span><span style="color: #D73A49">||</span><span style="color: #24292E">net.second</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">1</span><span style="color: #D73A49">||</span><span style="color: #24292E">net.first</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">n</span><span style="color: #D73A49">||</span><span style="color: #24292E">net.second</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">n) </span><span style="color: #D73A49">continue</span><span style="color: #24292E">;</span><span style="color: #6A737D">  // 超出边界</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (mmap[net.first][net.second]) </span><span style="color: #D73A49">continue</span><span style="color: #24292E">;</span><span style="color: #6A737D">  // 碰到障碍</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (vis[net.first][net.second]) </span><span style="color: #D73A49">continue</span><span style="color: #24292E">;</span><span style="color: #6A737D">  // 已经访问</span></span>
<span class="line"><span style="color: #24292E">      net.steps </span><span style="color: #D73A49">=</span><span style="color: #24292E"> cur.steps </span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span><span style="color: #6A737D">  // 若满足前进的条件就前进一步</span></span>
<span class="line"><span style="color: #24292E">      vis[net.first][net.second] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span><span style="color: #6A737D">  // 把访问过的地方标记</span></span>
<span class="line"><span style="color: #24292E">      q.</span><span style="color: #6F42C1">push</span><span style="color: #24292E">(net);</span><span style="color: #6A737D">  // 将子节点入队列</span></span>
<span class="line"><span style="color: #24292E">      </span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  ios;</span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n;</span></span>
<span class="line"><span style="color: #24292E">  string s;</span></span>
<span class="line"><span style="color: #6A737D">  // 注意：这里题目输入间没有空格，相当于是输入一整个数字，需要手动拆开</span></span>
<span class="line"><span style="color: #6A737D">  // 这里用转成字符串用ascii转化的方法</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> s ;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;j </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      mmap[i][j] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> s[j</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">]</span><span style="color: #D73A49">-</span><span style="color: #032F62">&#39;0&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">      vis[i][j]</span><span style="color: #D73A49">=</span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> sx </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E">sy </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> ex </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> ey;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">bfs</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>算法与数据结构</category>
      </categories>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>【算法】字符串哈希</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%93%88%E5%B8%8C/</url>
    <content><![CDATA[<h1 id="字符串哈希">字符串哈希</h1>
<p>字符串哈希是一种哈希函数</p>
<h2 id="得到哈希值">得到哈希值</h2>
<p>自然溢出：进行加减乘时，多出的位直接去掉，相当于每次都对<span
class="math inline">\(2^{64}\)</span>取模</p>
<h3 id="得到整个字符串的哈希值">得到整个字符串的哈希值：</h3>
<ul>
<li><p>选择一个质数做进制数，设为base</p></li>
<li><p>将字符串转化为base进制的数字并让其自然溢出</p>
<p>转化code：<code>ans = ans*base+v(s[i]);</code></p></li>
<li><p>让每一位的值从1开始，得到一个longlong数字代表字符串</p></li>
<li><p>利用数字比较代替字符串比较</p></li>
</ul>
<p>得到任何子串的哈希值：</p>
<ul>
<li>选择一个质数做进制数，设为base</li>
<li>得到base的各种次方，在自然溢出下用数组记录</li>
<li>得到每个位置的哈希<code>hash[i]=hash[i-1]*base+s[i]-'a'+1</code></li>
<li>字串s[l…r]的哈希值为<code>hash[r]-hash[l-1]*base^(r-l+1)</code></li>
</ul>
<h2 id="代码">代码</h2>
<p>整个字符串的哈希值：</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">endl</span><span style="color: #24292E"> &#39;\n&#39;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> ll;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> pair</span><span style="color: #D73A49">&lt;int</span><span style="color: #24292E">,</span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> PII;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #D73A49">e</span><span style="color: #005CC5">5</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> mod </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #D73A49">e</span><span style="color: #005CC5">9</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">7</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> base </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #D73A49">e</span><span style="color: #005CC5">9</span><span style="color: #D73A49">+</span><span style="color: #005CC5">7</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #6F42C1">value</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  ll ans </span><span style="color: #D73A49">=</span><span style="color: #24292E"> s[</span><span style="color: #005CC5">0</span><span style="color: #24292E">]</span><span style="color: #D73A49">-</span><span style="color: #032F62">&#39;a&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">s.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    ans </span><span style="color: #D73A49">=</span><span style="color: #24292E"> ans</span><span style="color: #D73A49">*</span><span style="color: #24292E">base</span><span style="color: #D73A49">+</span><span style="color: #24292E">(s[i]</span><span style="color: #D73A49">-</span><span style="color: #032F62">&#39;a&#39;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ans;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">solve</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> n;</span></span>
<span class="line"><span style="color: #24292E">  vector</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">ll</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> hash_s;</span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    string s;</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> s;</span></span>
<span class="line"><span style="color: #24292E">    hash_s.</span><span style="color: #6F42C1">push_back</span><span style="color: #24292E">(</span><span style="color: #6F42C1">value</span><span style="color: #24292E">(s));</span></span>
<span class="line"><span style="color: #24292E">    </span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">sort</span><span style="color: #24292E">(hash_s.</span><span style="color: #6F42C1">begin</span><span style="color: #24292E">(),hash_s.</span><span style="color: #6F42C1">end</span><span style="color: #24292E">());</span></span>
<span class="line"><span style="color: #24292E">  hash_s.</span><span style="color: #6F42C1">erase</span><span style="color: #24292E">(</span><span style="color: #6F42C1">unique</span><span style="color: #24292E">(hash_s.</span><span style="color: #6F42C1">begin</span><span style="color: #24292E">(), hash_s.</span><span style="color: #6F42C1">end</span><span style="color: #24292E">()), hash_s.</span><span style="color: #6F42C1">end</span><span style="color: #24292E">());</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> hash_s.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">()</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">ios</span><span style="color: #24292E">::</span><span style="color: #6F42C1">sync_with_stdio</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">); cin.</span><span style="color: #6F42C1">tie</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">); cout.</span><span style="color: #6F42C1">tie</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> tomorin</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  //cin &gt;&gt; tomorin;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E"> (tomorin</span><span style="color: #D73A49">--</span><span style="color: #24292E">) </span><span style="color: #6F42C1">solve</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>子串哈希值：</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">endl</span><span style="color: #24292E"> &#39;\n&#39;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> ll;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> pair</span><span style="color: #D73A49">&lt;int</span><span style="color: #24292E">,</span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> PII;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #D73A49">e</span><span style="color: #005CC5">5</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> mod </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #D73A49">e</span><span style="color: #005CC5">9</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">7</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> base </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #D73A49">e</span><span style="color: #005CC5">9</span><span style="color: #D73A49">+</span><span style="color: #005CC5">7</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt; </span><span style="color: #6F42C1">pows</span><span style="color: #24292E">(</span><span style="color: #6F42C1">N</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt; </span><span style="color: #6F42C1">hash_t</span><span style="color: #24292E">(</span><span style="color: #6F42C1">N</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">value</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  pows[</span><span style="color: #005CC5">0</span><span style="color: #24292E">]</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">s.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    pows[i] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> pows[i</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">]</span><span style="color: #D73A49">*</span><span style="color: #24292E">base;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #005CC5">hash_t</span><span style="color: #24292E">[</span><span style="color: #005CC5">0</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> s[</span><span style="color: #005CC5">0</span><span style="color: #24292E">] </span><span style="color: #D73A49">-</span><span style="color: #032F62">&#39;a&#39;</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">s.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">hash_t</span><span style="color: #24292E">[i] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">hash_t</span><span style="color: #24292E">[i</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">]</span><span style="color: #D73A49">*</span><span style="color: #24292E">base </span><span style="color: #D73A49">+</span><span style="color: #24292E">s[i]</span><span style="color: #D73A49">-</span><span style="color: #032F62">&#39;a&#39;</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #6F42C1">hash_get</span><span style="color: #24292E">(</span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #E36209">l</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #E36209">r</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  ll ans </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">hash_t</span><span style="color: #24292E">[r];</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (l</span><span style="color: #D73A49">&gt;</span><span style="color: #005CC5">0</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    ans</span><span style="color: #D73A49">-=</span><span style="color: #005CC5">hash_t</span><span style="color: #24292E">[l</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">]</span><span style="color: #D73A49">*</span><span style="color: #24292E">pows[r</span><span style="color: #D73A49">-</span><span style="color: #24292E">l</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ans;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">solve</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> n;</span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n;</span></span>
<span class="line"><span style="color: #24292E">  string s;</span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> s;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">value</span><span style="color: #24292E">(s);</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">hash_get</span><span style="color: #24292E">(</span><span style="color: #005CC5">2</span><span style="color: #24292E">,</span><span style="color: #005CC5">3</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">()</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">ios</span><span style="color: #24292E">::</span><span style="color: #6F42C1">sync_with_stdio</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">); cin.</span><span style="color: #6F42C1">tie</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">); cout.</span><span style="color: #6F42C1">tie</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> tomorin</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  //cin &gt;&gt; tomorin;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E"> (tomorin</span><span style="color: #D73A49">--</span><span style="color: #24292E">) </span><span style="color: #6F42C1">solve</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>算法与数据结构</category>
      </categories>
      <tags>
        <tag>算法</tag>
        <tag>字符串</tag>
      </tags>
  </entry>
  <entry>
    <title>【图论】图上BFS/DFS</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%9B%BE%E4%B8%8ABFS%E4%B8%8EDFS/</url>
    <content><![CDATA[<h1 id="图上bfs">图上BFS</h1>
<p>将BFS扩展到图，从顶点0开始访问，逐层访问其邻居顶点，持续到访问完毕</p>
<p>最后获得序列：按照访问距离离起始顶点最近的所有顶点</p>
<p>按照该序列，访问到每个顶点后，就找到了达到该顶点的最短路径（适用于权值相等）</p>
<p><strong>对相同距离邻居顶点，访问顺序不重要</strong></p>
<p>同样可以使用队列实现</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">100</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">bool</span><span style="color: #24292E"> vis[N];</span><span style="color: #6A737D"> // 访问标记数组</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">char</span><span style="color: #24292E"> VertexType ;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> EdgeType;</span></span>
<span class="line"><span style="color: #24292E">queue</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> q;</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">mat_grph</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  VertexType vertex[N];</span></span>
<span class="line"><span style="color: #24292E">  EdgeType arc[N][N];</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> vertex_num;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> edge_num;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">create_graph</span><span style="color: #24292E">(</span><span style="color: #6F42C1">mat_grph</span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #E36209">G</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;vertex_num </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">9</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;edge_num </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">15</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;vertex[</span><span style="color: #005CC5">0</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;A&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;vertex[</span><span style="color: #005CC5">1</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;B&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;vertex[</span><span style="color: #005CC5">2</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;C&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;vertex[</span><span style="color: #005CC5">3</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;D&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;vertex[</span><span style="color: #005CC5">4</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;E&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;vertex[</span><span style="color: #005CC5">5</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;F&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;vertex[</span><span style="color: #005CC5">6</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;G&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;vertex[</span><span style="color: #005CC5">7</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;H&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;vertex[</span><span style="color: #005CC5">8</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;I&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">G-&gt;vertex_num;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;j</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">G-&gt;vertex_num;j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      G-&gt;arc[i][j] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">0</span><span style="color: #24292E">][</span><span style="color: #005CC5">1</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">0</span><span style="color: #24292E">][</span><span style="color: #005CC5">5</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">1</span><span style="color: #24292E">][</span><span style="color: #005CC5">2</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">1</span><span style="color: #24292E">][</span><span style="color: #005CC5">6</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">1</span><span style="color: #24292E">][</span><span style="color: #005CC5">8</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">2</span><span style="color: #24292E">][</span><span style="color: #005CC5">3</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">2</span><span style="color: #24292E">][</span><span style="color: #005CC5">8</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">3</span><span style="color: #24292E">][</span><span style="color: #005CC5">4</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">3</span><span style="color: #24292E">][</span><span style="color: #005CC5">6</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">3</span><span style="color: #24292E">][</span><span style="color: #005CC5">7</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">3</span><span style="color: #24292E">][</span><span style="color: #005CC5">8</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">4</span><span style="color: #24292E">][</span><span style="color: #005CC5">5</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">4</span><span style="color: #24292E">][</span><span style="color: #005CC5">7</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">5</span><span style="color: #24292E">][</span><span style="color: #005CC5">6</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">6</span><span style="color: #24292E">][</span><span style="color: #005CC5">7</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  // 无向图，把对称的也复制过去</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">G-&gt;vertex_num;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;j</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">G-&gt;vertex_num;j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      G-&gt;arc[j][i] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> G-&gt;arc[i][j];</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">bfs</span><span style="color: #24292E">(</span><span style="color: #6F42C1">mat_grph</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">G</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  vis[i]</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> G.vertex[i]</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  q.</span><span style="color: #6F42C1">push</span><span style="color: #24292E">(i);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">(</span><span style="color: #D73A49">!</span><span style="color: #24292E">q.</span><span style="color: #6F42C1">empty</span><span style="color: #24292E">()){</span></span>
<span class="line"><span style="color: #24292E">    i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> q.</span><span style="color: #6F42C1">front</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    q.</span><span style="color: #6F42C1">pop</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;j</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">G.vertex_num;j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">(vis[j])</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E">G.arc[i][j]</span><span style="color: #D73A49">==</span><span style="color: #005CC5">1</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        vis[j] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> G.vertex[j]</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">        q.</span><span style="color: #6F42C1">push</span><span style="color: #24292E">(j);</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  mat_grph G;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">create_graph</span><span style="color: #24292E">(</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">G);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">memset</span><span style="color: #24292E">(vis, </span><span style="color: #005CC5">0</span><span style="color: #24292E">, sizeof vis);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">bfs</span><span style="color: #24292E">(G);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h1 id="图上dfs">图上DFS</h1>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%9B%BE%E4%B8%8ABFS%E4%B8%8EDFS/image-20250420205037428.png" class="" title="DFS邻接矩阵">
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">100</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">bool</span><span style="color: #24292E"> vis[N];</span><span style="color: #6A737D"> // 访问标记数组</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">char</span><span style="color: #24292E"> VertexType ;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> EdgeType;</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">mat_grph</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  VertexType vertex[N];</span></span>
<span class="line"><span style="color: #24292E">  EdgeType arc[N][N];</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> vertex_num;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> edge_num;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">create_graph</span><span style="color: #24292E">(</span><span style="color: #6F42C1">mat_grph</span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #E36209">G</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;vertex_num </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">9</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;edge_num </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">15</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;vertex[</span><span style="color: #005CC5">0</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;A&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;vertex[</span><span style="color: #005CC5">1</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;B&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;vertex[</span><span style="color: #005CC5">2</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;C&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;vertex[</span><span style="color: #005CC5">3</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;D&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;vertex[</span><span style="color: #005CC5">4</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;E&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;vertex[</span><span style="color: #005CC5">5</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;F&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;vertex[</span><span style="color: #005CC5">6</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;G&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;vertex[</span><span style="color: #005CC5">7</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;H&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;vertex[</span><span style="color: #005CC5">8</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;I&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">G-&gt;vertex_num;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;j</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">G-&gt;vertex_num;j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      G-&gt;arc[i][j] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">0</span><span style="color: #24292E">][</span><span style="color: #005CC5">1</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">0</span><span style="color: #24292E">][</span><span style="color: #005CC5">5</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">1</span><span style="color: #24292E">][</span><span style="color: #005CC5">2</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">1</span><span style="color: #24292E">][</span><span style="color: #005CC5">6</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">1</span><span style="color: #24292E">][</span><span style="color: #005CC5">8</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">2</span><span style="color: #24292E">][</span><span style="color: #005CC5">3</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">2</span><span style="color: #24292E">][</span><span style="color: #005CC5">8</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">3</span><span style="color: #24292E">][</span><span style="color: #005CC5">4</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">3</span><span style="color: #24292E">][</span><span style="color: #005CC5">6</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">3</span><span style="color: #24292E">][</span><span style="color: #005CC5">7</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">3</span><span style="color: #24292E">][</span><span style="color: #005CC5">8</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">4</span><span style="color: #24292E">][</span><span style="color: #005CC5">5</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">4</span><span style="color: #24292E">][</span><span style="color: #005CC5">7</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">5</span><span style="color: #24292E">][</span><span style="color: #005CC5">6</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">6</span><span style="color: #24292E">][</span><span style="color: #005CC5">7</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  // 无向图，把对称的也复制过去</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">G-&gt;vertex_num;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;j</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">G-&gt;vertex_num;j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      G-&gt;arc[j][i] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> G-&gt;arc[i][j];</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">dfs</span><span style="color: #24292E">(</span><span style="color: #6F42C1">mat_grph</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">G</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">i</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  vis[i] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> G.vertex[i]</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;j</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">G.vertex_num;j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span><span style="color: #6A737D"> // 寻找邻接矩阵中和第i个顶点间有边的顶点</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> ((</span><span style="color: #D73A49">!</span><span style="color: #24292E">vis[j]) </span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E"> G.arc[i][j]</span><span style="color: #D73A49">==</span><span style="color: #005CC5">1</span><span style="color: #24292E">){</span><span style="color: #6A737D"> // 如果没被访问过且存在边，则从其对应的顶点开始搜索与其有边的顶点</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">dfs</span><span style="color: #24292E">(G, j);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  mat_grph G;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">create_graph</span><span style="color: #24292E">(</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">G);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">memset</span><span style="color: #24292E">(vis, </span><span style="color: #005CC5">0</span><span style="color: #24292E">, sizeof vis);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">dfs</span><span style="color: #24292E">(G, </span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>算法与数据结构</category>
      </categories>
      <tags>
        <tag>数据结构</tag>
        <tag>图论</tag>
      </tags>
  </entry>
  <entry>
    <title>【数据结构】并查集</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%B9%B6%E6%9F%A5%E9%9B%86(Disjoint%20Set)/</url>
    <content><![CDATA[<h1 id="并查集disjoint-set">并查集(Disjoint Set)</h1>
<h2 id="概念">概念</h2>
<p>不相交集合：若有n个元素，其中的每个元素如果只属于某个集合，则可以把他们划为不想交集合</p>
<p>问题描述：将编号分别为1-n的n个对象划分为不相交集合，在每个集合中，选择其中某个元素代表所在集合</p>
<p>解决的问题：</p>
<ul>
<li>合并两个集合</li>
<li>查找某个元素属于哪个集合</li>
</ul>
<hr />
<blockquote>
<p>定义一个数组set，set[i]代表i所在的集合</p>
<p>我们用每个集合编号最小的元素标记所在集合</p>
</blockquote>
<h2 id="实现1">实现1</h2>
<p>如set: 1 2 1 4 2 6 1 6 2 2</p>
<p>他的不相交集合为{1,3,7}, {4}, {2,5,9,10}, {6,8}</p>
<h3 id="效率">效率</h3>
<p>查：只需要返回下标对应元素，因为此时对应的就是集合中的最小元素，<span
class="math inline">\(O(1)\)</span></p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6F42C1">find1</span><span style="color: #24292E">(x){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> set[x];</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>并：合并两个集合后，要找出一个更小的作为代表元素，合并时要遍历set中所有元素，把还是原来元素的改成新的更小元素，<span
class="math inline">\(O(n)\)</span></p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6F42C1">merge1</span><span style="color: #24292E">(a,b){</span></span>
<span class="line"><span style="color: #24292E">    i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">min</span><span style="color: #24292E">(a,b);</span></span>
<span class="line"><span style="color: #24292E">    j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">max</span><span style="color: #24292E">(a,b);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> k</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;k</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;k</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (set[k]</span><span style="color: #D73A49">==</span><span style="color: #24292E">j) set[k]</span><span style="color: #D73A49">==</span><span style="color: #24292E">i;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="实现2">实现2</h2>
<h4 id="每个集合用一颗有根树表示">每个集合用一颗有根树表示</h4>
<p>定义一个数组set</p>
<ul>
<li>若set[i]=i, 则i为该树的根节点，i代表本集合</li>
<li>若set[i]=j, 若j<span class="math inline">\(\neq\)</span>i,
则j是i的父节点</li>
</ul>
<h3 id="效率-1">效率</h3>
<p>查：如果集合对应的不是自己，则自己上面有父节点，将父节点存下来继续查找直到查到根节点，最坏<span
class="math inline">\(O(n)\)</span>，一般<span
class="math inline">\(O(\log n)\)</span></p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6F42C1">find2</span><span style="color: #24292E">(x){</span></span>
<span class="line"><span style="color: #24292E">    r </span><span style="color: #D73A49">=</span><span style="color: #24292E"> x;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E">(set[r]</span><span style="color: #D73A49">!=</span><span style="color: #24292E">r){</span></span>
<span class="line"><span style="color: #24292E">        r </span><span style="color: #D73A49">=</span><span style="color: #24292E"> set[r];</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> r;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>并：只需要将根节点改为另一个集合的根节点即可，<span
class="math inline">\(O(1)\)</span></p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6F42C1">merge2</span><span style="color: #24292E">(a,b){</span></span>
<span class="line"><span style="color: #24292E">    set[a]</span><span style="color: #D73A49">=</span><span style="color: #24292E">b;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="改进">改进</h3>
<p>如何避免最坏情况？</p>
<p>方法：<strong>将深度小的树合并到深度大的树</strong>，合并后深度不会变化</p>
<p>效果：合并后，包含k个节点的树最大高度不超过<span
class="math inline">\(\lfloor \lg k \rfloor\)</span></p>
<p>代码： 在合并时记录每棵树的高度，谁的高度大谁是新的根节点</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6F42C1">merge3</span><span style="color: #24292E">(a,b){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #6F42C1">height</span><span style="color: #24292E">(a)</span><span style="color: #D73A49">==</span><span style="color: #6F42C1">height</span><span style="color: #24292E">(b)){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">height</span><span style="color: #24292E">(a)</span><span style="color: #D73A49">=</span><span style="color: #6F42C1">height</span><span style="color: #24292E">(a)</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        set[b]</span><span style="color: #D73A49">=</span><span style="color: #24292E">a;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #6F42C1">height</span><span style="color: #24292E">(a)</span><span style="color: #D73A49">&lt;</span><span style="color: #6F42C1">height</span><span style="color: #24292E">(b)) set[a]</span><span style="color: #D73A49">=</span><span style="color: #24292E">b;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E"> set[b]</span><span style="color: #D73A49">=</span><span style="color: #24292E">a;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>此时查找操作的时间复杂度变成了<span class="math inline">\(O(\log
n)\)</span></p>
<h2 id="路径压缩">路径压缩</h2>
<p>问题：若一棵树的高度很大，查找路径很长，查找量很大的时候，很容易tle</p>
<p>思想：查找时如果路径较长，则修改信息，让下次查找的时候速度更快</p>
<p>方案：</p>
<ul>
<li>找到根节点</li>
<li>修改查找路径上的<strong>所有节点</strong>，将它们都指向根节点</li>
</ul>
<p><img src="E:\CS\Templates\并查集\并查集(Disjoint Set).assets\image-20241213095455535.png" alt="image-20241213095455535" style="zoom:67%;" /></p>
<h3 id="代码">代码</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6F42C1">find3</span><span style="color: #24292E">(x){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (set[x]</span><span style="color: #D73A49">!=</span><span style="color: #24292E">x) set[x]</span><span style="color: #D73A49">=</span><span style="color: #6F42C1">find3</span><span style="color: #24292E">(set[x]);</span><span style="color: #6A737D"> //当不是根节点时，调用find3找到其父节点的父节点，并赋给他的父节点，此时x的父节点改为他的父节点的父节点，直到指到他的根节点</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> set[x];</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="模板">模板</h2>
<blockquote>
<h3 id="题目描述">题目描述</h3>
<p>如题，现在有一个并查集，你需要完成合并和查询操作。</p>
<h3 id="输入格式">输入格式</h3>
<p>第一行包含两个整数 <span class="math inline">\(N,M\)</span> ,表示共有
<span class="math inline">\(N\)</span> 个元素和 <span
class="math inline">\(M\)</span> 个操作。</p>
<p>接下来 <span class="math inline">\(M\)</span> 行，每行包含三个整数
<span class="math inline">\(Z_i,X_i,Y_i\)</span> 。</p>
<p>当 <span class="math inline">\(Z_i=1\)</span> 时，将 <span
class="math inline">\(X_i\)</span> 与 <span
class="math inline">\(Y_i\)</span> 所在的集合合并。</p>
<p>当 <span class="math inline">\(Z_i=2\)</span> 时，输出 <span
class="math inline">\(X_i\)</span> 与 <span
class="math inline">\(Y_i\)</span> 是否在同一集合内，是的输出
<code>Y</code> ；否则输出 <code>N</code> 。</p>
<h3 id="输出格式">输出格式</h3>
<p>对于每一个 <span class="math inline">\(Z_i=2\)</span>
的操作，都有一行输出，每行包含一个大写字母，为 <code>Y</code> 或者
<code>N</code> 。</p>
<h3 id="样例-1">样例 #1</h3>
<h3 id="样例输入-1">样例输入 #1</h3>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">4 7</span></span>
<span class="line"><span style="color: #24292e">2 1 2</span></span>
<span class="line"><span style="color: #24292e">1 1 2</span></span>
<span class="line"><span style="color: #24292e">2 1 2</span></span>
<span class="line"><span style="color: #24292e">1 3 4</span></span>
<span class="line"><span style="color: #24292e">2 1 4</span></span>
<span class="line"><span style="color: #24292e">1 2 3</span></span>
<span class="line"><span style="color: #24292e">2 1 4</span></span></code></pre></div></div></figure>
<h3 id="样例输出-1">样例输出 #1</h3>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">N</span></span>
<span class="line"><span style="color: #24292e">Y</span></span>
<span class="line"><span style="color: #24292e">N</span></span>
<span class="line"><span style="color: #24292e">Y</span></span></code></pre></div></div></figure>
<h3 id="提示">提示</h3>
<p>对于 <span class="math inline">\(30\%\)</span> 的数据，<span
class="math inline">\(N \le 10\)</span>，<span class="math inline">\(M
\le 20\)</span>。</p>
<p>对于 <span class="math inline">\(70\%\)</span> 的数据，<span
class="math inline">\(N \le 100\)</span>，<span class="math inline">\(M
\le 10^3\)</span>。</p>
<p>对于 <span class="math inline">\(100\%\)</span> 的数据，<span
class="math inline">\(1\le N \le 10^4\)</span>，<span
class="math inline">\(1\le M \le 2\times 10^5\)</span>，<span
class="math inline">\(1 \le X_i, Y_i \le N\)</span>，<span
class="math inline">\(Z_i \in \{ 1, 2 \}\)</span>。</p>
</blockquote>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;cstring&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #D73A49">e</span><span style="color: #005CC5">6</span><span style="color: #D73A49">+</span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> n,m;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> disj[N];</span><span style="color: #6A737D"> // 并查集</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> cnt[N];</span><span style="color: #6A737D"> // 记录最大集合个数</span></span>
<span class="line"><span style="color: #6A737D">// 查找操作，使用路径压缩</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">find</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E">(disj[x]</span><span style="color: #D73A49">!=</span><span style="color: #24292E">x) disj[x]</span><span style="color: #D73A49">=</span><span style="color: #6F42C1">find</span><span style="color: #24292E">(disj[x]);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> disj[x];</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6A737D">// 合并操作，寻找两者最小根节点并将大的修改成小的</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">merge</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">,</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> ra </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">find</span><span style="color: #24292E">(a);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> rb </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">find</span><span style="color: #24292E">(b);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E">(ra</span><span style="color: #D73A49">!=</span><span style="color: #24292E">rb){</span></span>
<span class="line"><span style="color: #24292E">    disj[ra] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> rb;</span></span>
<span class="line"><span style="color: #24292E">    cnt[rb]</span><span style="color: #D73A49">+=</span><span style="color: #24292E">cnt[ra];</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6A737D">// 找集合个数（并查集找根）</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fcnt</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">bool</span><span style="color: #24292E"> vis[N]</span><span style="color: #D73A49">=</span><span style="color: #24292E">{};</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> ans </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">vis[</span><span style="color: #6F42C1">find</span><span style="color: #24292E">(i)]){</span></span>
<span class="line"><span style="color: #24292E">      vis[</span><span style="color: #6F42C1">find</span><span style="color: #24292E">(i)]</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">      ans</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ans;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E">m;</span></span>
<span class="line"><span style="color: #6A737D">  // 初始化每一位的根节点是他自己</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">memset</span><span style="color: #24292E">(cnt, </span><span style="color: #005CC5">1</span><span style="color: #24292E">, sizeof cnt);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) disj[i]</span><span style="color: #D73A49">=</span><span style="color: #24292E">i;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">(m</span><span style="color: #D73A49">--</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> z, x, y;</span></span>
<span class="line"><span style="color: #24292E">    cin</span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E">z</span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E">x</span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E">y;</span></span>
<span class="line"><span style="color: #6A737D">    // 进行合并</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (z</span><span style="color: #D73A49">==</span><span style="color: #005CC5">1</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">merge</span><span style="color: #24292E">(x,y);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #6A737D">      // 如果两者的根节点相同，则属于同一集合</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E">(</span><span style="color: #6F42C1">find</span><span style="color: #24292E">(x)</span><span style="color: #D73A49">==</span><span style="color: #6F42C1">find</span><span style="color: #24292E">(y)) cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;Y&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">else</span><span style="color: #24292E"> cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;N&quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="种类并查集">种类并查集</h2>
<p>一般的并查集维护的是具有连通性的一组关系，而对于一个具有多种关系（相斥或相互独立），我们需要使用种类并查集，亦称拓展域并查集</p>
<p>种类并查集是一种数据结构，用于解决具有多个相互关系集合的问题。它是传统并查集的扩展，能够处理集合间的不同关系，如相互排斥或相互独立的关系。</p>
<p>更具体一些，种类并查集维护的是一种循环对称的关系：</p>
<p>如果是<strong>三个及以上的集合，只要每个集合都是等价的，且集合间的每个关系都是等价的</strong>，就能用种类并查集来维护</p>
<p>例：</p>
<ul>
<li>敌人的敌人是朋友(<a
href="https://www.luogu.com.cn/problem/P1525">洛谷P1525</a>)</li>
</ul>
<p>该题使用贪心，可以把矛盾关系从大到小排序，将矛盾关系大的关到不同监狱中</p>
<p>但给出的信息是存在仇恨不能出现在同一监狱的两个人，故不能用传统并查集的思路处理</p>
<p>这里我们开两倍大小的并查集（拓展域），用前一半维护朋友关系，后一半维护敌人关系</p>
<p>假如共有4人，1是2的敌人，那我们将1和2+4合并，1+4和2合并，即1和6是敌人，5和2是敌人，又5和6是敌人关系，故1和5是朋友，5又和2是敌人，故1和2是敌人，2和1同理</p>
<p>故我们需要每次<code>merge(i,j+n)</code>与<code>merge(i+n,j)</code>来建立关系</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">endl</span><span style="color: #24292E"> &#39;\n&#39;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> ll;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> pair</span><span style="color: #D73A49">&lt;int</span><span style="color: #24292E">,</span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> PII;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #D73A49">e</span><span style="color: #005CC5">4</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> mod </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #D73A49">e</span><span style="color: #005CC5">9</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">7</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">node</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> x, y, z;</span></span>
<span class="line"><span style="color: #24292E">}pri[</span><span style="color: #005CC5">100050</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #6A737D">// 为假想敌预留空间，开2*N</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> disj[</span><span style="color: #005CC5">2</span><span style="color: #D73A49">*</span><span style="color: #24292E">N];</span></span>
<span class="line"><span style="color: #6A737D">//查</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">find</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E">(disj[x]</span><span style="color: #D73A49">!=</span><span style="color: #24292E">x)disj[x]</span><span style="color: #D73A49">=</span><span style="color: #6F42C1">find</span><span style="color: #24292E">(disj[x]);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> disj[x];</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6A737D">// 并</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">merge</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #6F42C1">find</span><span style="color: #24292E">(a)</span><span style="color: #D73A49">&gt;</span><span style="color: #6F42C1">find</span><span style="color: #24292E">(b))disj[</span><span style="color: #6F42C1">find</span><span style="color: #24292E">(a)] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">find</span><span style="color: #24292E">(b);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">else</span><span style="color: #24292E"> disj[</span><span style="color: #6F42C1">find</span><span style="color: #24292E">(b)]</span><span style="color: #D73A49">=</span><span style="color: #6F42C1">find</span><span style="color: #24292E">(a);</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">solve</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> n,m;</span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> m;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">m;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> pri[i].x </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> pri[i].y </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> pri[i].z;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 按罪恶值从大到小排序</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">sort</span><span style="color: #24292E">(pri</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">,pri</span><span style="color: #D73A49">+</span><span style="color: #24292E">m</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">, [</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">](</span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">node</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">node</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span><span style="color: #D73A49">return</span><span style="color: #24292E"> a.z</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">b.z;});</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n</span><span style="color: #D73A49">*</span><span style="color: #005CC5">2</span><span style="color: #24292E">;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    disj[i]</span><span style="color: #D73A49">=</span><span style="color: #24292E">i;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">m;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #6F42C1">find</span><span style="color: #24292E">(pri[i].x)</span><span style="color: #D73A49">==</span><span style="color: #6F42C1">find</span><span style="color: #24292E">(pri[i].y)){</span><span style="color: #6A737D"> // 若敌人的敌人仍在同监狱里，那还是敌人，只能输出值</span></span>
<span class="line"><span style="color: #24292E">      cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">pri[i].z;</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #6A737D">    // 合并敌人的敌人</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">merge</span><span style="color: #24292E">(pri[i].x</span><span style="color: #D73A49">+</span><span style="color: #24292E">n,pri[i].y);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">merge</span><span style="color: #24292E">(pri[i].x,pri[i].y</span><span style="color: #D73A49">+</span><span style="color: #24292E">n);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 全部遍历后发现没有符合的</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">()</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">ios</span><span style="color: #24292E">::</span><span style="color: #6F42C1">sync_with_stdio</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">); cin.</span><span style="color: #6F42C1">tie</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">); cout.</span><span style="color: #6F42C1">tie</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> tomorin</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  //cin &gt;&gt; tomorin;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E"> (tomorin</span><span style="color: #D73A49">--</span><span style="color: #24292E">) </span><span style="color: #6F42C1">solve</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>算法与数据结构</category>
      </categories>
      <tags>
        <tag>数据结构</tag>
      </tags>
  </entry>
  <entry>
    <title>【算法】快速幂</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%BF%AB%E9%80%9F%E5%B9%82/</url>
    <content><![CDATA[<h1 id="快速幂">快速幂</h1>
<h2 id="问题引入">问题引入</h2>
<blockquote>
<p>如何计算<span class="math inline">\(a^n\)</span></p>
</blockquote>
<p>朴素算法：让n个a相乘，时间复杂度为<span
class="math inline">\(O(n)\)</span>，当n特别大的时候，耗时特别长</p>
<p>而快速幂算法可以大大减少时间复杂度</p>
<h2 id="n的分类">n的分类</h2>
<h3 id="n为2的幂次时">n为2的幂次时</h3>
<p>如<span class="math inline">\(a^{64}\)</span></p>
<p>我们可以用上一次的结果当作下一次的乘数：</p>
<figure>
<img src="/快速幂/qpow1.png" title="快速幂1" alt="快速幂原理" />
<figcaption aria-hidden="true">快速幂原理</figcaption>
</figure>
<p>这样只需要进行六次乘法就可以得出结果，时间复杂度为<span
class="math inline">\(O(\log n)\)</span></p>
<p>即使用了<strong>倍增原理</strong>，将每次a的数量翻倍</p>
<h3 id="n不为2的幂次时">n不为2的幂次时</h3>
<p>我们可以将不是2的幂的数写成若干个2的幂的数的和，如<span
class="math inline">\(a^{105}\)</span></p>
<p>可以改写为<span
class="math inline">\(a^{1+8+32+64}\)</span>，再根据以上方法计算</p>
<h2 id="如何将n分解为2的幂次之和">如何将n分解为2的幂次之和？</h2>
<p>答案是位运算</p>
<p>让我们看看这几个数的二进制表示形式</p>
<figure>
<img src="/快速幂/qpow2.png" title="快速幂2"
alt="二进制表示分解n的原理" />
<figcaption aria-hidden="true">二进制表示分解n的原理</figcaption>
</figure>
<p>会发现，目标数n的二进制中的1的个数与位置正好对应它分解后的数字</p>
<h2 id="伪代码">伪代码</h2>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">function bigexp(a,n)</span></span>
<span class="line"><span style="color: #24292e">	r = 1</span></span>
<span class="line"><span style="color: #24292e">	while n!=0</span></span>
<span class="line"><span style="color: #24292e">		if n mod 2 == 1</span></span>
<span class="line"><span style="color: #24292e">			r = r*a</span></span>
<span class="line"><span style="color: #24292e">		a=a*a</span></span>
<span class="line"><span style="color: #24292e">		n=n/2</span></span>
<span class="line"><span style="color: #24292e">	return r</span></span></code></pre></div></div></figure>
<h4 id="逻辑">逻辑</h4>
<p>行3，7：每次除二，让二进制位从右到左减少一位，相当于右移一位</p>
<p>行6：每次让<span class="math inline">\(a^{n}\)</span>翻倍（<span
class="math inline">\(a^{1}\)</span>,<span
class="math inline">\(a^{2}\)</span>,<span
class="math inline">\(a^{4}\)</span>,<span
class="math inline">\(a^{8}\)</span>,<span
class="math inline">\(a^{16}\)</span>…）</p>
<p>行2，4，5，8：如果mod2==1，代表该位是1，则将该位代表的<span
class="math inline">\(a^{n}\)</span>与结果相乘，即让幂次相加</p>
<h4 id="位运算改进">位运算改进</h4>
<p><strong><code>n mod 2==1</code>等同于<code>n&amp;1</code></strong>，<strong><code>n/2</code>等同于<code>n&gt;&gt;1</code></strong></p>
<h4 id="时间复杂度">时间复杂度</h4>
<p><span class="math inline">\(O(\log
n)\)</span>，循环次数为n的二进制位数，对于整数n，它的二进制位数为<span
class="math inline">\(1+\lfloor\log_2n\rfloor\)</span></p>
<h2 id="板子">板子</h2>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">BigExp</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">,</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">n</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> r </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E"> (n</span><span style="color: #D73A49">!=</span><span style="color: #005CC5">0</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (n</span><span style="color: #D73A49">&amp;</span><span style="color: #005CC5">1</span><span style="color: #24292E">) r </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (r</span><span style="color: #D73A49">*</span><span style="color: #24292E">a);</span></span>
<span class="line"><span style="color: #24292E">        a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (a</span><span style="color: #D73A49">*</span><span style="color: #24292E">a);</span></span>
<span class="line"><span style="color: #24292E">        n </span><span style="color: #D73A49">&gt;&gt;=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> r;</span></span>
<span class="line"><span style="color: #24292E">   }</span></span></code></pre></div></div></figure>
<h2 id="应用1幂取模">应用1：幂取模</h2>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ModExpFast</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">,</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">n</span><span style="color: #24292E">,</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">m</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> r </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E"> (n</span><span style="color: #D73A49">!=</span><span style="color: #005CC5">0</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (n</span><span style="color: #D73A49">&amp;</span><span style="color: #005CC5">1</span><span style="color: #24292E">) r </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (r</span><span style="color: #D73A49">*</span><span style="color: #24292E">a)</span><span style="color: #D73A49">%</span><span style="color: #24292E">m;</span></span>
<span class="line"><span style="color: #24292E">        a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (a</span><span style="color: #D73A49">*</span><span style="color: #24292E">a)</span><span style="color: #D73A49">%</span><span style="color: #24292E">m;</span></span>
<span class="line"><span style="color: #24292E">        n </span><span style="color: #D73A49">&gt;&gt;=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> r;</span></span>
<span class="line"><span style="color: #24292E">   }</span></span></code></pre></div></div></figure>
<p>注：<span class="math inline">\((a \times b)\mod m=((a\mod
m)\times(b\mod m))\mod m\)</span></p>
<h2 id="应用2斐波那契数列">应用2：斐波那契数列</h2>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6F42C1">pair</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt; </span><span style="color: #6F42C1">fib</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">n</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (n </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> {</span><span style="color: #005CC5">0</span><span style="color: #24292E">, </span><span style="color: #005CC5">1</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fib</span><span style="color: #24292E">(n </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> c </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p.first </span><span style="color: #D73A49">*</span><span style="color: #24292E"> (</span><span style="color: #005CC5">2</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E"> p.second </span><span style="color: #D73A49">-</span><span style="color: #24292E"> p.first);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> d </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p.first </span><span style="color: #D73A49">*</span><span style="color: #24292E"> p.first </span><span style="color: #D73A49">+</span><span style="color: #24292E"> p.second </span><span style="color: #D73A49">*</span><span style="color: #24292E"> p.second;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (n </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> {d, c </span><span style="color: #D73A49">+</span><span style="color: #24292E"> d};</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">else</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> {c, d};</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>用矩阵形式表示斐波那契数列，如下图</p>
<figure>
<img src="/快速幂/qpow3.png" title="快速幂3" alt="斐波那契矩阵表示" />
<figcaption aria-hidden="true">斐波那契矩阵表示</figcaption>
</figure>
<p>我们可以发现它可以分为n个矩阵相乘 <span class="math display">\[
\left(
\begin{array}{cc}
1 &amp; 1\\
1 &amp; 0
\end{array}
\right)
^{n}
\]</span> 再乘列向量F1 F0</p>
]]></content>
      <categories>
        <category>算法与数据结构</category>
      </categories>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>【动态规划】子序列问题</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%AD%90%E5%BA%8F%E5%88%97%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<h1 id="子序列问题">子序列问题</h1>
<h2 id="最长公共子序列lcs">最长公共子序列(LCS)</h2>
<p>公共子序列即两个字符串中共有的子序列，现在需要寻找两个字符串的最长公共子序列</p>
<h3 id="思路">思路</h3>
<p>本质上是选与不选的问题，我们考虑最后一对字母，两两组合有四种情况</p>
<p>更一般化：</p>
<ul>
<li>当前操作：考虑<code>s[i]</code>与<code>t[j]</code>选或不选</li>
<li>子问题：s的前i个字母和t的前j个字母的LCS长度</li>
<li>下一个子问题
<ul>
<li>s的前i-1个字母和t的前j-1个字母的LCS长度（都选或都不选）</li>
<li>s的前i-1个字母和t的前j个字母的LCS长度（选s[i]不选t[j]）</li>
<li>s的前i个字母和t的前j-1个字母的LCS长度（选t[j]不选s[i]）</li>
</ul></li>
</ul>
<h3 id="转移方程">转移方程</h3>
<p><code>dfs(i,j) = max(dfs(i-1, j-i), dfs(i-1, j), dfs(i,j-1)+(s[i]==t[j]))</code></p>
<p>但可以考虑两个问题：</p>
<ul>
<li><code>s[i]==t[j]</code>时，需要<code>dfs(i-1, j-i), dfs(i-1, j)</code>吗？</li>
</ul>
<p>​ 不需要，可以从子序列方向推出矛盾</p>
<ul>
<li><p><code>s[i]!=t[j]</code>时，需要<code>dfs(i-1, j-1)</code>吗？</p>
<p>不需要，<code>dfs(i-1, j-1)</code>的结果已经在<code>dfs(i-1, j-i), dfs(i-1, j)</code>里面了</p></li>
</ul>
<p>故方程可以简化为 <span class="math display">\[
f[i][j] = \begin{cases}  f[i-1][j-1]+1
&amp;&amp;s[i]=t[j]\\  max(f[i-1][j], f[i][j-1]) &amp;&amp;s[i]\neq t[j]
\end{cases}
\]</span></p>
<h3 id="code">code</h3>
<p>朴素LCS：空间和时间都为<span
class="math inline">\(O(n^2)\)</span></p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> dp[N][N]</span><span style="color: #D73A49">=</span><span style="color: #24292E">{};</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">solve</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> n;</span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n;</span></span>
<span class="line"><span style="color: #24292E">  vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">s</span><span style="color: #24292E">(n</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">, </span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">t</span><span style="color: #24292E">(n</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">, </span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> s[i];</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> t[i];</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;j</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (s[i]</span><span style="color: #D73A49">==</span><span style="color: #24292E">t[j]){</span></span>
<span class="line"><span style="color: #24292E">        dp[i][j] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> dp[i</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">][j</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">]</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">else</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">        dp[i][j] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">max</span><span style="color: #24292E">(dp[i</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">][j],dp[i][j</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">]);</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> dp[n][n];</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>一维数组优化：对于计算当前行与上一行，需要考虑左、上与左上三种状态</p>
<p>此时左上的状态会被之前的计算给覆盖掉，故需要开一个临时变量存储</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> dp[N]</span><span style="color: #D73A49">=</span><span style="color: #24292E">{};</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">solve</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> n;</span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n;</span></span>
<span class="line"><span style="color: #24292E">  vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">s</span><span style="color: #24292E">(n</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">, </span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">t</span><span style="color: #24292E">(n</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">, </span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> s[i];</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> t[i];</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> pre </span><span style="color: #D73A49">=</span><span style="color: #24292E"> dp[</span><span style="color: #005CC5">0</span><span style="color: #24292E">];</span><span style="color: #6A737D"> // 初始化为0</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;j</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">int</span><span style="color: #24292E"> temp </span><span style="color: #D73A49">=</span><span style="color: #24292E"> dp[j</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">];</span><span style="color: #6A737D"> // 记录下一个的左上状态</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (s[i]</span><span style="color: #D73A49">==</span><span style="color: #24292E">t[j]){</span></span>
<span class="line"><span style="color: #24292E">        dp[j] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> pre</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">else</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">        dp[j] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">max</span><span style="color: #24292E">(dp[j],dp[j</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">]);</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">      pre </span><span style="color: #D73A49">=</span><span style="color: #24292E"> temp;</span><span style="color: #6A737D"> // 将上一个状态还原</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> dp[n];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>转化为LIS：</p>
<p>对于t序列的每个元素，映射为在s序列中的位置组成数组p</p>
<p>这时我们在t中选出一个子序列，且要保持相对顺序，若对应的p的子序列也是上升的，证明他们在s中也是按照相同先后顺序出现的</p>
<p>这说明选择的这些元素在s和t中都保持着相同的相对顺序，也就是公共子序列</p>
<p>故我们可以将求LCS的问题转换成求t在s的相对位置上的LIS的问题</p>
<p>例：</p>
<p>s = [ 5, 2, 8, 1, 6 ]，t = [ 2, 6, 1, 8 ]</p>
<p>则t在s的位置序列p = [2, 5, 4, 3]</p>
<p>LIS可以为[2, 4], 对应p[1],
p[3]，即在s上的2，4位置元素与t上的1，3位置元素都为[2,1]，是一个公共子序列</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">solve</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> n;</span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n;</span></span>
<span class="line"><span style="color: #24292E">  vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">s</span><span style="color: #24292E">(n</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">, </span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">t</span><span style="color: #24292E">(n</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">, </span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> dp;</span></span>
<span class="line"><span style="color: #24292E">  map</span><span style="color: #D73A49">&lt;int</span><span style="color: #24292E">,</span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> cnt;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> s[i];</span></span>
<span class="line"><span style="color: #24292E">    cnt[s[i]] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> i;</span><span style="color: #6A737D"> // 存储s数组中各数的位置</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> t[i];</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">lower_bound</span><span style="color: #24292E">(dp.</span><span style="color: #6F42C1">begin</span><span style="color: #24292E">(),dp.</span><span style="color: #6F42C1">end</span><span style="color: #24292E">(),cnt[t[i]]);</span><span style="color: #6A737D"> // 寻找t数组中值对应在s数组中的位置</span></span>
<span class="line"><span style="color: #6A737D">    // 求对应位置序列的LIS</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (j</span><span style="color: #D73A49">==</span><span style="color: #24292E">dp.</span><span style="color: #6F42C1">end</span><span style="color: #24292E">()){ </span></span>
<span class="line"><span style="color: #24292E">      dp.</span><span style="color: #6F42C1">push_back</span><span style="color: #24292E">(cnt[t[i]]);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">*</span><span style="color: #24292E">j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> cnt[t[i]];</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> dp.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="最长上升子序列lis">最长上升子序列(LIS)</h2>
<h3 id="dp">DP</h3>
<p>考虑子序列问题，用子集型回溯的思路考虑：</p>
<ul>
<li>选或不选：取最后一个数字作为序列尾，需要知道上一个数的下标</li>
<li>枚举选哪个：取最后一个数字，向前枚举，比较当前选的数和下一个要选的数</li>
</ul>
<p>则我们有思路：枚举num[i]作为LIS末尾元素，然后枚举num[j]为LIS倒数第二个元素，</p>
<p>其中<code>j&lt;i</code>且<code>nums[j]&lt;nums[i]</code></p>
<ul>
<li>子问题：以nums[i]结尾的LIS长度</li>
<li>当前操作：枚举nums[j]</li>
<li>下一个子问题：以nums[j]结尾的LIS长度</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">endl</span><span style="color: #24292E"> &#39;\n&#39;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> ll;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> pair</span><span style="color: #D73A49">&lt;int</span><span style="color: #24292E">,</span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> PII;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">5</span><span style="color: #D73A49">e</span><span style="color: #005CC5">3</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> mod </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #D73A49">e</span><span style="color: #005CC5">9</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">7</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">solve</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #6A737D">  // 让dp[i]是以i结尾的数组成的上升子序列的长度</span></span>
<span class="line"><span style="color: #6A737D">  // 考虑枚举选哪个，即比较当前选的数字和该数字之前的数字，选择更小的作为倒数第二个数</span></span>
<span class="line"><span style="color: #6A737D">  /*</span></span>
<span class="line"><span style="color: #6A737D">  则我们的子问题：num[i]结尾的LIS长度</span></span>
<span class="line"><span style="color: #6A737D">  操作：枚举num[j]</span></span>
<span class="line"><span style="color: #6A737D">  下一个子问题：以num[j]结尾的LIS长度</span></span>
<span class="line"><span style="color: #6A737D">  将子问题求最大值+1即为LIS</span></span>
<span class="line"><span style="color: #6A737D">  */</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> n;</span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n;</span></span>
<span class="line"><span style="color: #24292E">  ll a[N]</span><span style="color: #D73A49">=</span><span style="color: #24292E">{};</span></span>
<span class="line"><span style="color: #24292E">  ll dp[N]</span><span style="color: #D73A49">=</span><span style="color: #24292E">{};</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> a[i];</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    dp[i]</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;j</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">i;j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (a[j]</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">a[i]) dp[i]</span><span style="color: #D73A49">=</span><span style="color: #6F42C1">max</span><span style="color: #24292E">(dp[i],dp[j]</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  ll maxn </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    maxn </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">max</span><span style="color: #24292E">(maxn,dp[i]);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> maxn;</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">()</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">ios</span><span style="color: #24292E">::</span><span style="color: #6F42C1">sync_with_stdio</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">); cin.</span><span style="color: #6F42C1">tie</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">); cout.</span><span style="color: #6F42C1">tie</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> tomorin</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  //cin &gt;&gt; tomorin;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E"> (tomorin</span><span style="color: #D73A49">--</span><span style="color: #24292E">) </span><span style="color: #6F42C1">solve</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="与lcs">与LCS</h3>
<p>nums的LIS等价于nums与排序去重后的nums的LCS</p>
<h3 id="贪心二分">贪心+二分</h3>
<p>通过<strong>交换状态与状态值</strong>来进行优化</p>
<p>设g[i]为长度为i+1的IS的末尾元素最小值</p>
<style>.ergqpockcdpt{zoom:67%;}</style>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%AD%90%E5%BA%8F%E5%88%97%E9%97%AE%E9%A2%98/image-20250805191822734.png" class="ergqpockcdpt" alt="LIS-2">
<p>有以下结论：</p>
<ul>
<li>g是严格递增的</li>
<li>一次只能更新一个位置</li>
<li>更新的位置是第一个&gt;=nums[i]的数的下标，若nums[i]比g的最后一个还大，那就加到末尾，这里可以用二分查找</li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">endl</span><span style="color: #24292E"> &#39;\n&#39;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> ll;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> pair</span><span style="color: #D73A49">&lt;int</span><span style="color: #24292E">,</span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> PII;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #D73A49">e</span><span style="color: #005CC5">5</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> mod </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #D73A49">e</span><span style="color: #005CC5">9</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">7</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">solve</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #6A737D">  /*</span></span>
<span class="line"><span style="color: #6A737D">  进一步优化，交换状态与状态值</span></span>
<span class="line"><span style="color: #6A737D">  让g[i]表示长度为i+1的上升子序列的末尾元素的最小值</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  其中g是严格递增的</span></span>
<span class="line"><span style="color: #6A737D">  且一次只能更新一次，更新的位置是第一个&gt;=num[i]的数的下标</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">  故我们可以使用二分来查找第一个&gt;=num[i]的数的下标j,若不存在则直接添加到g末尾，否则修改g[j]为num[i]</span></span>
<span class="line"><span style="color: #6A737D">  */</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> n;</span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n;</span></span>
<span class="line"><span style="color: #24292E">  vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">arr</span><span style="color: #24292E">(n</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> arr[i];</span></span>
<span class="line"><span style="color: #24292E">  vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> g;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">lower_bound</span><span style="color: #24292E">(g.</span><span style="color: #6F42C1">begin</span><span style="color: #24292E">(), g.</span><span style="color: #6F42C1">end</span><span style="color: #24292E">(),arr[i]);</span><span style="color: #6A737D"> // 若不是严格递增，相等也可以，这里改成upperbound即可</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (j</span><span style="color: #D73A49">==</span><span style="color: #24292E">g.</span><span style="color: #6F42C1">end</span><span style="color: #24292E">()) g.</span><span style="color: #6F42C1">push_back</span><span style="color: #24292E">(arr[i]);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">*</span><span style="color: #24292E">j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> arr[i];</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> g.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">()</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">ios</span><span style="color: #24292E">::</span><span style="color: #6F42C1">sync_with_stdio</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">); cin.</span><span style="color: #6F42C1">tie</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">); cout.</span><span style="color: #6F42C1">tie</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> tomorin</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  //cin &gt;&gt; tomorin;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E"> (tomorin</span><span style="color: #D73A49">--</span><span style="color: #24292E">) </span><span style="color: #6F42C1">solve</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>算法与数据结构</category>
      </categories>
      <tags>
        <tag>DP</tag>
      </tags>
  </entry>
  <entry>
    <title>【图论】拓扑排序</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F/</url>
    <content><![CDATA[<h1 id="拓扑排序">拓扑排序</h1>
<h2 id="节点的度">节点的度</h2>
<ul>
<li>度：与节点相连的边的条数</li>
<li>入度：有向图中，指向当前节点的边的条数</li>
<li>出度：有向图中，从当前节点发出的边的条数</li>
</ul>
<h2 id="aov网">AOV网</h2>
<p>在一个表示工程的有向图中，用顶点表示活动，用弧表示活动之间的优先级，这样的有向图为顶点表示活动的网，称为AOV(Activity
On Vertex Network)网</p>
<h2 id="定义">定义</h2>
<p>将一个有向无环图G的所有顶点排成一个线性序列，使得有向无环图G的边集中的任意一条边&lt;u,v&gt;，始终满足u出现在v的前面</p>
<h2 id="构造">构造</h2>
<ol type="1">
<li>在有向无环图中找到一个没有前驱（入度为0）的节点入栈</li>
<li>将栈顶节点出栈，然后从图中将此节点删除，并删除以该节点为尾的弧</li>
<li>重复操作</li>
<li>如果所有节点都已经输出，则结束，否则重复1</li>
</ol>
<h2 id="实现邻接矩阵">实现(邻接矩阵)</h2>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F/image-20250416213937211.png" class="" title="例">
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">endl</span><span style="color: #24292E"> &#39;\n&#39;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> ll;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> pair</span><span style="color: #D73A49">&lt;int</span><span style="color: #24292E">,</span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> PII;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1000</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> mod </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #D73A49">e</span><span style="color: #005CC5">9</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">7</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> g[N][N], indgr[N], res[N];</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">topsort</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">n</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> k </span><span style="color: #D73A49">=</span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;j</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span><span style="color: #6A737D"> // 寻找入度为0的点</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E">(</span><span style="color: #D73A49">!</span><span style="color: #24292E">indgr[j]){</span></span>
<span class="line"><span style="color: #24292E">        res[i]</span><span style="color: #D73A49">=</span><span style="color: #24292E">j;</span><span style="color: #6A737D"> // 记录已经处理的点</span></span>
<span class="line"><span style="color: #24292E">        indgr[j]</span><span style="color: #D73A49">--</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 删除入读为0的点</span></span>
<span class="line"><span style="color: #24292E">        k</span><span style="color: #D73A49">=</span><span style="color: #24292E">j;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">break</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;j</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (g[k][j]</span><span style="color: #D73A49">==</span><span style="color: #005CC5">1</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        g[k][j]</span><span style="color: #D73A49">=</span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 删除对应边 可省略，因为拓扑排序只看入度</span></span>
<span class="line"><span style="color: #24292E">        indgr[j]</span><span style="color: #D73A49">--</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 入读-1</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">solve</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #6A737D">  // 视频中第一个例题</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> n, m;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">(</span><span style="color: #D73A49">~</span><span style="color: #6F42C1">scanf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">%d</span><span style="color: #032F62"> </span><span style="color: #005CC5">%d</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">, </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">n, </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">m)){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> x, y;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">memset</span><span style="color: #24292E">(indgr, </span><span style="color: #005CC5">0</span><span style="color: #24292E">, sizeof indgr);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">memset</span><span style="color: #24292E">(g, </span><span style="color: #005CC5">0</span><span style="color: #24292E">, sizeof g);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">m;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">scanf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">%d</span><span style="color: #032F62"> </span><span style="color: #005CC5">%d</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">,</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">x,</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">y);</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">g[x][y]) {</span></span>
<span class="line"><span style="color: #24292E">        g[x][y]</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        indgr[y]</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">topsort</span><span style="color: #24292E">(n);</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">n) </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">%d</span><span style="color: #032F62"> &quot;</span><span style="color: #24292E">, res[i]);</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">, res[i]);</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E"> </span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">()</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #6A737D">  //ios::sync_with_stdio(0); cin.tie(0); cout.tie(0);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> tomorin</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  //cin &gt;&gt; tomorin;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E"> (tomorin</span><span style="color: #D73A49">--</span><span style="color: #24292E">) </span><span style="color: #6F42C1">solve</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>注意：</p>
<ul>
<li>编号大的节点优先输出：寻找入度0的点时倒序遍历</li>
<li>如何判断有环：不存在入度为0的点</li>
</ul>
<h2 id="实现邻接表">实现(邻接表)</h2>
<p><strong>对于稀疏图，使用邻接矩阵会浪费大量空间</strong>，我们可以使用邻接表</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 邻接表节点结构</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">node</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> x;</span><span style="color: #6A737D"> // 节点编号</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> w;</span><span style="color: #6A737D"> // 权值</span></span>
<span class="line"><span style="color: #24292E">    node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> next;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">node</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">x_</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">w_</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;x </span><span style="color: #D73A49">=</span><span style="color: #24292E"> x_;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;w </span><span style="color: #D73A49">=</span><span style="color: #24292E"> w_;</span></span>
<span class="line"><span style="color: #24292E">        next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">nullptr</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">vector</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">node</span><span style="color: #D73A49">*&gt;</span><span style="color: #24292E"> head;</span><span style="color: #6A737D">      // 邻接表头节点数组</span></span>
<span class="line"><span style="color: #24292E">vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> in_degree;</span><span style="color: #6A737D">   // 记录每个节点的入度</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 添加有向边</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">add_edge</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">u</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">v</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">w</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> head[u];</span></span>
<span class="line"><span style="color: #24292E">    node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">node</span><span style="color: #24292E">(v,w);</span></span>
<span class="line"><span style="color: #24292E">    b-&gt;next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a-&gt;next;</span></span>
<span class="line"><span style="color: #24292E">    a-&gt;next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> b;</span></span>
<span class="line"><span style="color: #24292E">    in_degree[v]</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span><span style="color: #6A737D">      // 目标节点入度加1</span></span>
<span class="line"><span style="color: #24292E">}	</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 拓扑排序</span></span>
<span class="line"><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt; </span><span style="color: #6F42C1">topological_sort</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">n</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">    vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> result;</span><span style="color: #6A737D">          // 存储拓扑序列结果</span></span>
<span class="line"><span style="color: #24292E">    queue</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> q;</span><span style="color: #6A737D">               // 存储入度为0的节点</span></span>
<span class="line"><span style="color: #24292E">    </span></span>
<span class="line"><span style="color: #6A737D">    // 将所有入度为0的节点入队</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">; i </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E"> n; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E">(in_degree[i] </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">            q.</span><span style="color: #6F42C1">push</span><span style="color: #24292E">(i);</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span></span>
<span class="line"><span style="color: #6A737D">    // 不断取出入度为0的节点，更新其邻接点的入度</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E">(</span><span style="color: #D73A49">!</span><span style="color: #24292E">q.</span><span style="color: #6F42C1">empty</span><span style="color: #24292E">()) {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">int</span><span style="color: #24292E"> cur </span><span style="color: #D73A49">=</span><span style="color: #24292E"> q.</span><span style="color: #6F42C1">front</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">        q.</span><span style="color: #6F42C1">pop</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">        result.</span><span style="color: #6F42C1">push_back</span><span style="color: #24292E">(cur);</span><span style="color: #6A737D">   // 将当前节点加入结果序列</span></span>
<span class="line"><span style="color: #24292E">        </span></span>
<span class="line"><span style="color: #6A737D">        // 遍历当前节点的所有邻接点</span></span>
<span class="line"><span style="color: #24292E">        node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> head[cur]-&gt;next;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">while</span><span style="color: #24292E">(p) {</span></span>
<span class="line"><span style="color: #24292E">            in_degree[p-&gt;x]</span><span style="color: #D73A49">--</span><span style="color: #24292E">;</span><span style="color: #6A737D">   // 将邻接点的入度减1</span></span>
<span class="line"><span style="color: #6A737D">            // 如果入度减为0，则入队</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">if</span><span style="color: #24292E">(in_degree[p-&gt;x] </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">                q.</span><span style="color: #6F42C1">push</span><span style="color: #24292E">(p-&gt;x);</span></span>
<span class="line"><span style="color: #24292E">            }</span></span>
<span class="line"><span style="color: #24292E">            p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p-&gt;next;</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> result;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> n, m;</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> m;</span><span style="color: #6A737D">              // 输入节点数和边数</span></span>
<span class="line"><span style="color: #24292E">    </span></span>
<span class="line"><span style="color: #6A737D">    // 初始化</span></span>
<span class="line"><span style="color: #24292E">    head.</span><span style="color: #6F42C1">resize</span><span style="color: #24292E">(n</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    in_degree.</span><span style="color: #6F42C1">resize</span><span style="color: #24292E">(n</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">, </span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E"> n; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        head[i] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">node</span><span style="color: #24292E">(i,</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span></span>
<span class="line"><span style="color: #6A737D">    // 输入边的信息</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> m; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">int</span><span style="color: #24292E"> u, v, w;</span></span>
<span class="line"><span style="color: #24292E">        cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> u </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> v </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> w;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">add_edge</span><span style="color: #24292E">(u,v,w);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span></span>
<span class="line"><span style="color: #6A737D">    // 执行拓扑排序</span></span>
<span class="line"><span style="color: #24292E">    vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> topo </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">topological_sort</span><span style="color: #24292E">(n);</span></span>
<span class="line"><span style="color: #24292E">    </span></span>
<span class="line"><span style="color: #6A737D">    // 判断是否存在环并输出结果</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E">(topo.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">() </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> n) {</span></span>
<span class="line"><span style="color: #24292E">        cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;图中存在环，无法进行拓扑排序&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">    } </span><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> x : topo) {</span></span>
<span class="line"><span style="color: #24292E">            cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> x </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot; &quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h1 id="关键路径">关键路径</h1>
<h2 id="aoe网">AOE网</h2>
<p>在一个表示工程的带权有向图中，用顶点表示事件，用有向边表示活动，用边上的权值表示活动持续时间，这种有向图的边表示活动的网，称为AOE（Activity
On Edge Network）网</p>
<h2 id="etv与ltv">ETV与LTV</h2>
<p>ETV：表示事件最早发生的时间(earliest time of vertex)</p>
<p><strong>注意：考虑到多线程操作，事件最早发生时间应该是多个同步事件完成时间的最大值</strong></p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F/image-20250423222115389.png" class="" title="etv">
<p>LTV：表示事件最晚发生的时间(latest time of vertex)</p>
<p><strong>注意：同理，事件最晚发生时间应该是减去多个同步事件完成时间后的最小值</strong></p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F/image-20250423222735385.png" class="" title="ltv">
]]></content>
      <categories>
        <category>算法与数据结构</category>
      </categories>
      <tags>
        <tag>数据结构</tag>
        <tag>图论</tag>
      </tags>
  </entry>
  <entry>
    <title>【图论】图</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%9B%BE/</url>
    <content><![CDATA[<h1 id="图">图</h1>
<h2 id="定义">定义</h2>
<p>由顶点的有穷非空集合和顶点间的边的集合组成的</p>
<p>通常记为<code>G(v,e)</code>，G表示一个图，v是G中顶点集合，e是边的集合</p>
<p>即<code>V(G)</code>和<code>E(G)</code>分别成为G的点集和边集</p>
<p><strong>必须有顶点，但可以没有边</strong></p>
<h2 id="无向图与有向图">无向图与有向图</h2>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%9B%BE/image-20250418191304599.png" class="" title="类型">
<p>有向图用有序对表示，视为集合<span
class="math inline">\(V\)</span>上的一个二元关系<span
class="math inline">\(R\subseteq V\times V\)</span></p>
<p>无向图用无序对表示，视为集合<span
class="math inline">\(V\)</span>上的对称二元关系，即<span
class="math inline">\((u,v)\in R\)</span>必有<span
class="math inline">\((v,u)\in R\)</span></p>
<h2 id="简单图与多重图">简单图与多重图</h2>
<p>简单图：</p>
<ul>
<li>图中不能有顶点到自身的边</li>
<li>同一条便在途中不能出现两次及以上</li>
</ul>
<p>不满足上述条件的成为多重图</p>
<h2 id="完全图">完全图</h2>
<p>具有最多边数的图</p>
<p>对于一个具有n个顶点的无向完全图，边数量的最大值为<span
class="math inline">\(\frac{n(n-1)}{2}\)</span></p>
<p>对于一个具有n个顶点的有向完全图，边数量的最大值为<span
class="math inline">\(n(n-1)\)</span></p>
<h2 id="路径与路径长度">路径与路径长度</h2>
<p>路径：从一个顶点开始，经过一系列的边到达另一个顶点形成的顶点序列</p>
<p>路径长度：路径上边的条数</p>
<p>回路（环）：起点与终点相同的路径</p>
<p>简单路径：如果路径中不出现相同顶点，则成为简单路径</p>
<p>简单回路：除了第一个顶点和最后一个顶点外，其余顶点不重复出现的回路</p>
<h2 id="度">度</h2>
<p>对于无向图，顶点的度指的是与顶点相关联边的数目</p>
<p>入度：有向图中，箭头指向顶点v的边的数目</p>
<p>出度：有向图中，从该顶点出发的边的数目</p>
<p>与边的关系：</p>
<ul>
<li>图中所有顶点度之和等于边数的两倍</li>
<li>对于有向图，所有顶点的出度与入度之和相等，弧数量也相等</li>
</ul>
<h2 id="子图">子图</h2>
<p>图G的子图H，满足<span class="math inline">\(V(H)\)</span>是<span
class="math inline">\(V(G)\)</span>子集且<span
class="math inline">\(E(H)\)</span>是<span
class="math inline">\(E(G)\)</span>子集</p>
<h2 id="连通图">连通图</h2>
<p>连通图：在无向图中，如果顶点v到顶点w有路径，则称顶点v到顶点w是连通的。如果对于图中任意两个顶点都是连通的，则称此图为连通图</p>
<p>极大连通子图：在这个子图中任意两个顶点都是连通的，而且不能通过添加更多顶点或边来扩大这种连通性</p>
<p>连通分量：无向图中的极大连通子图称为连通分量</p>
<p>强连通图：在有向图中，对于每一对顶点v和w，从v到w和从w到v都有路径，则称该有向图是强连通图。</p>
<p>强连通分量：有向图中的极大强连通子图称为有向图的强连通分量</p>
<h2 id="生成树">生成树</h2>
<p>含有图中全部顶点的极小联通子树</p>
<p><strong>包含所有顶点n，但只有足以构成一棵树的n-1条边</strong></p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%9B%BE/image-20250418194932122.png" class="" title="生成树">
<h2 id="边权和网">边权和网</h2>
<p>权：在一个图中，每条边可以标注上一个代表某种含义的数值，该数值称为这个边的权值</p>
<p>网：边上带权值的图，也称为带权图</p>
<h2 id="例">例</h2>
<blockquote>
<p>若无向图<span
class="math inline">\(G=(v,e)\)</span>中含有七个顶点，要保证图G在任何情况下连通，则需要边数最少是</p>
</blockquote>
<p>即6个顶点的最多边数+1即为7个顶点最少边数</p>
<p>用公式<span class="math inline">\(\frac{n(n-1)}{2}\)</span></p>
]]></content>
      <categories>
        <category>算法与数据结构</category>
      </categories>
      <tags>
        <tag>数据结构</tag>
        <tag>图论</tag>
      </tags>
  </entry>
  <entry>
    <title>【数学】数论基础</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%95%B0%E8%AE%BA%E5%9F%BA%E7%A1%80/</url>
    <content><![CDATA[<h1 id="整除">整除</h1>
<h2 id="定义与性质">定义与性质</h2>
<p>设<span class="math inline">\(a,b\in \Z,a\neq0\)</span>，若<span
class="math inline">\(\exists q\in \Z\)</span>，使得<span
class="math inline">\(b=aq\)</span>，那么说b可被a整除，记作<span
class="math inline">\(a|b\)</span></p>
<ul>
<li><span class="math inline">\(a\mid b \iff -a\mid b \iff a\mid -b \iff
|a|\mid |b|\)</span><br />
</li>
<li><span class="math inline">\(a\mid b \wedge b\mid c \implies a\mid
c\)</span><br />
</li>
<li><span class="math inline">\(a\mid b \wedge a\mid c \iff \forall
x,y\in\mathbb{Z},\;a\mid(xb+yc)\)</span><br />
</li>
<li><span class="math inline">\(a\mid b \wedge b\mid a \implies b=\pm
a\)</span><br />
</li>
<li>设 <span class="math inline">\(m\neq0\)</span>，那么<br />
<span class="math display">\[
a\mid b \iff ma\mid mb
\]</span></li>
<li>设 <span class="math inline">\(b\neq0\)</span>，那么<br />
<span class="math display">\[
a\mid b \implies |a|\le|b|
\]</span></li>
<li>设 <span class="math inline">\(a\neq0,\;b=qa+c\)</span>，那么<br />
<span class="math display">\[
a\mid b \iff a\mid c
\]</span></li>
</ul>
<h2 id="约数">约数</h2>
<p>定义：若<span class="math inline">\(a|b\)</span>，则<span
class="math inline">\(b\)</span>是<span
class="math inline">\(a\)</span>的倍数，<span
class="math inline">\(a\)</span>是<span
class="math inline">\(b\)</span>的约数</p>
<p>性质：</p>
<ul>
<li><p>0是所有非0正数的倍数，对于整数<span class="math inline">\(b \neq
a\)</span>，b的约数只有有限个</p></li>
<li><p>平凡约数：对于整数<span class="math inline">\(b\neq
0\)</span>，±1、±b是b的平凡约数</p>
<p>当<span
class="math inline">\(b=±1\)</span>时，只有两个平凡约数</p></li>
<li><p>真约数：b的其他约数</p>
<ul>
<li><span class="math inline">\(b\neq
0\)</span>，当d遍历b的全体约数时，<span
class="math inline">\(\frac{b}{d}\)</span>也遍历b的全体约数</li>
<li><span
class="math inline">\(b&gt;0\)</span>，则当d遍历b时全体正约数时，<span
class="math inline">\(\frac{b}{d}\)</span>也遍历b的全体约数</li>
</ul></li>
</ul>
<p>没有特殊说明，约数总是指向正约数</p>
<h2 id="余数">余数</h2>
<h3 id="余数-1">余数</h3>
<p>设<span class="math inline">\(a,b\)</span>为两个给定的整数，<span
class="math inline">\(a\neq0\)</span>. 设<span
class="math inline">\(d\)</span>是一个给定的整数，则一定存在唯一一对整数<span
class="math inline">\(q\)</span>与<span
class="math inline">\(r\)</span>，满足<span
class="math inline">\(b=qa+r\)</span>，<span
class="math inline">\(q=\lfloor\frac{b}{a} \rfloor ,d\leq
r&lt;|a|+d\)</span></p>
<p>其中这里的d表示不同取值区间的余数，无论整数d取何值，r统称余数，<span
class="math inline">\(a|b\)</span>等价于<span
class="math inline">\(a|r\)</span></p>
<h3 id="带余数除法">带余数除法</h3>
<p>一般情况下，<span class="math inline">\(d=0\)</span>，此时<span
class="math inline">\(b=qa+r\)</span>，<span class="math inline">\(0\leq
r&lt;|a|\)</span>称为带余数除法，余数r称为最小非负余数，如果没有特别说明，余数总是指最小非负余数</p>
<p>r可以写成<span class="math inline">\(r=b\bmod{a}\)</span></p>
<h3 id="余数的性质">余数的性质</h3>
<ul>
<li>任一整数被正整数a除后，余数一定是且仅是0到(a-1)这a个数中的一个</li>
<li>相邻的a个整数被正整数a除后，恰好取到上述a个余数，特别的，一定有且仅有一个数被a整除</li>
</ul>
<h1 id="最大公约数与最小公倍数">最大公约数与最小公倍数</h1>
<h2 id="最大公约数">最大公约数</h2>
<h3 id="定义">定义</h3>
<p>一组整数的公约数，是指同时是这组数中每一个数的约数的数。<span
class="math inline">\(\pm 1\)</span>
是任意一组整数的公约数。一组整数的最大公约数，是指所有公约数里面最大的一个。写作<code>gcd(a,b)</code></p>
<h3 id="性质">性质</h3>
<ul>
<li><p><span class="math inline">\(\displaystyle
\gcd(a_1,\dots,a_n)=\gcd\bigl(|a_1|,\dots,|a_n|\bigr)\)</span></p></li>
<li><p><span class="math inline">\(\displaystyle
\gcd(a,b)=\gcd(b,a)\)</span></p></li>
<li><p>若 <span class="math inline">\(a\neq0\)</span>，则 <span
class="math display">\[\gcd(a,0)=\gcd(a,a)=|a|.\]</span></p></li>
<li><p><span class="math inline">\(\displaystyle
\gcd(bq+r,\;b)=\gcd(r,\;b)\)</span></p></li>
<li><p><span class="math inline">\(\displaystyle \gcd(a_1,\dots,a_n)
=\gcd\bigl(\gcd(a_1,a_2),a_3,\dots,a_n\bigr).\)</span><br />
进而对任意 <span class="math inline">\(1&lt;k&lt;n\)</span>，都有<br />
<span class="math display">\[
  \gcd(a_1,\dots,a_n)
  =\gcd\!\bigl(\gcd(a_1,\dots,a_k)\,,\,\gcd(a_{k+1},\dots,a_n)\bigr).
\]</span></p></li>
<li><p>对不全为 0 的整数 <span
class="math inline">\(a_1,\dots,a_n\)</span> 和非零整数 <span
class="math inline">\(m\)</span>，<br />
<span class="math display">\[
  \gcd(m a_1,\dots,m a_n)
  =|m|\;\gcd(a_1,\dots,a_n).
\]</span></p></li>
<li><p>对不全为 0 的整数 <span
class="math inline">\(a_1,\dots,a_n\)</span>，若 <span
class="math inline">\(\gcd(a_1,\dots,a_n)=d\)</span>，则<br />
<span class="math display">\[
\gcd\bigl(a_1/d,\dots,a_n/d\bigr)=1.
\]</span></p></li>
<li><p><span class="math inline">\(\displaystyle
\gcd\bigl(a^n,b^n\bigr)=\bigl(\gcd(a,b)\bigr)^n.\)</span></p></li>
<li><p>若 <span class="math inline">\(b\mid ac\)</span> 且 <span
class="math inline">\(\gcd(a,b)=1\)</span>，则 <span
class="math inline">\(b\mid c.\)</span></p></li>
<li><p>若 <span class="math inline">\(b\mid c,\;a\mid c\)</span> 且
<span class="math inline">\(\gcd(a,b)=1\)</span>，则 <span
class="math inline">\(ab\mid c.\)</span></p></li>
<li><p>若 <span class="math inline">\(\gcd(a,b)=1\)</span>，则 <span
class="math inline">\(\gcd(a,bc)=\gcd(a,c).\)</span></p></li>
<li><p>若 <span class="math inline">\(\gcd(a_i,b_j)=1,\;\forall\,1\le
i\le n,\;1\le j\le m\)</span>，则<br />
<span class="math display">\[
\gcd\Bigl(\prod_{i=1}^n a_i\,,\,\prod_{j=1}^m b_j\Bigr)=1.
\]</span> 特别地，若 <span
class="math inline">\(\gcd(a,b)=1\)</span>，则<br />
<span class="math display">\[
\gcd(a^n,b^m)=1.
\]</span></p></li>
<li><p>对整数 <span class="math inline">\(a_1,\dots,a_n\)</span>，若存在
<span class="math inline">\(v\in\mathbb{Z}\)</span> 使<br />
<span class="math display">\[
  \prod_{i=1}^n a_i = v^m,
\]</span> 且对任意 <span class="math inline">\(i\neq j\)</span> 有 <span
class="math inline">\(\gcd(a_i,a_j)=1\)</span>，则<br />
<span class="math display">\[
\forall\,1\le i\le n,\quad \sqrt[m]{a_i}\in\mathbb{Z}_0.
\]</span></p></li>
</ul>
<h3 id="求法">求法</h3>
<p>欧几里得算法：对于正整数<span
class="math inline">\(a,b\)</span>，有<span
class="math inline">\(\gcd(a,b)=\gcd(b, a\bmod{b})\)</span></p>
<p>代码实现如下：</p>
<p>递归版</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #6F42C1">gcd</span><span style="color: #24292E">(</span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">,</span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">	</span><span style="color: #D73A49">return</span><span style="color: #24292E"> b</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #D73A49">?</span><span style="color: #24292E">a</span><span style="color: #D73A49">:</span><span style="color: #6F42C1">gcd</span><span style="color: #24292E">(b,a</span><span style="color: #D73A49">%</span><span style="color: #24292E">b);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>位运算版</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #6F42C1">gcd</span><span style="color: #24292E">(</span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">,</span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">	</span><span style="color: #D73A49">while</span><span style="color: #24292E">(b</span><span style="color: #D73A49">^=</span><span style="color: #24292E">a</span><span style="color: #D73A49">^=</span><span style="color: #24292E">b</span><span style="color: #D73A49">^=</span><span style="color: #24292E">a</span><span style="color: #D73A49">%=</span><span style="color: #24292E">b);</span></span>
<span class="line"><span style="color: #24292E">	</span><span style="color: #D73A49">return</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>多个数求gcd，答案一定是每个数的约数，那么也一定是每相邻两个数的约数。我们采用归纳法，可以证明，每次取出两个数求出答案后再放回去，不会对所需要的答案造成影响。</p>
<h3 id="扩展欧几里得算法">扩展欧几里得算法</h3>
<p>exgcd是用来求形如<span
class="math inline">\(ax+by=\gcd(a,b)\)</span>的一组可行解的算法</p>
<p>证明略，一组可行解形如<span
class="math inline">\(x_1=y_2,y_1=x_2-\lfloor\frac{a}{b} \rfloor
y_2\)</span></p>
<p><span class="math inline">\(b=0\)</span>时，显然有<span
class="math inline">\(\gcd(a,0)=a\)</span>，则一组解为<span
class="math inline">\(x=1, y=0\)</span></p>
<p>代码：</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #6F42C1">exgcd</span><span style="color: #24292E">(</span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">,</span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">,</span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">x</span><span style="color: #24292E">,</span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">y</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">	</span><span style="color: #D73A49">if</span><span style="color: #24292E">(b</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">		x</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">; y</span><span style="color: #D73A49">=</span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">		</span><span style="color: #D73A49">return</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">	}</span></span>
<span class="line"><span style="color: #24292E">	ll d</span><span style="color: #D73A49">=</span><span style="color: #6F42C1">exgcd</span><span style="color: #24292E">(b,a</span><span style="color: #D73A49">%</span><span style="color: #24292E">b,x,y);</span></span>
<span class="line"><span style="color: #24292E">	ll t</span><span style="color: #D73A49">=</span><span style="color: #24292E">x;</span></span>
<span class="line"><span style="color: #24292E">	x</span><span style="color: #D73A49">=</span><span style="color: #24292E">y;</span></span>
<span class="line"><span style="color: #24292E">	y</span><span style="color: #D73A49">=</span><span style="color: #24292E">t</span><span style="color: #D73A49">-</span><span style="color: #24292E">(a</span><span style="color: #D73A49">/</span><span style="color: #24292E">b)</span><span style="color: #D73A49">*</span><span style="color: #24292E">y;</span></span>
<span class="line"><span style="color: #24292E">	</span><span style="color: #D73A49">return</span><span style="color: #24292E"> d;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="互素">互素</h3>
<p>若<span class="math inline">\(\gcd(a_1,b_1)=1\)</span>，称<span
class="math inline">\(a_1,a_2\)</span>互素，若<span
class="math inline">\(\gcd(a_1,\cdots,a_n)=1\)</span>称<span
class="math inline">\(a_1,\cdots,a_n\)</span>互素</p>
<p>多个整数互素，不一定两两互素</p>
<h3 id="快速gcd">快速GCD</h3>
<h4 id="预处理">预处理</h4>
<p><span class="math inline">\(O(n)\)</span>预处理，<span
class="math inline">\(O(1)\)</span>查询两个小于<span
class="math inline">\(n\)</span>的数的快速gcd</p>
<p>预处理：</p>
<ul>
<li>预处理所有<span class="math inline">\((i,j)\)</span>，其中<span
class="math inline">\(i,j\leq\sqrt{n}\)</span>的gcd，可以以<span
class="math inline">\(O(n)\)</span>推出</li>
<li>预处理<span class="math inline">\(n\)</span>以内质数</li>
</ul>
<p>查询：</p>
<p>设<span class="math inline">\(x=abc\)</span>，则<span
class="math inline">\((x,y)=(a,y)\times\left(b,\dfrac{y}{(a,y)}\right)\times\left(c,\dfrac{y}{(ab,y)}\right)\)</span></p>
<p>若<span class="math inline">\(a\in P\)</span>，只需要判断<span
class="math inline">\(a\)</span>是否整除<span
class="math inline">\(y\)</span>，否则<span
class="math inline">\((a,y)=(y\bmod a, a)\)</span>，因为<span
class="math inline">\(a\leq \sqrt{n}\)</span>，可查表</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> T </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1000</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> M </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1000000</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> g[T][T], fac[M][</span><span style="color: #005CC5">3</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #24292E">bitset</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">M</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> vis;</span></span>
<span class="line"><span style="color: #24292E">vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> pri;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">prework</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">  vis[</span><span style="color: #005CC5">0</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> vis[</span><span style="color: #005CC5">1</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">true</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  fac[</span><span style="color: #005CC5">1</span><span style="color: #24292E">][</span><span style="color: #005CC5">0</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> fac[</span><span style="color: #005CC5">1</span><span style="color: #24292E">][</span><span style="color: #005CC5">1</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> fac[</span><span style="color: #005CC5">1</span><span style="color: #24292E">][</span><span style="color: #005CC5">2</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #24292E">; i </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> M; </span><span style="color: #D73A49">++</span><span style="color: #24292E">i) {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">vis[i]) {</span></span>
<span class="line"><span style="color: #24292E">      fac[i][</span><span style="color: #005CC5">0</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> fac[i][</span><span style="color: #005CC5">1</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">      fac[i][</span><span style="color: #005CC5">2</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> i;</span></span>
<span class="line"><span style="color: #24292E">      pri.</span><span style="color: #6F42C1">push_back</span><span style="color: #24292E">(i);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j : pri) {</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">int</span><span style="color: #24292E"> mul </span><span style="color: #D73A49">=</span><span style="color: #24292E"> i </span><span style="color: #D73A49">*</span><span style="color: #24292E"> j;</span></span>
<span class="line"><span style="color: #24292E">      vis[mul] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">true</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">      fac[mul][</span><span style="color: #005CC5">0</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> fac[i][</span><span style="color: #005CC5">0</span><span style="color: #24292E">] </span><span style="color: #D73A49">*</span><span style="color: #24292E"> j;</span></span>
<span class="line"><span style="color: #24292E">      fac[mul][</span><span style="color: #005CC5">1</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> fac[i][</span><span style="color: #005CC5">1</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #24292E">      fac[mul][</span><span style="color: #005CC5">2</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> fac[i][</span><span style="color: #005CC5">2</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">sort</span><span style="color: #24292E">(fac[mul], fac[mul] </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">3</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (i </span><span style="color: #D73A49">%</span><span style="color: #24292E"> j </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">break</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> T; </span><span style="color: #D73A49">++</span><span style="color: #24292E">i)</span></span>
<span class="line"><span style="color: #24292E">    g[</span><span style="color: #005CC5">0</span><span style="color: #24292E">][i] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> g[i][</span><span style="color: #005CC5">0</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> i;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">; i </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> T; </span><span style="color: #D73A49">++</span><span style="color: #24292E">i)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">; j </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E"> i; </span><span style="color: #D73A49">++</span><span style="color: #24292E">j)</span></span>
<span class="line"><span style="color: #24292E">      g[i][j] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> g[j][i] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> g[j][i </span><span style="color: #D73A49">%</span><span style="color: #24292E"> j];</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">gcd</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> ans </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">3</span><span style="color: #24292E">; </span><span style="color: #D73A49">++</span><span style="color: #24292E">i) {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> _ </span><span style="color: #D73A49">=</span><span style="color: #24292E"> fac[a][i] </span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> T </span><span style="color: #D73A49">?</span><span style="color: #24292E"> (b </span><span style="color: #D73A49">%</span><span style="color: #24292E"> fac[a][i] </span><span style="color: #D73A49">?</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E"> </span><span style="color: #D73A49">:</span><span style="color: #24292E"> fac[a][i])</span></span>
<span class="line"><span style="color: #24292E">                          </span><span style="color: #D73A49">:</span><span style="color: #24292E"> g[fac[a][i]][b </span><span style="color: #D73A49">%</span><span style="color: #24292E"> fac[a][i]];</span></span>
<span class="line"><span style="color: #24292E">    b </span><span style="color: #D73A49">/=</span><span style="color: #24292E"> _;</span></span>
<span class="line"><span style="color: #24292E">    ans </span><span style="color: #D73A49">*=</span><span style="color: #24292E"> _;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ans;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h4 id="更相减损术">更相减损术</h4>
<p><span class="math inline">\(O(\log{n})\)</span></p>
<ul>
<li>若<span class="math inline">\(a=b\)</span>, <span
class="math inline">\((a,b)=a=b\)</span></li>
<li>若<span class="math inline">\(2|a,2|b\)</span>, <span
class="math inline">\((a,b)=\left(\dfrac{a}{2},\dfrac{b}{2}\right)\)</span></li>
<li>若<span class="math inline">\(2\mid a,2\nmid b\)</span>, <span
class="math inline">\((a,b)=\left(\dfrac{a}{2},b\right)\)</span></li>
<li>若均不满足，设<span class="math inline">\(a&gt;b\)</span>, 则<span
class="math inline">\((a,b)=(a-b,b)\)</span></li>
</ul>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">gcd</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">__builtin_ctz</span><span style="color: #24292E">(a);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">__builtin_ctz</span><span style="color: #24292E">(b);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> k </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">min</span><span style="color: #24292E">(i, j);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> d;</span></span>
<span class="line"><span style="color: #24292E">  b </span><span style="color: #D73A49">&gt;&gt;=</span><span style="color: #24292E"> j;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E"> (a) {</span></span>
<span class="line"><span style="color: #24292E">    a </span><span style="color: #D73A49">&gt;&gt;=</span><span style="color: #24292E"> i;</span></span>
<span class="line"><span style="color: #24292E">    d </span><span style="color: #D73A49">=</span><span style="color: #24292E"> b </span><span style="color: #D73A49">-</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">    i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">__builtin_ctz</span><span style="color: #24292E">(d);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (a </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> b) b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (d </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">) a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #24292E">d;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> d;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> b </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> k;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="最小公倍数">最小公倍数</h2>
<h3 id="定义-1">定义</h3>
<p>一组整数的公倍数，是指同时是这组数中每一个数的倍数的数。0是任意一组整数的公倍数。</p>
<p>一组整数的最小公倍数，是指所有正的公倍数里面，最小的一个数。记作<code>lcm(a,b)</code></p>
<h3 id="性质-1">性质</h3>
<ul>
<li><p><span class="math inline">\(\displaystyle
lcm(a_1,\dots,a_n)=lcm(|a_1|,\dots,|a_n|)\)</span></p></li>
<li><p><span class="math inline">\(\displaystyle
lcm(a,b)=lcm(b,a)\)</span></p></li>
<li><p>若 <span class="math inline">\(a\neq0\)</span>，则 <span
class="math inline">\(lcm(a,1)=lcm(a,a)=|a|.\)</span></p></li>
<li><p>若 <span class="math inline">\(a\mid b\)</span>，则 <span
class="math inline">\(lcm(a,b)=|b|.\)</span></p></li>
<li><p><span class="math inline">\(\displaystyle lcm(a_1,\dots,a_n)
  =lcm\bigl(lcm(a_1,a_2),a_3,\dots,a_n\bigr).\)</span><br />
进而对任意 <span
class="math inline">\(1&lt;k&lt;n-1\)</span>，都有<br />
<span class="math display">\[
lcm(a_1,\dots,a_n)
  =lcm\Bigl(lcm(a_1,\dots,a_k),\;lcm(a_{k+1},\dots,a_n)\Bigr).
\]</span></p></li>
<li><p>若 <span class="math inline">\(a_i\mid m,\ \forall\,1\le i\le
n\)</span>，则<br />
<span class="math display">\[
lcm(a_1,\dots,a_n)\mid m.
\]</span></p></li>
<li><p><span class="math inline">\(\displaystyle
lcm(ma_1,\dots,ma_n)=|m|\;lcm(a_1,\dots,a_n)\,.\)</span></p></li>
<li><p><span class="math inline">\(\displaystyle
lcm(a,b,c)\,lcm(ab,bc,ca)
  =lcm(a,b)\,lcm(b,c)\,lcm(c,a)\,.\)</span></p></li>
<li><p><span class="math inline">\(\displaystyle
lcm(a^n,b^n)=\bigl(lcm(a,b)\bigr)^n\,.\)</span></p></li>
</ul>
<h3 id="求法-1">求法</h3>
<p>两个数：<span class="math inline">\(\gcd(a,b)\times lcm(a,b)=a\times
b\)</span></p>
<p>代码</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #6F42C1">lcm</span><span style="color: #24292E">(</span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">,</span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">	</span><span style="color: #D73A49">return</span><span style="color: #24292E"> a</span><span style="color: #D73A49">/</span><span style="color: #6F42C1">gcd</span><span style="color: #24292E">(a,b)</span><span style="color: #D73A49">*</span><span style="color: #24292E">b;</span><span style="color: #6A737D"> // 防止 a*b 爆 ll，所以先 /gcd 再 *b</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>多个数：我们其实没有必要求一个共同的最大公约数再去处理，最直接的方法就是，当我们算出两个数的
gcd，或许在求多个数的
gcd时候，我们将它放入序列对后面的数继续求解，那么，我们转换一下，直接将最小公倍数放入序列即可。</p>
<h1 id="素数与合数">素数与合数</h1>
<p>见<a href=".\质数\质数.md">质数</a></p>
<h1 id="算术基本定理">算术基本定理</h1>
<h2 id="内容">内容</h2>
<p>算术基本引理：设p是素数，<span
class="math inline">\(p|a_1a_2\)</span>，那么<span
class="math inline">\(p|a_1\)</span>与<span
class="math inline">\(p|a_2\)</span>至少有一个成立</p>
<p>唯一分解定理：设正整数a，则必有表示<span
class="math inline">\(a=p_1p_2\cdots p_s\)</span>，其中<span
class="math inline">\(p_j(1\leq j\leq
s)\)</span>是素数，且不计次序的意义下，该表示唯一</p>
<h2 id="素数的另一种定义">素数的另一种定义</h2>
<p>对整数<span
class="math inline">\(p\ne0,\pm1\)</span>，若对任意满足<span
class="math inline">\(p|a_1a_2\)</span>的整数<span
class="math inline">\(a_1,a_2\)</span>均有<span
class="math inline">\(p|a_1\)</span>或<span
class="math inline">\(p|a_2\)</span>成立，则称p是素数</p>
<h1 id="同余">同余</h1>
<h2 id="定义-2">定义</h2>
<p>设<span class="math inline">\(m\ne0\)</span>。若<span
class="math inline">\(m\mid(a-b)\)</span>，称m为模数，<img
src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" /><strong>当
$xm=y m $时，我们说 <em>x</em> 和 <em>y</em> 关于 <em>m</em>
同余，表示为 <span class="math inline">\(x≡y(\bmod
m)\)</span></strong>，这种表示称为模m的同余式</p>
<h2 id="性质-2">性质</h2>
<ul>
<li><p><strong>定理 1</strong> 当 <span class="math display">\[a \equiv
b \pmod m\]</span> 且 <span class="math display">\[d \mid m\]</span>
时，有 <span class="math display">\[a \equiv b \pmod
d.\]</span></p></li>
<li><p><strong>定理 2</strong> 当 <span class="math display">\[a \equiv
b \pmod m\quad\text{且}\quad c \equiv d \pmod m\]</span> 时，有</p>
<figure class="shiki math"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></div><div class="code"><pre><code>  a + c \equiv b + d \pmod m,\\
  a - c \equiv b - d \pmod m,\\
  a \times c \equiv b \times d \pmod m.

- **定理 3**  当  $$ac \equiv bd \pmod m\quad\text{且}\quad \gcd(c,m)=1$$  时，有  $$a \equiv b \pmod m.$$
  
- **定理 4**  当  $$a \equiv b \pmod m$$  时，对于任意的 $c\neq0$，有  $$ac \equiv bc \pmod m.$$
  
- **定理 5**  当  $$a \equiv b \pmod m$$  时，对于任意的 $k>0$，有  $$a^k \equiv b^k \pmod m.$$
  
- **定理 6**  当  $$a \equiv b \pmod m$$  时，对于任意的整数 $t$，有  $$a = b + t\,m.$$

## 同余原理

当需要返回数据很大，超过了longlong的范围，一般需要返回一个数字对另一个数字取模的结果



对于四则运算，位数（bits）固定，我们认为时间复杂度为$O(1)$，但保留中间结果的情况下，位数可能会改变，导致复杂度增加

**定理：对于k位（非32、64位）整数，加减的复杂度为$O(k)$，乘除的复杂度变为$O(k^2)$**

此时需要同余原理

同余的数学化表示：

### 加法同余

对于$(a+b)\bmod{k}=c$，为了避免$a+b$得到更大的位数以出现问题，我们可以分别对$a$和$b$取模再相加取模，即$(a\bmod{k}+b\bmod{k})\bmod{k}=c'$，这样可以把$a$和$b$限制在32或64位，结果$c=c'$



### 乘法同余

对于$(a\times b)\bmod{k}=c$，分别对$a$和$b$取模再相乘取模，即$(a\bmod{k}\times b\bmod{k})\bmod{k}=c'$，这样可以把$a$和$b$限制在32或64位，结果$c=c'$

**注意：要保证相乘时中间结果不能溢出**



### 减法同余

关于取模，若一个数取模后的结果是负数，**则需要加一个模数后取模**，以获得他的正数表示

例如一个数%7的结果是-2，等同于这个数+7后%7的结果5，因为两者加2后分别是0和7，都可以被7整除

对于$(a-b)\bmod{k}=c$，我们需要在分别模m的基础上加一个m，即$((a\bmod{k}-b\bmod{k})+m)\bmod{k}=c'$，为了避免获得负数中间结果

# C/C++的整数除法与取模

## 规定

C/C++规定在整数除法中：

- 除数为0时，行为未定义
- 否则$\frac{a}{b}\times b+a\% b=a$

即取模运算的符号取决于除法如何取整，而这是实现定义的

从C++11起，规定**商向零取整**，取模的符号**与被除数相同**</code></pre></div></div></figure>
<p>5 % 3 == 2; 5 % -3 == 2; -5 % 3 == -2; -5 % -3 == -2;
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e"></span></span>
<span class="line"><span style="color: #24292e">## 快速乘</span></span>
<span class="line"><span style="color: #24292e"></span></span>
<span class="line"><span style="color: #24292e">要求模数在long long范围内的乘法取模，避免整数溢出，可以使用快速乘，能够实现$O(1)$且不需要`int128`</span></span>
<span class="line"><span style="color: #24292e"></span></span>
<span class="line"><span style="color: #24292e">我们可以发现：$a\times b\bmod{m}=a\times b-\lfloor\frac{ab}{m}\rfloor\times m$</span></span>
<span class="line"><span style="color: #24292e"></span></span>
<span class="line"><span style="color: #24292e">使用ull的自然溢出，可得：$a\times b\bmod{m}=a\times b-\lfloor\frac{ab}{m}\rfloor\times m=(a\times b-\lfloor\frac{ab}{m}\rfloor\times m)\bmod{2^{64}}$</span></span>
<span class="line"><span style="color: #24292e"></span></span>
<span class="line"><span style="color: #24292e">对于$\lfloor\frac{ab}{m}\rfloor$，若结果r在$[0,m)$时，直接返回r，否则返回$r+m$</span></span>
<span class="line"><span style="color: #24292e"></span></span>
<span class="line"><span style="color: #24292e"></span></span>
<span class="line"><span style="color: #24292e"></span></span>
<span class="line"><span style="color: #24292e">```c++</span></span>
<span class="line"><span style="color: #24292e">long long binmul(long long a, long long b, long long m) {</span></span>
<span class="line"><span style="color: #24292e">  unsigned long long c =</span></span>
<span class="line"><span style="color: #24292e">      (unsigned long long)a * b -</span></span>
<span class="line"><span style="color: #24292e">      (unsigned long long)((long double)a / m * b + 0.5L) * m;</span></span>
<span class="line"><span style="color: #24292e">  if (c &lt; m) return c;</span></span>
<span class="line"><span style="color: #24292e">  return c + m;</span></span>
<span class="line"><span style="color: #24292e">}</span></span></code></pre></div></div></figure></p></li>
</ul>
<h1 id="数论函数">数论函数</h1>
<p>数论函数指定义域为正整数的函数，可以视为一个数列</p>
<h2 id="积性函数">积性函数</h2>
<h3 id="定义-3">定义</h3>
<ul>
<li>数论中，若函数<span class="math inline">\(f(n)\)</span>满足<span
class="math inline">\(f(1)=1\)</span>，且<span
class="math inline">\(f(xy)=f(x)f(y)\)</span>对任意互质的<span
class="math inline">\(x,y\in \N^*\)</span>都成立，则<span
class="math inline">\(f(n)\)</span>为积性函数</li>
<li>数论中，若函数<span class="math inline">\(f(n)\)</span>满足<span
class="math inline">\(f(1)=1\)</span>，且<span
class="math inline">\(f(xy)=f(x)f(y)\)</span>对任意的<span
class="math inline">\(x,y\in \N^*\)</span>都成立，则<span
class="math inline">\(f(n)\)</span>为完全积性函数</li>
</ul>
<h3 id="性质-3">性质</h3>
<p>若 <span class="math inline">\(f(x)\)</span> 和 <span
class="math inline">\(g(x)\)</span>
均为积性函数，则以下函数也为积性函数：</p>
<ul>
<li><span class="math inline">\(h(x)=f(x^p)\)</span><br />
</li>
<li><span class="math inline">\(h(x)=f^p(x)\)</span><br />
</li>
<li><span class="math inline">\(h(x)=f(x)\,g(x)\)</span><br />
</li>
<li><span class="math display">\[h(x)=\sum_{d\mid
x}f(d)\,g\Bigl(\frac{x}{d}\Bigr)\]</span></li>
</ul>
<hr />
<p>对正整数 <span
class="math inline">\(x\)</span>，设其唯一质因数分解为<br />
<span class="math display">\[
x=\prod_i p_i^{k_i}\,,
\]</span> 其中 <span class="math inline">\(p_i\)</span> 为质数，<span
class="math inline">\(k_i\)</span> 为正整数。</p>
<ul>
<li><p>若 <span class="math inline">\(F(x)\)</span> 为积性函数，则<br />
<span class="math display">\[
F(x)=\prod_i F\bigl(p_i^{k_i}\bigr)\,.
\]</span></p></li>
<li><p>若 <span class="math inline">\(F(x)\)</span>
为完全积性函数，则<br />
$$ F(x)=_i F(p_i^{k_i}) =_i^{k_i},.</p>
<p>$$</p></li>
</ul>
<h2 id="加性函数">加性函数</h2>
<h3 id="定义-4">定义</h3>
<ul>
<li>数论中，若函数<span class="math inline">\(f(n)\)</span>满足<span
class="math inline">\(f(1)=1\)</span>，且<span
class="math inline">\(f(xy)=f(x)+f(y)\)</span>对任意互质的<span
class="math inline">\(x,y\in \N^*\)</span>都成立，则<span
class="math inline">\(f(n)\)</span>为积性函数</li>
<li>数论中，若函数<span class="math inline">\(f(n)\)</span>满足<span
class="math inline">\(f(1)=1\)</span>，且<span
class="math inline">\(f(xy)=f(x)+f(y)\)</span>对任意的<span
class="math inline">\(x,y\in \N^*\)</span>都成立，则<span
class="math inline">\(f(n)\)</span>为完全积性函数</li>
</ul>
<h3 id="性质-4">性质</h3>
<p>对正整数 <span
class="math inline">\(x\)</span>，设其唯一质因数分解为<br />
<span class="math display">\[
x = \prod_i p_i^{k_i},
\]</span> 其中 <span class="math inline">\(p_i\)</span> 为质数，<span
class="math inline">\(k_i\)</span> 为正整数。</p>
<ul>
<li><p>若 <span class="math inline">\(F(x)\)</span>
为<strong>加性函数</strong>，则有<br />
<span class="math display">\[
F(x) = \sum_i F\bigl(p_i^{k_i}\bigr)\,.
\]</span></p></li>
<li><p>若 <span class="math inline">\(F(x)\)</span>
为<strong>完全加性函数</strong>，则有<br />
<span class="math display">\[
F(x)
= \sum_i F\bigl(p_i^{k_i}\bigr)
= \sum_i F(p_i)\,\cdot k_i\,.
\]</span></p></li>
</ul>
]]></content>
      <categories>
        <category>数学</category>
      </categories>
      <tags>
        <tag>数学</tag>
        <tag>数论</tag>
      </tags>
  </entry>
  <entry>
    <title>【数据结构】字典树</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%AD%97%E5%85%B8%E6%A0%91/</url>
    <content><![CDATA[<h1 id="字典树trie">字典树(trie)</h1>
<blockquote>
<p>给予n个单词，在这n个单词中查询给定的单词是否存在</p>
</blockquote>
<h2 id="遍历">遍历</h2>
<p>使用string遍历每一个单词比较，s1==s2，时间复杂度为<span
class="math inline">\(O(nm)\)</span>，m为单词长度</p>
<p>若询问q次，则复杂度高达<span
class="math inline">\(O(nmq)\)</span></p>
<h2 id="字典树">字典树</h2>
<p>字典树是一种树形结构，树的每个节点上存储了一个字符</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%AD%97%E5%85%B8%E6%A0%91/image-20250201200659516.png" class="" title="字典树">
<p>标红的节点表示存在一个以该节点字符结尾的字符串</p>
<p>可以发现，以某个字符结尾的字符串在trie树上是唯一的，因为该节点只有一个父节点，沿着往上即可获得唯一的字符串。</p>
<p>还可以发现，若按照前序遍历，每个节点的字符是按字典序排列的，故trie树还可以用于排序</p>
<h3 id="建树">建树</h3>
<p>建立一个根节点，将字符串每一个字符依次从根节点插入，若存在对应字符节点便沿用，否则在上个父节点基础上新建节点，传入结尾位置时标记（是否结尾或第几个相同单词）</p>
<p>时间复杂度<span class="math inline">\(O(mn)\)</span></p>
<h3 id="询问">询问</h3>
<p>将读入的字符串从根节点开始一个个字符比对，若某个字符在同层节点中都没有则不存在该字符串，若到达该字符串末尾，但此时节点并未标记结尾位置，也判断为不存在该字符串。否则判断为存在</p>
<p>时间复杂度：<span
class="math inline">\(O(qx)\)</span>，x为每次询问字符串长度，共q次询问</p>
<h3 id="删除">删除</h3>
<ol type="1">
<li>判断是否有子节点</li>
<li>若没有子节点，标记不为一时-1，为1时递归删除到根节点</li>
</ol>
<h3 id="存储">存储</h3>
<p>用数组表示层数，每层再用数组表示26个字符在该层出现的次数</p>
<p>缺点：若字符少可行，若字符数过多，或每层分配的节点过多，占用空间会过大</p>
<p>时间换空间：使用map或unordered_map，但时间复杂度会变高</p>
<h2 id="板子">板子</h2>
<h3 id="结构体实现">结构体实现</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">26</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">// 开辟空间</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">trieNode</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">char</span><span style="color: #24292E"> val;</span></span>
<span class="line"><span style="color: #24292E">  trieNode</span><span style="color: #D73A49">**</span><span style="color: #24292E"> son;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> cnt;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">trieNode</span><span style="color: #24292E">(</span><span style="color: #D73A49">char</span><span style="color: #24292E"> </span><span style="color: #E36209">c</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    val </span><span style="color: #D73A49">=</span><span style="color: #24292E"> c;</span></span>
<span class="line"><span style="color: #24292E">    son </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> trieNode</span><span style="color: #D73A49">*</span><span style="color: #24292E">[N];</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">N;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) son[i]</span><span style="color: #D73A49">=</span><span style="color: #005CC5">nullptr</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    cnt </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">trieNode</span><span style="color: #D73A49">*</span><span style="color: #24292E"> root;</span></span>
<span class="line"><span style="color: #6A737D">// 插入操作</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">insert</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  trieNode</span><span style="color: #D73A49">*</span><span style="color: #24292E"> p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> root;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">s.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> c </span><span style="color: #D73A49">=</span><span style="color: #24292E"> s[i]</span><span style="color: #D73A49">-</span><span style="color: #032F62">&#39;a&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">p-&gt;son[c])p-&gt;son[c] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">trieNode</span><span style="color: #24292E">(c);</span></span>
<span class="line"><span style="color: #24292E">    p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p-&gt;son[c];</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  p-&gt;cnt</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6A737D">// 查询操作</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">query</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  trieNode</span><span style="color: #D73A49">*</span><span style="color: #24292E"> p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> root;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">s.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> c </span><span style="color: #D73A49">=</span><span style="color: #24292E"> s[i]</span><span style="color: #D73A49">-</span><span style="color: #032F62">&#39;a&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">p-&gt;son[c]) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p-&gt;son[c];</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> p-&gt;cnt;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  root </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">trieNode</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39; &#39;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">5</span><span style="color: #24292E">;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    string s;</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> s;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">insert</span><span style="color: #24292E">(s);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">5</span><span style="color: #24292E">;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    string s;</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> s;</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">query</span><span style="color: #24292E">(s)</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="数组实现">数组实现</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">26</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> M </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">105</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">// 开辟空间</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> trie[M][N];</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> cnt[M];</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> idx </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">// 插入操作</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">insert</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">s.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> c </span><span style="color: #D73A49">=</span><span style="color: #24292E"> s[i]</span><span style="color: #D73A49">-</span><span style="color: #032F62">&#39;a&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">trie[p][c])trie[p][c]</span><span style="color: #D73A49">=++</span><span style="color: #24292E">idx;</span></span>
<span class="line"><span style="color: #24292E">    p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> trie[p][c];</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  cnt[p]</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6A737D">// 查询操作</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">query</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">s.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> c </span><span style="color: #D73A49">=</span><span style="color: #24292E"> s[i]</span><span style="color: #D73A49">-</span><span style="color: #032F62">&#39;a&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">trie[p][c]) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> trie[p][c];</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> cnt[p];</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">5</span><span style="color: #24292E">;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    string s;</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> s;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">insert</span><span style="color: #24292E">(s);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">5</span><span style="color: #24292E">;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    string s;</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> s;</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">query</span><span style="color: #24292E">(s)</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="map实现">map实现</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">26</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> M </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">105</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">// 开辟空间</span></span>
<span class="line"><span style="color: #24292E">vector</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">map</span><span style="color: #D73A49">&lt;char</span><span style="color: #24292E">,</span><span style="color: #D73A49">int&gt;&gt;</span><span style="color: #24292E"> trie;</span><span style="color: #6A737D"> // 或使用unordered_map</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> cnt[M];</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> idx </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">// 插入操作</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">insert</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">s.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> c </span><span style="color: #D73A49">=</span><span style="color: #24292E"> s[i]</span><span style="color: #D73A49">-</span><span style="color: #032F62">&#39;a&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">trie[p][c])trie[p][c]</span><span style="color: #D73A49">=++</span><span style="color: #24292E">idx;</span></span>
<span class="line"><span style="color: #24292E">    p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> trie[p][c];</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  cnt[p]</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6A737D">// 查询操作</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">query</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">s.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> c </span><span style="color: #D73A49">=</span><span style="color: #24292E"> s[i]</span><span style="color: #D73A49">-</span><span style="color: #032F62">&#39;a&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">trie[p][c]) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> trie[p][c];</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> cnt[p];</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  trie </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">map</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">char</span><span style="color: #24292E">,</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt;&gt;(M);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">5</span><span style="color: #24292E">;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){ </span></span>
<span class="line"><span style="color: #24292E">    string s;</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> s;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">insert</span><span style="color: #24292E">(s);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">5</span><span style="color: #24292E">;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    string s;</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> s;</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">query</span><span style="color: #24292E">(s)</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="应用-查询前缀">应用-查询前缀</h2>
<blockquote>
<h3 id="题目描述">题目描述</h3>
<p>给定 <span class="math inline">\(n\)</span> 个模式串 <span
class="math inline">\(s_1, s_2, \dots, s_n\)</span> 和 <span
class="math inline">\(q\)</span> 次询问，每次询问给定一个文本串 <span
class="math inline">\(t_i\)</span>，请回答 <span
class="math inline">\(s_1 \sim s_n\)</span> 中有多少个字符串 <span
class="math inline">\(s_j\)</span> 满足 <span
class="math inline">\(t_i\)</span> 是 <span
class="math inline">\(s_j\)</span> 的<strong>前缀</strong>。</p>
<p>一个字符串 <span class="math inline">\(t\)</span> 是 <span
class="math inline">\(s\)</span> 的前缀当且仅当从 <span
class="math inline">\(s\)</span> 的末尾删去若干个（可以为 0
个）连续的字符后与 <span class="math inline">\(t\)</span> 相同。</p>
<p>输入的字符串大小敏感。例如，字符串 <code>Fusu</code> 和字符串
<code>fusu</code> 不同。</p>
<h3 id="输入格式">输入格式</h3>
<p><strong>本题单测试点内有多组测试数据</strong>。</p>
<p>输入的第一行是一个整数，表示数据组数 <span
class="math inline">\(T\)</span>。</p>
<p>对于每组数据，格式如下：<br />
第一行是两个整数，分别表示模式串的个数 <span
class="math inline">\(n\)</span> 和询问的个数 <span
class="math inline">\(q\)</span>。<br />
接下来 <span class="math inline">\(n\)</span>
行，每行一个字符串，表示一个模式串。<br />
接下来 <span class="math inline">\(q\)</span>
行，每行一个字符串，表示一次询问。</p>
<h3 id="输出格式">输出格式</h3>
<p>按照输入的顺序依次输出各测试数据的答案。<br />
对于每次询问，输出一行一个整数表示答案。</p>
</blockquote>
<h3 id="数组实现-1">数组实现</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ios</span><span style="color: #24292E"> ios::sync_with_stdio(0); cin.tie(0); cout.tie(0);</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">endl</span><span style="color: #24292E"> &#39;\n&#39;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> ll;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">unsigned</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> ull;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">double</span><span style="color: #24292E"> ld;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> pair</span><span style="color: #D73A49">&lt;int</span><span style="color: #24292E">,</span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> PII;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">3</span><span style="color: #D73A49">e</span><span style="color: #005CC5">6</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> M </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">70</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">double</span><span style="color: #24292E"> pi </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">acos</span><span style="color: #24292E">(</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1.0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> mod </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #D73A49">e</span><span style="color: #005CC5">9</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">7</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> INF </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">0x</span><span style="color: #005CC5">3f3f3f3f</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">double</span><span style="color: #24292E"> eps </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #D73A49">e-</span><span style="color: #005CC5">6</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> t;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> trie[N][M];</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> cnt[N];</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> idx </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">// char到int的转换</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ascii</span><span style="color: #24292E">(</span><span style="color: #D73A49">char</span><span style="color: #24292E"> </span><span style="color: #E36209">c</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (c</span><span style="color: #D73A49">&gt;=</span><span style="color: #032F62">&#39;a&#39;</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E"> c</span><span style="color: #D73A49">&lt;=</span><span style="color: #032F62">&#39;z&#39;</span><span style="color: #24292E">) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> c</span><span style="color: #D73A49">-</span><span style="color: #032F62">&#39;a&#39;</span><span style="color: #D73A49">+</span><span style="color: #005CC5">26</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (c</span><span style="color: #D73A49">&gt;=</span><span style="color: #032F62">&#39;A&#39;</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E">c</span><span style="color: #D73A49">&lt;=</span><span style="color: #032F62">&#39;Z&#39;</span><span style="color: #24292E">) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> c</span><span style="color: #D73A49">-</span><span style="color: #032F62">&#39;A&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">return</span><span style="color: #24292E"> c</span><span style="color: #D73A49">-</span><span style="color: #032F62">&#39;0&#39;</span><span style="color: #D73A49">+</span><span style="color: #005CC5">52</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6A737D">// 插入操作</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">insert</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">s.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> c </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ascii</span><span style="color: #24292E">(s[i]);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">trie[p][c]) trie[p][c]</span><span style="color: #D73A49">=++</span><span style="color: #24292E">idx;</span></span>
<span class="line"><span style="color: #24292E">    p</span><span style="color: #D73A49">=</span><span style="color: #24292E">trie[p][c];</span></span>
<span class="line"><span style="color: #24292E">    cnt[p]</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 这里与查询整个单词不同，需要每层计数</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6A737D">// 询问操作</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">query</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  //int sum = 0;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">s.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> c </span><span style="color: #D73A49">=</span><span style="color: #6F42C1">ascii</span><span style="color: #24292E">(s[i]);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">trie[p][c]) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    p</span><span style="color: #D73A49">=</span><span style="color: #24292E">trie[p][c];</span></span>
<span class="line"><span style="color: #6A737D">    // sum+=cnt[p];</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> cnt[p];</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">()</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  ios</span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> t;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">(t</span><span style="color: #D73A49">--</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> n , q;</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> q;</span></span>
<span class="line"><span style="color: #6A737D">    // 每次清空使用过的部分</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">idx;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;j</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">M;j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        trie[i][j]</span><span style="color: #D73A49">=</span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">idx;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      cnt[i]</span><span style="color: #D73A49">=</span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    idx </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      string s;</span></span>
<span class="line"><span style="color: #24292E">      cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> s;</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">insert</span><span style="color: #24292E">(s);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">q;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      string s;</span></span>
<span class="line"><span style="color: #24292E">      cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> s;</span></span>
<span class="line"><span style="color: #24292E">      cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">query</span><span style="color: #24292E">(s) </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>缺点是每次查询后数组重置时容易TLE，解决方法为只清空使用的部分</p>
<h3 id="结构体实现-1">结构体实现</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ios</span><span style="color: #24292E"> ios::sync_with_stdio(0); cin.tie(0); cout.tie(0);</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">endl</span><span style="color: #24292E"> &#39;\n&#39;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> ll;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">unsigned</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> ull;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">double</span><span style="color: #24292E"> ld;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> pair</span><span style="color: #D73A49">&lt;int</span><span style="color: #24292E">,</span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> PII;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">63</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">double</span><span style="color: #24292E"> pi </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">acos</span><span style="color: #24292E">(</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1.0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> mod </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #D73A49">e</span><span style="color: #005CC5">9</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">7</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> INF </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">0x</span><span style="color: #005CC5">3f3f3f3f</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">double</span><span style="color: #24292E"> eps </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #D73A49">e-</span><span style="color: #005CC5">6</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> t;</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">trieNode</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">char</span><span style="color: #24292E"> val;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> cnt;</span></span>
<span class="line"><span style="color: #24292E">  trieNode</span><span style="color: #D73A49">**</span><span style="color: #24292E"> son;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">trieNode</span><span style="color: #24292E">(</span><span style="color: #D73A49">char</span><span style="color: #24292E"> </span><span style="color: #E36209">c</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    val </span><span style="color: #D73A49">=</span><span style="color: #24292E">c;</span></span>
<span class="line"><span style="color: #24292E">    son </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> trieNode</span><span style="color: #D73A49">*</span><span style="color: #24292E">[N];</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">N;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) son[i]</span><span style="color: #D73A49">=</span><span style="color: #005CC5">nullptr</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    cnt </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">trieNode</span><span style="color: #D73A49">*</span><span style="color: #24292E"> root;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ascii</span><span style="color: #24292E">(</span><span style="color: #D73A49">char</span><span style="color: #24292E"> </span><span style="color: #E36209">c</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (c</span><span style="color: #D73A49">&gt;=</span><span style="color: #032F62">&#39;a&#39;</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E"> c</span><span style="color: #D73A49">&lt;=</span><span style="color: #032F62">&#39;z&#39;</span><span style="color: #24292E">) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> c</span><span style="color: #D73A49">-</span><span style="color: #032F62">&#39;a&#39;</span><span style="color: #D73A49">+</span><span style="color: #005CC5">26</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (c</span><span style="color: #D73A49">&gt;=</span><span style="color: #032F62">&#39;A&#39;</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E">c</span><span style="color: #D73A49">&lt;=</span><span style="color: #032F62">&#39;Z&#39;</span><span style="color: #24292E">) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> c</span><span style="color: #D73A49">-</span><span style="color: #032F62">&#39;A&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">return</span><span style="color: #24292E"> c</span><span style="color: #D73A49">-</span><span style="color: #032F62">&#39;0&#39;</span><span style="color: #D73A49">+</span><span style="color: #005CC5">52</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">insert</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  trieNode</span><span style="color: #D73A49">*</span><span style="color: #24292E"> p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> root;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">s.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> c </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ascii</span><span style="color: #24292E">(s[i]);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">p-&gt;son[c]) p-&gt;son[c] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">trieNode</span><span style="color: #24292E">(c);</span></span>
<span class="line"><span style="color: #24292E">    p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p-&gt;son[c];</span></span>
<span class="line"><span style="color: #24292E">    p-&gt;cnt</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">query</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  trieNode</span><span style="color: #D73A49">*</span><span style="color: #24292E"> p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> root;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">s.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> c </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ascii</span><span style="color: #24292E">(s[i]);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">p-&gt;son[c]) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p-&gt;son[c];</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> p-&gt;cnt;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">()</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  ios</span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> t;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">(t</span><span style="color: #D73A49">--</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> n,q;</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> q;</span></span>
<span class="line"><span style="color: #24292E">    root </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">trieNode</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39; &#39;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E">(n</span><span style="color: #D73A49">--</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      string s;</span></span>
<span class="line"><span style="color: #24292E">      cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> s;</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">insert</span><span style="color: #24292E">(s);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E">(q</span><span style="color: #D73A49">--</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      string s;</span></span>
<span class="line"><span style="color: #24292E">      cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> s;</span></span>
<span class="line"><span style="color: #24292E">      cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">query</span><span style="color: #24292E">(s)</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>缺点是滥用指针容易MLE，解决方法为N开小一点（差点炸的程度）</p>
]]></content>
      <categories>
        <category>算法与数据结构</category>
      </categories>
      <tags>
        <tag>数据结构</tag>
        <tag>字符串</tag>
      </tags>
  </entry>
  <entry>
    <title>【算法】排序</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%8E%92%E5%BA%8F/</url>
    <content><![CDATA[<h1 id="排序">排序</h1>
<h2 id="直接插入排序">直接插入排序</h2>
<p>即将每个元素一次插入到有序的部分</p>
<p>一开始将第一个数作为<strong>有序区</strong></p>
<p>直接插入排序即按顺序对每个元素与有序区的最后一个元素比较，若比其小（默认升序），则将该元素存入temp，让temp和有序区的各个元素比较，决定插入位置，插入后有序区扩充</p>
<p>我们采取倒着比较，可以实现同时比较与移动</p>
<ul>
<li><p>时间复杂度：<span class="math inline">\(O(n)\)</span>(最好),
<span class="math inline">\(O(n^2)\)</span>(最坏)， <span
class="math inline">\(O(n^2)\)</span>(平均)</p></li>
<li><p>空间复杂度：<span
class="math inline">\(O(1)\)</span>(辅助空间)</p></li>
<li><p>稳定性：<strong>稳定排序</strong></p></li>
</ul>
<h2 id="折半插入排序">折半插入排序</h2>
<p>区别：找插入位置的方法改为了折半查找</p>
<p>每次将待插入元素放入temp，让left与right指向有序区首尾，通过二分找到合适的插入位置</p>
<ul>
<li>时间复杂度：<span class="math inline">\(O(n)\)</span>(最好), <span
class="math inline">\(O(n^2)\)</span>(最坏)， <span
class="math inline">\(O(n^2)\)</span>(平均)</li>
<li>空间复杂度：<span class="math inline">\(O(1)\)</span>(辅助空间)</li>
<li>稳定性：<strong>稳定排序</strong></li>
</ul>
<h2 id="希尔排序">希尔排序</h2>
<p>基于插入排序的优势：基本有序与数量较小时的高效率</p>
<p>希尔排序通过增量d来对元素分组，d初始为长度的一半</p>
<p>按增量从下标为0开始，间隔d的元素分成一组，组内进行插入排序，排序完将起始点++，继续按间隔d的元素分成一组，以此类推，这是第一轮</p>
<p>第一轮结束后，将增量减半，继续分组进行插入排序</p>
<p>直到增量取值为1，此时即对整个数组插入排序</p>
<ul>
<li>时间复杂度：<span class="math inline">\(O(n)\)</span>(最好), <span
class="math inline">\(O(n^2)\)</span>(最坏)， <span
class="math inline">\(O(n^{1.3})\)</span>(平均)</li>
<li>空间复杂度：<span class="math inline">\(O(1)\)</span>(辅助空间)</li>
<li>稳定性：<strong>不稳定排序</strong></li>
</ul>
<h2 id="冒泡排序">冒泡排序</h2>
<p>即每轮都从前往后比较相邻的两个，逆序就交换</p>
<p>直到不能移动即实现归位，排好了一个元素</p>
<p>改进：引入flag标记每一轮是否进行交换，若发生交换则改为true，每轮结束后判断是否为false，若为false则表示已经有序</p>
<ul>
<li>时间复杂度：<span class="math inline">\(O(n)\)</span>(最好), <span
class="math inline">\(O(n^2)\)</span>(最坏)， <span
class="math inline">\(O(n^{2})\)</span>(平均)</li>
<li>空间复杂度：<span class="math inline">\(O(1)\)</span>(辅助空间)</li>
<li>稳定性：<strong>稳定排序</strong></li>
</ul>
<h2 id="快速排序">快速排序</h2>
<p>任取元素作为枢轴，划分成小于枢轴与大于枢轴两个部分，然后递归处理左右，直到空或只剩一个，以取第一个为例</p>
<p>定义一个pivot变量，将枢轴元素存入，设left与right指向数组首位，先让right向左移动，每个元素与枢轴比较，若小则移动到left位置，否则继续右移；然后让left向右移动，与枢轴比较，若大于则移动到right位置，否则继续右移</p>
<p>也可以不用pivot变量，而直接swap</p>
<p>即：</p>
<p><strong>right从右往左找比枢轴小的元素去填left的坑</strong></p>
<p><strong>left从左往右找比枢轴大的元素去填right的坑</strong></p>
<p>当left==right时，第一次划分结束，划分出两个区间，将枢轴填入指向的坑，此时枢轴归位</p>
<p>然后递归的处理每个区间</p>
<ul>
<li>时间复杂度：<span class="math inline">\(O(n\log n)\)</span>(最好)
<span class="math inline">\(O(n^2)\)</span>(最坏)， <span
class="math inline">\(O(n\log n)\)</span>(平均)</li>
<li>空间复杂度：<span class="math inline">\(O(\log n)\)</span>(辅助空间
最好), <span class="math inline">\(O(n)\)</span>(辅助空间 最差), <span
class="math inline">\(O(\log n )\)</span>(辅助空间 平均)</li>
<li>稳定性：<strong>不稳定排序</strong></li>
</ul>
<h2 id="简单选择排序">简单选择排序</h2>
<p>即每轮在剩下的数里选最小的换到前面</p>
<p>定义一个k变量，保存最小值下标，每轮设为剩下元素中的第一个位置，从下标1开始依次和k中下标变量比较，并更新最小元素下标，搜索一趟后，找到最小值位置，与下标0的元素交换，此时该位置元素归位</p>
<ul>
<li>时间复杂度：<span class="math inline">\(O(n^2)\)</span>(最好) <span
class="math inline">\(O(n^2)\)</span>(最坏)， <span
class="math inline">\(O(n^2)\)</span>(平均)</li>
<li>空间复杂度：<span class="math inline">\(O(1)\)</span>(辅助空间)</li>
<li>稳定性：<strong>不稳定排序</strong></li>
</ul>
<h2 id="堆排序">堆排序</h2>
<p>堆排序是使用堆实现的</p>
<ol type="1">
<li><p>建堆：倒着将每个节点为根的子树调整成堆，可以直接从非叶子节点开始调整</p>
<p>寻找最后一个非叶子节点，即第<span class="math inline">\(\lfloor
\frac{n}{2}\rfloor\)</span>号节点（第n号节点是最后一个叶子节点），拿其与其子树比较，判断是否为堆，若不是则交换不符合的父子节点</p>
<p>交换后，若子树非叶子节点，则需要继续往下比较，防止已有结构被破坏</p>
<p>（即从最后一个非叶节点开始依次向下调整）</p></li>
<li><p>排序：每次将堆顶元素与最后一个元素做交换，然后向下调整新的堆顶，此时该元素归位，隐去</p></li>
</ol>
<ul>
<li>时间复杂度：<span class="math inline">\(O(n\log n)\)</span>(最好)
<span class="math inline">\(O(n\log n)\)</span>(最坏)， <span
class="math inline">\(O(n\log n)\)</span>(平均)</li>
<li>空间复杂度：<span class="math inline">\(O(1)\)</span>(辅助空间)</li>
<li>稳定性：<strong>不稳定排序</strong></li>
</ul>
<h2 id="归并排序">归并排序</h2>
<blockquote>
<p>将两个有序数组合并为一个</p>
</blockquote>
<p>取两个指针指向两个数组的开头，比较更小的放入新数组并移动指针</p>
<p>其中一个放完后，另一个剩下的元素直接放到最后</p>
<h3 id="非递归">非递归</h3>
<p>归并排序即每轮堆相邻的子序列两两归并</p>
<p>一开始把每个元素作为单独子序列，此时所有序列均有序，之后开始归并，归并方法按照上文</p>
<p>一轮归并完后再进行归并，直到变成一个序列</p>
<h3 id="递归">递归</h3>
<p>从自顶向下思考</p>
<p>首先通过左右端点下标确定中间位置，根据中间位置划分为两个区间，</p>
<p>递归左右区间，通过中间位置划分为两个区间，再递归左右区间</p>
<p>直到两个区间有序，则回溯并执行归并操作</p>
<ul>
<li>时间复杂度：<span class="math inline">\(O(n\log n)\)</span>(最好)
<span class="math inline">\(O(n\log n)\)</span>(最坏)， <span
class="math inline">\(O(n\log n)\)</span>(平均)</li>
<li>空间复杂度：<span class="math inline">\(O(n)\)</span>(辅助空间)</li>
<li>稳定性：<strong>稳定排序</strong></li>
</ul>
<h2 id="基数排序">基数排序</h2>
<p>这是一种非比较排序，进行逐位排序</p>
<p>首先统一各元素位数，不够的加前导零</p>
<p>按照从最高位和从最低位排序，分为LSD（最低位优先）与MSD（最高位优先）</p>
<p>LSD较为简单：</p>
<p>首先将所有数按照个位分配，对于十进制，基数为0-9，造十个桶来存储，把每个数按照个位放到对应桶里</p>
<p>这里的桶采用链式存储，满足先进先出，即队列</p>
<p>然后从小到大遍历每个桶，把元素取出并链起来（next指针指向每个桶的队头）</p>
<p>然后按照十位分配，操作同上，直到整体有序</p>
<ul>
<li>时间复杂度：<span class="math inline">\(O(d\times
(n+r))\)</span>，其中d为最大数位数，n为要排的n个数，r为基数</li>
<li>空间复杂度：<span class="math inline">\(O(r)\)</span>(辅助空间)</li>
<li>稳定性：<strong>稳定排序</strong></li>
</ul>
]]></content>
      <categories>
        <category>算法与数据结构</category>
      </categories>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>【图论】最小生成树</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91/</url>
    <content><![CDATA[<h1 id="最小生成树">最小生成树</h1>
<h2 id="定义">定义</h2>
<p>生成树：一个连通图的生成树是一个极小的连通子图，包含图中的n个顶点，但只有构成一棵树的n-1条边</p>
<p>最小生成树：对带权图，它的最小生成树即为原图中边权之和最小的生成树</p>
<h2 id="性质">性质</h2>
<ul>
<li>一个连通图可以有多个生成树</li>
<li>所有生成树都包含相同顶点个数和边数</li>
<li>生成树中不存在环，添加一条鞭会构成环</li>
<li>移除生成树中的任意一条边都会导致图的不连通</li>
<li>对于包含<span
class="math inline">\(n\)</span>个顶点的无向连通图，，生成树包含<span
class="math inline">\(n\)</span>个顶点和<span
class="math inline">\(n-1\)</span>条边，最多包含<span
class="math inline">\(n^{n-2}\)</span>棵生成树</li>
</ul>
<h2 id="prim算法">Prim算法</h2>
<blockquote>
<p>有一个无向图G，每条边有对应边权，从A顶点开始，寻找一个权值最小的路径使其生成一个极小连通子图</p>
</blockquote>
<p>Prim算法即通过加点来构造最小生成树，可以从任何点开始</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91/image-20250420211824850.png" class="" title="最小生成树1">
<p>从A出发，跟A相连的两条路，选权值最小的A-B</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91/image-20250420211911784.png" class="" title="最小生成树2">
<p>此时待选路径有A-F, B-I, B-C, B-G</p>
<p>选择权值最小的路径，即A-F</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91/image-20250420212010372.png" class="" title="最小生成树3">
<p>此时待选路径有B-I, B-C, B-G, F-G, F-E</p>
<p>选择权值最小的路径，即B-I，以此类推</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91/image-20250420212112027.png" class="" title="最小生成树4">
<p>这里我们依次选择了A-B,A-F, B-I, I-C, B-G</p>
<p>此时权值最小的路径为G-F，但如果连上G-F，则形成了环，不符合极小连通子图</p>
<p>选择G-H</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91/image-20250420213152794.png" class="" title="最小生成树5">
<p>最后我们生成了这样的路径，即最小生成树</p>
<p><strong>Prim算法更适合稠密图</strong></p>
<p>(邻接矩阵)</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">100</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> MAX </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">0x</span><span style="color: #005CC5">7fffffff</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">char</span><span style="color: #24292E"> VertexType ;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> EdgeType;</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">mat_grph</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  VertexType vertex[N];</span></span>
<span class="line"><span style="color: #24292E">  EdgeType arc[N][N];</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> vertex_num;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> edge_num;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">create_graph</span><span style="color: #24292E">(</span><span style="color: #6F42C1">mat_grph</span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #E36209">G</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;vertex_num </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">9</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;edge_num </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">15</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;vertex[</span><span style="color: #005CC5">0</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;A&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;vertex[</span><span style="color: #005CC5">1</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;B&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;vertex[</span><span style="color: #005CC5">2</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;C&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;vertex[</span><span style="color: #005CC5">3</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;D&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;vertex[</span><span style="color: #005CC5">4</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;E&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;vertex[</span><span style="color: #005CC5">5</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;F&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;vertex[</span><span style="color: #005CC5">6</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;G&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;vertex[</span><span style="color: #005CC5">7</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;H&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;vertex[</span><span style="color: #005CC5">8</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;I&#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">G-&gt;vertex_num;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;j</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">G-&gt;vertex_num;j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E">(i</span><span style="color: #D73A49">==</span><span style="color: #24292E">j) G-&gt;arc[i][j] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">else</span><span style="color: #24292E"> G-&gt;arc[i][j]</span><span style="color: #D73A49">=</span><span style="color: #24292E">MAX;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">0</span><span style="color: #24292E">][</span><span style="color: #005CC5">1</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">0</span><span style="color: #24292E">][</span><span style="color: #005CC5">5</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">11</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">1</span><span style="color: #24292E">][</span><span style="color: #005CC5">2</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">18</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">1</span><span style="color: #24292E">][</span><span style="color: #005CC5">6</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">16</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">1</span><span style="color: #24292E">][</span><span style="color: #005CC5">8</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">12</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">2</span><span style="color: #24292E">][</span><span style="color: #005CC5">3</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">22</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">2</span><span style="color: #24292E">][</span><span style="color: #005CC5">8</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">8</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">3</span><span style="color: #24292E">][</span><span style="color: #005CC5">4</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">20</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">3</span><span style="color: #24292E">][</span><span style="color: #005CC5">6</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">24</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">3</span><span style="color: #24292E">][</span><span style="color: #005CC5">7</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">16</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">3</span><span style="color: #24292E">][</span><span style="color: #005CC5">8</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">21</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">4</span><span style="color: #24292E">][</span><span style="color: #005CC5">5</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">26</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">4</span><span style="color: #24292E">][</span><span style="color: #005CC5">7</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">7</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">5</span><span style="color: #24292E">][</span><span style="color: #005CC5">6</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">17</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">6</span><span style="color: #24292E">][</span><span style="color: #005CC5">7</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">19</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  // 无向图，把对称的也复制过去</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">G-&gt;vertex_num;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;j</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">G-&gt;vertex_num;j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      G-&gt;arc[j][i] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> G-&gt;arc[i][j];</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">prim</span><span style="color: #24292E">(</span><span style="color: #6F42C1">mat_grph</span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #E36209">G</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">   </span><span style="color: #D73A49">int</span><span style="color: #24292E"> i, j, k;</span></span>
<span class="line"><span style="color: #24292E">   </span><span style="color: #D73A49">int</span><span style="color: #24292E"> minn;</span></span>
<span class="line"><span style="color: #24292E">   </span><span style="color: #D73A49">int</span><span style="color: #24292E"> weight[N];</span><span style="color: #6A737D"> // 侯选边</span></span>
<span class="line"><span style="color: #24292E">   </span><span style="color: #D73A49">int</span><span style="color: #24292E"> vex_index[N];</span><span style="color: #6A737D"> // 表示下标和对应值分别代表的顶点间存在一条连线</span></span>
<span class="line"><span style="color: #6A737D">   // 从顶点A开始</span></span>
<span class="line"><span style="color: #24292E">   weight[</span><span style="color: #005CC5">0</span><span style="color: #24292E">]</span><span style="color: #D73A49">=</span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // vex_index某点与下标对应点赋值为0</span></span>
<span class="line"><span style="color: #24292E">   vex_index[</span><span style="color: #005CC5">0</span><span style="color: #24292E">]</span><span style="color: #D73A49">=</span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">   </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">G-&gt;vertex_num;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    weight[i] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> G-&gt;arc[</span><span style="color: #005CC5">0</span><span style="color: #24292E">][i];</span><span style="color: #6A737D"> // 存放第i个节点的待选权值</span></span>
<span class="line"><span style="color: #24292E">    vex_index[i] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 都从0开始连接</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">G-&gt;vertex_num;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    minn </span><span style="color: #D73A49">=</span><span style="color: #24292E"> MAX;</span></span>
<span class="line"><span style="color: #24292E">    j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    k </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">    // 从0到9，寻找最小的与之连接</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E">(j</span><span style="color: #D73A49">=</span><span style="color: #005CC5">0</span><span style="color: #24292E">;j</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">G-&gt;vertex_num;j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (weight[j]</span><span style="color: #D73A49">!=</span><span style="color: #005CC5">0</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E"> weight[j]</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">minn){</span></span>
<span class="line"><span style="color: #24292E">        minn </span><span style="color: #D73A49">=</span><span style="color: #24292E"> weight[j];</span></span>
<span class="line"><span style="color: #24292E">        k </span><span style="color: #D73A49">=</span><span style="color: #24292E"> j;</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> G-&gt;vertex[vex_index[k]]</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;, &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">G-&gt;vertex[k]</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">    weight[k]</span><span style="color: #D73A49">=</span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 该点已被选完，不能再用</span></span>
<span class="line"><span style="color: #6A737D">    // 找新连接点的待选路径</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;j</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">G-&gt;vertex_num;j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (weight[j]</span><span style="color: #D73A49">!=</span><span style="color: #005CC5">0</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E"> G-&gt;arc[k][j]</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">weight[j]){</span></span>
<span class="line"><span style="color: #24292E">        weight[j] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> G-&gt;arc[k][j];</span><span style="color: #6A737D"> // 更新备选项</span></span>
<span class="line"><span style="color: #24292E">        vex_index[j] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> k;</span><span style="color: #6A737D"> // 更新前一个节点的下标为新值</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  mat_grph G;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">create_graph</span><span style="color: #24292E">(</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">G);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">prim</span><span style="color: #24292E">(</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">G);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>(邻接表/链式前向星)</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">5005</span><span style="color: #24292E">, M </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">400005</span><span style="color: #24292E">; </span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Edge</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> to, w, next;</span></span>
<span class="line"><span style="color: #24292E">} edge[M];</span><span style="color: #6A737D"> // 无向图 开两倍</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> head[N], cnt;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> dist[N];</span><span style="color: #6A737D">  // 到生成树的距离</span></span>
<span class="line"><span style="color: #D73A49">bool</span><span style="color: #24292E"> vis[N];</span><span style="color: #6A737D">  // 是否已加入生成树</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> parent[N];</span><span style="color: #6A737D"> // 记录父节点</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> n, m, ans;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 链式前向星加边</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">add_edge</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">u</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">v</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">w</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">    edge[cnt].to </span><span style="color: #D73A49">=</span><span style="color: #24292E"> v;</span></span>
<span class="line"><span style="color: #24292E">    edge[cnt].w </span><span style="color: #D73A49">=</span><span style="color: #24292E"> w;</span></span>
<span class="line"><span style="color: #24292E">    edge[cnt].next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> head[u];</span></span>
<span class="line"><span style="color: #24292E">    head[u] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> cnt</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">prim</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">memset</span><span style="color: #24292E">(dist, </span><span style="color: #D73A49">0x</span><span style="color: #005CC5">3f</span><span style="color: #24292E">, sizeof dist);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">memset</span><span style="color: #24292E">(parent, </span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">, sizeof parent);</span></span>
<span class="line"><span style="color: #24292E">    dist[</span><span style="color: #005CC5">1</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    ans </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">; i </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E"> n; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">int</span><span style="color: #24292E"> u </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">, minn </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">0x</span><span style="color: #005CC5">3f3f3f3f</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">        // 找到距离生成树最近的点</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">; j </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E"> n; j</span><span style="color: #D73A49">++</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">if</span><span style="color: #24292E">(</span><span style="color: #D73A49">!</span><span style="color: #24292E">vis[j] </span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E"> dist[j] </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> minn) {</span></span>
<span class="line"><span style="color: #24292E">                minn </span><span style="color: #D73A49">=</span><span style="color: #24292E"> dist[j];</span></span>
<span class="line"><span style="color: #24292E">                u </span><span style="color: #D73A49">=</span><span style="color: #24292E"> j;</span></span>
<span class="line"><span style="color: #24292E">            }</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E">(u </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">) </span><span style="color: #D73A49">break</span><span style="color: #24292E">;</span><span style="color: #6A737D">  // 找不到新的点，说明图不连通</span></span>
<span class="line"><span style="color: #24292E">        vis[u] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">true</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        ans </span><span style="color: #D73A49">+=</span><span style="color: #24292E"> minn;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (parent[u]</span><span style="color: #D73A49">!=-</span><span style="color: #005CC5">1</span><span style="color: #24292E">) cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">parent[u] </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot; &quot;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">u</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span><span style="color: #6A737D"> // 非起点输出</span></span>
<span class="line"><span style="color: #6A737D">        // 更新其他点到生成树的距离</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> head[u]; </span><span style="color: #D73A49">~</span><span style="color: #24292E">i; i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> edge[i].next) {</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">int</span><span style="color: #24292E"> v </span><span style="color: #D73A49">=</span><span style="color: #24292E"> edge[i].to;</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">if</span><span style="color: #24292E">(</span><span style="color: #D73A49">!</span><span style="color: #24292E">vis[v] </span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E"> edge[i].w </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> dist[v]) {</span></span>
<span class="line"><span style="color: #24292E">                dist[v] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> edge[i].w;</span></span>
<span class="line"><span style="color: #24292E">                parent[v]</span><span style="color: #D73A49">=</span><span style="color: #24292E">u;</span></span>
<span class="line"><span style="color: #24292E">            }</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">memset</span><span style="color: #24292E">(head, </span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">, </span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(head));</span></span>
<span class="line"><span style="color: #24292E">    cnt </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> m;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">; i </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E"> m; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">int</span><span style="color: #24292E"> u, v, w;</span></span>
<span class="line"><span style="color: #24292E">        cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> u </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> v </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> w;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">add_edge</span><span style="color: #24292E">(u, v, w);</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">add_edge</span><span style="color: #24292E">(v, u, w);</span><span style="color: #6A737D">  // 无向图需要加两条边</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">prim</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">bool</span><span style="color: #24292E"> check </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">true</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">; i </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E"> n; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E">(</span><span style="color: #D73A49">!</span><span style="color: #24292E">vis[i]) {</span></span>
<span class="line"><span style="color: #24292E">          check </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">break</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E">(check) cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> ans </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E"> cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;orz&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">    </span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="kruskal算法">Kruskal算法</h2>
<p>Kruskal算法是通过加边来构建最小生成树的</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91/image-20250421205358929.png" class="" title="kruskal-1">
<p>按边权从小到大排序，最小的是V1-V3</p>
<p>首先判断加入前这两个端点是否在同一个连通分量中，若可以则添加</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91/image-20250421205650259.png" class="" title="kruskal-2">
<p>按边权顺序依次添加V4-V6， V2-V5</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91/image-20250421205746899.png" class="" title="kruskal-3">
<p>此时有两个相同最小边权的情况，证明有多个最小生成树，且都不在同一连通分量，故随便选一个</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91/image-20250421205855795.png" class="" title="kruskal-4">
<p>此时发现，V3与V6已经位于同一连通分量，故不能加边</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91/image-20250421210045002.png" class="" title="kruskal-5">
<p>直到所有点被连通，此时构建了最小生成树</p>
<p><strong>Kruskal算法更适合稀疏图</strong></p>
<p>代码部分使用了并查集来实现判断是否有环</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">5005</span><span style="color: #24292E">, M </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">400005</span><span style="color: #24292E">; </span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Edge</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> u,v,w;</span></span>
<span class="line"><span style="color: #24292E">} edge[M];</span><span style="color: #6A737D"> // 无向图 开两倍</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> parent[N];</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> n, m, cnt </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">, ans </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">// 查找操作</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">find</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (parent[x]</span><span style="color: #D73A49">!=</span><span style="color: #24292E">x)parent[x]</span><span style="color: #D73A49">=</span><span style="color: #6F42C1">find</span><span style="color: #24292E">(parent[x]);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> parent[x];</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6A737D">// 合并操作</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">merge</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #6F42C1">find</span><span style="color: #24292E">(a)</span><span style="color: #D73A49">&gt;</span><span style="color: #6F42C1">find</span><span style="color: #24292E">(b)) parent[</span><span style="color: #6F42C1">find</span><span style="color: #24292E">(a)]</span><span style="color: #D73A49">=</span><span style="color: #6F42C1">find</span><span style="color: #24292E">(b);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">else</span><span style="color: #24292E"> parent[</span><span style="color: #6F42C1">find</span><span style="color: #24292E">(b)]</span><span style="color: #D73A49">=</span><span style="color: #6F42C1">find</span><span style="color: #24292E">(a);</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> m;</span></span>
<span class="line"><span style="color: #6A737D">  // 建图，不需要链式前向星</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">m;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> x, y, w;</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> x </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> y </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> w;</span></span>
<span class="line"><span style="color: #24292E">    edge[i] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {x,y,w};</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 按权值排序</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">sort</span><span style="color: #24292E">(edge</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">,edge</span><span style="color: #D73A49">+</span><span style="color: #24292E">m</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">, [</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">](</span><span style="color: #6F42C1">Edge</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #6F42C1">Edge</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span><span style="color: #D73A49">return</span><span style="color: #24292E"> a.w</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">b.w;});</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) parent[i]</span><span style="color: #D73A49">=</span><span style="color: #24292E">i;</span><span style="color: #6A737D"> // 自己是自己的</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> temp </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">m;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #6F42C1">find</span><span style="color: #24292E">(edge[i].u)</span><span style="color: #D73A49">==</span><span style="color: #6F42C1">find</span><span style="color: #24292E">(edge[i].v)) </span><span style="color: #D73A49">continue</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 若两者是连通分量则跳过</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">merge</span><span style="color: #24292E">(edge[i].u,edge[i].v);</span><span style="color: #6A737D"> // 建边</span></span>
<span class="line"><span style="color: #24292E">      temp</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 记录建的边数</span></span>
<span class="line"><span style="color: #24292E">      ans</span><span style="color: #D73A49">+=</span><span style="color: #24292E">edge[i].w;</span><span style="color: #6A737D"> // 累加权值</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (temp</span><span style="color: #D73A49">!=</span><span style="color: #24292E">n</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">) cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;orz&quot;</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 若建边数不是n-1，则没有生成最小生成树</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">else</span><span style="color: #24292E"> cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> ans ;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>算法与数据结构</category>
      </categories>
      <tags>
        <tag>数据结构</tag>
        <tag>图论</tag>
      </tags>
  </entry>
  <entry>
    <title>【图论】最短路径</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/</url>
    <content><![CDATA[<h1 id="最短路径">最短路径</h1>
<h2 id="dijkstra">Dijkstra</h2>
<h3 id="思路">思路</h3>
<p>基本步骤：</p>
<ul>
<li>选定一个点，满足：
<ul>
<li>未被选过</li>
<li>距离最短</li>
</ul></li>
<li>对这个点的所有邻接点尝试<strong>松弛</strong>(如下图，从a到c权值为5，而从a到b到c权值为3，我们用后者代替前者成为最短路，此之为成功的松弛)</li>
</ul>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/image-20250424221240261.png" class="" title="dij">
<p>从a开始，依次寻找下一个节点，使得从a到当前节点的路径最短，直到找到结尾</p>
<p>遍历时，我们依次寻找a到当前节点的最短路径以及最近节点</p>
<p>当我们得到了最短权值，我们可以反推回a从而获取最短路径</p>
<p>用矩阵表示如下</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/image-20250424221254089.png" class="" title="dij矩阵">
<h3 id="代码">代码</h3>
<p>邻接矩阵</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">endl</span><span style="color: #24292E"> &#39;\n&#39;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> ll;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> pair</span><span style="color: #D73A49">&lt;int</span><span style="color: #24292E">,</span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> PII;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #D73A49">e</span><span style="color: #005CC5">5</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> mod </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #D73A49">e</span><span style="color: #005CC5">9</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">7</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">vector</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">vector</span><span style="color: #D73A49">&lt;int&gt;&gt;</span><span style="color: #24292E"> G;</span></span>
<span class="line"><span style="color: #24292E">vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> path;</span></span>
<span class="line"><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt; </span><span style="color: #6F42C1">dijkstra</span><span style="color: #24292E">(</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt;&gt; </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">G</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> n </span><span style="color: #D73A49">=</span><span style="color: #24292E"> G.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">dis</span><span style="color: #24292E">(n,</span><span style="color: #D73A49">0x</span><span style="color: #005CC5">3f3f3f3f</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">vis</span><span style="color: #24292E">(n,</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  dis[s] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">n</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> node </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;j</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">n;j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">vis[j]</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E">(node</span><span style="color: #D73A49">==-</span><span style="color: #005CC5">1</span><span style="color: #D73A49">||</span><span style="color: #24292E">dis[j]</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">dis[node])){</span></span>
<span class="line"><span style="color: #24292E">        node </span><span style="color: #D73A49">=</span><span style="color: #24292E"> j;</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;j</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">n;j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (dis[node]</span><span style="color: #D73A49">+</span><span style="color: #24292E">G[node][j]</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">dis[j]){</span></span>
<span class="line"><span style="color: #24292E">        dis[j] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> dis[node]</span><span style="color: #D73A49">+</span><span style="color: #24292E">G[node][j];</span></span>
<span class="line"><span style="color: #24292E">        path[j] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> node;</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    vis[node] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">true</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> dis;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6A737D">// 路径获取</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get_path</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">, </span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt; </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">P</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">x){</span></span>
<span class="line"><span style="color: #24292E">    P.</span><span style="color: #6F42C1">push_back</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 若该节点前有节点，则先获取前面节点的内容</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (path[x]</span><span style="color: #D73A49">!=-</span><span style="color: #005CC5">1</span><span style="color: #24292E">)</span><span style="color: #6F42C1">get_path</span><span style="color: #24292E">(path[x], P);</span></span>
<span class="line"><span style="color: #24292E">  P.</span><span style="color: #6F42C1">push_back</span><span style="color: #24292E">(x);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">solve</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> n, m, s;</span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> m </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> s;</span></span>
<span class="line"><span style="color: #24292E">  path </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt;(n,</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  G </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt;&gt; (n,</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt;(n, </span><span style="color: #D73A49">0x</span><span style="color: #005CC5">3f3f3f3f</span><span style="color: #24292E">));</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">m;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> u,v,w;</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> u </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> v </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> w;</span></span>
<span class="line"><span style="color: #24292E">    u</span><span style="color: #D73A49">--</span><span style="color: #24292E">,v</span><span style="color: #D73A49">--</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">G[u][v])G[u][v]</span><span style="color: #D73A49">=</span><span style="color: #24292E">w;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E"> G[u][v]</span><span style="color: #D73A49">=</span><span style="color: #6F42C1">min</span><span style="color: #24292E">(G[u][v],w);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> dis </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">dijkstra</span><span style="color: #24292E">(G, s</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">auto</span><span style="color: #24292E"> it: dis)cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> it </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&#39; &#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">()</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">ios</span><span style="color: #24292E">::</span><span style="color: #6F42C1">sync_with_stdio</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">); cin.</span><span style="color: #6F42C1">tie</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">); cout.</span><span style="color: #6F42C1">tie</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> tomorin</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  //cin &gt;&gt; tomorin;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E"> (tomorin</span><span style="color: #D73A49">--</span><span style="color: #24292E">) </span><span style="color: #6F42C1">solve</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="最小堆优化">最小堆优化</h3>
<p>上述朴素算法的问题：</p>
<ul>
<li>寻找最小点时，通过遍历n个点来获得最小点</li>
<li>对该点邻接点进行松弛时，我们也是通过遍历去寻找邻接点</li>
</ul>
<p>对于以上问题，我们可以选用小根堆与邻接表直接获取，可以实现代码的优化</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">endl</span><span style="color: #24292E"> &#39;\n&#39;</span></span>
<span class="line"><span style="color: #24292E">vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> edge, weight, Next, head;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> n, m, s;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> idx</span><span style="color: #D73A49">=</span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt; </span><span style="color: #6F42C1">dijkstra</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">dis</span><span style="color: #24292E">(n,</span><span style="color: #D73A49">0x</span><span style="color: #005CC5">3f3f3f3f</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">vis</span><span style="color: #24292E">(n,</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    dis[s]</span><span style="color: #D73A49">=</span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">    // 最小堆，first记录dis， second记录node</span></span>
<span class="line"><span style="color: #24292E">    priority_queue</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">pair</span><span style="color: #D73A49">&lt;int</span><span style="color: #24292E">,</span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E">, vector</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">pair</span><span style="color: #D73A49">&lt;int</span><span style="color: #24292E">,</span><span style="color: #D73A49">int&gt;&gt;</span><span style="color: #24292E">, greater</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">pair</span><span style="color: #D73A49">&lt;int</span><span style="color: #24292E">,</span><span style="color: #D73A49">int&gt;&gt;&gt;</span><span style="color: #24292E"> mh;</span></span>
<span class="line"><span style="color: #24292E">    mh.</span><span style="color: #6F42C1">push</span><span style="color: #24292E">({dis[s],</span><span style="color: #005CC5">0</span><span style="color: #24292E">});</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E">(</span><span style="color: #D73A49">!</span><span style="color: #24292E">mh.</span><span style="color: #6F42C1">empty</span><span style="color: #24292E">()){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">int</span><span style="color: #24292E"> node </span><span style="color: #D73A49">=</span><span style="color: #24292E"> mh.</span><span style="color: #6F42C1">top</span><span style="color: #24292E">().second;</span></span>
<span class="line"><span style="color: #24292E">        mh.</span><span style="color: #6F42C1">pop</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E">(vis[node]) </span><span style="color: #D73A49">continue</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> head[node];</span><span style="color: #D73A49">~</span><span style="color: #24292E">i;i</span><span style="color: #D73A49">=</span><span style="color: #24292E">Next[i]){</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (dis[edge[i]]</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">dis[node]</span><span style="color: #D73A49">+</span><span style="color: #24292E">weight[i]){</span></span>
<span class="line"><span style="color: #24292E">                dis[edge[i]]</span><span style="color: #D73A49">=</span><span style="color: #24292E">dis[node]</span><span style="color: #D73A49">+</span><span style="color: #24292E">weight[i];</span></span>
<span class="line"><span style="color: #24292E">                mh.</span><span style="color: #6F42C1">push</span><span style="color: #24292E">({dis[edge[i]],edge[i]});</span></span>
<span class="line"><span style="color: #24292E">            }</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        vis[node]</span><span style="color: #D73A49">=</span><span style="color: #005CC5">true</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> dis;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">add_edge</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">u</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">v</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">w</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    edge[idx] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> v;</span></span>
<span class="line"><span style="color: #24292E">    weight[idx] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> w;</span></span>
<span class="line"><span style="color: #24292E">    Next[idx] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> head[u];</span></span>
<span class="line"><span style="color: #24292E">    head[u]</span><span style="color: #D73A49">=</span><span style="color: #24292E">idx</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> m </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> s;</span></span>
<span class="line"><span style="color: #24292E">    head </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt; (n,</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    edge </span><span style="color: #D73A49">=</span><span style="color: #24292E"> weight </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt; (m,</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E">(m</span><span style="color: #D73A49">--</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">int</span><span style="color: #24292E"> u, v, w;</span></span>
<span class="line"><span style="color: #24292E">        cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> u </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> v </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> w;</span></span>
<span class="line"><span style="color: #24292E">        u</span><span style="color: #D73A49">--</span><span style="color: #24292E">,v</span><span style="color: #D73A49">--</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">add_edge</span><span style="color: #24292E">(u,v,w);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> dis </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">dijkstra</span><span style="color: #24292E">(s</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">auto</span><span style="color: #24292E"> it:dis) cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> it </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&#39; &#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="floyd">Floyd</h2>
<h3 id="思路-1">思路</h3>
<p>Floyd与Dijkstra都是看节点间的值，但是前者看的是每两点间最短距离</p>
<p><strong>Dis数组，记录两点距离：</strong></p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/image-20250423210341040.png" class="" title="floyd">
<p>这里矩阵中每个位置表示两点间的距离，而D上的下标表示从何处中转得到的距离（-1表示不进行中转）</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/image-20250423210633734.png" class="" title="floyd2">
<p>如此时<span class="math inline">\(D^0\)</span>为从<span
class="math inline">\(v_0\)</span>进行中转得到的两点间距离，且距离可以根据红色式子表示，即经过中转点后的距离与上一步已有距离的最小值</p>
<p><strong>Path数组，记录经过点(最短路径)</strong></p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/image-20250423211054681.png" class="" title="floyd3">
<p>Path数组记录了两点间经过的中转点是哪个点，若为直达则记录终点，如<span
class="math inline">\(P^{-1}\)</span>指的是没有中转，其中记录的都是终点，<span
class="math inline">\(P^0\)</span>指经过<span
class="math inline">\(v_0\)</span>中转，故<span
class="math inline">\(v_1\to v_2\)</span>对应的值为0，表示中转点为<span
class="math inline">\(v_0\)</span></p>
<p>通过path数组推出最短路径：</p>
<p>如寻找<span class="math inline">\(v_1\)</span>到<span
class="math inline">\(v_0\)</span>的最短路径：找到第一行第零列的点对应的点，该点即为到达终点的前一个点；再找到该点对应的点，即为到达该点的前一个点，直到推到起点</p>
<h3 id="代码-1">代码</h3>
<p>(邻接矩阵)</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">100</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> M </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">200</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> MAX </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">0x</span><span style="color: #005CC5">10000</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">char</span><span style="color: #24292E"> VertexType ;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> EdgeType;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">mat_grph</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  VertexType vertex[N];</span></span>
<span class="line"><span style="color: #24292E">  EdgeType arc[N][N];</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> vertex_num;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> edge_num;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">createGraph</span><span style="color: #24292E">(</span><span style="color: #6F42C1">mat_grph</span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #E36209">G</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">  G-&gt;vertex_num </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">9</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;edge_num </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">15</span><span style="color: #24292E">; </span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">G-&gt;vertex_num;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    G-&gt;vertex[i] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> i;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">G-&gt;vertex_num;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;j</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">G-&gt;vertex_num;j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E">(i</span><span style="color: #D73A49">==</span><span style="color: #24292E">j) G-&gt;arc[i][j] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">else</span><span style="color: #24292E"> G-&gt;arc[i][j]</span><span style="color: #D73A49">=</span><span style="color: #24292E">MAX;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">0</span><span style="color: #24292E">][</span><span style="color: #005CC5">1</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">0</span><span style="color: #24292E">][</span><span style="color: #005CC5">2</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">5</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">1</span><span style="color: #24292E">][</span><span style="color: #005CC5">2</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">3</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">1</span><span style="color: #24292E">][</span><span style="color: #005CC5">3</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">7</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">1</span><span style="color: #24292E">][</span><span style="color: #005CC5">4</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">5</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">2</span><span style="color: #24292E">][</span><span style="color: #005CC5">4</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">2</span><span style="color: #24292E">][</span><span style="color: #005CC5">5</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">7</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">3</span><span style="color: #24292E">][</span><span style="color: #005CC5">4</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">3</span><span style="color: #24292E">][</span><span style="color: #005CC5">6</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">3</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">4</span><span style="color: #24292E">][</span><span style="color: #005CC5">5</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">3</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">4</span><span style="color: #24292E">][</span><span style="color: #005CC5">6</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">6</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">4</span><span style="color: #24292E">][</span><span style="color: #005CC5">7</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">9</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">5</span><span style="color: #24292E">][</span><span style="color: #005CC5">7</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">5</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">6</span><span style="color: #24292E">][</span><span style="color: #005CC5">7</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">6</span><span style="color: #24292E">][</span><span style="color: #005CC5">8</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">7</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  G-&gt;arc[</span><span style="color: #005CC5">7</span><span style="color: #24292E">][</span><span style="color: #005CC5">8</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">4</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">G-&gt;vertex_num;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; j</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">G-&gt;vertex_num;j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      G-&gt;arc[j][i] </span><span style="color: #D73A49">=</span><span style="color: #24292E">  G-&gt;arc[i][j];</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">floyd</span><span style="color: #24292E">(</span><span style="color: #6F42C1">mat_grph</span><span style="color: #24292E"> </span><span style="color: #E36209">G</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> path[N][N];</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> dis[N][N];</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">G.vertex_num;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;j</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">G.vertex_num;j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      dis[i][j] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> G.arc[i][j];</span><span style="color: #6A737D"> // 最初的dis数组</span></span>
<span class="line"><span style="color: #24292E">      path[i][j] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> j;</span><span style="color: #6A737D"> // 最初的path数组</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">G.vertex_num;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;j</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">G.vertex_num;j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> k </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;k</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">G.vertex_num;k</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E">(dis[j][k]</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">dis[j][i]</span><span style="color: #D73A49">+</span><span style="color: #24292E">dis[i][k]){</span></span>
<span class="line"><span style="color: #24292E">          dis[j][k] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> dis[j][i]</span><span style="color: #D73A49">+</span><span style="color: #24292E">dis[i][k];</span></span>
<span class="line"><span style="color: #24292E">          path[j][k] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> path[j][i];</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> k;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">G.vertex_num;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> i</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">; j</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">G.vertex_num;j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;v</span><span style="color: #005CC5">%d</span><span style="color: #032F62">-&gt;v</span><span style="color: #005CC5">%d</span><span style="color: #032F62"> weight:</span><span style="color: #005CC5">%d</span><span style="color: #032F62"> &quot;</span><span style="color: #24292E">, i, j, dis[i][j]);</span></span>
<span class="line"><span style="color: #24292E">      k </span><span style="color: #D73A49">=</span><span style="color: #24292E"> path[i][j];</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;path:v</span><span style="color: #005CC5">%d</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">, i);</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">while</span><span style="color: #24292E">(k</span><span style="color: #D73A49">!=</span><span style="color: #24292E">j){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;-&gt;v</span><span style="color: #005CC5">%d</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">, k);</span></span>
<span class="line"><span style="color: #24292E">        k </span><span style="color: #D73A49">=</span><span style="color: #24292E"> path[k][j];</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;-&gt;v</span><span style="color: #005CC5">%d\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">, j);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  mat_grph G;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">createGraph</span><span style="color: #24292E">(</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">G);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">floyd</span><span style="color: #24292E">(G);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="a">A*</h2>
<p>解决问题：给定原点与目标点，最少代价路径是什么</p>
<p>特点：与dijkstra不同，A*算法考虑从原点到当前点的距离+当前点到目标点距离的估计距离，最后排大小</p>
<style>.yeccugerihyh{zoom:50%;}</style>

<p>如该方格，起点为G，终点为U</p>
<p>从G到U预估走4步，G到G走0步，故参与排序为0+4，放入小根堆，并将原点到当前点距离放入distance表中</p>
<p>G
4取出，G到L,N,H,F为1，放入distance，并分别算出到U的预估距离，相加放入小根堆</p>
<p>在取出堆顶并重复上述操作</p>
<p>dij可以看作A*每次预估距离都为0，是一个特例</p>
<h3 id="预估函数">预估函数</h3>
<p>预估函数是一种吸引力，合适的预估函数（越接近真实距离）会大大提升速度</p>
<p>要求：预估距离<strong>小于等于</strong>到终点的真实距离</p>
<p>预估距离经常选择：曼哈顿距离、欧氏距离、对角线距离等</p>
<p>如：若允许走斜线，曼哈顿距离就不能保证正确性了，此时可以取行与行、列与列间差值最大值</p>
<h3 id="板子">板子</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">endl</span><span style="color: #24292E"> &#39;\n&#39;</span></span>
<span class="line"><span style="color: #24292E">vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> edge, weight, Next, head;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> n, m, s, t;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> idx</span><span style="color: #D73A49">=</span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> idis;</span><span style="color: #6A737D"> // 根据需求填入计算合适理想距离</span></span>
<span class="line"><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt; </span><span style="color: #6F42C1">astar</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">dis</span><span style="color: #24292E">(n,</span><span style="color: #D73A49">0x</span><span style="color: #005CC5">3f3f3f3f</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">vis</span><span style="color: #24292E">(n,</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    dis[s]</span><span style="color: #D73A49">=</span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">    // 最小堆，first记录dis， second记录node</span></span>
<span class="line"><span style="color: #24292E">    priority_queue</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">pair</span><span style="color: #D73A49">&lt;int</span><span style="color: #24292E">,</span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E">, vector</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">pair</span><span style="color: #D73A49">&lt;int</span><span style="color: #24292E">,</span><span style="color: #D73A49">int&gt;&gt;</span><span style="color: #24292E">, greater</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">pair</span><span style="color: #D73A49">&lt;int</span><span style="color: #24292E">,</span><span style="color: #D73A49">int&gt;&gt;&gt;</span><span style="color: #24292E"> mh;</span></span>
<span class="line"><span style="color: #24292E">    mh.</span><span style="color: #6F42C1">push</span><span style="color: #24292E">({dis[s]</span><span style="color: #D73A49">+</span><span style="color: #24292E">idis[s],s});</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E">(</span><span style="color: #D73A49">!</span><span style="color: #24292E">mh.</span><span style="color: #6F42C1">empty</span><span style="color: #24292E">()){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">int</span><span style="color: #24292E"> node </span><span style="color: #D73A49">=</span><span style="color: #24292E"> mh.</span><span style="color: #6F42C1">top</span><span style="color: #24292E">().second;</span></span>
<span class="line"><span style="color: #24292E">        mh.</span><span style="color: #6F42C1">pop</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E">(vis[node]) </span><span style="color: #D73A49">continue</span><span style="color: #24292E">; </span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (s</span><span style="color: #D73A49">==</span><span style="color: #24292E">t) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> dis;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> head[node];</span><span style="color: #D73A49">~</span><span style="color: #24292E">i;i</span><span style="color: #D73A49">=</span><span style="color: #24292E">Next[i]){</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (dis[edge[i]]</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">dis[node]</span><span style="color: #D73A49">+</span><span style="color: #24292E">weight[i]){</span></span>
<span class="line"><span style="color: #24292E">                dis[edge[i]]</span><span style="color: #D73A49">=</span><span style="color: #24292E">dis[node]</span><span style="color: #D73A49">+</span><span style="color: #24292E">weight[i];</span></span>
<span class="line"><span style="color: #24292E">                mh.</span><span style="color: #6F42C1">push</span><span style="color: #24292E">({dis[edge[i]]</span><span style="color: #D73A49">+</span><span style="color: #24292E">idis[edge[i]],edge[i]});</span></span>
<span class="line"><span style="color: #24292E">            }</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        vis[node]</span><span style="color: #D73A49">=</span><span style="color: #005CC5">true</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> dis;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">add_edge</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">u</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">v</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">w</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    edge[idx] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> v;</span></span>
<span class="line"><span style="color: #24292E">    weight[idx] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> w;</span></span>
<span class="line"><span style="color: #24292E">    Next[idx] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> head[u];</span></span>
<span class="line"><span style="color: #24292E">    head[u]</span><span style="color: #D73A49">=</span><span style="color: #24292E">idx</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> m </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> s </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> t;</span></span>
<span class="line"><span style="color: #24292E">    head </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt; (n,</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    edge </span><span style="color: #D73A49">=</span><span style="color: #24292E"> weight </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt; (m,</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    idis </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt; (n,</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E">(m</span><span style="color: #D73A49">--</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">int</span><span style="color: #24292E"> u, v, w;</span></span>
<span class="line"><span style="color: #24292E">        cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> u </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> v </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> w;</span></span>
<span class="line"><span style="color: #24292E">        u</span><span style="color: #D73A49">--</span><span style="color: #24292E">,v</span><span style="color: #D73A49">--</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">add_edge</span><span style="color: #24292E">(u,v,w);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> dis </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">astar</span><span style="color: #24292E">(s</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">auto</span><span style="color: #24292E"> it:dis) cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> it </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&#39; &#39;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">    // if (it==0x3f3f3f3f) cout &lt;&lt;2147483647&lt;&lt;&#39; &#39;;</span></span>
<span class="line"><span style="color: #6A737D">    // else cout &lt;&lt; it &lt;&lt;&#39; &#39;;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>算法与数据结构</category>
      </categories>
      <tags>
        <tag>算法</tag>
        <tag>图论</tag>
      </tags>
  </entry>
  <entry>
    <title>【数据结构】树状数组</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84/</url>
    <content><![CDATA[<h2 id="树状数组">树状数组</h2>
<blockquote>
<p>给出一个长度为n的数组，完成以下两个操作</p>
<ul>
<li>将第x个数加上k</li>
<li>输出区间<span class="math inline">\([x,y]\)</span>内每个数的和</li>
</ul>
</blockquote>
<h2 id="前缀和">前缀和</h2>
<p>使用前缀和进行询问时，可以通过询问r与l-1处的前缀和并相减获得区间数之和</p>
<p>但进行增加操作时，若想实现在某位置i处增加v，那么该数后面的所有元素都要对应增加v</p>
<p>对于这个问题，朴素算法能做到<span
class="math inline">\(O(n^2)\)</span>的时间复杂度，易TLE</p>
<h2 id="优化思维">优化思维</h2>
<p>单个求区间和会超时，我们可以对数组进行处理：</p>
<p>我们可以把数字两两求和，存到另一个数组中，再进行两两求和，一直到剩一个数字</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84/image-20250125174255698.png" class="" title="树状数组思路1">
<p>这样即使要求的数很多，我们也可以利用额外的数组计算答案</p>
<p>如计算前15个数的和，我们只需要计算4个数字即可</p>
<p>但我们可以发现，每层中第偶数个数字是没有用的，因为都可以找到更上一层的代替，去掉以后，剩下的数据恰好为n个，可以装到一个数组中，与原始数组一样长</p>
<p>该数组即为树状数组，每个元素都对应着树的每个节点，而每个节点对应的是原数组的某个区间和</p>
<p>也可以理解为每个元素是以该元素为右边界所管辖的最长区间和中元素个数</p>

<p>求和时只需要找到对应区间，相加即可得到答案</p>
<p>修改某个数据时，也只需要向上找到包含它的区间进行修改即可</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84/image-20250125174648334.png" class="" title="树状数组思路2">
<h2 id="lowbit运算">lowbit()运算</h2>
<h3 id="定义">定义</h3>
<p>表示非负整数二进制表示下最低位1及其后面的0构成的数</p>
<p>即实现了提取最右侧1，并让其余位置变为0</p>
<p>e.g. <span
class="math inline">\(lowbit(44)=lowbit((101100)_2)=(100)_2=4\)</span></p>
<h3 id="求解方法">求解方法</h3>
<p>如44，二进制为101100</p>
<p>首先将该数取反：<span
class="math inline">\(\sim101100=010011\)</span></p>
<p>然后加一：<span class="math inline">\(010011+1=010100\)</span></p>
<p>这时发现除了最低位1与后面的0，其余位上与原数均不同</p>
<p>将这两个数按位与：<span class="math inline">\(101100 \and
010100=000100\)</span></p>
<p><strong>故<code>lowbit(n)=n&amp;(~n+1)=n&amp;-n</code></strong></p>
<h2 id="树状数组实现">树状数组实现</h2>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84/image-20250125160459690.png" class="" title="树状">
<p>我们根据序列建造一棵树，每个节点<span
class="math inline">\(t[x]\)</span> 保存以<span
class="math inline">\(x\)</span>为根的子树中叶节点值之和</p>
<p>将每个<span
class="math inline">\(t[x]\)</span>的x转化为二进制，我们发现每一层末尾0的个数相同，且0的个数与其覆盖长度有关，每层的lowbit()值都相同</p>
<p>故<span class="math inline">\(t[x]\)</span>节点覆盖长度就是lowbit(x)
，序号为i的序列正好就是长度为lowbit(i)且以i结尾的序列</p>
<p>且<span class="math inline">\(t[x]\)</span>节点的父节点为<span
class="math inline">\(t[x+lowbit(x)]\)</span></p>
<p>整棵树的深度为<span class="math inline">\(\log n +1\)</span></p>
<h3 id="add操作">add()操作</h3>
<p>对于add(x,k)操作，若要在整棵树上维护这个值，需要一层一层找到父节点，并按照需要来修改这个节点的值</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">add</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">,</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">k</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E">(;x</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;x</span><span style="color: #D73A49">+=</span><span style="color: #24292E">x</span><span style="color: #D73A49">&amp;-</span><span style="color: #24292E">x) t[x]</span><span style="color: #D73A49">+=</span><span style="color: #24292E">k;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>最坏复杂度：<span class="math inline">\(O(\log n)\)</span></p>
<h3 id="ask操作">ask()操作</h3>
<p>向坐上找一个节点，只需要将下标-=lowbit(这个节点的下标)</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ask</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> ans </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (; x; x</span><span style="color: #D73A49">-=</span><span style="color: #24292E">x</span><span style="color: #D73A49">&amp;-</span><span style="color: #24292E">x) ans</span><span style="color: #D73A49">+=</span><span style="color: #24292E">t[x];</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ans;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>最坏复杂度：<span class="math inline">\(O(\log n)\)</span></p>
<h2 id="应用">应用</h2>
<p>树状数组是一个动态维护前缀和的工具</p>
<h3 id="单点修改单点查询">单点修改，单点查询</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6F42C1">add</span><span style="color: #24292E">(x,k);</span></span>
<span class="line"><span style="color: #24292E">ans</span><span style="color: #D73A49">=</span><span style="color: #6F42C1">ask</span><span style="color: #24292E">(x)</span><span style="color: #D73A49">-</span><span style="color: #6F42C1">ask</span><span style="color: #24292E">(x</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span></code></pre></div></div></figure>
<h3 id="单点修改区间查询">单点修改，区间查询</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6F42C1">add</span><span style="color: #24292E">(x,k);</span></span>
<span class="line"><span style="color: #24292E">ans</span><span style="color: #D73A49">=</span><span style="color: #6F42C1">ask</span><span style="color: #24292E">(r)</span><span style="color: #D73A49">-</span><span style="color: #6F42C1">ask</span><span style="color: #24292E">(l</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span></code></pre></div></div></figure>
<h3 id="区间修改单点查询">区间修改，单点查询</h3>
<p>由差分可知，原数组第i项可以由差分数组第1项到第i项累加获得</p>
<p>则对于区间修改，只需要在对应l与r+1处进行val的修改即可完成对整个差分数组的修改</p>
<p>引入差分数组b，用树状数组维护b的前缀和，即a数组每个元素的增量</p>
<p>区间修改：<span class="math inline">\([l,r]+d\)</span>
<code>add(l,d); add(r+1,-d)</code></p>
<p>单点查询：<code>ans = a[x]+ask(x)</code></p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6F42C1">add</span><span style="color: #24292E">(l,d); </span><span style="color: #6F42C1">add</span><span style="color: #24292E">(r</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #D73A49">-</span><span style="color: #24292E">d);</span></span>
<span class="line"><span style="color: #24292E">ans</span><span style="color: #D73A49">=</span><span style="color: #24292E">a[x]</span><span style="color: #D73A49">+</span><span style="color: #6F42C1">ask</span><span style="color: #24292E">(x);</span></span></code></pre></div></div></figure>
<h3 id="区间修改区间查询">区间修改，区间查询</h3>
<p>将k项数按差分数组和拆开合并如下</p>

<p>故我们可以维护两棵树，转换为四条add</p>
<p>查询操作按找公式分别计算两棵树</p>
<p>设树状数组<span
class="math inline">\(t_1\)</span>维护b[i]前缀和，<span
class="math inline">\(t_2\)</span>维护i*b[i]前缀和</p>
<p>区间修改：</p>
<ul>
<li>对<span
class="math inline">\(t_1\)</span>，<code>add1(l,d), add1(r+1,-d)</code></li>
<li>对<span
class="math inline">\(t_2\)</span>，<code>add2(l,(l-1)*d), add2(r+1,-r*d)</code></li>
</ul>
<p>区间查询：<code>ans=(sum[r]+(r+1)*ask1(r)-ask2(r))-(sum[l-1]+l*ask1(l-1)-ask2(l-1))</code></p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> t1[maxn],t2[maxn];</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">add1</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">,</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">k</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E">(;x</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;x</span><span style="color: #D73A49">+=</span><span style="color: #24292E">x</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">x</span><span style="color: #D73A49">-</span><span style="color: #24292E">x) t1[x]</span><span style="color: #D73A49">+=</span><span style="color: #24292E">k;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ask1</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> ans </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (; x; x</span><span style="color: #D73A49">-=</span><span style="color: #24292E">x</span><span style="color: #D73A49">&amp;-</span><span style="color: #24292E">x) ans</span><span style="color: #D73A49">+=</span><span style="color: #24292E">t1[x];</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ans;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">add2</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">,</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">k</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E">(;x</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;x</span><span style="color: #D73A49">+=</span><span style="color: #24292E">x</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">x</span><span style="color: #D73A49">-</span><span style="color: #24292E">x) t2[x]</span><span style="color: #D73A49">+=</span><span style="color: #24292E">k;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ask2</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> ans </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (; x; x</span><span style="color: #D73A49">-=</span><span style="color: #24292E">x</span><span style="color: #D73A49">&amp;-</span><span style="color: #24292E">x) ans</span><span style="color: #D73A49">+=</span><span style="color: #24292E">t2[x];</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ans;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6F42C1">add1</span><span style="color: #24292E">(l,d); </span><span style="color: #6F42C1">add1</span><span style="color: #24292E">(r</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #D73A49">-</span><span style="color: #24292E">d); </span><span style="color: #6F42C1">add2</span><span style="color: #24292E">(l,(l</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">)</span><span style="color: #D73A49">*</span><span style="color: #24292E">d); </span><span style="color: #6F42C1">add2</span><span style="color: #24292E">(r</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">, </span><span style="color: #D73A49">-</span><span style="color: #24292E">r</span><span style="color: #D73A49">*</span><span style="color: #24292E">d);</span></span>
<span class="line"><span style="color: #24292E">ans</span><span style="color: #D73A49">=</span><span style="color: #24292E">(sum[r]</span><span style="color: #D73A49">+</span><span style="color: #24292E">(r</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">)</span><span style="color: #D73A49">*</span><span style="color: #6F42C1">ask1</span><span style="color: #24292E">(r)</span><span style="color: #D73A49">-</span><span style="color: #6F42C1">ask2</span><span style="color: #24292E">(r))</span><span style="color: #D73A49">-</span><span style="color: #24292E">(sum[l</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">]</span><span style="color: #D73A49">+</span><span style="color: #24292E">l</span><span style="color: #D73A49">*</span><span style="color: #6F42C1">ask1</span><span style="color: #24292E">(l</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">)</span><span style="color: #D73A49">-</span><span style="color: #6F42C1">ask2</span><span style="color: #24292E">(l</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">))</span></span></code></pre></div></div></figure>
<h2 id="应用逆序对">应用：逆序对</h2>
<h3
id="查询符合条件逆序对思路"><strong>查询符合条件逆序对思路</strong></h3>
<p>从右往左遍历，每次将搜到的数计入词频数组++，并查询该位置右侧有多少小于该位置数的数，可以通过对词频数组进行前缀和（求和到该位置-1）获得</p>
<p>由于一直在查询前缀和，可以将词频数组构建树状数组，查询能到到<span
class="math inline">\(O(\log n)\)</span></p>
<p>由于该题数据范围很大，若直接建立树状数组空间会炸，故需要离散化获得数据间的相对大小</p>
<h3 id="离散化">离散化</h3>
<p>该树状数组叫做值域树状数组：下标为值，对应值为词频，故下标要支持值域的数据范围</p>
<p>处理：将原数组复制并排序，从左到右遍历，且要将相同值去掉</p>
<p>回到原数组，用二分查找当前数在排序数组中的位置，用位置下标替换当前值</p>
<p>这样操作结束后，数与数之间的相对大小没有变化，故逆序对的数量也不会变化</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">endl</span><span style="color: #24292E"> &#39;\n&#39;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> ll;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">unsigned</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> ull;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">double</span><span style="color: #24292E"> ld;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> pair</span><span style="color: #D73A49">&lt;int</span><span style="color: #24292E">,</span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> PII;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">5</span><span style="color: #D73A49">e</span><span style="color: #005CC5">5</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">double</span><span style="color: #24292E"> pi </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">acos</span><span style="color: #24292E">(</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1.0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> mod </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #D73A49">e</span><span style="color: #005CC5">9</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">7</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> INF </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">0x</span><span style="color: #005CC5">3f3f3f3f</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">double</span><span style="color: #24292E"> eps </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #D73A49">e-</span><span style="color: #005CC5">6</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">ll arr[N];</span></span>
<span class="line"><span style="color: #24292E">ll sorted[N];</span></span>
<span class="line"><span style="color: #24292E">ll tree[N];</span></span>
<span class="line"><span style="color: #24292E">ll n;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">add</span><span style="color: #24292E">(</span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">,</span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #E36209">k</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (;x</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;x</span><span style="color: #D73A49">+=</span><span style="color: #24292E">x</span><span style="color: #D73A49">&amp;-</span><span style="color: #24292E">x)tree[x]</span><span style="color: #D73A49">+=</span><span style="color: #24292E">k;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ask</span><span style="color: #24292E">(</span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  ll ans </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (;x;x</span><span style="color: #D73A49">-=</span><span style="color: #24292E">x</span><span style="color: #D73A49">&amp;-</span><span style="color: #24292E">x) ans </span><span style="color: #D73A49">+=</span><span style="color: #24292E"> tree[x];</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ans;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">solve</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">  ll re </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> arr[i];</span></span>
<span class="line"><span style="color: #24292E">    sorted[i]</span><span style="color: #D73A49">=</span><span style="color: #24292E">arr[i];</span></span>
<span class="line"><span style="color: #24292E">  } </span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">sort</span><span style="color: #24292E">(sorted</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">,sorted</span><span style="color: #D73A49">+</span><span style="color: #24292E">n</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span><span style="color: #6A737D"> // 对用于离散化的数组排序</span></span>
<span class="line"><span style="color: #24292E">  ll m </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  // 对sorted数组去重，以得到实际参与离散化的范围1-m</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E">(sorted[m]</span><span style="color: #D73A49">!=</span><span style="color: #24292E">sorted[i]){</span></span>
<span class="line"><span style="color: #24292E">      sorted[</span><span style="color: #D73A49">++</span><span style="color: #24292E">m]</span><span style="color: #D73A49">=</span><span style="color: #24292E">sorted[i];</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 二分查找</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">auto</span><span style="color: #24292E"> b_sort </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [</span><span style="color: #D73A49">&amp;</span><span style="color: #24292E">](</span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    ll l </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">, r </span><span style="color: #D73A49">=</span><span style="color: #24292E"> m</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">, ans </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E">(l</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #D73A49">!=</span><span style="color: #24292E">r){</span></span>
<span class="line"><span style="color: #24292E">      ll mid </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (l</span><span style="color: #D73A49">+</span><span style="color: #24292E">r)</span><span style="color: #D73A49">/</span><span style="color: #005CC5">2</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (sorted[mid]</span><span style="color: #D73A49">&gt;=</span><span style="color: #24292E">x){</span></span>
<span class="line"><span style="color: #6A737D">        //ans = mid;</span></span>
<span class="line"><span style="color: #24292E">        r</span><span style="color: #D73A49">=</span><span style="color: #24292E">mid;</span></span>
<span class="line"><span style="color: #24292E">      } </span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">else</span><span style="color: #24292E"> l </span><span style="color: #D73A49">=</span><span style="color: #24292E"> mid;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> r;</span></span>
<span class="line"><span style="color: #24292E">  };</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    arr[i]</span><span style="color: #D73A49">=</span><span style="color: #6F42C1">b_sort</span><span style="color: #24292E">(arr[i]);</span><span style="color: #6A737D"> // 二分查找找到对应数在sorted的位置并将值替换为下标，进行离散化</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> n;i</span><span style="color: #D73A49">&gt;=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">--</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">add</span><span style="color: #24292E">(arr[i],</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span><span style="color: #6A737D"> // 词频+1</span></span>
<span class="line"><span style="color: #24292E">    re </span><span style="color: #D73A49">+=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ask</span><span style="color: #24292E">(arr[i]</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span><span style="color: #6A737D"> // 寻找小于当前数-1的词频前缀和</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">re </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">()</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">ios</span><span style="color: #24292E">::</span><span style="color: #6F42C1">sync_with_stdio</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">); cin.</span><span style="color: #6F42C1">tie</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">); cout.</span><span style="color: #6F42C1">tie</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> tomorin</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  //cin &gt;&gt; tomorin;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E"> (tomorin</span><span style="color: #D73A49">--</span><span style="color: #24292E">) </span><span style="color: #6F42C1">solve</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>算法与数据结构</category>
      </categories>
      <tags>
        <tag>数据结构</tag>
      </tags>
  </entry>
  <entry>
    <title>【算法】滑动窗口</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3/</url>
    <content><![CDATA[<h1 id="滑动窗口">滑动窗口</h1>
<h2 id="定义">定义</h2>
<p>在一个数组中框定一段子数组作为窗口</p>
<p>若想让该窗口元素增加，可以考虑让右边界r++，即窗口从右边吸收数字</p>
<p>若想让该窗口元素减少，可以考虑让左边界l++，即窗口从左边弹出数字</p>
<p>一般解决子数组相关问题</p>
<h2 id="例1模板">例1/模板</h2>
<blockquote>
<p>给定一个含有<span
class="math inline">\(n\)</span>个正整数的数组和一个正整数target</p>
<p>找到累加和<span
class="math inline">\(\geq\)</span>target的长度最小的子数组并返回长度，如果不存在符合条件的则返回0</p>
</blockquote>
<p>我们可以先固定子数组的左端点，让右端点右移，直到数组和大于target，由于数组所有数都为正整数，因此找到第一个累加和大于target后，后面再加一定也大于target</p>
<p>此时循环判断累加和是否<span
class="math inline">\(\geq\)</span>target，若成立则剔出左侧数字，记录子数组长度</p>
<p>然后以该子数组为起点，右端点右移，重复上述操作，寻找等于target的子数组，记录数组长度</p>
<p>时间复杂度：<span class="math inline">\(O(n)\)</span></p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ios</span><span style="color: #24292E"> ios::sync_with_stdio(0); cin.tie(0); cout.tie(0);</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">endl</span><span style="color: #24292E"> &#39;\n&#39;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> ll;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">unsigned</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> ull;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">double</span><span style="color: #24292E"> ld;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> pair</span><span style="color: #D73A49">&lt;int</span><span style="color: #24292E">,</span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> PII;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #D73A49">e</span><span style="color: #005CC5">5</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">double</span><span style="color: #24292E"> pi </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">acos</span><span style="color: #24292E">(</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1.0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> mod </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #D73A49">e</span><span style="color: #005CC5">9</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">7</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> INF </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">0x</span><span style="color: #005CC5">3f3f3f3f</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">double</span><span style="color: #24292E"> eps </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #D73A49">e-</span><span style="color: #005CC5">6</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> n,tar;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> a[N];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">()</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  ios</span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> tar;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> a[i];</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> ans </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">0x</span><span style="color: #005CC5">3f3f3f3f</span><span style="color: #24292E">, sum </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">, l </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 定义记录结果长度，数组元素之和，左端点</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> r </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;r</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;r</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span><span style="color: #6A737D"> // 先让右端点右移</span></span>
<span class="line"><span style="color: #24292E">    sum</span><span style="color: #D73A49">+=</span><span style="color: #24292E">a[r];</span><span style="color: #6A737D"> // 累加求和</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E">(sum</span><span style="color: #D73A49">&gt;=</span><span style="color: #24292E">tar){</span><span style="color: #6A737D"> // 当求和大于等于目标开始移动左端点以寻找更小区间</span></span>
<span class="line"><span style="color: #24292E">      ans </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">min</span><span style="color: #24292E">(ans,r</span><span style="color: #D73A49">-</span><span style="color: #24292E">l</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span><span style="color: #6A737D"> // 更新最小区间</span></span>
<span class="line"><span style="color: #24292E">      sum</span><span style="color: #D73A49">-=</span><span style="color: #24292E">a[l</span><span style="color: #D73A49">++</span><span style="color: #24292E">];</span><span style="color: #6A737D"> // 减去滑出窗口的数同时让左端点右移</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 找到符合目标的区间</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (ans</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n) cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> ans;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">else</span><span style="color: #24292E"> cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E"> ;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="例2">例2</h2>
<blockquote>
<p>给定一个字符串<span
class="math inline">\(s\)</span>，找出不含有重复字符的最长字串长度</p>
</blockquote>
<p>即寻找最长无重复字符的窗口</p>
<p>让右边界一直右移，直到遇到重复字符，让左边界移动到<code>max(左边界，重复字符上次位置+1)</code></p>
<p>因为任何时候窗口情况一定是没有重复数组在内的，若重复字符上次位置比此时左边界小，则若还是移动到重复字符上次位置+1的话，窗口会变长，不保证加长部分会不会又出现重复字符</p>
<p>若右移后无重复字符，可以看作重复字符位置为-1或不存在，用max仍保持原左边界</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ios</span><span style="color: #24292E"> ios::sync_with_stdio(0); cin.tie(0); cout.tie(0);</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">endl</span><span style="color: #24292E"> &#39;\n&#39;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> ll;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">unsigned</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> ull;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">double</span><span style="color: #24292E"> ld;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> pair</span><span style="color: #D73A49">&lt;int</span><span style="color: #24292E">,</span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> PII;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #D73A49">e</span><span style="color: #005CC5">5</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">double</span><span style="color: #24292E"> pi </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">acos</span><span style="color: #24292E">(</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1.0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> mod </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #D73A49">e</span><span style="color: #005CC5">9</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">7</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> INF </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">0x</span><span style="color: #005CC5">3f3f3f3f</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">double</span><span style="color: #24292E"> eps </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #D73A49">e-</span><span style="color: #005CC5">6</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">string s;</span></span>
<span class="line"><span style="color: #24292E">unordered_map</span><span style="color: #D73A49">&lt;char</span><span style="color: #24292E">,</span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> cnt;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">()</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  ios</span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> s;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">s.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) cnt[s[i]]</span><span style="color: #D73A49">=-</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 初始化都为第一次出现</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> ans </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 记录最长区间</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> l </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">, r </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;r</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">s.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();r</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    l </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">max</span><span style="color: #24292E">(l,cnt[s[r]]</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span><span style="color: #6A737D"> // 左边界移动</span></span>
<span class="line"><span style="color: #24292E">    ans </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">max</span><span style="color: #24292E">(ans,r</span><span style="color: #D73A49">-</span><span style="color: #24292E">l</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span><span style="color: #6A737D"> // 记录结果</span></span>
<span class="line"><span style="color: #24292E">    cnt[s[r]]</span><span style="color: #D73A49">=</span><span style="color: #24292E">r;</span><span style="color: #6A737D"> // 更新上次出现字符位置为当前r位置</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> ans;</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="例3">例3</h2>
<blockquote>
<p>给你一个字符串 <code>s</code> 、一个字符串 <code>t</code> 。返回
<code>s</code> 中涵盖 <code>t</code> 所有字符的最小子串。如果
<code>s</code> 中不存在涵盖 <code>t</code>
所有字符的子串，则返回空字符串 <code>""</code> 。</p>
</blockquote>
<p>我们可以逆向以一种”debt”思维解决。遍历要查找的字符，发现一个-1，这样需要查找的字符数都为负数，在查找时，每个字符出现后对应加一，则非
要查找字符将始终为正数，而要查找的字符为负数</p>
<p>先让右边界右移，当debt变为0（窗口包含了足够要查找的字串），开始移动左边界，使字串最小，这时debt大于0的都为不需要查找的字符，故可以左移，直到碰到需要查找的不再移动。</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ios</span><span style="color: #24292E"> ios::sync_with_stdio(0); cin.tie(0); cout.tie(0);</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">endl</span><span style="color: #24292E"> &#39;\n&#39;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> ll;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">unsigned</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> ull;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">double</span><span style="color: #24292E"> ld;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> pair</span><span style="color: #D73A49">&lt;int</span><span style="color: #24292E">,</span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> PII;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #D73A49">e</span><span style="color: #005CC5">5</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">double</span><span style="color: #24292E"> pi </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">acos</span><span style="color: #24292E">(</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1.0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> mod </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #D73A49">e</span><span style="color: #005CC5">9</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">7</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> INF </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">0x</span><span style="color: #005CC5">3f3f3f3f</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">double</span><span style="color: #24292E"> eps </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #D73A49">e-</span><span style="color: #005CC5">6</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">string s,t;</span></span>
<span class="line"><span style="color: #24292E">unordered_map</span><span style="color: #D73A49">&lt;char</span><span style="color: #24292E">,</span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> cnt;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">()</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  ios</span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> s </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> t;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (s.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">()</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">t.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">()){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">t.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) cnt[t[i]]</span><span style="color: #D73A49">--</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> len </span><span style="color: #D73A49">=</span><span style="color: #24292E"> INF, start </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // len用于记录最小字串，start记录字串开头，便于输出</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> debt </span><span style="color: #D73A49">=</span><span style="color: #24292E"> t.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> l </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">, r </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;r</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">s.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();r</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (cnt[s[r]]</span><span style="color: #D73A49">++&lt;</span><span style="color: #005CC5">0</span><span style="color: #24292E">) debt</span><span style="color: #D73A49">--</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 字符计数加一后仍是负的，证明是要查找的(debt的)字符，让debt--</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E">(debt</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">){</span><span style="color: #6A737D"> // 所有字符都查到后</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">while</span><span style="color: #24292E">(cnt[s[l]]</span><span style="color: #D73A49">&gt;</span><span style="color: #005CC5">0</span><span style="color: #24292E">){</span><span style="color: #6A737D"> // 寻找最小子区间</span></span>
<span class="line"><span style="color: #24292E">        cnt[s[l</span><span style="color: #D73A49">++</span><span style="color: #24292E">]]</span><span style="color: #D73A49">--</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 若是非查找字符，可以让左边界右移拿回</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (r</span><span style="color: #D73A49">-</span><span style="color: #24292E">l</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">len){</span><span style="color: #6A737D"> // 记录最小子区间以及开始位置</span></span>
<span class="line"><span style="color: #24292E">        len </span><span style="color: #D73A49">=</span><span style="color: #24292E"> r</span><span style="color: #D73A49">-</span><span style="color: #24292E">l</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        start </span><span style="color: #D73A49">=</span><span style="color: #24292E"> l;</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 若查不到则输出空字符串，否则截取字符串输出</span></span>
<span class="line"><span style="color: #24292E">  len </span><span style="color: #D73A49">==</span><span style="color: #24292E"> INF </span><span style="color: #D73A49">?</span><span style="color: #24292E"> cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&quot;&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">:</span><span style="color: #24292E"> cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> s.</span><span style="color: #6F42C1">substr</span><span style="color: #24292E">(start,start</span><span style="color: #D73A49">+</span><span style="color: #24292E">len);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="总结">总结</h2>
<p>关键：找到<strong>范围</strong>和<strong>答案指标</strong>之间的<strong>单调性关系</strong></p>
<p>求解大流程：求子数组在<strong>每个位置开头或结尾</strong>情况下的答案</p>
]]></content>
      <categories>
        <category>算法与数据结构</category>
      </categories>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>【算法】矩阵快速幂</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E7%9F%A9%E9%98%B5%E5%BF%AB%E9%80%9F%E5%B9%82/</url>
    <content><![CDATA[<h1 id="矩阵快速幂">矩阵快速幂</h1>
<h2 id="解决的问题">解决的问题</h2>
<ul>
<li><p>固定关系的一维k阶递推表达式</p></li>
<li><p>固定关系的k维一阶递推表达式</p></li>
</ul>
<p>时间复杂度<span class="math inline">\(O(\log n\times
k^3)\)</span></p>
<h2 id="矩阵乘法">矩阵乘法</h2>
<p>前提：对于二维矩阵，两个行列式相乘需要满足一个行列式的列数=另一个行列式的行数</p>
<p>算法： <span class="math display">\[
\begin{vmatrix}  a&amp;b \\  c&amp;d\end{vmatrix}\times
\begin{vmatrix}  e&amp;f
\\  g&amp;h\end{vmatrix}=\begin{vmatrix}  ae+bg&amp;af+bh
\\  ce+dg&amp;cg+dh\end{vmatrix}
\]</span> Code：</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt;&gt; </span><span style="color: #6F42C1">martix_mul</span><span style="color: #24292E">(</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt;&gt; </span><span style="color: #E36209">a</span><span style="color: #24292E">,</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt;&gt; </span><span style="color: #E36209">b</span><span style="color: #24292E"> ){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> n </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> m </span><span style="color: #D73A49">=</span><span style="color: #24292E"> b[</span><span style="color: #005CC5">0</span><span style="color: #24292E">].</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> k </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a[</span><span style="color: #005CC5">0</span><span style="color: #24292E">].</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  vector</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">vector</span><span style="color: #D73A49">&lt;int&gt;&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ans</span><span style="color: #24292E">(n, </span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt;(m));</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;j</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">m;j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> c </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;c</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">k;c</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        ans[i][j] </span><span style="color: #D73A49">+=</span><span style="color: #24292E">a[i][c]</span><span style="color: #D73A49">*</span><span style="color: #24292E">b[c][j];</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ans;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="矩阵快速幂-1">矩阵快速幂</h2>
<p>前提：需要是正方形矩阵</p>
<p>单位矩阵：类似乘法中的1，即主对角线上为1，其余位置为0的矩阵，与矩阵相乘不会改变原矩阵</p>
<p>Code：</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt;&gt; </span><span style="color: #6F42C1">mqpow</span><span style="color: #24292E">(</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt;&gt; </span><span style="color: #E36209">m</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> n </span><span style="color: #D73A49">=</span><span style="color: #24292E"> m.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  vector</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">vector</span><span style="color: #D73A49">&lt;int&gt;&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ans</span><span style="color: #24292E">(n, </span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">int</span><span style="color: #24292E">&gt;(n));</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    ans[i][i]</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">(p){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E">(p</span><span style="color: #D73A49">&amp;</span><span style="color: #005CC5">1</span><span style="color: #24292E">)ans </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">martix_mul</span><span style="color: #24292E">(ans, m);</span></span>
<span class="line"><span style="color: #24292E">    m </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">martix_mul</span><span style="color: #24292E">(m,m);</span></span>
<span class="line"><span style="color: #24292E">    p</span><span style="color: #D73A49">&gt;&gt;=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ans;</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="例求斐波那契数列">例：求斐波那契数列</h2>
<p>将斐波那契转换为矩阵形式：</p>
<p>设第0，1项分别为0，1，对应的矩阵[1, 0]</p>
<p>我们将该矩阵乘一个关系矩阵<span
class="math inline">\(\begin{vmatrix}  1&amp;1
\\  1&amp;0\end{vmatrix}\)</span>，得到的结果即为斐波那契数列的第2,1项[1,1]</p>
<p>以此类推，求斐波那契数列的第<span
class="math inline">\(n\)</span>项的通项公式为 <span
class="math display">\[
\begin{vmatrix}  1&amp;0\end{vmatrix}\times \begin{vmatrix}  1&amp;1
\\  1&amp;0\end{vmatrix}^{n-1}
\]</span>
其中，关系矩阵的第0列直接由递推表达式系数决定，剩下几项可以用前面的初始项带入求出</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"></span>
<span class="line"><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">ll</span><span style="color: #24292E">&gt;&gt; </span><span style="color: #6F42C1">mul</span><span style="color: #24292E">(</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">ll</span><span style="color: #24292E">&gt;&gt; </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">ll</span><span style="color: #24292E">&gt;&gt; </span><span style="color: #E36209">b</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #E36209">mod</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> n </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> m </span><span style="color: #D73A49">=</span><span style="color: #24292E"> b[</span><span style="color: #005CC5">0</span><span style="color: #24292E">].</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> k </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a[</span><span style="color: #005CC5">0</span><span style="color: #24292E">].</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  vector</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">vector</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">ll</span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ans</span><span style="color: #24292E">(n,</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">ll</span><span style="color: #24292E">&gt;(m));</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; j</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">m;j</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> c </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;c</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">k;c</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        ans[i][j]</span><span style="color: #D73A49">=</span><span style="color: #24292E"> (ans[i][j]</span><span style="color: #D73A49">+</span><span style="color: #24292E">a[i][c]</span><span style="color: #D73A49">*</span><span style="color: #24292E">b[c][j])</span><span style="color: #D73A49">%</span><span style="color: #24292E">mod;</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ans;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">ll</span><span style="color: #24292E">&gt;&gt; </span><span style="color: #6F42C1">mqpow</span><span style="color: #24292E">(</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">ll</span><span style="color: #24292E">&gt;&gt; </span><span style="color: #E36209">m</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #E36209">p</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #E36209">mod</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  ll n </span><span style="color: #D73A49">=</span><span style="color: #24292E"> m.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  vector</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">vector</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">ll</span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ans</span><span style="color: #24292E">(n,</span><span style="color: #6F42C1">vector</span><span style="color: #24292E">&lt;</span><span style="color: #6F42C1">ll</span><span style="color: #24292E">&gt;(n));</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    ans[i][i]</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">(p){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E">(p</span><span style="color: #D73A49">&amp;</span><span style="color: #005CC5">1</span><span style="color: #24292E">) ans </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">mul</span><span style="color: #24292E">(ans, m, mod);</span></span>
<span class="line"><span style="color: #24292E">    m </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">mul</span><span style="color: #24292E">(m,m,mod);</span></span>
<span class="line"><span style="color: #24292E">    p</span><span style="color: #D73A49">&gt;&gt;=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ans;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">solve</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">  ll n;</span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E">(n</span><span style="color: #D73A49">==</span><span style="color: #005CC5">1</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E"> ;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  vector</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">vector</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">ll</span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> unit </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {{</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">1</span><span style="color: #24292E">},{</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">0</span><span style="color: #24292E">}};</span></span>
<span class="line"><span style="color: #24292E">  vector</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">vector</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">ll</span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> start </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {{</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">0</span><span style="color: #24292E">}};</span></span>
<span class="line"><span style="color: #24292E">  vector</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">vector</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">ll</span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> ans </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">mul</span><span style="color: #24292E">(start, </span><span style="color: #6F42C1">mqpow</span><span style="color: #24292E">(unit,n</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">, mod), mod);</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> ans[</span><span style="color: #005CC5">0</span><span style="color: #24292E">][</span><span style="color: #005CC5">0</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>算法与数据结构</category>
      </categories>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>【数据结构】栈</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%A0%88/</url>
    <content><![CDATA[<h1 id="栈">栈</h1>
<h2 id="特点">特点</h2>
<ul>
<li>仅可在表尾操作</li>
<li>表尾称为栈顶(top)，表头称为栈底</li>
<li>不含元素的空表为空栈</li>
<li>栈遵循<strong>后进先出（LIFO）</strong>的原则</li>
<li>基本操作包括push，pop</li>
</ul>
<h2 id="顺序表实现">顺序表实现</h2>
<h3 id="初始化">初始化</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">struct</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  ElemType data[MAXSIZE];</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> top;</span></span>
<span class="line"><span style="color: #24292E">}</span><span style="color: #6F42C1">Stack</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 栈的初始化</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">initStack</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Stack</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  s-&gt;top </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 表示空栈</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="判断空栈">判断空栈</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">isEmpty</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Stack</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (s-&gt;top</span><span style="color: #D73A49">==-</span><span style="color: #005CC5">1</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Empty&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="压栈">压栈</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 压栈</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">push</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Stack</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">s</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ElemType</span><span style="color: #24292E"> </span><span style="color: #E36209">e</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (s-&gt;top</span><span style="color: #D73A49">&gt;=</span><span style="color: #24292E">MAXSIZE</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Full&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  s-&gt;top</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 栈顶上移一位</span></span>
<span class="line"><span style="color: #24292E">  s-&gt;data[s-&gt;top]</span><span style="color: #D73A49">=</span><span style="color: #24292E"> e;</span><span style="color: #6A737D"> // 压入数据</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="出栈">出栈</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 出栈</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">pop</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Stack</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">s</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ElemType</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">e</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (s-&gt;top</span><span style="color: #D73A49">==-</span><span style="color: #005CC5">1</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Empty&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">*</span><span style="color: #24292E">e </span><span style="color: #D73A49">=</span><span style="color: #24292E"> s-&gt;data[s-&gt;top];</span><span style="color: #6A737D"> // 弹出栈顶元素</span></span>
<span class="line"><span style="color: #24292E">  s-&gt;top</span><span style="color: #D73A49">--</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 栈顶下移一位</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="获取栈顶元素">获取栈顶元素</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 获取栈顶元素</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">getTop</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Stack</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">s</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ElemType</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">e</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (s-&gt;top</span><span style="color: #D73A49">==-</span><span style="color: #005CC5">1</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Empty&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">*</span><span style="color: #24292E">e </span><span style="color: #D73A49">=</span><span style="color: #24292E"> s-&gt;data[s-&gt;top];</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="动态分配内存">动态分配内存</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">struct</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  ElemType </span><span style="color: #D73A49">*</span><span style="color: #24292E">data;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> top;</span></span>
<span class="line"><span style="color: #24292E">}</span><span style="color: #6F42C1">Stack</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 栈的初始化</span></span>
<span class="line"><span style="color: #6F42C1">Stack</span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">initStack</span><span style="color: #24292E">(){;</span></span>
<span class="line"><span style="color: #24292E">  Stack </span><span style="color: #D73A49">*</span><span style="color: #24292E">s </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (Stack</span><span style="color: #D73A49">*</span><span style="color: #24292E">)</span><span style="color: #6F42C1">malloc</span><span style="color: #24292E">(</span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(Stack));</span></span>
<span class="line"><span style="color: #24292E">  s-&gt;data </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (ElemType</span><span style="color: #D73A49">*</span><span style="color: #24292E">)</span><span style="color: #6F42C1">malloc</span><span style="color: #24292E">(</span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(ElemType)</span><span style="color: #D73A49">*</span><span style="color: #24292E">MAXSIZE);</span></span>
<span class="line"><span style="color: #24292E">  s-&gt;top </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 表示空栈</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> s;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="链表实现">链表实现</h2>
<p>使用单向链表来实现栈</p>
<p>尾节点为栈底，首节点为栈顶</p>
<ul>
<li>压栈：链表头插法</li>
<li>出栈：删除头节点后的首节点</li>
<li>判空：只有头节点（head-&gt;next == NULL）</li>
<li>获取栈顶数据：找头节点的next的data（head-&gt;next-&gt;data）</li>
</ul>
<h3 id="初始化-1">初始化</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> ElemType;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">stack</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  ElemType data;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">stack</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E">next;</span></span>
<span class="line"><span style="color: #24292E">}</span><span style="color: #6F42C1">Stack</span><span style="color: #24292E">;</span></span></code></pre></div></div></figure>
<h3 id="判空">判空</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 判空</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">isEmpty</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Stack</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (s-&gt;next </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">NULL</span><span style="color: #24292E">){</span><span style="color: #6A737D"> // 头节点的next指向NULL</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Empty&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="压栈-1">压栈</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 压栈</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">push</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Stack</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">s</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ElemType</span><span style="color: #24292E"> </span><span style="color: #E36209">e</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  Stack</span><span style="color: #D73A49">*</span><span style="color: #24292E"> p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (Stack</span><span style="color: #D73A49">*</span><span style="color: #24292E">)</span><span style="color: #6F42C1">malloc</span><span style="color: #24292E">(</span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(Stack));</span></span>
<span class="line"><span style="color: #24292E">  p-&gt;data </span><span style="color: #D73A49">=</span><span style="color: #24292E"> e;</span></span>
<span class="line"><span style="color: #24292E">  p-&gt;next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> s-&gt;next;</span></span>
<span class="line"><span style="color: #24292E">  s-&gt;next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="出栈-1">出栈</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 出栈</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">pop</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Stack</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">s</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ElemType</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">e</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (s-&gt;next</span><span style="color: #D73A49">==</span><span style="color: #005CC5">NULL</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Empty&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  Stack </span><span style="color: #D73A49">*</span><span style="color: #24292E">q </span><span style="color: #D73A49">=</span><span style="color: #24292E"> s-&gt;next;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">*</span><span style="color: #24292E">e </span><span style="color: #D73A49">=</span><span style="color: #24292E"> q-&gt;data;</span></span>
<span class="line"><span style="color: #24292E">  s-&gt;next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> q-&gt;next;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">free</span><span style="color: #24292E">(q);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="获取栈顶元素-1">获取栈顶元素</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 获取栈顶元素</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">getTop</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Stack</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">s</span><span style="color: #24292E">,</span><span style="color: #6F42C1">ElemType</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">e</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (s-&gt;next </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">NULL</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Empty&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">*</span><span style="color: #24292E">e </span><span style="color: #D73A49">=</span><span style="color: #24292E"> s-&gt;next-&gt;data;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="单调栈">单调栈</h2>
<p>单调栈常用于寻找元素：</p>
<ul>
<li>寻找元素的下一个更大/更小元素</li>
<li>寻找元素左侧第一个更大/更小元素</li>
</ul>
<p>进一步，单调栈可以应用于优化DP等问题</p>
<h3 id="无重复值">无重复值</h3>
<blockquote>
<p>对给定数组(如[2, 5, 6, 7, 3, 4, 1,
8])，寻找每个位置的左边与右边离自己最近比自己小的位置在哪</p>
</blockquote>
<p>暴力遍历会有<span
class="math inline">\(O(N^2)\)</span>的时间复杂度，我们可以用栈来优化</p>
<p>创建一个空栈（存下标），该栈要求大压小：</p>
<p>没东西直接放入对应下标</p>
<p>若满足大压小则放入，当不满足时弹出栈顶</p>
<p>此时<strong>弹出后的栈顶</strong>就是弹出元素左边最近且比它小的数</p>
<p><strong>使得该元素弹出的元素</strong>就是弹出元素右边最近且比它小的数</p>
<p>如依次放入2, 5, 6, 7，当压入3时，发现元素小于栈顶元素，故无法压入</p>
<p>此时弹出栈顶元素7，则7左边最近且比它小的数为6，右边最近且比它小的数3</p>
<p>继续压入3，发现元素小于栈顶元素，无法压入</p>
<p>此时弹出栈顶元素6，则6左边最近且比它小的数为5，右边最近且比它小的数为3</p>
<p>……</p>
<p>直到可以压入时再压入，继续往后压入元素下标</p>
<p>遍历结束，开始清算栈中剩下的数字</p>
<p>若此时<strong>没有数字让当前位置弹出</strong>，则右边最近且比它小的数不存在</p>
<p>若此时<strong>底下已经没有元素压着了</strong>，则左边最近且比它小的数不存在</p>
<p><strong>同理，使用小压大的单调栈可以寻找离自己最近比自己大的位置</strong></p>
<h3 id="有重复值">有重复值</h3>
<blockquote>
<p>对给定数组(如[2, 3, 4, 3, 2, 1, 3, 5, 6, 3, 4, 3,
2])，寻找每个位置的左边与右边离自己最近比自己小的位置在哪</p>
</blockquote>
<p>创建一个大压小的空栈</p>
<p>整体逻辑与无重复值相同，但当压入下一个数时发现与当前数相同时</p>
<p>不压入该数，而是弹出当前值，作为当前数右侧离自己最近比自己小的值（此时是错误的）</p>
<p>当遍历阶段与清算阶段结束后，各个元素关系如下，其中框住的是错误的位置</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%A0%88/image-20250401215723368.png" class="" title="重复值单调栈-1">
<p>左侧无需修正，右侧<strong>倒序</strong>遍历每个位置的右侧元素，若发现与遍历元素相等，则将右侧元素对应的右侧离它最近比它小的元素作为当前遍历元素的右侧元素</p>
<p>如发现9位置为3，而其右侧元素为11位置的3，则我们看11位置的3的右侧元素，是12位置的2，那我们将9位置右侧元素改为12位置的2</p>
<p>我们可以发现，需要此种操作时，两数之间总会有大于两数的数</p>
<h3 id="模板">模板</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;iostream&gt;</span></span>
<span class="line"><span style="color: #6A737D">//#include &lt;stack&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">3</span><span style="color: #D73A49">e</span><span style="color: #005CC5">6</span><span style="color: #D73A49">+</span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">//stack&lt;int&gt; st;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> arr[N];</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> stack[N];</span><span style="color: #6A737D"> // 数组实现栈, 内部存的是下标</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> ans[N][</span><span style="color: #005CC5">2</span><span style="color: #24292E">];</span><span style="color: #6A737D"> // 二维的0位置为左侧答案，1位置为右侧答案</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> n, r;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> arr[i];</span></span>
<span class="line"><span style="color: #24292E">  r </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> cur;</span></span>
<span class="line"><span style="color: #6A737D">  // 遍历阶段</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E">(r</span><span style="color: #D73A49">&gt;</span><span style="color: #005CC5">0</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E"> arr[stack[r</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">]]</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">arr[i]){</span><span style="color: #6A737D"> // 小于等于时看大于当前位置，大于等于反之</span></span>
<span class="line"><span style="color: #24292E">      cur </span><span style="color: #D73A49">=</span><span style="color: #24292E"> stack[</span><span style="color: #D73A49">--</span><span style="color: #24292E">r];</span><span style="color: #6A737D"> // 当前弹出位置</span></span>
<span class="line"><span style="color: #24292E">      ans[cur][</span><span style="color: #005CC5">0</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> r</span><span style="color: #D73A49">&gt;</span><span style="color: #005CC5">0</span><span style="color: #24292E"> </span><span style="color: #D73A49">?</span><span style="color: #24292E"> stack[r</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">]</span><span style="color: #D73A49">:-</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 左侧最近答案</span></span>
<span class="line"><span style="color: #24292E">      ans[cur][</span><span style="color: #005CC5">1</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> i;</span><span style="color: #6A737D"> // 右侧最近答案</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    stack[r</span><span style="color: #D73A49">++</span><span style="color: #24292E">]</span><span style="color: #D73A49">=</span><span style="color: #24292E">i;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 清算阶段</span></span>
<span class="line"><span style="color: #24292E">   </span><span style="color: #D73A49">while</span><span style="color: #24292E"> (r</span><span style="color: #D73A49">&gt;</span><span style="color: #005CC5">0</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    cur </span><span style="color: #D73A49">=</span><span style="color: #24292E"> stack[</span><span style="color: #D73A49">--</span><span style="color: #24292E">r];</span></span>
<span class="line"><span style="color: #24292E">    ans[cur][</span><span style="color: #005CC5">0</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> r</span><span style="color: #D73A49">&gt;</span><span style="color: #005CC5">0</span><span style="color: #D73A49">?</span><span style="color: #24292E"> stack[r</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">]</span><span style="color: #D73A49">:-</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    ans[cur][</span><span style="color: #005CC5">1</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">   }</span></span>
<span class="line"><span style="color: #6A737D">   // 修正阶段</span></span>
<span class="line"><span style="color: #6A737D">   // 只需要修正右侧答案，从右往左修正，n-1右侧的一定是-1，不需要修正</span></span>
<span class="line"><span style="color: #24292E">   </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> n</span><span style="color: #D73A49">-</span><span style="color: #005CC5">2</span><span style="color: #24292E">; i</span><span style="color: #D73A49">&gt;=</span><span style="color: #005CC5">0</span><span style="color: #24292E">; i</span><span style="color: #D73A49">--</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E">(ans[i][</span><span style="color: #005CC5">1</span><span style="color: #24292E">]</span><span style="color: #D73A49">!=-</span><span style="color: #005CC5">1</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E"> arr[ans[i][</span><span style="color: #005CC5">1</span><span style="color: #24292E">]]</span><span style="color: #D73A49">==</span><span style="color: #24292E">arr[i]){</span></span>
<span class="line"><span style="color: #24292E">      ans[i][</span><span style="color: #005CC5">1</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> ans[ans[i][</span><span style="color: #005CC5">1</span><span style="color: #24292E">]][</span><span style="color: #005CC5">1</span><span style="color: #24292E">];</span><span style="color: #6A737D"> // 现在右侧答案的右侧的答案作为现在右侧的答案</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">   }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">   </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">     cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">ans[i][</span><span style="color: #005CC5">0</span><span style="color: #24292E">]</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #032F62">&#39; &#39;</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">ans[i][</span><span style="color: #005CC5">1</span><span style="color: #24292E">]</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">   }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>根据具体题目，若只让求右侧等条件，相等时也可以进栈</p>
]]></content>
      <categories>
        <category>算法与数据结构</category>
      </categories>
      <tags>
        <tag>数据结构</tag>
        <tag>表</tag>
      </tags>
  </entry>
  <entry>
    <title>【图论】最近公共祖先(LCA)</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%9C%80%E8%BF%91%E5%85%AC%E5%85%B1%E7%A5%96%E5%85%88(LCA)/</url>
    <content><![CDATA[<h1 id="最近公共祖先lca">最近公共祖先(LCA)</h1>
<h2 id="概念">概念</h2>
<ul>
<li><p>祖先：从某个节点上溯到根节点的所有节点都是该节点的祖先，如图中节点5的祖先为节点3
1 0</p></li>
<li><p>公共祖先：两个节点共有的祖先，如图中节点2和节点5的公共祖先为1
0</p></li>
<li><p>最近公共祖先：所有公共祖先中深度最深的祖先，若待求的一个节点本身是另一个节点的祖先，则该节点即为所求最近公共祖先</p>
<figure>
<img src="最近公共祖先(LCA)/image-20250506113430524.png" alt="LCA" />
<figcaption aria-hidden="true">LCA</figcaption>
</figure></li>
</ul>
<h2 id="朴素算法">朴素算法</h2>
<p>思路：将两节点跳至同一深度，让两节点同时上跳至同一节点</p>
<p>方法：DFS</p>
<h2 id="倍增lca">倍增LCA</h2>
<p>使用倍增思想，以及st表来寻找祖先。</p>
<p>由倍增思想，我们可以得到某节点<span
class="math inline">\(2^i\)</span>级祖先是<span
class="math inline">\(2^{i-1}\)</span>级祖先的<span
class="math inline">\(2^{i-1}\)</span>级祖先</p>
<p>故我们只需要每次寻找两节点尽可能相遇的位置，则它们的父节点一定相遇，此时父节点便为LCA</p>
<p>具体来说，同时往上走的时候要<strong>保证各自到达的节点不同</strong>，走到最后在往上走一步即可</p>
<p>时间复杂度<span class="math inline">\(O(\log n)\)</span></p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">endl</span><span style="color: #24292E"> &#39;\n&#39;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> ll;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> pair</span><span style="color: #D73A49">&lt;int</span><span style="color: #24292E">,</span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> PII;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">5</span><span style="color: #D73A49">e</span><span style="color: #005CC5">5</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> mod </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #D73A49">e</span><span style="color: #005CC5">9</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">7</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> n, m, s;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> st[N][</span><span style="color: #005CC5">20</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> head[N],depth[N];</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> power, cnt;</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">node2</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> u, f ,e;</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">node</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> to, nxt;</span></span>
<span class="line"><span style="color: #24292E">}edge[</span><span style="color: #005CC5">2</span><span style="color: #D73A49">*</span><span style="color: #24292E">N];</span><span style="color: #6A737D"> // 无向图 开两倍</span></span>
<span class="line"><span style="color: #6A737D">// 链式前向星建图</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">add_edge</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">from</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">to</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  edge[</span><span style="color: #D73A49">++</span><span style="color: #24292E">cnt].to </span><span style="color: #D73A49">=</span><span style="color: #24292E"> to;</span></span>
<span class="line"><span style="color: #24292E">  edge[cnt].nxt </span><span style="color: #D73A49">=</span><span style="color: #24292E"> head[from];</span></span>
<span class="line"><span style="color: #24292E">  head[from]</span><span style="color: #D73A49">=</span><span style="color: #24292E">cnt;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6A737D">// 非递归版本 防止爆栈</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">dfs_stack</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">i</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">fat</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  stack</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">node2</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> stk;</span></span>
<span class="line"><span style="color: #24292E">  stk.</span><span style="color: #6F42C1">push</span><span style="color: #24292E">({i,</span><span style="color: #005CC5">0</span><span style="color: #24292E">,</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">});</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">(</span><span style="color: #D73A49">!</span><span style="color: #24292E">stk.</span><span style="color: #6F42C1">empty</span><span style="color: #24292E">()){</span></span>
<span class="line"><span style="color: #24292E">    node2 cur </span><span style="color: #D73A49">=</span><span style="color: #24292E"> stk.</span><span style="color: #6F42C1">top</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    stk.</span><span style="color: #6F42C1">pop</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (cur.e</span><span style="color: #D73A49">==-</span><span style="color: #005CC5">1</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      depth[cur.u] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> depth[cur.f]</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">      st[cur.u][</span><span style="color: #005CC5">0</span><span style="color: #24292E">]</span><span style="color: #D73A49">=</span><span style="color: #24292E">cur.f;</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> s</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;(</span><span style="color: #005CC5">1</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">s)</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">depth[cur.u];s</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        st[cur.u][s] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> st[st[cur.u][s</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">]][s</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">      cur.e </span><span style="color: #D73A49">=</span><span style="color: #24292E"> head[cur.u];</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E"> cur.e </span><span style="color: #D73A49">=</span><span style="color: #24292E"> edge[cur.e].nxt;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (cur.e</span><span style="color: #D73A49">!=</span><span style="color: #005CC5">0</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      stk.</span><span style="color: #6F42C1">push</span><span style="color: #24292E">(cur);</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (edge[cur.e].to</span><span style="color: #D73A49">!=</span><span style="color: #24292E">cur.f){</span></span>
<span class="line"><span style="color: #24292E">        stk.</span><span style="color: #6F42C1">push</span><span style="color: #24292E">({edge[cur.e].to, cur.u, </span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">});</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6A737D">// 递归查找每个节点的深度</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">dfs</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">i</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">fat</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  depth[i] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> depth[fat]</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  st[i][</span><span style="color: #005CC5">0</span><span style="color: #24292E">]</span><span style="color: #D73A49">=</span><span style="color: #24292E">fat;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;(</span><span style="color: #005CC5">1</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">p)</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">depth[i];p</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    st[i][p] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> st[st[i][p</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">]][p</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">];</span><span style="color: #6A737D"> // 跳</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> e </span><span style="color: #D73A49">=</span><span style="color: #24292E"> head[i]; e; e </span><span style="color: #D73A49">=</span><span style="color: #24292E"> edge[e].nxt){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (edge[e].to</span><span style="color: #D73A49">!=</span><span style="color: #24292E">fat){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">dfs</span><span style="color: #24292E">(edge[e].to, i);      </span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6A737D">// 开始向上走寻找</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">lca</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #6A737D">  // 将深度大的设为a，深度小的设为b</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (depth[a]</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">depth[b]){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> temp </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">    a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> b;</span></span>
<span class="line"><span style="color: #24292E">    b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> temp;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 让更深的a上跳</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> power; p</span><span style="color: #D73A49">&gt;=</span><span style="color: #005CC5">0</span><span style="color: #24292E">; p</span><span style="color: #D73A49">--</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (depth[st[a][p]]</span><span style="color: #D73A49">&gt;=</span><span style="color: #24292E">depth[b]){</span><span style="color: #6A737D"> // 保证上跳不超过b</span></span>
<span class="line"><span style="color: #24292E">      a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> st[a][p];</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 特判来到同一层时两者相同，即b是a的祖先</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (a</span><span style="color: #D73A49">==</span><span style="color: #24292E">b){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 到达同一层，开始上跳，保证每次上跳两者不到同一节点</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> power; p</span><span style="color: #D73A49">&gt;=</span><span style="color: #005CC5">0</span><span style="color: #24292E">; p</span><span style="color: #D73A49">--</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (st[a][p]</span><span style="color: #D73A49">!=</span><span style="color: #24292E">st[b][p]){</span></span>
<span class="line"><span style="color: #24292E">      a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> st[a][p];</span></span>
<span class="line"><span style="color: #24292E">      b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> st[b][p];</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> st[a][</span><span style="color: #005CC5">0</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">solve</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> m </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> s;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> u, v;</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> u </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> v;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">add_edge</span><span style="color: #24292E">(u,v);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">add_edge</span><span style="color: #24292E">(v,u);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  power </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">log2</span><span style="color: #24292E">(n);</span></span>
<span class="line"><span style="color: #24292E">  cnt </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  //dfs_stack(s,0);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">dfs</span><span style="color: #24292E">(s,</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">(m</span><span style="color: #D73A49">--</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> a, b;</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> a </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> b;</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">lca</span><span style="color: #24292E">(a,b)</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">()</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">ios</span><span style="color: #24292E">::</span><span style="color: #6F42C1">sync_with_stdio</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">); cin.</span><span style="color: #6F42C1">tie</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">); cout.</span><span style="color: #6F42C1">tie</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> tomorin</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  //cin &gt;&gt; tomorin;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E"> (tomorin</span><span style="color: #D73A49">--</span><span style="color: #24292E">) </span><span style="color: #6F42C1">solve</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="tarjan算法">Tarjan算法</h2>
<p>Tarjan将所有询问存储，并在dfs中离线处理</p>
<p>步骤：</p>
<ul>
<li>建好每个节点的问题列表，并遍历树，即建立两节点之间的关系，双向</li>
<li>来到当前节点cur，标记vis数组为true，表示当前节点已经访问</li>
<li>遍历cur的所有子树，每棵子树遍历完后和cur节点合并，cur为头节点</li>
</ul>
<p>​ 此时cur为该节点子树节点集合的头节点</p>
<ul>
<li>遍历完所有子树后，处理cur节点的每一条查询(cur, x)
<ul>
<li>若x已经访问过，则cur与x的最低公共祖先 = x所在集合头节点</li>
<li>若没有访问过，则先不处理，等到x节点时再去处理(x, cur)得到答案</li>
</ul></li>
</ul>
<p>时间复杂度：<span class="math inline">\(O(n+m)\)</span></p>
<p>只能离线查询</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">endl</span><span style="color: #24292E"> &#39;\n&#39;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> ll;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> pair</span><span style="color: #D73A49">&lt;int</span><span style="color: #24292E">,</span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> PII;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">5</span><span style="color: #D73A49">e</span><span style="color: #005CC5">5</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> mod </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #D73A49">e</span><span style="color: #005CC5">9</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">7</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> n, m, s;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> tcnt, qcnt;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> headt[N], headq[N];</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> vis[N], ans[N], disj[N];</span></span>
<span class="line"><span style="color: #6A737D">// 储存树</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">node</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> to, nxt;</span></span>
<span class="line"><span style="color: #24292E">}edge[</span><span style="color: #005CC5">2</span><span style="color: #D73A49">*</span><span style="color: #24292E">N];</span></span>
<span class="line"><span style="color: #6A737D">// 储存询问</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">node2</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> to, idx, nxt;</span></span>
<span class="line"><span style="color: #24292E">}query[</span><span style="color: #005CC5">2</span><span style="color: #D73A49">*</span><span style="color: #24292E">N];</span></span>
<span class="line"><span style="color: #6A737D">// 对树加边</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">add_tedge</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">from</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">to</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  edge[</span><span style="color: #D73A49">++</span><span style="color: #24292E">tcnt].to </span><span style="color: #D73A49">=</span><span style="color: #24292E"> to;</span></span>
<span class="line"><span style="color: #24292E">  edge[tcnt].nxt </span><span style="color: #D73A49">=</span><span style="color: #24292E"> headt[from];</span></span>
<span class="line"><span style="color: #24292E">  headt[from] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> tcnt;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6A737D">// 对询问加边</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">add_qedge</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">from</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">to</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">i</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  query[</span><span style="color: #D73A49">++</span><span style="color: #24292E">qcnt].to </span><span style="color: #D73A49">=</span><span style="color: #24292E"> to;</span></span>
<span class="line"><span style="color: #24292E">  query[qcnt].nxt </span><span style="color: #D73A49">=</span><span style="color: #24292E"> headq[from];</span></span>
<span class="line"><span style="color: #24292E">  query[qcnt].idx </span><span style="color: #D73A49">=</span><span style="color: #24292E"> i;</span></span>
<span class="line"><span style="color: #24292E">  headq[from] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> qcnt;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6A737D">// 并查集查找操作</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">find</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (disj[x]</span><span style="color: #D73A49">!=</span><span style="color: #24292E">x) disj[x] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">find</span><span style="color: #24292E">(disj[x]);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> disj[x];</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">tarjan</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">u</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">f</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  vis[u] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 当前节点已访问</span></span>
<span class="line"><span style="color: #6A737D">  // 遍历该节点的孩子</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> e </span><span style="color: #D73A49">=</span><span style="color: #24292E"> headt[u], v; e; e</span><span style="color: #D73A49">=</span><span style="color: #24292E">edge[e].nxt){</span></span>
<span class="line"><span style="color: #24292E">    v </span><span style="color: #D73A49">=</span><span style="color: #24292E"> edge[e].to;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (v</span><span style="color: #D73A49">!=</span><span style="color: #24292E">f){</span><span style="color: #6A737D"> // 孩子和父节点不能相同</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">tarjan</span><span style="color: #24292E">(v,u);</span><span style="color: #6A737D"> // 递归，让现在的孩子作为子过程的父亲节点</span></span>
<span class="line"><span style="color: #24292E">      disj[v] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> u;</span><span style="color: #6A737D"> // 子树头节点改为当前节点，即合并</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 开始处理问题</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> e </span><span style="color: #D73A49">=</span><span style="color: #24292E"> headq[u], v; e; e</span><span style="color: #D73A49">=</span><span style="color: #24292E">query[e].nxt){</span></span>
<span class="line"><span style="color: #24292E">    v </span><span style="color: #D73A49">=</span><span style="color: #24292E"> query[e].to;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (vis[v]){</span><span style="color: #6A737D"> // 问题已遍历，可以处理</span></span>
<span class="line"><span style="color: #24292E">      ans[query[e].idx]</span><span style="color: #D73A49">=</span><span style="color: #6F42C1">find</span><span style="color: #24292E">(v);</span><span style="color: #6A737D"> // 问题编号位置找到v所在集合的头节点，填入ans即为答案</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">solve</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> m </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> s;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    disj[i]</span><span style="color: #D73A49">=</span><span style="color: #24292E">i;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  qcnt </span><span style="color: #D73A49">=</span><span style="color: #24292E"> tcnt </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> u, v;</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> u </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> v;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">add_tedge</span><span style="color: #24292E">(u, v);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">add_tedge</span><span style="color: #24292E">(v, u);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">; i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">m;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> u, v;</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> u </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> v;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">add_qedge</span><span style="color: #24292E">(u, v, i);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">add_qedge</span><span style="color: #24292E">(v, u, i);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">tarjan</span><span style="color: #24292E">(s, </span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">m;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> ans[i]</span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E">endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">()</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">ios</span><span style="color: #24292E">::</span><span style="color: #6F42C1">sync_with_stdio</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">); cin.</span><span style="color: #6F42C1">tie</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">); cout.</span><span style="color: #6F42C1">tie</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> tomorin</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  //cin &gt;&gt; tomorin;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E"> (tomorin</span><span style="color: #D73A49">--</span><span style="color: #24292E">) </span><span style="color: #6F42C1">solve</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>算法与数据结构</category>
      </categories>
      <tags>
        <tag>算法</tag>
        <tag>图论</tag>
        <tag>树上问题</tag>
      </tags>
  </entry>
  <entry>
    <title>【算法】IDDFS与IDA*</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%BF%AD%E4%BB%A3%E5%8A%A0%E6%B7%B1%E4%B8%8EIDA/</url>
    <content><![CDATA[<h1 id="iddfs与ida">IDDFS与IDA*</h1>
<h2 id="iddfs">IDDFS</h2>
<h3 id="原理">原理</h3>
<p>迭代加深搜索是对dfs与bfs的优化，即以bfs进行dfs，对dfs限制了深度，空间复杂度较小</p>
<p>当达到限制的深度d时返回。若一次搜索没有找到合法的解，就让设定的深度+1，重新从根开始</p>
<p>一般用于寻找最优解</p>
<h3 id="过程">过程</h3>
<p>首先设定较小深度作为全局变量进行dfs，每进入一次将当前深度+1，当发现d大于设定的深度limit就返回。若搜索途中发现答案可以回溯，回溯时可以记录路径。若没有发现答案，就回到函数入口，增加设定深度，继续搜索</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6F42C1">IDDFS</span><span style="color: #24292E">(u,d)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> d</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">limit</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E"> each </span><span style="color: #6F42C1">edge</span><span style="color: #24292E"> (u,v)</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #6F42C1">IDDFS</span><span style="color: #24292E">(v,d</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #D73A49">return</span></span></code></pre></div></div></figure>
<h3 id="应用">应用</h3>
<p>bfs空间不够优秀+需要寻找最优解</p>
<h2 id="ida">IDA*</h2>
<p>即使用了迭代加深的A*算法</p>
<h3 id="优点">优点</h3>
<ul>
<li>不需要判重与排序，利于深度剪枝</li>
<li>空间需求少，每个深度下实际是dfs</li>
</ul>
<h3 id="缺点">缺点</h3>
<p>重复搜索：即使前后两次搜索差距小，回溯时每次深度变大都要再次从头搜索</p>
<h3 id="剪枝原则">剪枝原则</h3>
<p>当前局面的估价函数值+当前的搜索深度 &gt; 预定义的最大搜索深度</p>
<p>估计函数的标准可参考：在一定范围内加大各个状态启发函数值的差别</p>
<h3 id="例">例</h3>
<blockquote>
<p>P1379 八数码难题</p>
</blockquote>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">endl</span><span style="color: #24292E"> &#39;\n&#39;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> ll;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> pair</span><span style="color: #D73A49">&lt;int</span><span style="color: #24292E">,</span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> PII;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #D73A49">e</span><span style="color: #005CC5">5</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> mod </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #D73A49">e</span><span style="color: #005CC5">9</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">7</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> string ed </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;123804765&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> dx[]</span><span style="color: #D73A49">=</span><span style="color: #24292E">{</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">0</span><span style="color: #24292E">,</span><span style="color: #005CC5">0</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> dy[]</span><span style="color: #D73A49">=</span><span style="color: #24292E">{</span><span style="color: #005CC5">0</span><span style="color: #24292E">,</span><span style="color: #005CC5">0</span><span style="color: #24292E">,</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">1</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> mdepth;</span></span>
<span class="line"><span style="color: #24292E">string s;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">h</span><span style="color: #24292E">(</span><span style="color: #6F42C1">string</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> ans </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">s.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (s[i]</span><span style="color: #D73A49">==</span><span style="color: #032F62">&#39;0&#39;</span><span style="color: #24292E">) </span><span style="color: #D73A49">continue</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> ed.</span><span style="color: #6F42C1">find</span><span style="color: #24292E">(s[i]);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> r </span><span style="color: #D73A49">=</span><span style="color: #24292E"> i</span><span style="color: #D73A49">/</span><span style="color: #005CC5">3</span><span style="color: #24292E">, c</span><span style="color: #D73A49">=</span><span style="color: #24292E"> i</span><span style="color: #D73A49">%</span><span style="color: #005CC5">3</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> x </span><span style="color: #D73A49">=</span><span style="color: #24292E"> j</span><span style="color: #D73A49">/</span><span style="color: #005CC5">3</span><span style="color: #24292E">, y </span><span style="color: #D73A49">=</span><span style="color: #24292E"> j</span><span style="color: #D73A49">%</span><span style="color: #005CC5">3</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    ans</span><span style="color: #D73A49">+=</span><span style="color: #6F42C1">abs</span><span style="color: #24292E">(r</span><span style="color: #D73A49">-</span><span style="color: #24292E">x)</span><span style="color: #D73A49">+</span><span style="color: #6F42C1">abs</span><span style="color: #24292E">(c</span><span style="color: #D73A49">-</span><span style="color: #24292E">y);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ans;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">bool</span><span style="color: #24292E"> </span><span style="color: #6F42C1">dfs</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">cd</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">st</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> cnt </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">h</span><span style="color: #24292E">(s);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">cnt) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (cd</span><span style="color: #D73A49">+</span><span style="color: #24292E">cnt</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">mdepth) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> pos </span><span style="color: #D73A49">=</span><span style="color: #24292E"> s.</span><span style="color: #6F42C1">find</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;0&#39;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> x </span><span style="color: #D73A49">=</span><span style="color: #24292E"> pos</span><span style="color: #D73A49">/</span><span style="color: #005CC5">3</span><span style="color: #24292E">, y </span><span style="color: #D73A49">=</span><span style="color: #24292E"> pos</span><span style="color: #D73A49">%</span><span style="color: #005CC5">3</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">4</span><span style="color: #24292E">;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> nx </span><span style="color: #D73A49">=</span><span style="color: #24292E"> x</span><span style="color: #D73A49">+</span><span style="color: #24292E">dx[i], ny </span><span style="color: #D73A49">=</span><span style="color: #24292E"> y</span><span style="color: #D73A49">+</span><span style="color: #24292E">dy[i];</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (nx</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">0</span><span style="color: #D73A49">||</span><span style="color: #24292E">nx</span><span style="color: #D73A49">&gt;</span><span style="color: #005CC5">2</span><span style="color: #D73A49">||</span><span style="color: #24292E">ny</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">0</span><span style="color: #D73A49">||</span><span style="color: #24292E">ny</span><span style="color: #D73A49">&gt;</span><span style="color: #005CC5">2</span><span style="color: #D73A49">||</span><span style="color: #24292E">nx</span><span style="color: #D73A49">*</span><span style="color: #005CC5">3</span><span style="color: #D73A49">+</span><span style="color: #24292E">ny</span><span style="color: #D73A49">==</span><span style="color: #24292E">st)</span><span style="color: #D73A49">continue</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">swap</span><span style="color: #24292E">(s[pos], s[nx</span><span style="color: #D73A49">*</span><span style="color: #005CC5">3</span><span style="color: #D73A49">+</span><span style="color: #24292E">ny]);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E">(</span><span style="color: #6F42C1">dfs</span><span style="color: #24292E">(cd</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">,pos)) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">swap</span><span style="color: #24292E">(s[pos], s[nx</span><span style="color: #D73A49">*</span><span style="color: #005CC5">3</span><span style="color: #D73A49">+</span><span style="color: #24292E">ny]);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">solve</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> s;</span></span>
<span class="line"><span style="color: #24292E">  mdepth </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">h</span><span style="color: #24292E">(s);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">(mdepth</span><span style="color: #D73A49">&lt;=</span><span style="color: #005CC5">27</span><span style="color: #D73A49">&amp;&amp;!</span><span style="color: #6F42C1">dfs</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">,</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">)) mdepth</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> mdepth; </span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">()</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">ios</span><span style="color: #24292E">::</span><span style="color: #6F42C1">sync_with_stdio</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">); cin.</span><span style="color: #6F42C1">tie</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">); cout.</span><span style="color: #6F42C1">tie</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> tomorin</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #6A737D">  //cin &gt;&gt; tomorin;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E"> (tomorin</span><span style="color: #D73A49">--</span><span style="color: #24292E">) </span><span style="color: #6F42C1">solve</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>算法与数据结构</category>
      </categories>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>【数学】组合数学</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E7%BB%84%E5%90%88%E6%95%B0%E5%AD%A6/</url>
    <content><![CDATA[<h1 id="组合数学">组合数学</h1>
<h2 id="抽屉原理">抽屉原理</h2>
<ul>
<li><p>将n+1个物体划分为n组，至少有一组有两个及以上的物体</p></li>
<li><p>将n个物体划分为k组，至少存在一个分组，含有大于等于<span
class="math inline">\(\lceil \frac{n}{k}\rceil\)</span>个物体</p></li>
</ul>
<h2 id="插板法">插板法</h2>
<blockquote>
<p>n个完全相同的元素分为k组，每组至少一个元素，一共有多少分发</p>
</blockquote>
<p>我们通过插板子来实现分组，用k-1块板子插入n-1个空中，即有$ $中分发</p>
<p>若每组允许为空，我们将条件转化为在n+k个元素形成的n+k-1个空里面插板子，即有$
$</p>
<h2 id="容斥原理">容斥原理</h2>
<p>前置知识：德摩根律</p>
<p>简单形式：设A,B是分别具有性质<span
class="math inline">\(P_1\)</span>和<span
class="math inline">\(P_2\)</span>的元素集合，则<span
class="math inline">\(|A\cup B|=|A|+|B|-|A\cap B|\)</span></p>
<p>推广：设集合S的子集<span
class="math inline">\(A_1\)</span>具有性质<span
class="math inline">\(P_1\)</span>，…，<span
class="math inline">\(A_n\)</span>具有性质<span
class="math inline">\(P_n\)</span>，则</p>
<ol type="1">
<li><p>集合S至少具有性质<span
class="math inline">\(P_1,P_2,\cdots,P_n\)</span>之一的元素个数为$
_{i=1}^{n}
|A_i|=|A_i|-|A_iA_j|+|A_iA_jA_k|-+(-1)<sup>n|_{i=1}</sup>{n}A_i|
$</p></li>
<li><p>集合S不具有性质<span
class="math inline">\(P_1,P_2,\cdots,P_n\)</span>之一的元素个数为$
_{i=1}^{n}
||=|S|-(|A_i|-|A_iA_j|+|A_iA_jA_k|-+(-1)<sup>n|_{i=1}</sup>{n}A_i|
)$</p></li>
</ol>
<h2 id="求组合数">求组合数</h2>
<blockquote>
<p>求解<span
class="math inline">\(\binom{n}{m}\mod{p}\)</span>(其中p为质数)</p>
</blockquote>
<h3 id="阶乘乘法逆元">阶乘+乘法逆元</h3>
<ol type="1">
<li>求出阶乘n!,m!,(n-m)!，每次乘法后取模</li>
<li>求出阶乘对应的乘法逆元</li>
</ol>
<p>这里我们可以预处理掉对应阶乘与对应逆元，在计算组合数时直接计算</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">ll fac[N], infac[N];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 快速幂计算</span></span>
<span class="line"><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #6F42C1">qpow</span><span style="color: #24292E">(</span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #E36209">n</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #E36209">m</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">    ll r </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E"> (n) {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (n </span><span style="color: #D73A49">&amp;</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">) r </span><span style="color: #D73A49">=</span><span style="color: #24292E"> r </span><span style="color: #D73A49">*</span><span style="color: #24292E"> a </span><span style="color: #D73A49">%</span><span style="color: #24292E"> m;</span></span>
<span class="line"><span style="color: #24292E">        a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a </span><span style="color: #D73A49">*</span><span style="color: #24292E"> a </span><span style="color: #D73A49">%</span><span style="color: #24292E"> m;</span></span>
<span class="line"><span style="color: #24292E">        n </span><span style="color: #D73A49">&gt;&gt;=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> r;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 初始化阶乘和逆元</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">init_fac</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">    fac[</span><span style="color: #005CC5">0</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> infac[</span><span style="color: #005CC5">0</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (ll i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">; i </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> N; </span><span style="color: #D73A49">++</span><span style="color: #24292E">i) {</span></span>
<span class="line"><span style="color: #24292E">        fac[i] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> fac[i </span><span style="color: #D73A49">-</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">] </span><span style="color: #D73A49">*</span><span style="color: #24292E"> i </span><span style="color: #D73A49">%</span><span style="color: #24292E"> mod;</span></span>
<span class="line"><span style="color: #24292E">        infac[i] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">qpow</span><span style="color: #24292E">(fac[i], mod </span><span style="color: #D73A49">-</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #24292E">, mod);</span><span style="color: #6A737D"> // 使用快速幂计算逆元</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 组合数计算</span></span>
<span class="line"><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #6F42C1">C</span><span style="color: #24292E">(</span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #E36209">n</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #E36209">m</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (m </span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> n </span><span style="color: #D73A49">||</span><span style="color: #24292E"> m </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 边界条件</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> fac[n] </span><span style="color: #D73A49">*</span><span style="color: #24292E"> infac[m] </span><span style="color: #D73A49">%</span><span style="color: #24292E"> mod </span><span style="color: #D73A49">*</span><span style="color: #24292E"> infac[n </span><span style="color: #D73A49">-</span><span style="color: #24292E"> m] </span><span style="color: #D73A49">%</span><span style="color: #24292E"> mod;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p><strong>别忘了调用<code>init_fac()</code>进行初始化！！！</strong></p>
<h3 id="卢卡斯定理">卢卡斯定理</h3>
<p><span class="math display">\[
\begin{array}{c}C_{a}^{b}\equiv
C_{\lfloor\frac{a}{p}\rfloor}^{\lfloor\frac{b}{p}\rfloor} \cdot C_{a
\bmod p }^{b\bmod p}\pmod{p}\end{array}
\]</span></p>
<p>其中前半部分可以用卢卡斯定理递归求解，后半部分用上方方法求解</p>
<p>卢卡斯定理可以优化求解速度，而且适用于求解a，b较大而p较小的情况</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #6F42C1">lucas</span><span style="color: #24292E">(</span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #E36209">n</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #E36209">m</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">m)</span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">lucas</span><span style="color: #24292E">(n</span><span style="color: #D73A49">/</span><span style="color: #24292E">mod, m</span><span style="color: #D73A49">/</span><span style="color: #24292E">mod)</span><span style="color: #D73A49">*</span><span style="color: #6F42C1">C</span><span style="color: #24292E">(n</span><span style="color: #D73A49">%</span><span style="color: #24292E">mod,m</span><span style="color: #D73A49">%</span><span style="color: #24292E">mod)</span><span style="color: #D73A49">%</span><span style="color: #24292E">mod;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>数学</category>
      </categories>
      <tags>
        <tag>数学</tag>
        <tag>组合数学</tag>
      </tags>
  </entry>
  <entry>
    <title>【数据结构】表</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%A1%A8/</url>
    <content><![CDATA[<h1 id="表">表</h1>
<h2 id="线性表">线性表</h2>
<p>n个数据类型相同的元素构成的有限序列</p>
<ul>
<li>空表：大小为0的表</li>
<li>首节点：存在唯一一个被称为第一个的元素</li>
<li>尾节点：存在唯一一个被称为最后一个的元素</li>
<li>前驱：<span class="math inline">\(A_{i-1}\)</span>前驱<span
class="math inline">\(A_i\)</span></li>
<li>后继：<span class="math inline">\(A_{i+1}\)</span>后继<span
class="math inline">\(A_i\)</span></li>
</ul>
<p><strong>对于除了首尾节点的元素<span
class="math inline">\(A_i\)</span>，它只会有一个前驱、一个后继</strong></p>
<h2 id="顺序表实现">顺序表实现</h2>
<p>顺序表：一组连续内存单元存储线性表的各个元素</p>
<p>对于静态表，<strong>main函数调用时，应传入列表的地址(&amp;)</strong></p>
<h3 id="建表">建表</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">MAXSIZE</span><span style="color: #24292E"> 100</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> ElemType;</span><span style="color: #6A737D"> // 方便存储不同类型数据的情况下修改数据类型</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 建表</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">SeqList</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  ElemType data[MAXSIZE];</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> length;</span><span style="color: #6A737D"> // 顺序表数据个数</span></span>
<span class="line"><span style="color: #24292E">};</span></span></code></pre></div></div></figure>
<h3 id="初始化">初始化</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 初始化</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">initList</span><span style="color: #24292E">(</span><span style="color: #6F42C1">SeqList</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">L</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  L-&gt;length </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="尾插元素">尾插元素</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 尾插元素</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">appendElem</span><span style="color: #24292E">(</span><span style="color: #6F42C1">SeqList</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">L</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ElemType</span><span style="color: #24292E"> </span><span style="color: #E36209">e</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (L-&gt;length</span><span style="color: #D73A49">&gt;=</span><span style="color: #24292E">MAXSIZE){</span><span style="color: #6A737D"> // 判满</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;已满</span><span style="color: #005CC5">\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  L-&gt;data[L-&gt;length] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> e;</span><span style="color: #6A737D"> // 在末尾添加元素</span></span>
<span class="line"><span style="color: #24292E">  L-&gt;length</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 将顺序表长度加一</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="插入元素">插入元素</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 插入元素</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">insertElem</span><span style="color: #24292E">(</span><span style="color: #6F42C1">SeqList</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">L</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ElemType</span><span style="color: #24292E"> </span><span style="color: #E36209">e</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">pos</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (L-&gt;length</span><span style="color: #D73A49">&gt;=</span><span style="color: #24292E">MAXSIZE){</span><span style="color: #6A737D"> // 判满</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;已满</span><span style="color: #005CC5">\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (pos</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">1</span><span style="color: #24292E"> </span><span style="color: #D73A49">||</span><span style="color: #24292E"> pos</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> L-&gt;length){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;位置错误</span><span style="color: #005CC5">\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> L-&gt;length</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">; i</span><span style="color: #D73A49">&gt;=</span><span style="color: #24292E">pos</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">--</span><span style="color: #24292E">){</span><span style="color: #6A737D"> // 倒序让插入元素后面的元素后移一位</span></span>
<span class="line"><span style="color: #24292E">    L-&gt;data[i</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> L-&gt;data[i];</span><span style="color: #6A737D"> // 向后移动元素</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  L-&gt;data[pos</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> e;</span><span style="color: #6A737D"> // 插入元素</span></span>
<span class="line"><span style="color: #24292E">  L-&gt;length</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 将顺序表长度加一</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>最坏时间复杂度<span class="math inline">\(O(n)\)</span></p>
<p>需要将插入位置后的元素都后移一位</p>
<h3 id="遍历列表">遍历列表</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 遍历元素</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">listElem</span><span style="color: #24292E">(</span><span style="color: #6F42C1">SeqList</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">L</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> L-&gt;length; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">%d</span><span style="color: #032F62"> &quot;</span><span style="color: #24292E">, L-&gt;data[i]);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="删除元素">删除元素</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 删除元素并返回删除的元素</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">delElem</span><span style="color: #24292E">(</span><span style="color: #6F42C1">SeqList</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">L</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">pos</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ElemType</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">e</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">*</span><span style="color: #24292E">e </span><span style="color: #D73A49">=</span><span style="color: #24292E"> L-&gt;data[pos</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">];</span><span style="color: #6A737D"> // 取出删除元素</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (pos </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> L-&gt;length){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> pos; i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">L-&gt;length; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      L-&gt;data[i</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> L-&gt;data[i];</span><span style="color: #6A737D"> // 从pos开始向后，将后面一位覆盖到前一位实现删除</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  L-&gt;length</span><span style="color: #D73A49">--</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 表长度减一，这样最后一个元素不用覆盖也可以</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>该删除可以返回删除掉的元素，用e变量存储</p>
<h3 id="查找元素">查找元素</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 查找元素</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">findElem</span><span style="color: #24292E">(</span><span style="color: #6F42C1">SeqList</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">L</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ElemType</span><span style="color: #24292E"> </span><span style="color: #E36209">e</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">L-&gt;length; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (e</span><span style="color: #D73A49">==</span><span style="color: #24292E">L-&gt;data[i]){</span><span style="color: #6A737D"> // 找到元素</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> i</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 返回位置</span></span>
<span class="line"><span style="color: #24292E">    } </span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 找不到返回-1</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="使用动态顺序表实现">使用动态顺序表实现</h3>
<p>通过malloc函数在堆中动态分配内存建表</p>
<p>不同的地方只是在建表与初始化上</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 建表 </span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">struct</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">  ElemType </span><span style="color: #D73A49">*</span><span style="color: #24292E">data;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> length;</span></span>
<span class="line"><span style="color: #24292E">}</span><span style="color: #6F42C1">SeqList</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 初始化 分配内存</span></span>
<span class="line"><span style="color: #6F42C1">SeqList</span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">initList</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  SeqList </span><span style="color: #D73A49">*</span><span style="color: #24292E">L </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (SeqList</span><span style="color: #D73A49">*</span><span style="color: #24292E">)</span><span style="color: #6F42C1">malloc</span><span style="color: #24292E">(</span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(SeqList));</span></span>
<span class="line"><span style="color: #24292E">  L -&gt; data </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (ElemType</span><span style="color: #D73A49">*</span><span style="color: #24292E">)</span><span style="color: #6F42C1">malloc</span><span style="color: #24292E">(</span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(ElemType)</span><span style="color: #D73A49">*</span><span style="color: #24292E">MAXSIZE);</span></span>
<span class="line"><span style="color: #24292E">  L -&gt; length </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> L;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>此时在main函数建表时只需要调用initList函数初始化并将返回的结构体指针存入一个对应变量即可</p>
<p>由于此时获得的直接是地址，故对应操作时便不需要取地址了</p>
<h2 id="链表实现">链表实现</h2>
<p>链表存储的特点是用一组任意的存储单元存储数据（<strong>可连续可不连续</strong>）</p>
<p>对每一个存储单元，除了要存储当前数据，还需要存储一个指示其直接后继的信息（地址），这两部分信息组成了一个<strong>节点</strong>，n个节点链接成了一个链表，即为线性表</p>
<p>节点包括两个域：</p>
<ul>
<li>数据域：存储数据元素信息</li>
<li>指针域：存储直接后继存储位置</li>
</ul>
<h3 id="单链表">单链表</h3>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%A1%A8/image-20250311194320005.png" class="" title="单链表">
<p>next中存储了下一个节点的地址，其中尾节点中的next指向NULL，表示到达链表尾部</p>
<h4 id="初始化-1">初始化</h4>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 单链表初始化-建立头节点</span></span>
<span class="line"><span style="color: #6F42C1">Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">initList</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  Node </span><span style="color: #D73A49">*</span><span style="color: #24292E">head </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (Node</span><span style="color: #D73A49">*</span><span style="color: #24292E">)</span><span style="color: #6F42C1">malloc</span><span style="color: #24292E">(</span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(Node));</span><span style="color: #6A737D"> // 分配一个节点大小的空间</span></span>
<span class="line"><span style="color: #24292E">  head-&gt;data </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 数据设为0</span></span>
<span class="line"><span style="color: #24292E">  head-&gt;next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">NULL</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 下一个地址设为NULL</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> head;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> test </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">initList</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>建立一个头节点，作为线性表的开始，其数据为0，地址默认为NULL</p>
<p>创建链表时，只需要调用initList函数并将返回的结构体指针赋给对应变量即可</p>
<h4 id="头插元素">头插元素</h4>
<p>头插元素实现了在头节点后插入数据</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%A1%A8/image-20250311202107588.png" class="" title="单链表头插法-1">
<p>先让新节点的next指向原头节点指向的下一个节点</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%A1%A8/image-20250311202236733.png" class="" title="单链表头插法-2">
<p>再让头节点指向的节点更改为新的节点</p>
<p><strong>顺序很重要</strong></p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">insertHead</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #E36209">L</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ElemType</span><span style="color: #24292E"> </span><span style="color: #E36209">e</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  Node </span><span style="color: #D73A49">*</span><span style="color: #24292E">p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (Node</span><span style="color: #D73A49">*</span><span style="color: #24292E">)</span><span style="color: #6F42C1">malloc</span><span style="color: #24292E">(</span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(Node));</span><span style="color: #6A737D"> // 分配存储数据的节点的空间</span></span>
<span class="line"><span style="color: #24292E">  p-&gt;data </span><span style="color: #D73A49">=</span><span style="color: #24292E"> e;</span><span style="color: #6A737D"> // 将插入元素赋值给该节点</span></span>
<span class="line"><span style="color: #24292E">  p-&gt;next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> L-&gt;next;</span><span style="color: #6A737D"> // 将该节点的next指向原头节点指向的节点</span></span>
<span class="line"><span style="color: #24292E">  L-&gt;next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p;</span><span style="color: #6A737D"> // 将原头节点的next指向该新节点</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h4 id="尾插元素-1">尾插元素</h4>
<p>头插元素实现了在尾节点后插入数据，我们需要先寻找尾节点</p>
<p>找到某节点的next==NULL时便找到了尾节点</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 获得尾节点地址</span></span>
<span class="line"><span style="color: #6F42C1">Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get_tail</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #E36209">L</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  Node </span><span style="color: #D73A49">*</span><span style="color: #24292E">p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> L;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">(p-&gt;next</span><span style="color: #D73A49">!=</span><span style="color: #005CC5">NULL</span><span style="color: #24292E">){</span><span style="color: #6A737D"> // 当节点不为空时</span></span>
<span class="line"><span style="color: #24292E">    p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p-&gt;next;</span><span style="color: #6A737D"> // 顺着寻找下一个节点</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> p;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%A1%A8/image-20250314151034553.png" class="" title="单链表尾插法-1">
<p>先让先前的尾节点指向新节点</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%A1%A8/image-20250314151114407.png" class="" title="单链表尾插法-2">
<p>再让新节点指向NULL</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 尾插法插入元素</span></span>
<span class="line"><span style="color: #6F42C1">Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">insertTail</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #E36209">tail</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ElemType</span><span style="color: #24292E"> </span><span style="color: #E36209">e</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (Node</span><span style="color: #D73A49">*</span><span style="color: #24292E">)</span><span style="color: #6F42C1">malloc</span><span style="color: #24292E">(</span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(Node));</span></span>
<span class="line"><span style="color: #24292E">  p-&gt;data </span><span style="color: #D73A49">=</span><span style="color: #24292E"> e;</span></span>
<span class="line"><span style="color: #24292E">  tail-&gt;next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p;</span></span>
<span class="line"><span style="color: #24292E">  p-&gt;next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">NULL</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> p;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>注意，尾插法每次返回尾节点，这样下次插入时就可以接着上一次的插入了，不需要再get</p>
<h4 id="指定位置插入元素">指定位置插入元素</h4>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%A1%A8/image-20250314153115490.png" class="" title="单链表指定插入-1">
<p>首先要找到待插入位置的前一个元素，然后让新节点指向该元素的下一个元素</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%A1%A8/image-20250314153247549.png" class="" title="单链表指定插入-2">
<p>然后让前一个节点指向新节点的位置</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 指定位置插入元素</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">insertNode</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #E36209">L</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">pos</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ElemType</span><span style="color: #24292E"> </span><span style="color: #E36209">e</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> L;</span></span>
<span class="line"><span style="color: #6A737D">  // 让指针指向需要插入位置的前驱节点</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">pos</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p-&gt;next;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (p</span><span style="color: #D73A49">==</span><span style="color: #005CC5">NULL</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> q </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (Node</span><span style="color: #D73A49">*</span><span style="color: #24292E">)</span><span style="color: #6F42C1">malloc</span><span style="color: #24292E">(</span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(Node));</span><span style="color: #6A737D"> // 要插入的新节点</span></span>
<span class="line"><span style="color: #24292E">  q-&gt;data </span><span style="color: #D73A49">=</span><span style="color: #24292E"> e;</span><span style="color: #6A737D"> // 输入数据</span></span>
<span class="line"><span style="color: #24292E">  q-&gt;next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p-&gt;next;</span><span style="color: #6A737D"> // 新节点下一个位置赋值为前驱节点指向的后一个节点</span></span>
<span class="line"><span style="color: #24292E">  p-&gt;next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> q;</span><span style="color: #6A737D"> // 前驱节点指向插入的新节点</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h4 id="删除节点">删除节点</h4>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%A1%A8/image-20250314223445905.png" class="" title="单链表删除-1">
<p>找到删除节点的前驱节点p</p>
<p>用指针q指向要删除的节点</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%A1%A8/image-20250314223541977.png" class="" title="单链表删除-2">
<p>通过改变p的后继节点实现删除</p>
<p>并释放删除节点的空间</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 删除节点</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">delNode</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #E36209">L</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">pos</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> L;</span></span>
<span class="line"><span style="color: #6A737D">  // 让指针指向需要删除位置的前驱节点</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">pos</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p-&gt;next;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (p </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">NULL</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (p-&gt;next </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">NULL</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;位置错误</span><span style="color: #005CC5">\n</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">  Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> q </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p-&gt;next;</span><span style="color: #6A737D"> // q指向要删除的节点</span></span>
<span class="line"><span style="color: #24292E">  p-&gt;next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> q-&gt;next;</span><span style="color: #6A737D"> // 要删除节点的前驱节点指向其后继节点</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">free</span><span style="color: #24292E">(q);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h4 id="获取链表长度">获取链表长度</h4>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 获取链表长度</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">listLength</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #E36209">L</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> L;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> cnt </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">(p</span><span style="color: #D73A49">!=</span><span style="color: #005CC5">NULL</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p-&gt;next;</span></span>
<span class="line"><span style="color: #24292E">    cnt</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> cnt;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h4 id="释放链表">释放链表</h4>
<p>把头结点后的节点都释放掉</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%A1%A8/image-20250315104451003.png" class="" title="单链表释放-1">
<p>让指针p指向头节点后的第一个节点</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%A1%A8/image-20250315104516739.png" class="" title="单链表释放-2">
<p>若p不为NULL，让q指向p的后继节点，并释放p指向的节点</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%A1%A8/image-20250315104539072.png" class="" title="单链表释放-3">
<p>让p, q指向同一个节点，循环以上操作</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 释放链表</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">freeList</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #E36209">L</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> L-&gt;next;</span><span style="color: #6A737D"> // p指针指向头节点后的第一个节点</span></span>
<span class="line"><span style="color: #24292E">  Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> q;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">(p</span><span style="color: #D73A49">!=</span><span style="color: #005CC5">NULL</span><span style="color: #24292E">){</span><span style="color: #6A737D"> // 判断p指向是否是空节点</span></span>
<span class="line"><span style="color: #24292E">    q </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p-&gt;next;</span><span style="color: #6A737D"> // q指向p的后继</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">free</span><span style="color: #24292E">(p);</span><span style="color: #6A737D"> // 释放p</span></span>
<span class="line"><span style="color: #24292E">    p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> q;</span><span style="color: #6A737D"> // p指向其后继（q指向的节点）</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  L-&gt;next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">NULL</span><span style="color: #24292E">;</span><span style="color: #6A737D"> //释放后原链表头节点指向NULL</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h4 id="注意">注意</h4>
<ul>
<li>时间复杂度：读取数据–顺序表&gt;链表 修改数据–链表&gt;顺序表</li>
<li>不要忘记初始化指针变量，防止其变为野指针</li>
<li>何时使用malloc？
<ul>
<li>声明指向一个结构的指针不会创建该结构，而是给出足够空间容纳结构可能会使用的地址</li>
<li>使用malloc可以使系统创建一个新的结构并返回指向该结构的指针</li>
<li>故若想使用指针变量沿着一个表行进，就没必要创建新的结构，不宜使用malloc</li>
</ul></li>
<li>free的结果：指针指向的地址没变，但该位置处的数据已经无定义了（野指针）</li>
<li>若未对链表进行过删除操作，则调用malloc的次数应该等于表的大小，含表头再+1</li>
</ul>
<h3 id="单项循环链表">单项循环链表</h3>
<p>特点：表中最后一个节点的指针域指向<strong>头节点</strong>，形成一个环</p>
<p>终止条件：<code>p!=L</code>或<code>p-&gt;next!=L</code></p>
<h4 id="判断是否有环">判断是否有环</h4>
<p>快慢指针</p>
<p>让快指针一次走两步，慢指针一次走一步</p>
<p>当遇不到NULL时，若有环，则两者会一直追赶，根据概率一定会有一个时候相遇</p>
<p>若能相遇则说明有环，否则若碰到NULL证明没有环</p>
<p>注意特判只有一个元素或没有元素时，不然当前节点的指针域会赋值给空指针而报RE</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Solution</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">bool</span><span style="color: #24292E"> </span><span style="color: #6F42C1">hasCycle</span><span style="color: #24292E">(</span><span style="color: #6F42C1">ListNode</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">head</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">        ListNode</span><span style="color: #D73A49">*</span><span style="color: #24292E"> fast </span><span style="color: #D73A49">=</span><span style="color: #24292E"> head;</span></span>
<span class="line"><span style="color: #24292E">        ListNode</span><span style="color: #D73A49">*</span><span style="color: #24292E"> slow </span><span style="color: #D73A49">=</span><span style="color: #24292E"> head;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (fast</span><span style="color: #D73A49">==</span><span style="color: #005CC5">nullptr</span><span style="color: #D73A49">||</span><span style="color: #24292E">fast-&gt;next</span><span style="color: #D73A49">==</span><span style="color: #005CC5">nullptr</span><span style="color: #24292E">) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">while</span><span style="color: #24292E">(fast</span><span style="color: #D73A49">!=</span><span style="color: #005CC5">nullptr</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E">fast-&gt;next</span><span style="color: #D73A49">!=</span><span style="color: #005CC5">nullptr</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">            fast </span><span style="color: #D73A49">=</span><span style="color: #24292E"> fast-&gt;next-&gt;next;</span></span>
<span class="line"><span style="color: #24292E">            slow </span><span style="color: #D73A49">=</span><span style="color: #24292E"> slow-&gt;next;</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (fast</span><span style="color: #D73A49">==</span><span style="color: #24292E">slow) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">true</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">};</span></span></code></pre></div></div></figure>
<h4 id="找到环的入口">找到环的入口</h4>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%A1%A8/image-20250316220646941.png" class="" title="循环单链表">
<p>设起点到入口距离为<span
class="math inline">\(x\)</span>，入口到相遇距离为<span
class="math inline">\(y\)</span>，相遇再到入口距离为<span
class="math inline">\(z\)</span>，则快慢指针走的路程如下：</p>
<p><span class="math inline">\(fast = x+y+n(x+y)\)</span></p>
<p><span class="math inline">\(slow = x+y\)</span></p>
<p>其中n为圈数，由于快指针的速度为慢指针的两倍，故慢指针一定会在一圈内与快指针相遇</p>
<p>有<span class="math inline">\(2(x+y)=x+y+n(y+z)\)</span></p>
<p>化简得$ = n(y+z)-y<span
class="math inline">\(，由于快指针先入环，且速度快于慢指针，故快指针至少转一圈才能与慢指针相遇，即\)</span>n$至少为1</p>
<p>多拿出一圈来将y约掉，则<span
class="math inline">\(x=(n-1)(y+z)+z\)</span></p>
<p>当<span
class="math inline">\(n=1\)</span>时，即快指针转一圈与慢指针相遇的情况下，<span
class="math inline">\(x=z\)</span>，即两者会在环的入口处相遇</p>
<p>当<span class="math inline">\(n&gt;1\)</span>时，由于<span
class="math inline">\(y+z\)</span>是一整圈的路程，即走完若干圈后快指针还会再走<span
class="math inline">\(z\)</span>距离，最后与慢指针在环的入口处相遇</p>
<p>故我们可以在相遇位置设置一个指针，在起始位置设置一个指针，两者相遇处即为入口</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ListNode</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> val;</span></span>
<span class="line"><span style="color: #24292E">    ListNode </span><span style="color: #D73A49">*</span><span style="color: #24292E">next;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">ListNode</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">) : </span><span style="color: #6F42C1">val</span><span style="color: #24292E">(x), </span><span style="color: #6F42C1">next</span><span style="color: #24292E">(</span><span style="color: #005CC5">nullptr</span><span style="color: #24292E">) {}</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Solution</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">ListNode</span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">detectCycle</span><span style="color: #24292E">(</span><span style="color: #6F42C1">ListNode</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">head</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">int</span><span style="color: #24292E"> cnt[</span><span style="color: #005CC5">10005</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #24292E">            ListNode</span><span style="color: #D73A49">*</span><span style="color: #24292E"> fast </span><span style="color: #D73A49">=</span><span style="color: #24292E"> head;</span></span>
<span class="line"><span style="color: #24292E">            ListNode</span><span style="color: #D73A49">*</span><span style="color: #24292E"> slow </span><span style="color: #D73A49">=</span><span style="color: #24292E"> head;</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (fast</span><span style="color: #D73A49">==</span><span style="color: #005CC5">nullptr</span><span style="color: #D73A49">||</span><span style="color: #24292E">fast-&gt;next</span><span style="color: #D73A49">==</span><span style="color: #005CC5">nullptr</span><span style="color: #24292E">) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">nullptr</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">while</span><span style="color: #24292E">(fast</span><span style="color: #D73A49">!=</span><span style="color: #005CC5">nullptr</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E">fast-&gt;next</span><span style="color: #D73A49">!=</span><span style="color: #005CC5">nullptr</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">                fast </span><span style="color: #D73A49">=</span><span style="color: #24292E"> fast-&gt;next-&gt;next;</span></span>
<span class="line"><span style="color: #24292E">                slow </span><span style="color: #D73A49">=</span><span style="color: #24292E"> slow-&gt;next;</span></span>
<span class="line"><span style="color: #24292E">                </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (fast</span><span style="color: #D73A49">==</span><span style="color: #24292E">slow){</span></span>
<span class="line"><span style="color: #24292E">                    ListNode</span><span style="color: #D73A49">*</span><span style="color: #24292E"> index1 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> fast;</span></span>
<span class="line"><span style="color: #24292E">                    ListNode</span><span style="color: #D73A49">*</span><span style="color: #24292E"> index2 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> head;</span></span>
<span class="line"><span style="color: #24292E">                    </span><span style="color: #D73A49">while</span><span style="color: #24292E">(index1</span><span style="color: #D73A49">!=</span><span style="color: #24292E">index2){</span></span>
<span class="line"><span style="color: #24292E">                        index1 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> index1-&gt;next;</span></span>
<span class="line"><span style="color: #24292E">                        index2 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> index2-&gt;next;</span></span>
<span class="line"><span style="color: #24292E">                    }</span></span>
<span class="line"><span style="color: #24292E">                    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> index1;</span></span>
<span class="line"><span style="color: #24292E">                }</span></span>
<span class="line"><span style="color: #24292E">            }</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">nullptr</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">    };</span></span></code></pre></div></div></figure>
<h3 id="双向链表">双向链表</h3>
<p>特点：双向链表的节点中有两个指针域：一个指向<strong>直接后继</strong>，另一个指向<strong>直接前驱</strong></p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%A1%A8/image-20250316223202666.png" class="" title="双向链表">
<h4 id="建表-1">建表</h4>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> ElemType;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">node</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  ElemType data;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">node</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E">prev, </span><span style="color: #D73A49">*</span><span style="color: #24292E">next;</span></span>
<span class="line"><span style="color: #24292E">}</span><span style="color: #6F42C1">Node</span><span style="color: #24292E">;</span></span></code></pre></div></div></figure>
<h4 id="初始化-2">初始化</h4>
<p>与单链表相同</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 初始化建立头节点</span></span>
<span class="line"><span style="color: #6F42C1">Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">initList</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  Node </span><span style="color: #D73A49">*</span><span style="color: #24292E">head </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (Node</span><span style="color: #D73A49">*</span><span style="color: #24292E">)</span><span style="color: #6F42C1">malloc</span><span style="color: #24292E">(</span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(Node));</span><span style="color: #6A737D"> // 分配一个节点大小的空间</span></span>
<span class="line"><span style="color: #24292E">  head-&gt;data </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 数据设为0</span></span>
<span class="line"><span style="color: #24292E">  head-&gt;next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">NULL</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 下一个地址设为NULL</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> head;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h4 id="头插法">头插法</h4>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%A1%A8/image-20250316223533852.png" class="" title="双向链表头插法-1">
<p>让新节点的prev指向头节点</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%A1%A8/image-20250316223601056.png" class="" title="双向链表头插法-2">
<p>让新节点的next指向头节点的next</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%A1%A8/image-20250316223722812.png" class="" title="双向链表头插法-3">
<p>让头节点的next节点的prev指向新节点，让头节点的next指向新节点</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 头插法</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">insertHead</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #E36209">L</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ElemType</span><span style="color: #24292E"> </span><span style="color: #E36209">e</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (Node</span><span style="color: #D73A49">*</span><span style="color: #24292E">)</span><span style="color: #6F42C1">malloc</span><span style="color: #24292E">(</span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(Node));</span></span>
<span class="line"><span style="color: #24292E">  p-&gt;data </span><span style="color: #D73A49">=</span><span style="color: #24292E"> e;</span></span>
<span class="line"><span style="color: #24292E">  p-&gt;prev </span><span style="color: #D73A49">=</span><span style="color: #24292E"> L;</span><span style="color: #6A737D"> // 新节点的prev指向头节点</span></span>
<span class="line"><span style="color: #24292E">  p-&gt;next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> L-&gt;next;</span><span style="color: #6A737D"> // 新节点的next指向头节点后的第一个节点</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (L-&gt;next</span><span style="color: #D73A49">!=</span><span style="color: #005CC5">NULL</span><span style="color: #24292E">){</span><span style="color: #6A737D"> // 保证并非只有一个头节点</span></span>
<span class="line"><span style="color: #24292E">    L-&gt;next-&gt;prev </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p;</span><span style="color: #6A737D"> // 新节点的next节点的prev指向新节点</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  L-&gt;next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p;</span><span style="color: #6A737D"> // 头节点的next节点指向新节点</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h4 id="尾插法">尾插法</h4>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%A1%A8/image-20250317125757701.png" class="" title="双向链表尾插法-1">
<p>让新节点的prev指向尾节点</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%A1%A8/image-20250317125834523.png" class="" title="双向链表尾插法-2">
<p>让尾节点的next指向新节点</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%A1%A8/image-20250317125920694.png" class="" title="双向链表尾插法-3">
<p>将NULL值赋给新节点的next</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 获得尾节点地址</span></span>
<span class="line"><span style="color: #6F42C1">Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get_tail</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #E36209">L</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  Node </span><span style="color: #D73A49">*</span><span style="color: #24292E">p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> L;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">(p-&gt;next</span><span style="color: #D73A49">!=</span><span style="color: #005CC5">NULL</span><span style="color: #24292E">){</span><span style="color: #6A737D"> // 当节点不为空时</span></span>
<span class="line"><span style="color: #24292E">    p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p-&gt;next;</span><span style="color: #6A737D"> // 顺着寻找下一个节点</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> p;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 尾插法</span></span>
<span class="line"><span style="color: #6F42C1">Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">insertTail</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #E36209">tail</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ElemType</span><span style="color: #24292E"> </span><span style="color: #E36209">e</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (Node</span><span style="color: #D73A49">*</span><span style="color: #24292E">)</span><span style="color: #6F42C1">malloc</span><span style="color: #24292E">(</span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(Node));</span></span>
<span class="line"><span style="color: #24292E">  p-&gt;data </span><span style="color: #D73A49">=</span><span style="color: #24292E"> e;</span></span>
<span class="line"><span style="color: #24292E">  p-&gt;prev </span><span style="color: #D73A49">=</span><span style="color: #24292E"> tail;</span></span>
<span class="line"><span style="color: #24292E">  tail-&gt;next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p;</span></span>
<span class="line"><span style="color: #24292E">  p-&gt;next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">NULL</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> p;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h4 id="指定位置插入">指定位置插入</h4>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%A1%A8/image-20250317132908468.png" class="" title="双向链表指定位置插入-1">
<p>寻找前置节点，让新节点prev指向前置节点</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%A1%A8/image-20250317133012982.png" class="" title="双向链表指定位置插入-2">
<p>让新节点的next指向后置节点</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%A1%A8/image-20250318190327505.png" class="" title="双向链表指定位置插入-3">
<p>让前置节点的next的prev指向新节点</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%A1%A8/image-20250318190446545.png" class="" title="双向链表指定位置插入-4">
<p>前置节点的next指向新节点</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 指定位置插入数据</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">insertNode</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #E36209">L</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">pos</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ElemType</span><span style="color: #24292E"> </span><span style="color: #E36209">e</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> L;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">pos</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p-&gt;next;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (p</span><span style="color: #D73A49">==</span><span style="color: #005CC5">NULL</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> q </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (Node</span><span style="color: #D73A49">*</span><span style="color: #24292E">)</span><span style="color: #6F42C1">malloc</span><span style="color: #24292E">(</span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(Node));</span></span>
<span class="line"><span style="color: #24292E">  q-&gt;data </span><span style="color: #D73A49">=</span><span style="color: #24292E"> e;</span></span>
<span class="line"><span style="color: #24292E">  q-&gt;prev </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p;</span></span>
<span class="line"><span style="color: #24292E">  q-&gt;next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p-&gt;next;</span></span>
<span class="line"><span style="color: #24292E">  p-&gt;next-&gt;prev </span><span style="color: #D73A49">=</span><span style="color: #24292E"> q;</span></span>
<span class="line"><span style="color: #24292E">  p-&gt;next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> q;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h4 id="删除元素-1">删除元素</h4>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%A1%A8/image-20250318210055879.png" class="" title="双向链表删除-1">
<p>找到要删除节点的前驱节点，用指针记录要删除的节点</p>
<p>改变p的后继节点以及删除节点的后继节点的前驱来删除节点</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 删除元素</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">delNode</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #E36209">L</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">pos</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  Node </span><span style="color: #D73A49">*</span><span style="color: #24292E">p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> L;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">pos</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span><span style="color: #6A737D"> // 找到前驱节点</span></span>
<span class="line"><span style="color: #24292E">    p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p-&gt;next;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (p</span><span style="color: #D73A49">==</span><span style="color: #005CC5">NULL</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (p-&gt;next</span><span style="color: #D73A49">==</span><span style="color: #005CC5">NULL</span><span style="color: #24292E">){</span><span style="color: #6A737D"> // 判断删除位置是否超出了表长度</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;要删除的位置错误&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  Node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> q </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p-&gt;next;</span><span style="color: #6A737D"> // q指向要删除的节点</span></span>
<span class="line"><span style="color: #24292E">  p-&gt;next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> q-&gt;next;</span><span style="color: #6A737D"> // p的next指向q的后继节点</span></span>
<span class="line"><span style="color: #24292E">  q-&gt;next-&gt;prev </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p;</span><span style="color: #6A737D"> // q的后继节点的prev指向p</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">free</span><span style="color: #24292E">(q);</span><span style="color: #6A737D"> // 删除q</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="顺序表与链表">顺序表与链表</h2>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%A1%A8/image-20250318211103963.png" class="" title="顺序表与链表">
]]></content>
      <categories>
        <category>算法与数据结构</category>
      </categories>
      <tags>
        <tag>数据结构</tag>
      </tags>
  </entry>
  <entry>
    <title>【数学】逆元</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E9%80%86%E5%85%83/</url>
    <content><![CDATA[<h1 id="逆元">逆元</h1>
<h2 id="前置知识">前置知识</h2>
<h3 id="单位元">单位元</h3>
<p>在一个集合中，对于某种运算，如果对于任何的集合元素 a，和元素 e
运算，得到还是集合元素 a 本身，则称 e 为这个运算下的单位元。</p>
<p>在加法运算中，对于任意实数<span
class="math inline">\(a\)</span>，有<span
class="math inline">\(a+e=e+a=a\)</span>，则单位元<span
class="math inline">\(e=0\)</span> (可以认作相反数)</p>
<p>在乘法运算中，对于任意实数<span
class="math inline">\(a\)</span>，有<span class="math inline">\(a\times
e=e\times a=a\)</span>，则单位元<span class="math inline">\(e=1\)</span>
(可以认作倒数)</p>
<p>模乘的单位元是<span class="math inline">\(1(\bmod n)\)</span>
(证明自己搜)</p>
<h3 id="逆元-1">逆元</h3>
<p>在一个集合中，对于某种运算
，如果任意两个元素的运算结果等于单位元，则称这两个元素互为逆元。</p>
<h3 id="模意义下的乘法逆元"><strong>模意义下的乘法逆元</strong></h3>
<p>若<span class="math inline">\(ax\equiv 1(\bmod p)\)</span> 且<span
class="math inline">\(\gcd(a,p)=1\)</span>(a与p互质)，则称a关于模p的乘法逆元为x</p>
<p>逆元即数论中的广义倒数。</p>
<h3 id="费马小定理">费马小定理</h3>
<p>若p为质数，则<span
class="math inline">\(\gcd(a,p)=1\)</span>，则<span
class="math inline">\(a^{p-1}\equiv 1(\bmod p)\)</span></p>
<p>或对于任意整数a，有<span class="math inline">\(a^p\equiv a(\bmod
p)\)</span></p>
<h3 id="欧拉函数">欧拉函数</h3>
<p><span
class="math inline">\(\varphi(n)\)</span>，表示小于等于n的正整数中和n互质的数的个数，如<span
class="math inline">\(\varphi(1)=1\)</span></p>
<ul>
<li><p><strong>当n是质数时，有<span
class="math inline">\(\varphi(n)=n-1\)</span></strong></p></li>
<li><p>欧拉函数是积性函数，即对任意满足<span
class="math inline">\(\gcd(a,b)=1\)</span>的整数a,b，有<span
class="math inline">\(\varphi(ab)=\varphi(a)\varphi(b)\)</span></p>
<p>特别地，当n是奇数时<span
class="math inline">\(\varphi(2n)=\varphi(n)\)</span></p></li>
</ul>
<p><strong>求一个数的欧拉函数值</strong>：在质因数分解的同时求解即可</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">eular_phi</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">n</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> ans </span><span style="color: #D73A49">=</span><span style="color: #24292E"> n;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #24292E">;i</span><span style="color: #D73A49">*</span><span style="color: #24292E">i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (n</span><span style="color: #D73A49">%</span><span style="color: #24292E">i</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">            ans </span><span style="color: #D73A49">=</span><span style="color: #24292E"> ans</span><span style="color: #D73A49">/</span><span style="color: #24292E">i</span><span style="color: #D73A49">*</span><span style="color: #24292E">(i</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">while</span><span style="color: #24292E">(n</span><span style="color: #D73A49">%</span><span style="color: #24292E">i</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">) n</span><span style="color: #D73A49">/=</span><span style="color: #24292E">i;</span></span>
<span class="line"><span style="color: #24292E">        } </span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (n</span><span style="color: #D73A49">&gt;</span><span style="color: #005CC5">1</span><span style="color: #24292E">) ans </span><span style="color: #D73A49">=</span><span style="color: #24292E"> ans</span><span style="color: #D73A49">/</span><span style="color: #24292E">n</span><span style="color: #D73A49">*</span><span style="color: #24292E">(n</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ans;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="欧拉定理">欧拉定理</h3>
<p>若<span class="math inline">\(\gcd(a,m)=1\)</span>，则<span
class="math inline">\(a^{\varphi(m)}\equiv 1(\bmod m)\)</span></p>
<p>则对于费马小定理，有更一般的结论：<span class="math inline">\(x\equiv
a^{\varphi(p)-1}(\bmod p)\)</span></p>
<h2 id="应用">应用</h2>
<p>求除法的模运算时，经常会因为精度或溢出问题而导致结果产生误差。</p>
<p>故我们可以将求<span class="math inline">\(\frac{a}{b}\bmod
p\)</span>转化为<span class="math inline">\(a\cdot b的逆元 \bmod
p\)</span></p>
<p>将除法转为乘法，精度问题便就解决了</p>
<h2 id="扩展欧几里得定理求逆元">扩展欧几里得定理求逆元</h2>
<blockquote>
<p>给定正整数a，b，求满足<span
class="math inline">\(ax+by=1\)</span>的x的最小正整数解，若无解返回-1</p>
</blockquote>
<h3 id="结论">结论</h3>
<ul>
<li>当a与b不互质时，逆元必定不存在</li>
<li>当a与b互质时，有<span
class="math inline">\(ax+by=ay&#39;+b(x&#39;-\lfloor \frac{a}{b}\rfloor
y&#39;)\)</span></li>
</ul>
<p>对应系数可得： <span class="math display">\[
\left\{
    \begin{array}{**lr**}  
    x=y&#39; \\
    y=x&#39;-\lfloor\frac{a}{b}\rfloor y&#39;
    \end{array}
\right.
\]</span> 若改为求满足<span class="math inline">\(ax\equiv 1(\bmod
p)\)</span> 的最小正整数解，经过变形</p>
<p>原式可以由<span class="math inline">\(ax=kn+1\)</span>变为<span
class="math inline">\(ax+kn=1\)</span>，则和上方一致</p>
<h3 id="模板">模板</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">exgcd</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">x</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">y</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (b</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        x</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">,y</span><span style="color: #D73A49">=</span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">exgcd</span><span style="color: #24292E">(b, a</span><span style="color: #D73A49">%</span><span style="color: #24292E">b, y, x);</span></span>
<span class="line"><span style="color: #24292E">    y </span><span style="color: #D73A49">-=</span><span style="color: #24292E"> a</span><span style="color: #D73A49">/</span><span style="color: #24292E">b</span><span style="color: #D73A49">*</span><span style="color: #24292E">x;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="费马小定理-1">费马小定理</h2>
<blockquote>
<p>给定素数p和正整数a，求满足<span class="math inline">\(ax\equiv
1(\bmod p)\)</span>的最小正整数x，若不存在返回-1</p>
</blockquote>
<p>此时模数固定为素数，故直接可以用费马小定理求解</p>
<p>当a为p的倍数时，<span class="math inline">\(ax\equiv0(\bmod
p)\)</span>，所以一定不存在，返回-1</p>
<p>根据费马小定理有<span class="math inline">\(a^{p-1}\equiv 1(\bmod
p)\)</span>，又<span class="math inline">\(ax\equiv 1(\bmod
p)\)</span></p>
<p>则<span class="math inline">\(ax\equiv a^{p-1}(\bmod
p)\)</span>，逆元x满足<span class="math inline">\(x=a^{p-2}(\bmod
p)\)</span></p>
<h3 id="代码">代码</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">qpow</span><span style="color: #24292E">(</span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> ans </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (a</span><span style="color: #D73A49">%</span><span style="color: #24292E">p</span><span style="color: #D73A49">+</span><span style="color: #24292E">p)</span><span style="color: #D73A49">%</span><span style="color: #24292E">p;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E">(b</span><span style="color: #D73A49">!=</span><span style="color: #005CC5">0</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (b</span><span style="color: #D73A49">&amp;</span><span style="color: #005CC5">1</span><span style="color: #24292E">) ans </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (a</span><span style="color: #D73A49">*</span><span style="color: #24292E">ans)</span><span style="color: #D73A49">%</span><span style="color: #24292E">p;</span></span>
<span class="line"><span style="color: #24292E">        a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (a</span><span style="color: #D73A49">*</span><span style="color: #24292E">a)</span><span style="color: #D73A49">%</span><span style="color: #24292E">p;</span></span>
<span class="line"><span style="color: #24292E">        b</span><span style="color: #D73A49">&gt;&gt;=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ans;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="线性求逆元">线性求逆元</h2>
<p>对于求一连串数字模p的逆元，上两种方法容易超时，用这种方法更快一些</p>
<h3 id="结论-1">结论</h3>
<p>(证明见oi-wiki)</p>
<p>有递推式 <span class="math display">\[
i^{-1} \equiv
\left\{
    \begin{array}{**lr**}  
    1 &amp; i=1\\
    -\lfloor\frac{p}{i}\rfloor(p\bmod i)^{-1} &amp; i\neq1
    \end{array}
\right.
\]</span></p>
<h3 id="代码-1">代码</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">liner</span><span style="color: #24292E">(</span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #E36209">n</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #E36209">p</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  inv[</span><span style="color: #005CC5">1</span><span style="color: #24292E">]</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (ll i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    inv[i]</span><span style="color: #D73A49">=</span><span style="color: #24292E">(ll)(p</span><span style="color: #D73A49">-</span><span style="color: #24292E">p</span><span style="color: #D73A49">/</span><span style="color: #24292E">i)</span><span style="color: #D73A49">*</span><span style="color: #24292E">inv[p</span><span style="color: #D73A49">%</span><span style="color: #24292E">i]</span><span style="color: #D73A49">%</span><span style="color: #24292E">p;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="线性求任意逆元">线性求任意逆元</h3>
<p>首先我们求出n个数的前缀积<span
class="math inline">\(s_{i}\)</span>，这时我们可以用exgcd或费马小定理求出<span
class="math inline">\(s_{n}\)</span>的乘法逆元</p>
<p>又因为<span class="math inline">\((a\times b)^{-1}=a^{-1}\times
b^{-1}\)</span>，<span class="math inline">\(a\times
a^{-1}=1\)</span>，故我们可以将<span class="math inline">\(s_{n}\times
a_{n}\)</span>，<span
class="math inline">\(a_{n}\)</span>就会和其逆元抵消，以求出<span
class="math inline">\(s_{inv_{n-1}}\)</span></p>
<p>求出所有前缀积的逆元后，我们可以让前缀积的逆元乘i-1的前缀积来消除其他逆元，以得到<span
class="math inline">\(a_{i}\)</span>的逆元，即<span
class="math inline">\(s_{i-1}\times sv_{i}=a^{-1}_{i}\)</span></p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">s[</span><span style="color: #005CC5">0</span><span style="color: #24292E">]</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) s[i]</span><span style="color: #D73A49">=</span><span style="color: #24292E">s[i</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">]</span><span style="color: #D73A49">*</span><span style="color: #24292E">a[i]</span><span style="color: #D73A49">%</span><span style="color: #24292E">p;</span></span>
<span class="line"><span style="color: #24292E">sv[n]</span><span style="color: #D73A49">=</span><span style="color: #6F42C1">qpow</span><span style="color: #24292E">(s[n],p</span><span style="color: #D73A49">-</span><span style="color: #005CC5">2</span><span style="color: #24292E">);</span><span style="color: #6A737D"> // 也可以用exgcd</span></span>
<span class="line"><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> n;i</span><span style="color: #D73A49">&gt;=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">--</span><span style="color: #24292E">) sv[i</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">]</span><span style="color: #D73A49">=</span><span style="color: #24292E">sv[i]</span><span style="color: #D73A49">*</span><span style="color: #24292E">a[i]</span><span style="color: #D73A49">%</span><span style="color: #24292E">p;</span></span>
<span class="line"><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) inv[i]</span><span style="color: #D73A49">=</span><span style="color: #24292E">sv[i]</span><span style="color: #D73A49">*</span><span style="color: #24292E">s[i</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">]</span><span style="color: #D73A49">%</span><span style="color: #24292E">p;</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>数学</category>
      </categories>
      <tags>
        <tag>数学</tag>
        <tag>数论</tag>
      </tags>
  </entry>
  <entry>
    <title>【数据结构】队列</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E9%98%9F%E5%88%97/</url>
    <content><![CDATA[<h1 id="队列">队列</h1>
<h2 id="特点">特点</h2>
<ul>
<li>只允许在表的一端插入，而在另一端删除</li>
<li>允许插入的一端被称为队尾（rear），允许删除的一端被称为队头（front）</li>
<li>队列遵循<strong>先进先出（FIFO）</strong>的原则</li>
</ul>
<h2 id="顺序表实现">顺序表实现</h2>
<h3 id="建表">建表</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> ElemType;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">struct</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">  ElemType data[MAXSIZE];</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> front;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> rear;</span></span>
<span class="line"><span style="color: #24292E">}</span><span style="color: #6F42C1">Queue</span><span style="color: #24292E">;</span></span></code></pre></div></div></figure>
<h3 id="初始化">初始化</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">initQueue</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Queue</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">Q</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  Q-&gt;front </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  Q-&gt;rear </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="判空">判空</h3>
<p>判断首尾相遇即为空（并非为0）</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 判空</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">isEmpty</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Queue</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">Q</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (Q-&gt;front </span><span style="color: #D73A49">==</span><span style="color: #24292E"> Q-&gt;rear){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Empty&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="出队">出队</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 出队</span></span>
<span class="line"><span style="color: #6F42C1">ElemType</span><span style="color: #24292E"> </span><span style="color: #6F42C1">dequeue</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Queue</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">Q</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #6F42C1">isEmpty</span><span style="color: #24292E">(Q)){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Empty&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  } </span></span>
<span class="line"><span style="color: #24292E">  ElemType e </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Q-&gt;data[Q-&gt;front];</span></span>
<span class="line"><span style="color: #24292E">  Q-&gt;front</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> e;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="入队">入队</h3>
<p>队列不满时才能入队，但有一种特殊情况：</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E9%98%9F%E5%88%97/image-20250321142019294.png" class="" title="入队-1">
<p>此时队尾在最后，但队头在中间，意味着已经有数据出队，此时队列里仍有位置</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E9%98%9F%E5%88%97/image-20250321142256990.png" class="" title="入队-2">
<p>这时我们需要将数据移到队头，使队尾向前以便插入元素</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 判断队列是否满</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">queueFull</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Queue</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">Q</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (Q-&gt;front </span><span style="color: #D73A49">&gt;</span><span style="color: #005CC5">0</span><span style="color: #24292E">){</span><span style="color: #6A737D"> //说明front在中间，前面还有位置</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> step </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Q-&gt;front;</span><span style="color: #6A737D"> // 取front的位置</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Q-&gt;front; i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">Q-&gt;rear; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span><span style="color: #6A737D"> // 遍历已经有元素的位置</span></span>
<span class="line"><span style="color: #24292E">      Q-&gt;data[i</span><span style="color: #D73A49">-</span><span style="color: #24292E">step] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Q-&gt;data[i];</span><span style="color: #6A737D"> // 向前移动到头</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    Q-&gt;front </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 让front指向0</span></span>
<span class="line"><span style="color: #24292E">    Q-&gt;rear </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Q-&gt;rear </span><span style="color: #D73A49">-</span><span style="color: #24292E"> step;</span><span style="color: #6A737D"> // rear往前调整</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #6A737D">// 入队</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">enqueue</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Queue</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">Q</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ElemType</span><span style="color: #24292E"> </span><span style="color: #E36209">e</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (Q-&gt;rear </span><span style="color: #D73A49">&gt;=</span><span style="color: #24292E">MAXSIZE){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #6F42C1">queueFull</span><span style="color: #24292E">(Q)){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  Q-&gt;data[Q-&gt;rear] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> e;</span></span>
<span class="line"><span style="color: #24292E">  Q-&gt;rear</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>注意，该方法时间复杂度较大，对于大量数据可能效率会很低</p>
<h3 id="获取队头元素">获取队头元素</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 获取队头元素</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">getHead</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Queue</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">Q</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ElemType</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">e</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #6F42C1">isEmpty</span><span style="color: #24292E">(Q)){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Empty&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">*</span><span style="color: #24292E">e </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Q-&gt;data[Q-&gt;front];</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="动态分配内存">动态分配内存</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> ElemType;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">struct</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">  ElemType </span><span style="color: #D73A49">*</span><span style="color: #24292E">data;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> front;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> rear;</span></span>
<span class="line"><span style="color: #24292E">}</span><span style="color: #6F42C1">Queue</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 初始化队列</span></span>
<span class="line"><span style="color: #6F42C1">Queue</span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">initQueue</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Queue</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">Q</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  Queue </span><span style="color: #D73A49">*</span><span style="color: #24292E">q </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (Queue</span><span style="color: #D73A49">*</span><span style="color: #24292E">)</span><span style="color: #6F42C1">malloc</span><span style="color: #24292E">(</span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(Queue));</span></span>
<span class="line"><span style="color: #24292E">  q-&gt;data </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (ElemType)</span><span style="color: #6F42C1">malloc</span><span style="color: #24292E">(</span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(ElemType)</span><span style="color: #D73A49">*</span><span style="color: #24292E">MAXSIZE);</span></span>
<span class="line"><span style="color: #24292E">  Q-&gt;front </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  Q-&gt;rear </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> q;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="循环队列">循环队列</h2>
<p>循环队列可以避免整体移动位置的情况</p>
<p>即让front指向队头的前一个元素，rear指向队尾元素</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E9%98%9F%E5%88%97/image-20250325190247849.png" class="" title="循环队列">
<h3 id="入队-1">入队</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 入队</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">enqueue</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Queue</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">Q</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ElemType</span><span style="color: #24292E"> </span><span style="color: #E36209">e</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> ((Q-&gt;rear</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">)</span><span style="color: #D73A49">%</span><span style="color: #24292E">MAXSIZE </span><span style="color: #D73A49">==</span><span style="color: #24292E"> Q-&gt;front){</span><span style="color: #6A737D"> // 循环队列判满</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Full&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  Q-&gt;data[Q-&gt;rear] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> e;</span></span>
<span class="line"><span style="color: #24292E">  Q-&gt;rear </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (Q-&gt;rear</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">)</span><span style="color: #D73A49">%</span><span style="color: #24292E">MAXSIZE;</span><span style="color: #6A737D"> // 循环在队尾加1</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>取余保证在0到MAXSIZE-1的范围内循环下标</p>
<h3 id="填不满的循环队列">填不满的循环队列</h3>
<p>有这么一种情况：</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E9%98%9F%E5%88%97/image-20250325191758942.png" class="" title="循环队列的bug">
<p>在上次入队后，rear+1，队尾到达0位置</p>
<p>此时若再进行入队操作，首先判断<code>(Q-&gt;rear+1)%MAXSIZE</code>，结果为1，此时正好满足<code>rear==front</code>意为堆满</p>
<p>但实际上还留有一个位置，用于判断堆满（与队空区分），若不留空则队满与队空的判断条件一样，无法判断</p>
<h3 id="计算元素个数">计算元素个数</h3>
<ol type="1">
<li><strong>rear&gt;front</strong></li>
</ol>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E9%98%9F%E5%88%97/image-20250325193014057.png" class="" title="元素个数1">
<p>此时元素个数=<code>rear-front</code></p>
<ol start="2" type="1">
<li><strong>rear&gt;front</strong></li>
</ol>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E9%98%9F%E5%88%97/image-20250325193235681.png" class="" title="元素个数2">
<p>分两块计算：0到rear与front到maxsize</p>
<p>即元素个数=<code>rear+1+MAXSIZE-front-1</code>=<code>rear-front+MAXSIZE</code></p>
<p>综上，计算公式可以写作<code>(rear-front+MAXSIZE)%MAXSIZE</code></p>
<h3 id="另两种循环队列">另两种循环队列</h3>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E9%98%9F%E5%88%97/image-20250325194256752.png" class="" title="type1">
<p>此时front指向当前队头元素，rear指向队尾元素的后一个元素</p>
<p>队空：<code>front==rear</code></p>
<p>队满：<code>front=(rear+1)%MAXSIZE</code>，也要空出一个位置</p>
<p>元素个数：与上一种一样</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E9%98%9F%E5%88%97/image-20250325195911661.png" class="" title="type2">
<p>此时front指向队头元素，rear指向队尾元素</p>
<p>队空：<code>front=(rear+1)%MAXSIZE</code></p>
<p>入队情况有两种：</p>
<p>第一种是<strong>先入队再判满</strong></p>
<p>可以发现当<code>rear==front</code>时，队中有一个元素</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E9%98%9F%E5%88%97/image-20250325200400276.png" class="" title="full">
<p>为了留一个空位判断队空队满，所以当<code>front==(rear+2)%MAXSIZE</code>时有队满</p>
<p>元素个数：</p>
<ol type="1">
<li><p>rear&gt;front</p>
<p>此时元素个数=<code>rear-front+1</code></p></li>
<li><p>rear&lt;front</p></li>
</ol>
<p>​ 分两块讨论，0到rear与front到maxsize</p>
<p>​ 即元素个数=<code>rear+1+MAXSIZE-front</code></p>
<p>综上，元素个数=<code>(rear-front+1+MAXSIZE)%MAXSIZE</code></p>
<h2 id="链表实现">链表实现</h2>
<h3 id="构建队列">构建队列</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> ElemType;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">QueueNode</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  ElemType data;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">QueueNode</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E">next;</span></span>
<span class="line"><span style="color: #24292E">}</span><span style="color: #6F42C1">QueueNode</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Queue</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  QueueNode </span><span style="color: #D73A49">*</span><span style="color: #24292E">front;</span></span>
<span class="line"><span style="color: #24292E">  QueueNode </span><span style="color: #D73A49">*</span><span style="color: #24292E">rear;</span></span>
<span class="line"><span style="color: #24292E">}</span><span style="color: #6F42C1">Queue</span><span style="color: #24292E">;</span></span></code></pre></div></div></figure>
<p>这里多定义了一个结构体Queue，记录队头与队尾指针，而QueueNode为存储数据的链表</p>
<h3 id="初始化-1">初始化</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 初始化</span></span>
<span class="line"><span style="color: #6F42C1">Queue</span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">initQueue</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    Queue</span><span style="color: #D73A49">*</span><span style="color: #24292E"> q </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (Queue</span><span style="color: #D73A49">*</span><span style="color: #24292E">)</span><span style="color: #6F42C1">malloc</span><span style="color: #24292E">(</span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(Queue));</span></span>
<span class="line"><span style="color: #24292E">    QueueNode</span><span style="color: #D73A49">*</span><span style="color: #24292E"> node </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (QueueNode</span><span style="color: #D73A49">*</span><span style="color: #24292E">)</span><span style="color: #6F42C1">malloc</span><span style="color: #24292E">(</span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(QueueNode));</span><span style="color: #6A737D"> // 定义一个头节点</span></span>
<span class="line"><span style="color: #24292E">    node-&gt;data </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 头节点的data为0</span></span>
<span class="line"><span style="color: #24292E">    node-&gt;next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">NULL</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 空队列</span></span>
<span class="line"><span style="color: #24292E">    q-&gt;front </span><span style="color: #D73A49">=</span><span style="color: #24292E"> node;</span><span style="color: #6A737D"> // 队头指向头节点</span></span>
<span class="line"><span style="color: #24292E">    q-&gt;rear </span><span style="color: #D73A49">=</span><span style="color: #24292E"> node;</span><span style="color: #6A737D"> // 队尾指向头节点</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> q;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="入队-2">入队</h3>
<p>使用尾插法，此时认为队头为首节点，队尾为尾节点</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E9%98%9F%E5%88%97/image-20250325202418686.png" class="" title="链表实现-插入节点1">
<p>创建新节点</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E9%98%9F%E5%88%97/image-20250325202444945.png" class="" title="链表实现-插入节点2">
<p>让头节点的next指向该节点</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E9%98%9F%E5%88%97/image-20250325202513666.png" class="" title="链表实现-插入节点3">
<p>尾指针后移一位</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 入队</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">enqueue</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Queue</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">q</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ElemType</span><span style="color: #24292E"> </span><span style="color: #E36209">e</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  QueueNode</span><span style="color: #D73A49">*</span><span style="color: #24292E"> node </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (QueueNode</span><span style="color: #D73A49">*</span><span style="color: #24292E">)</span><span style="color: #6F42C1">malloc</span><span style="color: #24292E">(</span><span style="color: #D73A49">sizeof</span><span style="color: #24292E">(QueueNode));</span></span>
<span class="line"><span style="color: #24292E">  node-&gt;data </span><span style="color: #D73A49">=</span><span style="color: #24292E"> e;</span></span>
<span class="line"><span style="color: #24292E">  node-&gt;next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">NULL</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  q-&gt;rear-&gt;next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> node;</span><span style="color: #6A737D"> // 原来队尾指针指向节点的next指向新节点</span></span>
<span class="line"><span style="color: #24292E">  q-&gt;rear </span><span style="color: #D73A49">=</span><span style="color: #24292E"> node;</span><span style="color: #6A737D"> // 队尾指针移到新节点</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="出队-1">出队</h3>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E9%98%9F%E5%88%97/image-20250325203533196.png" class="" title="链表实现-出队1">
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E9%98%9F%E5%88%97/image-20250325203602101.png" class="" title="链表实现-出队2">
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 出队</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">dequeue</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Queue</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">q</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ElemType</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #E36209">e</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  QueueNode</span><span style="color: #D73A49">*</span><span style="color: #24292E"> node </span><span style="color: #D73A49">=</span><span style="color: #24292E"> q-&gt;front-&gt;next;</span><span style="color: #6A737D"> // 要删除的节点是头节点的后一个节点（对头结点）</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">*</span><span style="color: #24292E">e </span><span style="color: #D73A49">=</span><span style="color: #24292E"> node-&gt;data;</span><span style="color: #6A737D"> // 取出要删除的元素</span></span>
<span class="line"><span style="color: #24292E">  q-&gt;front-&gt;next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> node-&gt;next;</span><span style="color: #6A737D"> // 让头节点的下一个元素指向要删除节点的下一个元素</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (q-&gt;rear </span><span style="color: #D73A49">==</span><span style="color: #24292E"> node){</span><span style="color: #6A737D"> // 若只有一个节点（删除的是尾节点）</span></span>
<span class="line"><span style="color: #24292E">    q-&gt;rear </span><span style="color: #D73A49">==</span><span style="color: #24292E"> q-&gt;front;</span><span style="color: #6A737D"> // 讲队列设为空</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">free</span><span style="color: #24292E">(node);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="单调队列">单调队列</h2>
<p>假设有一个数组(如<code>[5,2,6,3,7,2,5,3]</code>)，使用滑动窗口，通过对l++,
r++实现让数字进入进出窗口</p>
<p>单调队列可以实现在滑动窗口每一时刻获得窗口中的
最大最小值，以低成本</p>
<p>单调队列通过双端队列实现，假设要求最大值，则双端队列从头到尾依次是从大到小，存储的是元素下标</p>
<p><strong>右侧拓展：</strong></p>
<p>队列为空时，第一个元素的下标进入(0-&gt;5)</p>
<p>若下一个元素进入满足严格从大到小，则进入，否则将最尾端元素弹出，直到满足从大到小</p>
<p><strong>左侧收缩：</strong></p>
<p>滑动窗口滑动，则不在指定范围内的下标从队头弹出</p>
<p>由此可以发现，每时最大值应为<strong>队头下标对应元素</strong></p>
<p><strong>How？</strong></p>
<p>单调队列维持了每次最值的可能性</p>
<p>满足严格从大到小的顺序的队列保证了在前一个元素从队头弹出的情况下，下一个元素成为最大值</p>
<p>由于窗口不回退，当更大的数进入时，前面比它小的数便没有机会成为某时刻的最大值了，故可以弹出</p>
<p><strong>时间复杂度：</strong>最坏<span
class="math inline">\(O(N)\)</span></p>
]]></content>
      <categories>
        <category>算法与数据结构</category>
      </categories>
      <tags>
        <tag>数据结构</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61B】HW2-Percolation</title>
    <url>/CS61B/HW2-Percolation/</url>
    <content><![CDATA[<h1 id="hw2-percolation">HW2-Percolation</h1>
<h2 id="要求">要求</h2>
<p>实现蒙特卡洛模拟下的渗透模拟</p>
<p>具体来说，给一个N*N的方格，可以将某些方格挖空，若从最顶层挖，则上方会有水流流下，并蔓延到相邻的空格中。</p>
<p>不同开放方格概率下，生成渗透（水流从上贯通到下）的概率不同</p>
<p>在<span class="math inline">\(N=100\)</span>下，开放方格概率<span
class="math inline">\(p*=0.593\)</span>时，渗透率出现突变，意味着在这之前几乎没有可以渗透的情况，在这之后几乎都是渗透的情况</p>
<p>作业要求使用模拟求出不同情况下<span
class="math inline">\(p*\)</span>的价值</p>
<img src="/CS61B/HW2-Percolation/image-20250819201133702.png" class="" title="概率">
<h2 id="percolation-class">Percolation class</h2>
<p>实现以下API</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Percolation</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">   </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Percolation</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">N</span><span style="color: #24292E">)                </span><span style="color: #6A737D">// create N-by-N grid, with all sites initially blocked</span></span>
<span class="line"><span style="color: #24292E">   </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">open</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">row</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">col</span><span style="color: #24292E">)       </span><span style="color: #6A737D">// open the site (row, col) if it is not open already</span></span>
<span class="line"><span style="color: #24292E">   </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">boolean</span><span style="color: #24292E"> </span><span style="color: #6F42C1">isOpen</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">row</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">col</span><span style="color: #24292E">)  </span><span style="color: #6A737D">// is the site (row, col) open?</span></span>
<span class="line"><span style="color: #24292E">   </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">boolean</span><span style="color: #24292E"> </span><span style="color: #6F42C1">isFull</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">row</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">col</span><span style="color: #24292E">)  </span><span style="color: #6A737D">// is the site (row, col) full?</span></span>
<span class="line"><span style="color: #24292E">   </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">numberOfOpenSites</span><span style="color: #24292E">()           </span><span style="color: #6A737D">// number of open sites</span></span>
<span class="line"><span style="color: #24292E">   </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">boolean</span><span style="color: #24292E"> </span><span style="color: #6F42C1">percolates</span><span style="color: #24292E">()              </span><span style="color: #6A737D">// does the system percolate?</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="the-weightedquickunionuf-class">The
<code>WeightedQuickUnionUF</code> class</h3>
<p>作业提供了一个带权并查集的类，实现以上API时必须要用到该并查集，接口如下：</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">WeightedQuickUnionUF</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">   </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">WeightedQuickUnionUF</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">n</span><span style="color: #24292E">)      </span><span style="color: #6A737D">// creates a UF with n elements</span></span>
<span class="line"><span style="color: #24292E">   </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">count</span><span style="color: #24292E">()                      </span><span style="color: #6A737D">// number of disjoint sets</span></span>
<span class="line"><span style="color: #24292E">   </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">find</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">p</span><span style="color: #24292E">)                  </span><span style="color: #6A737D">// the root of p&#39;s set</span></span>
<span class="line"><span style="color: #24292E">   </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">boolean</span><span style="color: #24292E"> </span><span style="color: #6F42C1">connected</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">p</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">q</span><span style="color: #24292E">)  </span><span style="color: #6A737D">// whether p and q are in the same set</span></span>
<span class="line"><span style="color: #24292E">   </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">union</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">p</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">q</span><span style="color: #24292E">)         </span><span style="color: #6A737D">// join p and q&#39;s sets together</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="backwash问题">backwash问题</h3>
<p>在试图使用一个并查集来维护连通性与是否填满时，出现了意料之外的bug</p>
<p>如图</p>
<img src="/CS61B/HW2-Percolation/image-20250820094512555.png" class="" title="bw1">
<p>此时B到N已经被打通，实现了渗透</p>
<img src="/CS61B/HW2-Percolation/image-20250820094542145.png" class="" title="bw2">
<p>这时打通LP，会发现程序也会将水填到这两块地方，因为在当前并查集中</p>
<ul>
<li>L与P相连，P与（虚拟）底部相连</li>
<li>B与F与J与N相连，N与（虚拟）底部相连</li>
<li>而两个（虚拟）底部是同一个，并查集会通过底部判断N与P相连</li>
</ul>
<p>这就不符合我们的要求了</p>
<p>为解决这个问题，我们选择再开一个并查集单独维护某格是否被填满的情况，这个并查集不会与（虚拟）底部相连，也就避免了与连通性混淆，具体的：在<code>row==size-1</code>时，不对新并查集进行合并</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">if</span><span style="color: #24292E">(row</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    uf.</span><span style="color: #6F42C1">union</span><span style="color: #24292E">(top,idx);</span></span>
<span class="line"><span style="color: #24292E">    ufFull.</span><span style="color: #6F42C1">union</span><span style="color: #24292E">(top, idx);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">if</span><span style="color: #24292E">(row</span><span style="color: #D73A49">==</span><span style="color: #24292E">size</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">) uf.</span><span style="color: #6F42C1">union</span><span style="color: #24292E">(bottom,idx);</span></span></code></pre></div></div></figure>
<p>以及判断时分开使用</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">boolean</span><span style="color: #24292E"> </span><span style="color: #6F42C1">isFull</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> row, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> col) {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #6F42C1">valid</span><span style="color: #24292E">(row, col)) </span><span style="color: #D73A49">throw</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IndexOutOfBoundsException</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E">(</span><span style="color: #D73A49">!</span><span style="color: #6F42C1">isOpen</span><span style="color: #24292E">(row,col)) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> idx </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">convert</span><span style="color: #24292E">(row, col);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ufFull.</span><span style="color: #6F42C1">connected</span><span style="color: #24292E">(top,idx);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="虚拟顶部底部问题">虚拟顶部/底部问题</h3>
<p>最初，本人使用0作为虚拟顶部，size-1作为虚拟底部，但这会造成下标的冲突</p>
<p>因为并查集中，对于每个坐标的idx是通过$ +
$计算的，可能会造成size-1或0与计算的格点坐标冲突以导致结果错误。</p>
<p>因此，需要将虚拟顶部与底部的值设置一个超出格点范围（0~size*size-1）的值，这里我们设置虚拟顶部为<span
class="math inline">\(\text{size}\times
\text{size}\)</span>，虚拟底部为<span
class="math inline">\(\text{size}\times \text{size}+1\)</span></p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">top </span><span style="color: #D73A49">=</span><span style="color: #24292E">size</span><span style="color: #D73A49">*</span><span style="color: #24292E">size;</span></span>
<span class="line"><span style="color: #24292E">bottom </span><span style="color: #D73A49">=</span><span style="color: #24292E"> size</span><span style="color: #D73A49">*</span><span style="color: #24292E">size</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span></code></pre></div></div></figure>
<h3 id="实例变量设置">实例变量设置</h3>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E">[][] grid; </span><span style="color: #6A737D">// 存储方格是被阻挡还是被挖空</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> open; </span><span style="color: #6A737D">// 存储挖空数量</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> size </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; </span><span style="color: #6A737D">// 记录尺寸</span></span>
<span class="line"><span style="color: #D73A49">private</span><span style="color: #24292E"> WeightedQuickUnionUF uf; </span><span style="color: #6A737D">// 记录是否渗透的并查集</span></span>
<span class="line"><span style="color: #D73A49">private</span><span style="color: #24292E"> WeightedQuickUnionUF ufFull; </span><span style="color: #6A737D">// 记录某格是否填满的并查集</span></span>
<span class="line"><span style="color: #D73A49">private</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E">[] dx </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span><span style="color: #005CC5">0</span><span style="color: #24292E">,</span><span style="color: #005CC5">0</span><span style="color: #24292E">,</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">private</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E">[] dy </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">0</span><span style="color: #24292E">,</span><span style="color: #005CC5">0</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #D73A49">private</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> top;</span></span>
<span class="line"><span style="color: #D73A49">private</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> bottom;</span></span></code></pre></div></div></figure>
<h3 id="构造函数">构造函数</h3>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Percolation</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> N) {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E">(N</span><span style="color: #D73A49">&lt;=</span><span style="color: #005CC5">0</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">throw</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IllegalArgumentException</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    grid </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E">[N][N];</span></span>
<span class="line"><span style="color: #24292E">    open </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    size </span><span style="color: #D73A49">=</span><span style="color: #24292E"> N;</span></span>
<span class="line"><span style="color: #24292E">    top </span><span style="color: #D73A49">=</span><span style="color: #24292E">size</span><span style="color: #D73A49">*</span><span style="color: #24292E">size;</span></span>
<span class="line"><span style="color: #24292E">    bottom </span><span style="color: #D73A49">=</span><span style="color: #24292E"> size</span><span style="color: #D73A49">*</span><span style="color: #24292E">size</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    uf </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">WeightedQuickUnionUF</span><span style="color: #24292E">(size</span><span style="color: #D73A49">*</span><span style="color: #24292E">size</span><span style="color: #D73A49">+</span><span style="color: #005CC5">2</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    ufFull </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">WeightedQuickUnionUF</span><span style="color: #24292E">(size</span><span style="color: #D73A49">*</span><span style="color: #24292E">size</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> N; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; j </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> N; j</span><span style="color: #D73A49">++</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">            grid[i][j] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>对并查集初始化，并设置虚拟顶部与底部，将数组初始化为全被阻挡的初始状态</p>
<h3 id="open">open</h3>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">open</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> row, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> col) {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #6F42C1">valid</span><span style="color: #24292E">(row, col)) </span><span style="color: #D73A49">throw</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IndexOutOfBoundsException</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #6F42C1">isOpen</span><span style="color: #24292E">(row, col)) </span><span style="color: #D73A49">return</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    grid[row][col] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    open</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> idx </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">convert</span><span style="color: #24292E">(row, col);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E">(row</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        uf.</span><span style="color: #6F42C1">union</span><span style="color: #24292E">(top,idx);</span></span>
<span class="line"><span style="color: #24292E">        ufFull.</span><span style="color: #6F42C1">union</span><span style="color: #24292E">(top, idx);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E">(row</span><span style="color: #D73A49">==</span><span style="color: #24292E">size</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">) uf.</span><span style="color: #6F42C1">union</span><span style="color: #24292E">(bottom,idx);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">4</span><span style="color: #24292E">;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">int</span><span style="color: #24292E"> nr </span><span style="color: #D73A49">=</span><span style="color: #24292E"> row</span><span style="color: #D73A49">+</span><span style="color: #24292E">dx[i];</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">int</span><span style="color: #24292E"> nc </span><span style="color: #D73A49">=</span><span style="color: #24292E"> col</span><span style="color: #D73A49">+</span><span style="color: #24292E">dy[i];</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E">(nr </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E"> </span><span style="color: #D73A49">||</span><span style="color: #24292E">nr</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">size</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #D73A49">||</span><span style="color: #24292E"> nc </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E"> </span><span style="color: #D73A49">||</span><span style="color: #24292E">nc</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">size</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">) </span><span style="color: #D73A49">continue</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #6F42C1">isOpen</span><span style="color: #24292E">(nr,nc)){</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">int</span><span style="color: #24292E"> tidx </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">convert</span><span style="color: #24292E">(nr,nc);</span></span>
<span class="line"><span style="color: #24292E">            uf.</span><span style="color: #6F42C1">union</span><span style="color: #24292E">(idx, tidx);</span></span>
<span class="line"><span style="color: #24292E">            ufFull.</span><span style="color: #6F42C1">union</span><span style="color: #24292E">(idx, tidx);</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>首先判断是否合法以及是否已经是开放</p>
<p>然后将该格标记为开放，并计算该格对应并查集idx</p>
<p>为了防止backwash，第一行都与顶部连通，而最后一行判断full的并查集不与底部连通</p>
<p>循环判断四个方位是否连通，若连通则在并查集标记</p>
<h3 id="isfull">isFull</h3>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">boolean</span><span style="color: #24292E"> </span><span style="color: #6F42C1">isFull</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> row, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> col) {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #6F42C1">valid</span><span style="color: #24292E">(row, col)) </span><span style="color: #D73A49">throw</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IndexOutOfBoundsException</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E">(</span><span style="color: #D73A49">!</span><span style="color: #6F42C1">isOpen</span><span style="color: #24292E">(row,col)) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> idx </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">convert</span><span style="color: #24292E">(row, col);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ufFull.</span><span style="color: #6F42C1">connected</span><span style="color: #24292E">(top,idx);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>判满使用单独的并查集，计算idx值并判断与顶部是否连通即可</p>
<h3 id="percolates">percolates</h3>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">boolean</span><span style="color: #24292E"> </span><span style="color: #6F42C1">percolates</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> uf.</span><span style="color: #6F42C1">connected</span><span style="color: #24292E">(top,bottom);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>判断是否渗透，用渗透并查集判断顶部与底部是否相连即可</p>
]]></content>
      <categories>
        <category>CS61B</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>CS61B</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61B】Lab2-Debugging</title>
    <url>/CS61B/Lab2-Debugging/</url>
    <content><![CDATA[<h1 id="lab2-debugging">Lab2-Debugging</h1>
<p>我们需要学会在idea中使用交互式的debug工具</p>
<p>在行号上点击以设置断点，当debug时，运行到断点处便会停止</p>
<p>设置断点后，点击debug按钮开始进行debug</p>
<p>此时在控制台处会有debugger窗口，在左侧可以看到当前的所有方法调用，在右侧可以看到程序当前点的实例变量值（它们也会在编辑器中以灰色文本显示）。对于类的实例，可以点击下拉菜单来展开它们并查看它们的字段。</p>
<p>有一些按钮可以进行操作：</p>
<img src="/CS61B/Lab2-Debugging/image-20250709210158266.png" class="" title="操作按钮">
]]></content>
      <categories>
        <category>CS61B</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>CS61B</tag>
      </tags>
  </entry>
  <entry>
    <title>【图论】邻接表</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E9%82%BB%E6%8E%A5%E8%A1%A8/</url>
    <content><![CDATA[<h2 id="邻接矩阵">邻接矩阵</h2>
<p>给如下一个有向图：</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E9%82%BB%E6%8E%A5%E8%A1%A8/image-20250413211606425.png" class="" title="例图">
<p>该图有四个节点，五条边。右侧表示了有向图的起点，终点以及边权</p>
<p>根据该图建立邻接矩阵：</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E9%82%BB%E6%8E%A5%E8%A1%A8/image-20250413211803839.png" class="" title="邻接矩阵">
<p>可以发现，邻接矩阵中许多位置并没有使用，故浪费了空间与时间</p>
<h2 id="邻接表">邻接表</h2>
<p>让起点与终点直接相连，而不考虑先后顺序</p>
<p>将终点和边权作为一个节点，按头插法插入每个起点位置，就构建了一个邻接表</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E9%82%BB%E6%8E%A5%E8%A1%A8/image-20250413212746653.png" class="" title="邻接表">
<h3 id="链表实现">链表实现</h3>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">node</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> x;</span><span style="color: #6A737D"> // 节点编号</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> w;</span><span style="color: #6A737D"> // 某个顶点到x的权值</span></span>
<span class="line"><span style="color: #24292E">  node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> next;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">node</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">x_</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">w_</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;x </span><span style="color: #D73A49">=</span><span style="color: #24292E"> x_;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">-&gt;w </span><span style="color: #D73A49">=</span><span style="color: #24292E"> w_;</span></span>
<span class="line"><span style="color: #24292E">    next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">nullptr</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">vector</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">node</span><span style="color: #D73A49">*&gt;</span><span style="color: #24292E"> head;</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">add_edge</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">u</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">v</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">w</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> head[u];</span><span style="color: #6A737D"> // 现在的头</span></span>
<span class="line"><span style="color: #24292E">  node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">node</span><span style="color: #24292E">(v,w);</span><span style="color: #6A737D"> // 建立新的节点</span></span>
<span class="line"><span style="color: #6A737D">  // 头插法</span></span>
<span class="line"><span style="color: #24292E">  b-&gt;next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a-&gt;next;</span></span>
<span class="line"><span style="color: #24292E">  a-&gt;next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> b;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> n, m;</span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> m;</span></span>
<span class="line"><span style="color: #24292E">  head.</span><span style="color: #6F42C1">resize</span><span style="color: #24292E">(n</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    head[i] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">node</span><span style="color: #24292E">(i,</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">m;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> u,v,w;</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> u </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> v </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> w;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">add_edge</span><span style="color: #24292E">(u,v,w);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 遍历</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    node</span><span style="color: #D73A49">*</span><span style="color: #24292E"> p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> head[i]-&gt;next;</span><span style="color: #6A737D"> // 从某个节点开始，指向其相邻节点并输出</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E">(p){</span></span>
<span class="line"><span style="color: #6A737D">      // 起点总是i，而i连接的所有节点均为其兄弟</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;(</span><span style="color: #005CC5">%d</span><span style="color: #032F62">, </span><span style="color: #005CC5">%d</span><span style="color: #032F62">, </span><span style="color: #005CC5">%d</span><span style="color: #032F62">)&quot;</span><span style="color: #24292E">,i,p-&gt;x,p-&gt;w);</span></span>
<span class="line"><span style="color: #24292E">      p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p-&gt;next;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="数组实现">数组实现</h3>
<p>建立四个数组</p>
<ul>
<li><code>edge[i]</code>：表示索引为i的边的终点，大小为m</li>
<li><code>next[i]</code>：表示索引为i的边的下一条兄
弟边的索引，大小为m</li>
<li><code>head[i]</code>：表示i的第一条边的索引，大小为n</li>
<li><code>weigh[i]</code>：表示索引为i的权重，大小为m</li>
</ul>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E9%82%BB%E6%8E%A5%E8%A1%A8/image-20250413215851485.png" class="" title="数组模拟空间">
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">vector</span><span style="color: #D73A49">&lt;int&gt;</span><span style="color: #24292E"> head, edge, Next, weight;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> idx </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span><span style="color: #6A737D"> // 表示边的索引</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">add_edge</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">u</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">v</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">w</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  edge[idx] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> v;</span></span>
<span class="line"><span style="color: #24292E">  weight[idx]</span><span style="color: #D73A49">=</span><span style="color: #24292E"> w;</span></span>
<span class="line"><span style="color: #24292E">  Next[idx] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> head[u];</span></span>
<span class="line"><span style="color: #24292E">  head[u]</span><span style="color: #D73A49">=</span><span style="color: #24292E">idx</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> n, m;</span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> m;</span></span>
<span class="line"><span style="color: #24292E">  head.</span><span style="color: #6F42C1">resize</span><span style="color: #24292E">(n</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  edge.</span><span style="color: #6F42C1">resize</span><span style="color: #24292E">(m</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  Next.</span><span style="color: #6F42C1">resize</span><span style="color: #24292E">(m</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  weight.</span><span style="color: #6F42C1">resize</span><span style="color: #24292E">(m</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">m;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> u,v,w;</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> u </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> v </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> w;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">add_edge</span><span style="color: #24292E">(u,v,w);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 遍历</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> head[i]; </span><span style="color: #D73A49">~</span><span style="color: #24292E">j; j</span><span style="color: #D73A49">=</span><span style="color: #24292E">Next[j]){</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">int</span><span style="color: #24292E"> u </span><span style="color: #D73A49">=</span><span style="color: #24292E"> i;</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">int</span><span style="color: #24292E"> v </span><span style="color: #D73A49">=</span><span style="color: #24292E"> edge[j];</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">int</span><span style="color: #24292E"> w </span><span style="color: #D73A49">=</span><span style="color: #24292E"> weight[j];</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">printf</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;(</span><span style="color: #005CC5">%d</span><span style="color: #032F62">, </span><span style="color: #005CC5">%d</span><span style="color: #032F62">, </span><span style="color: #005CC5">%d</span><span style="color: #032F62">)&quot;</span><span style="color: #24292E">, u, v, w);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    cout </span><span style="color: #D73A49">&lt;&lt;</span><span style="color: #24292E"> endl;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="链式前向星">链式前向星</h2>
<h3 id="图的多种表示">图的多种表示</h3>
<ol type="1">
<li>输入数据模式</li>
</ol>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">4 5</span></span>
<span class="line"><span style="color: #24292e">1 4 9</span></span>
<span class="line"><span style="color: #24292e">4 3 8</span></span>
<span class="line"><span style="color: #24292e">1 2 5</span></span>
<span class="line"><span style="color: #24292e">2 4 6</span></span>
<span class="line"><span style="color: #24292e">1 3 7</span></span></code></pre></div></div></figure>
<ol start="2" type="1">
<li>平面图</li>
<li>邻接矩阵</li>
<li>邻接表</li>
</ol>
<h3 id="数组实现-1">数组实现</h3>
<p>用一个数组与一个结构体：</p>
<ul>
<li>head数组，大小为顶点个数，保存边的下标，初始化为-1，表示从i出发没有边</li>
<li>edge结构体，大小为边个数，元素表示终点、距离与下一条边的位置</li>
</ul>
<p>如输入1 4 9，表示从1出发，终点为4，距离为9</p>
<p>检查是否有从1出发的边，没有(-1)，next改为-1，此时第一条边从1出发，将<code>head[1]=1</code></p>
<p>再输入4 3 8</p>
<p>检查是否有从4出发的边，没有(-1)，next改为-1，此时第二条边从4出发，将<code>head[4]=2</code></p>
<p>再输入1 2 5</p>
<p>检查是否有从1出发的边，<code>head[1]=1</code>，next改为1，此时第三条边也从1出发，将<code>head[1]=3</code></p>
<p>再输入2 4 6</p>
<p>检查是否有从2出发的边，没有(-1)，next改为-1，此时第四条边从2出发，将<code>head[2]=4</code></p>
<p>再输入1 3 7</p>
<p>检查是否有从1出发的边，<code>head[1]=3</code>，next改为3，此时第五条边也从1出发，将<code>head[1]=5</code></p>
<p>最终为<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E9%82%BB%E6%8E%A5%E8%A1%A8/image-20250417213030565.png" class="" title="前向星后"></p>
<p><strong>即实现了头插法</strong></p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">#include</span><span style="color: #24292E"> </span><span style="color: #032F62">&lt;bits/stdc++.h&gt;</span></span>
<span class="line"><span style="color: #D73A49">#define</span><span style="color: #24292E"> </span><span style="color: #6F42C1">endl</span><span style="color: #24292E"> &#39;\n&#39;</span></span>
<span class="line"><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">namespace</span><span style="color: #24292E"> </span><span style="color: #6F42C1">std</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> </span><span style="color: #D73A49">long</span><span style="color: #24292E"> ll;</span></span>
<span class="line"><span style="color: #D73A49">typedef</span><span style="color: #24292E"> pair</span><span style="color: #D73A49">&lt;int</span><span style="color: #24292E">,</span><span style="color: #D73A49">int&gt;</span><span style="color: #24292E"> PII;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> N </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #D73A49">e</span><span style="color: #005CC5">5</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> mod </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #D73A49">e</span><span style="color: #005CC5">9</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">7</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> n, m, s, u, v, w, cnt;</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> head[</span><span style="color: #005CC5">100005</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #D73A49">struct</span><span style="color: #24292E"> </span><span style="color: #6F42C1">edge</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> to, dis, nxt;</span></span>
<span class="line"><span style="color: #24292E">}edge[</span><span style="color: #005CC5">200005</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Add_edge</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">from</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">to</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">w</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  edge[</span><span style="color: #D73A49">++</span><span style="color: #24292E">cnt].to </span><span style="color: #D73A49">=</span><span style="color: #24292E"> to;</span></span>
<span class="line"><span style="color: #24292E">  edge[cnt].dis </span><span style="color: #D73A49">=</span><span style="color: #24292E"> w;</span></span>
<span class="line"><span style="color: #24292E">  edge[cnt].nxt </span><span style="color: #D73A49">=</span><span style="color: #24292E"> head[from];</span></span>
<span class="line"><span style="color: #24292E">  head[from]</span><span style="color: #D73A49">=</span><span style="color: #24292E">cnt;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">solve</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> n </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> m;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">fill</span><span style="color: #24292E">(head, head</span><span style="color: #D73A49">+</span><span style="color: #24292E">n</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> u </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> v </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> w;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">Add_edge</span><span style="color: #24292E">(u,v,w);</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #6A737D">  // 遍历</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> k </span><span style="color: #D73A49">=</span><span style="color: #24292E"> head[i];</span><span style="color: #D73A49">~</span><span style="color: #24292E">k;k </span><span style="color: #D73A49">=</span><span style="color: #24292E"> edge[k].nxt){</span></span>
<span class="line"><span style="color: #6A737D">      /*具体处理*/</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">()</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">ios</span><span style="color: #24292E">::</span><span style="color: #6F42C1">sync_with_stdio</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">); cin.</span><span style="color: #6F42C1">tie</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">); cout.</span><span style="color: #6F42C1">tie</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">int</span><span style="color: #24292E"> tomorin</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  cin </span><span style="color: #D73A49">&gt;&gt;</span><span style="color: #24292E"> tomorin;</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E"> (tomorin</span><span style="color: #D73A49">--</span><span style="color: #24292E">) </span><span style="color: #6F42C1">solve</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="十字链表">十字链表</h2>
<p>十字链表分为两部分：</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E9%82%BB%E6%8E%A5%E8%A1%A8/image-20250418204334524.png" class="" title="顶点节点">
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E9%82%BB%E6%8E%A5%E8%A1%A8/image-20250418204348032.png" class="" title="弧节点">
<p>顶点节点存储权值、入度(firstIn)与出度(firstOut)；弧节点存储弧尾顶点在顶点数组中的位置(tailVex)，弧头顶点在顶点数组中的位置(headVex)，指向弧头相同的下一条弧(hLink)，指向弧尾相同的下一条弧(tLink)与边权(Info)</p>
<p>每个节点组成了两个链表：以当前节点为弧头的弧组成的链表、以当前节点为弧尾的弧组成的链表</p>
<p>在寻找时<strong>自己找自己</strong>，即若为弧头组成链表，则依次寻找弧头相同的组成链表(firstIn-&gt;headVex)；若为弧尾组成链表，则依次寻找弧尾相同的组成链表(firstOut-&gt;tailVex)</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E9%82%BB%E6%8E%A5%E8%A1%A8/image-20250418215525320.png" class="" title="十字链表">
<h2 id="邻接多重表">邻接多重表</h2>
<p>邻接多重表分为两部分：</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E9%82%BB%E6%8E%A5%E8%A1%A8/image-20250418220625498.png" class="" title="邻接多重表">
<p>顶点节点存储权值与指向的第一条跟该顶点有关系的边</p>
<p>表节点：</p>
<ul>
<li>mark：标志域，标记某节点是否已经被操作过，例如遍历各节点时，为0表示还未遍历，为1表示遍历过</li>
<li>ivex与jvex：表示节点表示的边两端的顶点在数组中的位置下标</li>
<li>ilink与jlink：表示指向下一条与ivex，jvex相关的边</li>
<li>info：边的权值</li>
</ul>
<p>邻接多重表也遵循<strong>自己找自己</strong>，但比起十字链表更加灵活（两节点位置可互换），思路与十字链表类似</p>
<img src="/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E9%82%BB%E6%8E%A5%E8%A1%A8/image-20250418221004833.png" class="" title="邻接多重表">
]]></content>
      <categories>
        <category>算法与数据结构</category>
      </categories>
      <tags>
        <tag>数据结构</tag>
        <tag>图论</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61B】Lab6-BSTMap</title>
    <url>/CS61B/Lab6-BSTMap/</url>
    <content><![CDATA[<h1 id="lab6---bstmap">Lab6 - BSTMap</h1>
<p>实现以二叉搜索树为底层的Map</p>
<ul>
<li>该类需要有两个泛型K, V表示键值对</li>
<li>其中键K要是Comparable的实现</li>
</ul>
<h2 id="创建类">创建类</h2>
<p>创建实现文件并修改开头</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">BSTMap</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">K</span><span style="color: #24292E"> </span><span style="color: #D73A49">extends</span><span style="color: #24292E"> Comparable&lt;</span><span style="color: #D73A49">K</span><span style="color: #24292E">&gt;, </span><span style="color: #D73A49">V</span><span style="color: #24292E">&gt; </span><span style="color: #D73A49">implements</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Map61B</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">K</span><span style="color: #24292E">, </span><span style="color: #D73A49">V</span><span style="color: #24292E">&gt;</span></span></code></pre></div></div></figure>
<p>即BSTMap要是Map61B的实现，且泛型K是Comparable的extends</p>
<p>因为要实现一个二叉搜索树，故我们需要嵌套一个节点类用于储存数据</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">private</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">BSTNode</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    K key;</span></span>
<span class="line"><span style="color: #24292E">    V val;</span></span>
<span class="line"><span style="color: #24292E">    BSTNode l_child;</span></span>
<span class="line"><span style="color: #24292E">    BSTNode r_child;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> size;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">BSTNode</span><span style="color: #24292E">(K </span><span style="color: #E36209">k</span><span style="color: #24292E">, V </span><span style="color: #E36209">v</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        key </span><span style="color: #D73A49">=</span><span style="color: #24292E"> k;</span></span>
<span class="line"><span style="color: #24292E">        val </span><span style="color: #D73A49">=</span><span style="color: #24292E"> v;</span></span>
<span class="line"><span style="color: #24292E">        l_child </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">null</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        r_child </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">null</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        size </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>同时写构造函数</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">BSTMap</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    root </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">null</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #24292E">...</span></span>
<span class="line"><span style="color: #D73A49">private</span><span style="color: #24292E"> BSTNode root;</span></span>
<span class="line"><span style="color: #D73A49">private</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> size </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span></code></pre></div></div></figure>
<h2 id="size与clear">size()与clear()</h2>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">@</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">size</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> size;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">@</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">clear</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">    size </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    root </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">null</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>size即返回树的size，clear将树根置为null，且要把size置零</p>
<h2 id="put">put()</h2>
<p>实现放入节点</p>
<p>这里我们需要在根节点的基础上使用递归向下添加节点，具体可以创建一个递归辅助函数，传入每次准备插入的节点进行递归</p>
<ul>
<li>若传入节点为空节点，则创建一个新节点并传入键值，并将size+1表示多一个节点</li>
<li>若不为空，则比较当前节点的键与传入的键的大小
<ul>
<li>若小于，则按照BST的性质应该作为该节点的左子树，因此向左递归</li>
<li>若大于，则按照BST的性质应该作为该节点的右子树，因此向右递归</li>
<li>若相等，则更新键处的值为最新</li>
</ul></li>
<li>返回更新的节点</li>
</ul>
<p><strong>注意：这里的键不能直接比较，需要使用CompareTo函数</strong>，这也是继承Comparable类的作用</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">@</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">put</span><span style="color: #24292E">(K key, V value) {</span></span>
<span class="line"><span style="color: #24292E">    root </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">put_assist</span><span style="color: #24292E">(key, value, root);</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">private</span><span style="color: #24292E"> BSTNode </span><span style="color: #6F42C1">put_assist</span><span style="color: #24292E">(K key, V value, BSTNode N){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (N</span><span style="color: #D73A49">==</span><span style="color: #005CC5">null</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        size</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">BSTNode</span><span style="color: #24292E">(key, value);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (key.</span><span style="color: #6F42C1">compareTo</span><span style="color: #24292E">(N.key)</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">0</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        N.l_child </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">put_assist</span><span style="color: #24292E">(key, value, N.l_child);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (key.</span><span style="color: #6F42C1">compareTo</span><span style="color: #24292E">(N.key)</span><span style="color: #D73A49">&gt;</span><span style="color: #005CC5">0</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        N.r_child </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">put_assist</span><span style="color: #24292E">(key, value, N.r_child);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">        N.val </span><span style="color: #D73A49">=</span><span style="color: #24292E"> value;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D">//N.size = 1+ size(N.l_child) +size(N.r_child);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> N;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="get">get()</h2>
<p>同理，我们创建一个递归辅助函数，通过递归方法遍历左右子树，将给定的key与途径的节点比较</p>
<ul>
<li>若小于则向左子树递归查找</li>
<li>若大于则向右子树递归查找</li>
<li>若相等则说明找到对应键，返回对应值即可</li>
</ul>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">@</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> V </span><span style="color: #6F42C1">get</span><span style="color: #24292E">(K key) {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get_assist</span><span style="color: #24292E">(key, root);</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">private</span><span style="color: #24292E"> V </span><span style="color: #6F42C1">get_assist</span><span style="color: #24292E">(K key, BSTNode N){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (N</span><span style="color: #D73A49">==</span><span style="color: #005CC5">null</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">null</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (key.</span><span style="color: #6F42C1">compareTo</span><span style="color: #24292E">(N.key)</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">0</span><span style="color: #24292E">) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get_assist</span><span style="color: #24292E">(key, N.l_child);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (key.</span><span style="color: #6F42C1">compareTo</span><span style="color: #24292E">(N.key)</span><span style="color: #D73A49">&gt;</span><span style="color: #005CC5">0</span><span style="color: #24292E">) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get_assist</span><span style="color: #24292E">(key, N.r_child);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">return</span><span style="color: #24292E"> N.val;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="containskey">ContainsKey()</h2>
<p>判断map中是否含有指定的键</p>
<p>一开始的想法是直接调用get，但是问题是是否包含键与值没有关系，当键存在而值为空时，get返回的仍为null，会造成误判</p>
<p>故我们仿照get重新写一个辅助函数，但是返回布尔值，若键为空返回false，若找到对应键返回true</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">@</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">boolean</span><span style="color: #24292E"> </span><span style="color: #6F42C1">containsKey</span><span style="color: #24292E">(K key) {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">contains</span><span style="color: #24292E">(key, root);</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">private</span><span style="color: #24292E"> </span><span style="color: #D73A49">boolean</span><span style="color: #24292E"> </span><span style="color: #6F42C1">contains</span><span style="color: #24292E">(K key, BSTNode N){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (N</span><span style="color: #D73A49">==</span><span style="color: #005CC5">null</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (key.</span><span style="color: #6F42C1">compareTo</span><span style="color: #24292E">(N.key)</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">0</span><span style="color: #24292E">) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">contains</span><span style="color: #24292E">(key, N.l_child);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (key.</span><span style="color: #6F42C1">compareTo</span><span style="color: #24292E">(N.key)</span><span style="color: #D73A49">&gt;</span><span style="color: #005CC5">0</span><span style="color: #24292E">) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">contains</span><span style="color: #24292E">(key, N.r_child);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">true</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="iterator">Iterator()</h2>
<p>实现按序迭代<strong>键</strong>的功能</p>
<p>我们可以单独把键存入一个列表，并且返回该列表自带的迭代器</p>
<p>这时需要一个辅助函数遍历BST并取出所有键，而若要实现按序，我们采用中序遍历，这样可以保证比节点小的先放入，比节点大的后放入，实现有序</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> Iterator</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">K</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">iterator</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">    List&lt;</span><span style="color: #D73A49">K</span><span style="color: #24292E">&gt; iterKeys </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> ArrayList&lt;&gt;();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">iterMid</span><span style="color: #24292E">(root, iterKeys);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> iterKeys.</span><span style="color: #6F42C1">iterator</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">private</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">iterMid</span><span style="color: #24292E">(BSTNode N, List</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">K</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> Array){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (N</span><span style="color: #D73A49">==</span><span style="color: #005CC5">null</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">iterMid</span><span style="color: #24292E">(N.l_child, Array);</span></span>
<span class="line"><span style="color: #24292E">    Array.</span><span style="color: #6F42C1">add</span><span style="color: #24292E">(N.key);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">iterMid</span><span style="color: #24292E">(N.r_child, Array);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="keyset">KeySet()</h2>
<p><strong><em>暂时搁置</em></strong></p>
<h2 id="remove">remove()</h2>
<p>删除操作，仍采用递归逻辑</p>
<p>首先判断是否含有对应key，若没有直接返回null</p>
<p>若有则记录旧值，进行删除操作并返回旧值</p>
<p>删除通过辅助递归函数来进行：</p>
<ul>
<li>若进入函数已经是空节点，则返回null</li>
<li>否则比较传入键与每个节点（注意，这里要将return的节点赋值到对应子树上，这样才能算连上）
<ul>
<li>小于则向左边递归</li>
<li>大于则向右边递归</li>
<li>若等于则发现待删除节点</li>
</ul></li>
<li>找到后分情况进行删除
<ul>
<li>若本身为叶子节点，则直接置空</li>
<li>若有左孩子或有孩子，将其左孩子或右孩子直接替代当前节点即可</li>
<li>若都有，我们可以让一个辅助节点cur指向待删除节点左孩子，往下递归找到左孩子的最大节点，让要删除节点的右子树放在此时cur的右子树上，删除待删除节点，这样既能保持BST的性质又能实现删除</li>
</ul></li>
</ul>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">@</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> V </span><span style="color: #6F42C1">remove</span><span style="color: #24292E">(K key) {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #6F42C1">containsKey</span><span style="color: #24292E">(key)){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">null</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    V oldValue </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get</span><span style="color: #24292E">(key);</span></span>
<span class="line"><span style="color: #24292E">    root </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">remove_assist</span><span style="color: #24292E">(key, root);</span></span>
<span class="line"><span style="color: #24292E">    size</span><span style="color: #D73A49">--</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> oldValue;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">private</span><span style="color: #24292E"> BSTNode </span><span style="color: #6F42C1">remove_assist</span><span style="color: #24292E">(K key, BSTNode N){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (N </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">null</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">null</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (key.</span><span style="color: #6F42C1">compareTo</span><span style="color: #24292E">(N.key)</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">0</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        N.l_child </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">remove_assist</span><span style="color: #24292E">(key, N.l_child);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (key.</span><span style="color: #6F42C1">compareTo</span><span style="color: #24292E">(N.key)</span><span style="color: #D73A49">&gt;</span><span style="color: #005CC5">0</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        N.r_child </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">remove_assist</span><span style="color: #24292E">(key, N.r_child);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (key.</span><span style="color: #6F42C1">compareTo</span><span style="color: #24292E">(N.key)</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (N.l_child</span><span style="color: #D73A49">==</span><span style="color: #005CC5">null</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E"> N.r_child</span><span style="color: #D73A49">==</span><span style="color: #005CC5">null</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">null</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (N.l_child </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">null</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> N.r_child;</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (N.r_child </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">null</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> N.l_child;</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">else</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">            BSTNode cur </span><span style="color: #D73A49">=</span><span style="color: #24292E"> N.l_child;</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">while</span><span style="color: #24292E">(cur.r_child</span><span style="color: #D73A49">!=</span><span style="color: #005CC5">null</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">                cur </span><span style="color: #D73A49">=</span><span style="color: #24292E"> cur.r_child;</span></span>
<span class="line"><span style="color: #24292E">            }</span></span>
<span class="line"><span style="color: #24292E">            cur.r_child </span><span style="color: #D73A49">=</span><span style="color: #24292E"> N.r_child;</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> cur;</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> N;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>CS61B</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>CS61B</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61B】Lec10-Iterators, Object Methods</title>
    <url>/CS61B/Lec10%20-%20Iterators,%20Object%20Methods/</url>
    <content><![CDATA[<h1 id="lec10---iterators-object-methods">Lec10 - Iterators, Object
Methods</h1>
<h2 id="iterators">Iterators</h2>
<p>使用迭代器可以让自己的数据类型可以被迭代（支持for-each loop）</p>
<ul>
<li>需要让对应类实现<code>Iterable</code>接口</li>
<li>具有<code>Iterator</code>方法来返回迭代器对象（实现一个嵌套类）</li>
<li>迭代器需要具有<code>hasNext()</code>和<code>next()</code>方法</li>
</ul>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">package</span><span style="color: #24292E"> </span><span style="color: #B31D28; font-style: italic">L</span><span style="color: #24292E">ec10;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">import</span><span style="color: #24292E"> java.util.Iterator;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ArraySet</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">T</span><span style="color: #24292E">&gt; </span><span style="color: #D73A49">implements</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Iterable</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">T</span><span style="color: #24292E">&gt; {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">private</span><span style="color: #24292E"> </span><span style="color: #D73A49">T</span><span style="color: #24292E">[] items;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">private</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> size;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ArraySet</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">        items </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #D73A49">T</span><span style="color: #24292E">[]) </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #D73A49">Object</span><span style="color: #24292E">[</span><span style="color: #005CC5">100</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #24292E">        size </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">private</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ArraySetIterator</span><span style="color: #24292E"> </span><span style="color: #D73A49">implements</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Iterator</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">T</span><span style="color: #24292E">&gt;{</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">private</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> pos;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">ArraySetIterator</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">            pos </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        @</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">boolean</span><span style="color: #24292E"> </span><span style="color: #6F42C1">hasNext</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (pos</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">size){</span></span>
<span class="line"><span style="color: #24292E">                </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">true</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">            }</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">        @</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">public</span><span style="color: #24292E"> T </span><span style="color: #6F42C1">next</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">            T itemToReturn </span><span style="color: #D73A49">=</span><span style="color: #24292E"> items[pos];</span></span>
<span class="line"><span style="color: #24292E">            pos</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> itemToReturn;</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> Iterator&lt;</span><span style="color: #D73A49">T</span><span style="color: #24292E">&gt; </span><span style="color: #6F42C1">iterator</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ArraySetIterator</span><span style="color: #24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>（注：仅有迭代器部分，没有其他具体实现）</p>
<h2 id="object-method">Object Method</h2>
<p>Java中所有类都是Object的子类</p>
<h3 id="tostring">toString()</h3>
<p>给予一个object的字符串表示</p>
<p>println方法也调用了toString()方法</p>
<p>该方法类似于python中的repr方法，可以给类一个自定义的字符串输出形式</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">@</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> String </span><span style="color: #6F42C1">toString</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    StringBuilder stringToReturn </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">StringBuilder</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;{&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E">(T x</span><span style="color: #D73A49">:</span><span style="color: #24292E"> </span><span style="color: #005CC5">this</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        stringToReturn.</span><span style="color: #6F42C1">append</span><span style="color: #24292E">(x);</span></span>
<span class="line"><span style="color: #24292E">        stringToReturn.</span><span style="color: #6F42C1">append</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;, &quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    stringToReturn.</span><span style="color: #6F42C1">append</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;}&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> stringToReturn.</span><span style="color: #6F42C1">toString</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="this">this</h3>
<p>this是当前对象的一个引用，可以使用this来访问自己的实例变量和方法</p>
<p>但java中this是不必须的</p>
<p>若方法中的局部变量和实例变量重名，此时必须要用this加以区分</p>
<h3 id="equals">equals()</h3>
<p>equals()方法通过判断两个对象的地址来判断是否相同</p>
<p>当然，可以通过重写方法来改变其他判断相同的方法</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">@</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">boolean</span><span style="color: #24292E"> </span><span style="color: #6F42C1">equals</span><span style="color: #24292E">(Object o){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (o </span><span style="color: #D73A49">instanceof</span><span style="color: #24292E"> ArraySet uSet){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #005CC5">this</span><span style="color: #24292E">.size </span><span style="color: #D73A49">!=</span><span style="color: #24292E"> uSet.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">()){</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (T x</span><span style="color: #D73A49">:</span><span style="color: #24292E"> </span><span style="color: #005CC5">this</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">uSet.</span><span style="color: #6F42C1">contains</span><span style="color: #24292E">(x)){</span></span>
<span class="line"><span style="color: #24292E">                </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">            }</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">true</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>其中，关键字<code>A instanceof B</code>的用处如下</p>
<ul>
<li>检查o是否指向类B，若不是返回false</li>
<li>若是，返回true并将A作为B类并命名为B后面的名字</li>
<li>o是null也可以运行</li>
</ul>
]]></content>
      <categories>
        <category>CS61B</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>CS61B</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61B】Lec13-Asymptotics II</title>
    <url>/CS61B/Lec13%20-%20Asymptotics%20II/</url>
    <content><![CDATA[<h1 id="lec13---asymptotics-ii">Lec13 - Asymptotics II</h1>
<h2 id="大theta">大<span class="math inline">\(\Theta\)</span></h2>
<p>对于一个表达运行时间的式子<span class="math inline">\(R(N)\in
\Theta(f(N))\)</span></p>
<p>意味着存在两个整数<span class="math inline">\(k_1\)</span>与<span
class="math inline">\(k_2\)</span>使得<span
class="math inline">\(k_1\cdot f(N)\leq R(N)\leq k_2 \cdot
f(N)\)</span></p>
<p>对于所有<span class="math inline">\(N\geq N_0\)</span></p>
<p>常用该表示法描述函数的增长顺序与运行时长的增长率</p>
<h2 id="大o">大O</h2>
<p><span class="math inline">\(R(N)\in O(f(N))\)</span></p>
<p>意味着存在整数与<span class="math inline">\(k_2\)</span>使得<span
class="math inline">\(R(N)\leq k_2 \cdot f(N)\)</span></p>
<p>对于所有<span class="math inline">\(N\geq N_0\)</span></p>
<p>即大O表示仅被上界约束，描述小于等于<span
class="math inline">\(f(N)\)</span></p>
<h2 id="大omega">大<span class="math inline">\(\Omega\)</span></h2>
<p><span class="math inline">\(R(N)\in \Omega(f(N))\)</span></p>
<p>意味着存在两个整数<span class="math inline">\(k_1\)</span>与<span
class="math inline">\(k_2\)</span>使得<span
class="math inline">\(k_1\cdot f(N)\leq R(N)\)</span></p>
<p>对于所有<span class="math inline">\(N\geq N_0\)</span></p>
<p>常用该表示法描述函数的增长顺序与</p>
<p>即大<span
class="math inline">\(\Omega\)</span>表示仅被下界约束，描述大于等于<span
class="math inline">\(f(N)\)</span></p>
<h2 id="关系证明">关系证明</h2>
<blockquote>
<p>证明若<span class="math inline">\(f(x)\in O(g(x))\)</span>且<span
class="math inline">\(f(x)\in \Omega(g(x))\)</span>，则<span
class="math inline">\(f(x)\in \Theta(g(x))\)</span></p>
</blockquote>
<img src="/CS61B/Lec13%20-%20Asymptotics%20II/image-20250721195208102.png" class="" title="证明">
<h2 id="另一种表示形式">另一种表示形式</h2>
<p>将<span class="math inline">\(g(x)\)</span>除到<span
class="math inline">\(f(x)\)</span>下面，有<span
class="math inline">\(a\leq \frac{f(x)}{g(x)}\leq b\)</span></p>
<ul>
<li><p>若<span
class="math inline">\(\frac{f(x)}{g(x)}\)</span>有上界，则<span
class="math inline">\(f(x)\in O(g(x))\)</span></p></li>
<li><p>若<span
class="math inline">\(\frac{f(x)}{g(x)}\)</span>有下界，则<span
class="math inline">\(f(x)\in \Omega(g(x))\)</span></p></li>
<li><p>若<span
class="math inline">\(\frac{f(x)}{g(x)}\)</span>有界，则<span
class="math inline">\(f(x)\in \Theta(g(x))\)</span></p></li>
</ul>
]]></content>
      <categories>
        <category>CS61B</category>
      </categories>
      <tags>
        <tag>算法</tag>
        <tag>Java</tag>
        <tag>CS61B</tag>
      </tags>
  </entry>
  <entry>
    <title>【数学】裴蜀定理</title>
    <url>/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E8%A3%B4%E8%9C%80%E5%AE%9A%E7%90%86/</url>
    <content><![CDATA[<h1 id="裴蜀定理">裴蜀定理</h1>
<h2 id="内容">内容</h2>
<p>若a和b是不全为0的整数，则有整数x、y使得<span
class="math inline">\(ax+by=\gcd(a,b)\)</span></p>
<p>即a、b的最大公约数=ax+by，随意给定x、y能得到的最小正数差值</p>
<h2 id="推论">推论</h2>
<ul>
<li>如果a和b是不全为0的整数，a与b互质，当且仅当存在整数x、y，使得<span
class="math inline">\(ax+by=1\)</span></li>
<li>如果a和b是不全为0的整数，并且<span
class="math inline">\(ax+by=c\)</span>有解，那么c一定是<span
class="math inline">\(\gcd(a,b)\)</span>的整数倍</li>
<li>a和b两项的裴蜀定理可以推广到多项的情况</li>
</ul>
<h2 id="扩展欧几里得算法">扩展欧几里得算法</h2>
<p>对于方程<span
class="math inline">\(ax+by=\gcd(a,b)\)</span>，当a和b确定，那么<span
class="math inline">\(\gcd(a,b)\)</span>也确定，保证入参a和b没有负数</p>
<p>扩展欧几里得算法可以给出a和b的最大公约数d以及其中一个特解x和y</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 扩展欧几里得算法</span></span>
<span class="line"><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">exgcd</span><span style="color: #24292E">(</span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">x</span><span style="color: #24292E">, </span><span style="color: #6F42C1">ll</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;</span><span style="color: #E36209">y</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (b</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    x</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E">,y</span><span style="color: #D73A49">=</span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">exgcd</span><span style="color: #24292E">(b,a</span><span style="color: #D73A49">%</span><span style="color: #24292E">b,y,x);</span></span>
<span class="line"><span style="color: #24292E">  y</span><span style="color: #D73A49">-=</span><span style="color: #24292E">a</span><span style="color: #D73A49">/</span><span style="color: #24292E">b</span><span style="color: #D73A49">*</span><span style="color: #24292E">x;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>时间复杂度：理论<span class="math inline">\(O(\log
\min(a,b))\)</span>，实际<span class="math inline">\(O((\log
\min(a,b))^3)\)</span></p>
]]></content>
      <categories>
        <category>数学</category>
      </categories>
      <tags>
        <tag>数学</tag>
        <tag>数论</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61B】Lab3-Debugging2</title>
    <url>/CS61B/Lab3-Debugging2/</url>
    <content><![CDATA[<h1 id="lab3-debugging2">Lab3-Debugging2</h1>
<p>给予项目Adventure来进行调试并修改代码</p>
<h2 id="学会阅读堆栈追踪">学会阅读堆栈追踪</h2>
<p>运行主方法后，会在某个位置抛出异常：</p>
<img src="/CS61B/Lab3-Debugging2/image-20250711184407241.png" class="" title="error1">
<p>一般作物类型会在报错第一行出现，如该处出现错误：<code>NullPointerException</code></p>
<p>对于这一类的异常，java也会抛出解释，这里指的是<code>this.input</code>为<code>null</code>，因此我们不能调用方法</p>
<p>下方表示程序引发错误时的方法调用序列：列表中的第一行是错误发生的位置，其下一行表示调用抛出错误方法的代码行，依此类推。</p>
<p>可以点击蓝色文本追踪到对应文件和方法行处</p>
<p><strong>注意：按照执行顺序，堆栈追踪第一行错误显示的应为发生错误时最后调用的方法，可以根据此来判断bug的位置等</strong></p>
<h2 id="debug-beecountingstage">Debug <code>BeeCountingStage</code></h2>
<p>根据错误信息发现，错误应该出现在<code>BeeCountingStage</code>中，我们跳入该类进行检查</p>
<p>此处抛出空指针的原因是<code>this.input</code>还是空指针，未被初始化，因此我们需要对input初始化</p>
<p>可以发现声明变量处代码为<code>private List&lt;String&gt; input;</code>，再看构造函数发现这两处均为对input初始化，故我们在构造函数中添加初始化代码<code>this.input = new ArrayList&lt;&gt;(0);</code>即可解决问题</p>
<p>第二个问题还是出现在该类中，错误类型为<code>IndexOutOfBoundsError</code></p>
<p>经检查，是<code>sumInput</code>函数中，for循环的终止条件多了等号，导致多访问了一位没有定义的位置</p>
<h2 id="debug-speciesliststage">Debug <code>SpeciesListStage</code></h2>
<p>错误类型为<code>/ by zero</code>，跟踪到函数<code>arraySimilarity</code></p>
<p>发现在return处计算相似度时，若询问结束，还会传入一次空字符串，即listOne的size为0，导致除以0的错误发生</p>
<p>所以若传入的是空字符串，我们需要特定的返回0</p>
<h2 id="debug-palindromestage">Debug <code>PalindromeStage</code></h2>
<p>错误类型：<code>Index 3 out of bounds for length 3</code></p>
<p>我们进入类<code>PalindromeStage</code>，根据IDEA的warning提示，来到函数<code>digitsToIntList</code></p>
<p>容易发现第一个bug出在for循环中，对计数器i的操作有误，此处为反向遍历，i应该自减</p>
<p>第二个bug也在for循环中，对于s的下标，最后一位应该是<code>s.length()-1</code>，第一位应该是0，这样避免charAt方法出现异常</p>
<h2 id="debug-machinestage">Debug <code>MachineStage</code></h2>
<p>该机器的作用是将输入的两个等长数列的每位进行比较，选出每个下标中更大的那一位，并组成一个新数组并求和，但目前结果有误</p>
<p>第一个问题出在<code>mysteryMax</code>处，这里对b-a获得了两个掩码</p>
<ul>
<li>当 <code>b - a &gt;= 0</code> 时，<code>w</code> 为 0，</li>
<li>当 <code>b - a &lt; 0</code> 时，<code>w</code> 为 -1（即全 1）</li>
</ul>
<p>然后z为w的取反，获得的是相反结果，max的计算等价于</p>
<ul>
<li>若
<code>b &gt;= a</code>：<code>w = 0</code>，<code>z = -1</code>，结果为
<code>(b &amp; 0) | (a &amp; -1)</code>，返回 <code>a</code></li>
<li>若
<code>b &lt; a</code>：<code>w = -1</code>，<code>z = 0</code>，结果为
<code>(b &amp; -1) | (a &amp; 0)</code>，返回 <code>b</code></li>
</ul>
<p>因此这里返回的是最小值，而非最大值，应该将z与w对调</p>
<p>第二个问题出在<code>arraySum</code>处，这里要求数组最大值之和</p>
<p>但代码行<code>sum = sum + mysteryAdd(sum, x[i]);</code>明显多加了一个sum，因为<code>mysteryAdd</code>中已经执行了相加操作并返回和，应该删除一个</p>
]]></content>
      <categories>
        <category>CS61B</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>CS61B</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61B】Lec15-Disjoint Sets</title>
    <url>/CS61B/Lec15%20-%20Disjoint%20Sets/</url>
    <content><![CDATA[<h1 id="lec15---disjoint-sets">Lec15 - Disjoint Sets</h1>
<p>解决连通性问题</p>
<p>较好的方法是只需要记录每个相连元素属于哪个集合，至于如何连接不必关心</p>
<h2 id="数据结构的选择">数据结构的选择</h2>
<h3 id="sets">sets</h3>
<img src="/CS61B/Lec15%20-%20Disjoint%20Sets/image-20250725201031703.png" class="" title="set">
<p>过于复杂并且耗时高</p>
<h3 id="arrays">arrays</h3>
<p>另一个想法是：起始将每个元素设置为不同id，只需要记录每个元素所在集合的id，连通只需要将该元素所在集合id改变为目标id即可；检查是否连通只需要检查id是否一致</p>
<p>时间复杂度：</p>
<img src="/CS61B/Lec15%20-%20Disjoint%20Sets/image-20250725201043534.png" class="" title="arrays">
<p>连通方法复杂度还是高了一些</p>
<h3 id="trees">trees</h3>
<p>想法是：给每一个元素分配一个父节点来代替id</p>
<ul>
<li><p>对于连通操作：可以找到要连通的两个集合的根节点，将一个的根节点设置为另一个</p></li>
<li><p>对于检查连通操作：从待检查节点向上寻找父节点，一直找到根节点看是否相同即可</p></li>
</ul>
<p>操作本质即寻根并操作根节点</p>
<p>时间复杂度：</p>
<img src="/CS61B/Lec15%20-%20Disjoint%20Sets/image-20250725201852805.png" class="" title="trees">
<h2 id="优化树结构">优化树结构</h2>
<p>我们需要最小化树高</p>
<ul>
<li>将较短的树连接到较长的树下</li>
<li>若高度相同，则需要打破相同</li>
</ul>
<p>规定：总是将更小的树根连接到更大的树上</p>
<p>注意：使用权重衡量才能最小化平均步数，而使用高度衡量只能最小化最坏步数</p>
<p>时间复杂度：</p>
<img src="/CS61B/Lec15%20-%20Disjoint%20Sets/image-20250725204030644.png" class="" title="goodtree">
<p>再次进行优化：</p>
<p>查找后将所有节点都连接到根节点上，这样再次查找不必再遍历</p>
<p>这样，随着操作继续，我们的树会变得越来越矮，直到树高为1，这样所有操作都很快</p>
<img src="/CS61B/Lec15%20-%20Disjoint%20Sets/image-20250725205429211.png" class="" title="bettter">
<p>其中<span
class="math inline">\(\alpha(N)\)</span>为逆阿克曼函数，该函数的增长速度特别缓慢，对于具有意义的值x，<span
class="math inline">\(\alpha(x)\)</span>的值始终不大于4，故可以看作常数时间</p>
]]></content>
      <categories>
        <category>CS61B</category>
      </categories>
      <tags>
        <tag>数据结构</tag>
        <tag>Java</tag>
        <tag>CS61B</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61B】Lec16-Extends, Sets, Maps, and BSTs</title>
    <url>/CS61B/Lec16%20-%20Extends,%20Sets,%20Maps,%20and%20BSTs/</url>
    <content><![CDATA[<h1 id="lec16---extends-sets-maps-and-bsts">Lec16 - Extends, Sets, Maps,
and BSTs</h1>
<h2 id="extends">Extends</h2>
<p>从前，若一个类是接口的下位词，我们使用<code>implements</code>来书写方法的实现</p>
<p>但若想实现一个类是另一个类的下位词，我们需要使用<code>extends</code></p>
<p>extends可以用于类与类、接口与接口之间</p>
<h3 id="例实现rotatingsllist">例：实现RotatingSLList</h3>
<p>即让最后一个元素右旋到第一个元素</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">package</span><span style="color: #24292E"> </span><span style="color: #B31D28; font-style: italic">L</span><span style="color: #24292E">ec16;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">RotatingSLList</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">Item</span><span style="color: #24292E">&gt; </span><span style="color: #D73A49">extends</span><span style="color: #24292E"> </span><span style="color: #6F42C1">SLList</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">Item</span><span style="color: #24292E">&gt; {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">rotateRight</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">        Item x </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">removeLast</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">addFirst</span><span style="color: #24292E">(x);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(</span><span style="color: #D73A49">String</span><span style="color: #24292E">[] </span><span style="color: #E36209">args</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        RotatingSLList&lt;</span><span style="color: #D73A49">Integer</span><span style="color: #24292E">&gt; rsl </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> RotatingSLList&lt;&gt;();</span></span>
<span class="line"><span style="color: #24292E">        rsl.</span><span style="color: #6F42C1">addLast</span><span style="color: #24292E">(</span><span style="color: #005CC5">10</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        rsl.</span><span style="color: #6F42C1">addLast</span><span style="color: #24292E">(</span><span style="color: #005CC5">11</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        rsl.</span><span style="color: #6F42C1">addLast</span><span style="color: #24292E">(</span><span style="color: #005CC5">12</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        rsl.</span><span style="color: #6F42C1">addLast</span><span style="color: #24292E">(</span><span style="color: #005CC5">13</span><span style="color: #24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">        rsl.</span><span style="color: #6F42C1">rotateRight</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">        rsl.</span><span style="color: #6F42C1">print</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>extends继承了SLList中的所有成员：</p>
<ul>
<li>所有实例与静态变量</li>
<li>所有方法（除了构造函数）</li>
<li>所有嵌套类</li>
</ul>
<p>但若成员是私有的就无法访问了</p>
<h3 id="例实现vengefulsllist">例：实现VengefulSLList</h3>
<p>记录被删除的元素</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">package</span><span style="color: #24292E"> </span><span style="color: #B31D28; font-style: italic">L</span><span style="color: #24292E">ec16;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">import</span><span style="color: #24292E"> java.util.ArrayList;</span></span>
<span class="line"><span style="color: #D73A49">import</span><span style="color: #24292E"> java.util.List;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">VengefulSLList</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">Item</span><span style="color: #24292E">&gt; </span><span style="color: #D73A49">extends</span><span style="color: #24292E"> </span><span style="color: #6F42C1">SLList</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">Item</span><span style="color: #24292E">&gt;{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">private</span><span style="color: #24292E"> SLList&lt;</span><span style="color: #D73A49">Item</span><span style="color: #24292E">&gt; deletedItems ;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">VengefulSLList</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">        deletedItems </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> SLList&lt;</span><span style="color: #D73A49">Item</span><span style="color: #24292E">&gt;();</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    @</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> Item </span><span style="color: #6F42C1">removeLast</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">        Item removedItem </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">super</span><span style="color: #24292E">.</span><span style="color: #6F42C1">removeLast</span><span style="color: #24292E">(); </span><span style="color: #6A737D">// 使用父类的方法</span></span>
<span class="line"><span style="color: #24292E">        deletedItems.</span><span style="color: #6F42C1">addLast</span><span style="color: #24292E">(removedItem);</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> removedItem;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">printLostItems</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">        deletedItems.</span><span style="color: #6F42C1">print</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(</span><span style="color: #D73A49">String</span><span style="color: #24292E">[] </span><span style="color: #E36209">args</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        VengefulSLList&lt;</span><span style="color: #D73A49">Integer</span><span style="color: #24292E">&gt; vsl </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> VengefulSLList&lt;&gt;();</span></span>
<span class="line"><span style="color: #24292E">        vsl.</span><span style="color: #6F42C1">addLast</span><span style="color: #24292E">(</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        vsl.</span><span style="color: #6F42C1">addLast</span><span style="color: #24292E">(</span><span style="color: #005CC5">5</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        vsl.</span><span style="color: #6F42C1">addLast</span><span style="color: #24292E">(</span><span style="color: #005CC5">10</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        vsl.</span><span style="color: #6F42C1">addLast</span><span style="color: #24292E">(</span><span style="color: #005CC5">15</span><span style="color: #24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">        vsl.</span><span style="color: #6F42C1">removeLast</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">        vsl.</span><span style="color: #6F42C1">removeLast</span><span style="color: #24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">        vsl.</span><span style="color: #6F42C1">printLostItems</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>这里我们实现了对继承方法的重写</p>
<p>其中，我们可以使用<code>super</code>来调用父类中的方法</p>
<h2 id="bst">BST</h2>
<h3 id="随机表">随机表</h3>
<p>链表的搜索效率较慢，我们可以在不同节点间随机额外添加一些链接，这样可以依赖随机性获得更好的效率</p>
<h3 id="二叉搜索树的原理">二叉搜索树的原理</h3>
<p>若我们将每次搜索都折半，就能大幅提高效率，一个链表可以进行如下改造：</p>
<style>.yxddhsbahyac{zoom:67%;}</style>
<img src="/CS61B/Lec16%20-%20Extends,%20Sets,%20Maps,%20and%20BSTs/image-20250729203948925.png" class="yxddhsbahyac" alt="BST">
<p>这是一棵二叉搜索树</p>
<p>二叉搜索树是一个有根的二叉树，对于书中的每个节点</p>
<ul>
<li>左子树中的每个节点的值都小于该节点的值</li>
<li>右子树中的每个节点的值都大于该节点的值</li>
</ul>
<style>.uiuxqbncgeqm{zoom:50%;}</style>
<img src="/CS61B/Lec16%20-%20Extends,%20Sets,%20Maps,%20and%20BSTs/image-20250729204424840.png" class="uiuxqbncgeqm" alt="BST">
<h3 id="寻找特定元素">寻找特定元素</h3>
<ul>
<li>若待寻找元素等于当前元素，返回</li>
<li>若待寻找元素小于当前元素，前往左子树寻找</li>
<li>若待寻找元素大于当前元素，前往右子树寻找</li>
</ul>
<p>时间复杂度：<span class="math inline">\(\Theta(\log n)\)</span></p>
<p>因此搜索一颗完全BST的速度是很快的</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">static</span><span style="color: #24292E"> BST </span><span style="color: #6F42C1">find</span><span style="color: #24292E">(BST T, key sk){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (T</span><span style="color: #D73A49">==</span><span style="color: #005CC5">null</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">null</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (sk.</span><span style="color: #6F42C1">equals</span><span style="color: #24292E">(T.key))</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> T;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (sk</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">T.key)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">find</span><span style="color: #24292E">(T.left, sk);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">find</span><span style="color: #24292E">(T.right, sk);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="添加元素">添加元素</h3>
<p>首先寻找待插入元素</p>
<ul>
<li>若找到了就不进行操作</li>
<li>若没找到
<ul>
<li>创建一个新节点</li>
<li>创建合适链接</li>
</ul></li>
</ul>
<p>使用递归书写</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">static</span><span style="color: #24292E"> BST </span><span style="color: #6F42C1">insert</span><span style="color: #24292E">(BST T, key ik){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (T</span><span style="color: #D73A49">==</span><span style="color: #005CC5">null</span><span style="color: #24292E">) </span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">BST</span><span style="color: #24292E">(ik);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (ik</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">T.key)</span></span>
<span class="line"><span style="color: #24292E">        T.left </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">insert</span><span style="color: #24292E">(T.left, ik);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (ik</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">T.key)</span></span>
<span class="line"><span style="color: #24292E">        T.right </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">insert</span><span style="color: #24292E">(T.right, ik);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> T;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="删除元素">删除元素</h3>
<p><strong>删除没有孩子的节点：</strong></p>
<p>直接删除，即将其父节点对应的左/右节点置空</p>
<p><strong>删除一个孩子的节点：</strong></p>
<p>要在维持BST性质的前提下删除：可以发现该节点的孩子一定大于（右侧）或小于（左侧）该节点</p>
<p>故我们可以寻找该节点的孩子，将指向它的节点指向他的孩子即可</p>
<p><strong>删除两个孩子的节点：</strong></p>
<p>找到左子树最大的节点或右子树最小的节点，替代待删除节点即可</p>
]]></content>
      <categories>
        <category>CS61B</category>
      </categories>
      <tags>
        <tag>数据结构</tag>
        <tag>Java</tag>
        <tag>CS61B</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61B】Lec17-B-Trees</title>
    <url>/CS61B/Lec17%20-%20B-Trees/</url>
    <content><![CDATA[<h1 id="lec17---b-trees">Lec17 - B-Trees</h1>
<h2 id="bst-height">BST Height</h2>
<p>BST在最好情况与最坏情况下的树高，以及对应时间复杂度差异很大</p>
<ul>
<li>最好情况下（完全二叉树）为<span class="math inline">\(\Theta(\log
N)\)</span></li>
<li>最坏情况下（成链）为<span
class="math inline">\(\Theta(N)\)</span></li>
</ul>
<p>其中这两种描述是最具体的</p>
<h3 id="高度深度与平均深度">高度、深度与平均深度</h3>
<ul>
<li>节点深度指的是离根节点的距离</li>
<li>树的高度指的是最深的叶子节点的深度</li>
<li>平均深度指的是每个节点深度和的平均值</li>
</ul>
<p>如果我们随机向BST中插入或删除节点，可以发现这棵树具有<span
class="math inline">\(\Theta(\log N)\)</span>的平均深度与高度</p>
<h2 id="b-tree">B-Tree</h2>
<h3 id="思路">思路</h3>
<p>但是我们不能保证插入的节点是随机的，因此可能会导致BST逐渐偏向一边高</p>
<p>因此我们需要避免在底部添加过多的节点</p>
<p>我们可以将多个值放入同一个节点中，这样可以保证叶子的深度不发生改变</p>
<p>但我们为了寻找元素，需要遍历同一个节点的多个值，花费时间与形成列表的长度有关</p>
<p>我们可以设置一个长度限制，当一个节点中值的数量超过了限制，就把中间的值给他的父节点</p>
<p>若出现节点值位于父节点两个值之间的节点，则让他们单独成一个节点</p>
<style>.eelxtiyumkoh{zoom:50%;}</style>
<img src="/CS61B/Lec17%20-%20B-Trees/image-20250731203714505.png" class="eelxtiyumkoh" alt="image-20250731203714505">
<style>.sqjbsnypkzwh{zoom:50%;}</style>
<img src="/CS61B/Lec17%20-%20B-Trees/image-20250731203719417.png" class="sqjbsnypkzwh" alt="image-20250731203719417">
<p>若根中的值超过限制，我们取中间的值作为新的根节点，让树增加一层</p>
<style>.hsmtbxxyujdu{zoom: 50%;}</style>
<img src="/CS61B/Lec17%20-%20B-Trees/image-20250731203957659.png" class="hsmtbxxyujdu" alt="B-T">
<p>观察发现，这种树有着很好的平衡性</p>
<ul>
<li>若分离根节点，所有节点都会下移一层</li>
<li>若分离其他节点，树高不变</li>
</ul>
<h3 id="b-tree-1">B-Tree</h3>
<p>以上推导出的树形结构被称为B-树，其中</p>
<ul>
<li>长度限制L=3的又称2-3-4树或2-4树</li>
<li>长度限制L=2的又称2-3树</li>
</ul>
<p>数字指代一个节点可能有多少个孩子</p>
<p>B树常用于比较小的长度限制（L=2或L=3）或非常的大的长度限制</p>
<img src="/CS61B/Lec17%20-%20B-Trees/image-20250731205409999.png" class="" title="2-3-4 and 2-3">
<h3 id="不变量">不变量</h3>
<ul>
<li>所有叶子到根的距离相同</li>
<li>具有k个元素的非叶子节点一定有k+1个孩子</li>
</ul>
<h3 id="树高">树高</h3>
<p>若L为一个节点最大元素数量，则树高应在<span
class="math inline">\(\log_{L+1}(N)\)</span>至<span
class="math inline">\(\log_{2}(N)\)</span>之间</p>
<ul>
<li>最大树高为所有非叶子节点有一个元素时</li>
<li>最小树高为所有节点有L个元素时</li>
<li>平均树高为<span class="math inline">\(\Theta(\log N)\)</span></li>
</ul>
<h3 id="时间复杂度">时间复杂度</h3>
<p>最坏情况下，需要遍历H+1个节点，每个节点需要遍历L个元素</p>
<p>故复杂度为<span
class="math inline">\(O(HL)\)</span>其中带入H化简为<span
class="math inline">\(O(\log N)\)</span></p>
]]></content>
      <categories>
        <category>CS61B</category>
      </categories>
      <tags>
        <tag>数据结构</tag>
        <tag>Java</tag>
        <tag>CS61B</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61B】Lec18-Red Black Trees</title>
    <url>/CS61B/Lec18%20-%20Red%20Black%20Trees/</url>
    <content><![CDATA[<h1 id="lec18---red-black-trees">Lec18 - Red Black Trees</h1>
<h2 id="b-tree的缺点">B-Tree的缺点</h2>
<ul>
<li>需要维护不同的节点类型</li>
<li>需要在2-nodes与3-nodes之间转换</li>
<li>需要分裂节点</li>
</ul>
<h2 id="树旋转">树旋转</h2>
<p>假设我们要构造一棵节点为1，2，3的BST，则我们可以构造出五种可能的BSTs</p>
<img src="/CS61B/Lec18%20-%20Red%20Black%20Trees/image-20250804190815819.png" class="" title="r">
<p>每种BST的获得是基于插入顺序决定的</p>
<p>更普遍的，对于N个节点的BST，我们可以构造出Catalan(N)种可能的BSTs</p>
<p>而且这些树之间通过<strong>旋转（且在<span
class="math inline">\(2n-6\)</span>次旋转内）</strong>可以相互转化</p>
<h3 id="rotateleft">rotateLeft</h3>
<p>让x作为G的右孩子，实现G为x的新的左孩子，且保持BST的性质</p>
<style>.fsgdmqzjiycz{zoom:50%;}</style>
<img src="/CS61B/Lec18%20-%20Red%20Black%20Trees/image-20250804191623202.png" class="fsgdmqzjiycz" alt="rL1">
<p>若单纯让G称为P的左孩子，P会连上三棵子树</p>
<style>.zirtlgqodxsg{zoom:50%;}</style>
<img src="/CS61B/Lec18%20-%20Red%20Black%20Trees/image-20250804191725034.png" class="zirtlgqodxsg" alt="rL2">
<p>我们需要将K下的子树移动到G的右子树，这样仍然保留了它小于P且大于G的性质</p>
<h3 id="rotateright">rotateRight</h3>
<p>让x作为P的左孩子，实现P为x的新的右孩子，且保持BST的性质</p>
<style>.lnnwdjjextmb{zoom:50%;}</style>
<img src="/CS61B/Lec18%20-%20Red%20Black%20Trees/image-20250804192517045.png" class="lnnwdjjextmb" alt="rR">
<h3 id="例">例</h3>
<style>.cfqumeqrseln{zoom:50%;}</style>
<img src="/CS61B/Lec18%20-%20Red%20Black%20Trees/image-20250804192804762.png" class="cfqumeqrseln" alt="eg">
<p>左侧的树可以通过两次旋转得到右侧的树</p>
<h3 id="用处">用处</h3>
<ul>
<li>可以缩短或增长一棵树</li>
<li>可以保留BST的性质</li>
<li>可以使用旋转操作来平衡BST（在<span
class="math inline">\(O(N)\)</span>次移动内）</li>
</ul>
<img src="/CS61B/Lec18%20-%20Red%20Black%20Trees/image-20250804193152592.png" class="" title="BalanceBST">
<h2 id="红黑树">红黑树</h2>
<h3 id="原理">原理</h3>
<p>若我们想把一棵2-3树用BST表示，对于3元素节点，处理相对棘手</p>
<p>有一种思路：对一个节点中更小的元素在左下侧创建一个“粘性链接”</p>
<style>.lwdtzfemrlbl{zoom:67%;}</style>
<img src="/CS61B/Lec18%20-%20Red%20Black%20Trees/image-20250804194000966.png" class="lwdtzfemrlbl" alt="rbt1">
<p>并将这个链接设置为红色</p>
<p>我们称这种表示2-3树的形式为左倾红黑树（LLRB）</p>
<ul>
<li>LLRBs是正常的BSTs</li>
<li>一棵LLRB与一棵2-3树是一一对应的</li>
<li>红色链接没有任何特殊行为</li>
</ul>
<style>.xhtlddilycuk{zoom:50%;}</style>
<img src="/CS61B/Lec18%20-%20Red%20Black%20Trees/image-20250804194249337.png" class="xhtlddilycuk" alt="rbt2">
<h3 id="树高">树高</h3>
<img src="/CS61B/Lec18%20-%20Red%20Black%20Trees/image-20250804195408074.png" class="" title="rbt3">
<ul>
<li>在LLRB中，每个3nodes节点变成2nodes节点</li>
<li>总高为3black+2red=5</li>
<li>更通常的，一颗LLRB有不多于其对应2-3树的两倍树高</li>
</ul>
<h3 id="红黑树的构造">红黑树的构造</h3>
<p>如果先创建2-3树再转换就很麻烦了，我们可以用以下方法构建</p>
<ul>
<li>按BST插入</li>
<li>使用0或多次旋转来维持一一对应的关系</li>
</ul>
<ol type="1">
<li>插入的颜色：我们应该总是插入<strong>红色</strong></li>
</ol>
<p>因为2-3树中新值总是加在叶子节点中</p>
<style>.vywwcfcbvisr{zoom:50%;}</style>
<img src="/CS61B/Lec18%20-%20Red%20Black%20Trees/image-20250804201119148.png" class="vywwcfcbvisr" alt="conv1">
<ol start="2" type="1">
<li><p>若在叶子右侧插入，造成右倾：我们需要对插入节点的父节点<strong>左旋</strong></p>
<p>因为红色链接不应该出现在右侧</p></li>
</ol>
<style>.clvmqcrvmwra{zoom:50%;}</style>
<img src="/CS61B/Lec18%20-%20Red%20Black%20Trees/image-20250804201317563.png" class="clvmqcrvmwra" alt="conv2">
<ol start="3" type="1">
<li><p>若一个节点下插入了两个红色链接：我们可以暂时保持状态</p>
<p>此时在2-3树的表示下为过满，让中间节点上移的状态</p></li>
</ol>
<img src="/CS61B/Lec18%20-%20Red%20Black%20Trees/image-20250804201805151.png" class="" title="conv3">
<ol start="4" type="1">
<li>若存在两次左侧插入：对两个节点的父节点<strong>右旋</strong></li>
</ol>
<style>.twjypgsyvrtc{zoom:50%;}</style>
<img src="/CS61B/Lec18%20-%20Red%20Black%20Trees/image-20250804202126848.png" class="twjypgsyvrtc" alt="conv4">
<ol start="5" type="1">
<li><p>处理临时的两个红色链接：将两个红色链接置黑，将上方的黑色链接置红</p>
<p>在2-3树中等同于将中间节点上移</p></li>
</ol>
<style>.wijyvpklqljr{zoom:50%;}</style>
<img src="/CS61B/Lec18%20-%20Red%20Black%20Trees/image-20250804202852817.png" class="wijyvpklqljr" alt="cnov5">
<ol start="6" type="1">
<li>修复右侧红色链接：有时候颜色反转后会出现单独的右侧红色链接，这时需要<strong>左旋</strong></li>
</ol>
<style>.pbwkonqiidya{zoom:50%;}</style>
<img src="/CS61B/Lec18%20-%20Red%20Black%20Trees/image-20250804203115934.png" class="pbwkonqiidya" alt="conv6">
<h3 id="总结">总结</h3>
<style>.xdpocgmqifoe{zoom:50%;}</style>
<img src="/CS61B/Lec18%20-%20Red%20Black%20Trees/image-20250804203318897.png" class="xdpocgmqifoe" alt="conclu">
<h2 id="时间复杂度">时间复杂度</h2>
<ul>
<li>LLRB的树高为<span class="math inline">\(O(\log N)\)</span></li>
<li>插入操作为<span class="math inline">\(O(\log
N)\)</span>（包括插入新节点与旋转、颜色变换）</li>
</ul>
]]></content>
      <categories>
        <category>CS61B</category>
      </categories>
      <tags>
        <tag>数据结构</tag>
        <tag>Java</tag>
        <tag>CS61B</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61B】Lec19-20 Hashing</title>
    <url>/CS61B/Lec19-20%20-%20Hashing/</url>
    <content><![CDATA[<h1 id="lec19-20-hashing">Lec19-20 Hashing</h1>
<h2 id="搜索树的可进步之处">搜索树的可进步之处</h2>
<ul>
<li>树中的元素需要是可比较的，如两个汉字便无法存储在其中</li>
<li>时间复杂度为<span class="math inline">\(\Theta(\log
N)\)</span>，能不能再进行优化</li>
</ul>
<h2 id="快一点">快一点</h2>
<h3 id="writeitonthewall-set">WriteItOnTheWall Set</h3>
<p>假设我们有一个集合WriteItOnTheWall</p>
<p>对于这种集合，添加元素是很快的，只要有空位就可以添加，但是寻找元素是很慢的</p>
<p>用时间复杂度表示为<span
class="math inline">\(\Theta(1)\)</span>与<span
class="math inline">\(\Theta(N)\)</span></p>
<p>这种集合的好处是不需要管元素种类，只管往里添加即可</p>
<h3 id="bobacounter-set">BobaCounter Set</h3>
<p>我们将上面的集合优化，将整面墙分为十个部分，标号0-9，对应每个数字的个位数放入相应的集合中。</p>
<p>这样我们的耗时可以减少十分之一</p>
<p>但是这种思路也有问题：</p>
<ul>
<li>会浪费每个分区的空间</li>
<li>各个分区元素个数可能会不平衡</li>
<li>数字不一定随机</li>
<li>其他数据类型该如何处理</li>
</ul>
<h2 id="哈希表">哈希表</h2>
<h3 id="减少浪费空间">减少浪费空间</h3>
<p>使用链表，每个相同尾数的元素进入后添加一个节点链接到上一个元素后面</p>
<h3 id="处理大量数据">处理大量数据</h3>
<p>设有N个物品，M个桶，假设平均分，则每个桶里有<span
class="math inline">\(\frac{N}{M}\)</span>个物品，时间复杂度为<span
class="math inline">\(\Theta(\frac{N}{M})\)</span></p>
<p>若M为常数则时间复杂度可以减至<span
class="math inline">\(\Theta(N)\)</span></p>
<p>使M随着N的增长而增长，我们可以做到常数时间复杂度。这时我们需要一种方法来根据不同的M将数组分为M组</p>
<h3 id="取模操作">取模操作</h3>
<p>我们可以通过取模做到这一点</p>
<ul>
<li>可以适用于任意的M</li>
<li>可以平均分配随机的数</li>
<li>使用质数当模数分配结果可以更加独立</li>
</ul>
<h3 id="增加m">增加M</h3>
<p>为了保持常数时间复杂度，我们需要始终保持<span
class="math inline">\(\frac{N}{M}\)</span>小于某个常数k</p>
<p>常用方法是：当桶的平均大小大于k，我们增加M</p>
<ul>
<li>当增加M时，我们同时要保证将数重新均分到新的桶中</li>
<li>参考ArrayList中的resize，最好的方法是每次double M的大小</li>
</ul>
<p><img src="Lec19 - Hashing Ⅰ/image-20250811205136948.png" alt="过大" style="zoom:67%;" /></p>
<p><img src="Lec19 - Hashing Ⅰ/image-20250811205158134.png" alt="扩容" style="zoom:67%;" /></p>
<p>综上，若我们有N个元素均分，每个列表的长度为<span
class="math inline">\(\frac{N}{M}\)</span></p>
<ul>
<li><span class="math inline">\(\frac{N}{M}\)</span>近乎一个常数</li>
<li>故操作的时间复杂度也大约是常数</li>
</ul>
<h3 id="支持其他数据类型">支持其他数据类型</h3>
<p>对于不同数据类型，问题在于存放数据的集合并不负责将对应数据分类。</p>
<p>集合对于int类型的操作最为灵活，故我们需要让集合只作用与int类型</p>
<p>此时其他类型需要依靠自己的类来实现到int的转换</p>
<p>对字符串：有一种方法是将字符串用26进制转换为一个数</p>
<p><img src="Lec19 - Hashing Ⅰ/image-20250813192626702.png" alt="转换例" style="zoom: 50%;" /></p>
<p>通过这种方法我们可以支持string操作</p>
<h3 id="哈希码">哈希码</h3>
<p>对于汉字等拥有庞大字库的字符，若使用unicode码套用该方法，转换出的数字可能会超出数据类型的范围，实际上数字大小随着字符长度是<strong>指数增加</strong>的</p>
<p>因此我们需要通过减小进制数来将庞大的数字固定在一个范围内，如整型的取值范围等，如java中使用31计算，计算出来的数值即为<strong>哈希码</strong>，减小范围的代价是可能有重复的哈希码，但是对于有意义的字符串，这种概率还是比较小的</p>
<p>Java转换哈希码的函数如下：</p>
<figure>
<img src="Lec19%20-%20Hashing%20Ⅰ/image-20250813200355217.png"
alt="哈希码" />
<figcaption aria-hidden="true">哈希码</figcaption>
</figure>
<h3 id="哈希表-1">哈希表</h3>
<p>我们创建的集合称为<strong>哈希表</strong></p>
<ul>
<li>数据通过特定的哈希函数转换成哈希码，保证在整型的取值范围内</li>
<li>哈希码之后使用模数被减少到一个合理的下标</li>
</ul>
<p>在Java中，哈希表最常用来实现set和map</p>
<h3 id="哈希函数">哈希函数</h3>
<p>设计哈希函数的原则是让入表的元素平均分配</p>
<p>其中一种重写哈希函数的场景是对类重写equals方法时，为了能让哈希表正常工作，我们也需要重写哈希码方法，来确保<strong>若两个元素相等则他们的哈希码一致</strong>，若不设置可能相同的元素会进入不同的桶中</p>
<h2 id="不可变类型">不可变类型</h2>
<p>不可变类型指在实例化后无法再改变的类型</p>
<p>如int，string等类型</p>
<p><strong>final</strong>关键字可以设置一个不可变变量，防止你在设置值后进行修改</p>
<ul>
<li>final变量意味着你可以给该变量分配一个值，这之后就不能再修改了</li>
<li>final关键字对于一个不可变类来说不是必须的</li>
</ul>
<p><img src="Lec19 - Hashing Ⅰ/image-20250813210346191.png" alt="不可变类" style="zoom:67%;" /></p>
<p>哈希表中，不要改变一个用作键的对象，否则会将自己放在错误的位置</p>
]]></content>
      <categories>
        <category>CS61B</category>
      </categories>
      <tags>
        <tag>数据结构</tag>
        <tag>Java</tag>
        <tag>CS61B</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61B】Lec21 Priority Queue &amp; Heaps</title>
    <url>/CS61B/Lec21%20Priority%20Queue%20&amp;%20Heaps/</url>
    <content><![CDATA[<h1 id="lec21-priority-queue-heaps">Lec21 Priority Queue &amp;
Heaps</h1>
<h2 id="堆">堆</h2>
<h3 id="定义">定义</h3>
<p>若我们使用BST，处理相同元素时会变得很棘手，故我们需要引入堆这种数据结构</p>
<p>堆（二叉最小堆）是一颗<strong>完全二叉树</strong>，并且它遵循<strong>最小堆原则</strong>：</p>
<ul>
<li>每个节点的值都不大于它两个子节点的键值</li>
</ul>
<h3 id="添加元素">添加元素</h3>
<style>.cbbyvbwkjnen{zoom: 50%;}</style>
<img src="/CS61B/Lec21%20Priority%20Queue%20&%20Heaps/image-20250818160733544.png" class="cbbyvbwkjnen" alt="add1">
<p>首先将待添加元素加入堆底</p>
<style>.udckrhsfefff{zoom:50%;}</style>
<img src="/CS61B/Lec21%20Priority%20Queue%20&%20Heaps/image-20250818160832938.png" class="udckrhsfefff" alt="add2">
<p>然后将该节点与父节点比较，按照结果如果小于父节点则上浮，直到合适位置</p>
<h3 id="删除元素">删除元素</h3>
<p>首先去除根节点，选择堆尾部节点，与期父节点比较，若满足更小性质就将节点上移</p>
<style>.ukszuhdivqxb{zoom:50%;}</style>
<img src="/CS61B/Lec21%20Priority%20Queue%20&%20Heaps/image-20250818163553169.png" class="ukszuhdivqxb" alt="del">
<h3 id="实现方法">实现方法</h3>
<p>我们将键存在一个数组中，而不需要存储树结构</p>
<p>这只适用于完全二叉树，因为只有完全二叉树可以实现从左往右依次标号得到键列表的结果</p>
<img src="/CS61B/Lec21%20Priority%20Queue%20&%20Heaps/image-20250818170504297.png" class="" title="实现">
<p>为了方便操作，我们将0下标空出来，这样对于节点k，计算父亲与孩子节点就更方便了：</p>
<ul>
<li>左孩子 = <span class="math inline">\(k\times 2\)</span></li>
<li>右孩子 = <span class="math inline">\(k\times 2+1\)</span></li>
<li>父亲 = <span class="math inline">\(\frac{k}{2}\)</span></li>
</ul>
<p>对于上浮，使用递归操作，只需要比较当前节点与父节点大小，若父节点更大就需要交换并上浮</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">swim</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> k){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (keys[</span><span style="color: #6F42C1">parent</span><span style="color: #24292E">(k)]</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">keys[k]){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">swap</span><span style="color: #24292E">(k, </span><span style="color: #6F42C1">parent</span><span style="color: #24292E">(k));</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">swim</span><span style="color: #24292E">(</span><span style="color: #6F42C1">parent</span><span style="color: #24292E">(k));</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="优先队列的接口">优先队列的接口</h3>
<p>可以用 于获取最小/最大/最佳元素</p>
<style>.xzytzcqdudxe{zoom: 50%;}</style>
<img src="/CS61B/Lec21%20Priority%20Queue%20&%20Heaps/image-20250818154426606.png" class="xzytzcqdudxe" alt="pq">
<h3 id="时间复杂度">时间复杂度</h3>
<img src="/CS61B/Lec21%20Priority%20Queue%20&%20Heaps/image-20250818170913779.png" class="" title="times">
]]></content>
      <categories>
        <category>CS61B</category>
      </categories>
      <tags>
        <tag>数据结构</tag>
        <tag>Java</tag>
        <tag>CS61B</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61B】Lec22-23 Tree and Graph Traversalsaring</title>
    <url>/CS61B/Lec22-23%20Tree%20and%20Graph%20Traversalsaring/</url>
    <content><![CDATA[<h1 id="lec22-23-tree-and-graph-traversalsaring">Lec22-23 Tree and Graph
Traversalsaring</h1>
<p>## 树的遍历</p>
<style>.hpvhsduwscby{zoom:50%;}</style>
<img src="/CS61B/Lec22-23%20Tree%20and%20Graph%20Traversalsaring/image-20250917104407365.png" class="hpvhsduwscby" alt="image-20250917104407365">
<ul>
<li>层序遍历：从上到下，从左到右的遍历（DBFACEG）</li>
<li>深度优先遍历：首先遍历深度节点
<ul>
<li>前序遍历：访问当前节点-&gt;遍历左侧节点-&gt;遍历右侧节点（DBACFEG）</li>
<li>中序遍历：遍历左侧节点-&gt;访问当前节点-&gt;遍历右侧节点（ABCDEFG）</li>
<li>后序遍历：遍历左侧节点-&gt;遍历右侧节点-&gt;访问当前节点（ACBEGFD）</li>
</ul></li>
</ul>
<h2 id="图">图</h2>
<p>树有助于表示<strong>严格层序关系</strong>，但不一定所有的关系都是层序关系，比如存在环的地图</p>
<h3 id="定义">定义</h3>
<p>一个图由：</p>
<ul>
<li>一组节点</li>
<li>0或多条边，每条边连接了两个节点</li>
</ul>
<h3 id="简单图">简单图</h3>
<ul>
<li>没有边自己连接自己的节点</li>
<li>没有两条边连接相同节点</li>
</ul>
<h3 id="一些术语">一些术语</h3>
<ul>
<li>邻接顶点：彼此有边的顶点</li>
<li>权重：顶点和边上都可以包含值</li>
<li>路径：由边连接的顶点序列
<ul>
<li>简单路径：没有重复顶点的路径</li>
</ul></li>
<li>环：第一个和最后一个顶点相同
<ul>
<li>存在至少一个环的图称为有环图</li>
</ul></li>
<li>连通：若两个顶点间存在一条路径，则我们认为这两个顶点是连通的。若所有顶点连通，则图是连通的</li>
</ul>
<h3 id="api">API</h3>
<img src="/CS61B/Lec22-23%20Tree%20and%20Graph%20Traversalsaring/image-20250919104112385.png" class="" title="API">
<h2 id="图的表示">图的表示</h2>
<h3 id="邻接矩阵">邻接矩阵</h3>
<img src="/CS61B/Lec22-23%20Tree%20and%20Graph%20Traversalsaring/image-20250919112007865.png" class="" title="am">
<p>对于图若从s到t存在一条边，对应矩阵的元素设为1</p>
<p>对于无向图，s到t存在边则t到s也存在，邻接矩阵中是对称表现</p>
<p>采用这种数据结构表示的话，需要开一个很大的数组，并且会有很多空间被浪费掉</p>
<h3 id="邻接表">邻接表</h3>
<p>按顶点数维护一个列表，即对于顶点i作为index，与之相连的节点作为该index下的元素存入</p>
<img src="/CS61B/Lec22-23%20Tree%20and%20Graph%20Traversalsaring/image-20250919112922161.png" class="" title="al">
<img src="/CS61B/Lec22-23%20Tree%20and%20Graph%20Traversalsaring/image-20250919112932749.png" class="" title="al">
<p>若V是定点总数，E是边总数，则时间复杂度为<span
class="math inline">\(\Theta(V+E)\)</span></p>
<h2 id="图的遍历">图的遍历</h2>
<blockquote>
<p>寻找一个从s到任意可以到达的顶点v，最多访问每个顶点一次</p>
</blockquote>
<h3 id="dfs">DFS</h3>
<p>优先尽量往深处搜索，dfs(v)如下：</p>
<ul>
<li>标记v</li>
<li>对每一个没有标记的邻接节点w
<ul>
<li>设置<code>edgeTo[w]=v</code></li>
<li>dfs(w)</li>
</ul></li>
</ul>
<p>这个遍历顺序称为<strong>DFS前序遍历</strong>：在dfs遍历邻居前进行操作</p>
<p>同样还有DFS后序遍历：在dfs遍历邻居后进行操作</p>
<p>我们使用邻接表实现：</p>
<img src="/CS61B/Lec22-23%20Tree%20and%20Graph%20Traversalsaring/image-20250919111022617.png" class="" title="DFS">
<h3 id="bfs">BFS</h3>
<p>广度优先遍历，即按照与s的距离的顺序操作</p>
<p>这种遍历的搜索优先考虑广度而非深度</p>
]]></content>
      <categories>
        <category>CS61B</category>
      </categories>
      <tags>
        <tag>图论</tag>
        <tag>Java</tag>
        <tag>CS61B</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61B】Lec24 Shortest Paths</title>
    <url>/CS61B/Lec24%20Shortest%20Paths/</url>
    <content><![CDATA[<h1 id="lec24-shortest-paths">Lec24 Shortest Paths</h1>
<p>## 最短路的思想</p>
<p>为什么bfs不起作用：bfs倾向于选择节点少的路径，但若节点少的边权和大于节点多的边权和，结果就会出错</p>
<p>给予该图，寻找从A到每一个节点的最短路</p>
<p>可以发现，大多最短路径都包含了其他最短路径作为中间步骤，所有最短路倾向于重叠</p>
<p>实际上，我们可以说解决方案总是一颗树，即图的一个子树，我们想走最短路时，总是先走一个中间的最短路径，可以看作所有顶点上最短路径的并集，我们称这棵树为最短路径树（SPT）</p>
<p>若顶点数为V，则边数E总为V-1</p>
<figure>
<img
src="C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20250921105149229.png"
alt="eg" />
<figcaption aria-hidden="true">eg</figcaption>
</figure>
<p>接下来我们构建算法来寻找最短路</p>
<p>首先我们设定每个顶点都没有标记过，距离设为无穷，SPT中没有边</p>
<figure>
<img
src="C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20250921111925893.png"
alt="spt" />
<figcaption aria-hidden="true">spt</figcaption>
</figure>
<p>从A开始，将顶点A放入列表</p>
<p>当列表非空：</p>
<ul>
<li>从列表中移除一个顶点并标记</li>
<li>对每个由v到w的边界，若不在SPT中存在，则添加该边，并将w放入列表</li>
</ul>
<figure>
<img
src="C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20250921112243074.png"
alt="state" />
<figcaption aria-hidden="true">state</figcaption>
</figure>
<p>这显然不对，因为这种以BFS为基础的算法是按序处理距离起点1、2、3的顶点</p>
<p>若边权相同，则有效，否则会失效</p>
<p>接下来，尝试按边权将一条边分成若干小节点连成的边，小节点间的边边权都为1</p>
<figure>
<img
src="C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20250921112748456.png"
alt="dummy" />
<figcaption aria-hidden="true">dummy</figcaption>
</figure>
<p>这样可以获得正确结果，但我们创建了过多虚拟节点，且遍历的步数也会变多，这样会很慢很慢</p>
<p>抛去虚拟节点，这种算法访问节点的顺序可以成为<strong>最优优先顺序</strong>，我们接下来尝试按照该顺序遍历，但不创建虚拟节点</p>
<p>类似于BFS，但是这种情况下我们需要每次从列表中移除最近的边，选择使用优先队列追踪这个最近的边</p>
<p>添加A到列表</p>
<p>当列表非空：</p>
<ul>
<li>从列表中移除<strong>距离最近</strong>的顶点并标记</li>
<li>对每个v到w，若w不是spt的一部分，则添加边，添加w到列表中</li>
</ul>
<figure>
<img
src="C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20250921113838084.png"
alt="best" />
<figcaption aria-hidden="true">best</figcaption>
</figure>
<p>但结果仍然不正确，因为我们只考虑按最佳顶点来遍历，但每当计算出一条路径长度，我们就立即采用了该长度，但其实如果再等待一下，我们可以找到一条更短的路径</p>
<h2 id="dijkstra">Dijkstra</h2>
<p>该算法的思想在上面的基础上，暂定了最佳路径，并在稍后寻找更好的路径并覆盖先前的路径，这种方法叫做<strong>松弛</strong>。</p>
<h3 id="具体步骤">具体步骤</h3>
<p>将所有顶点添加到列表</p>
<p>若列表非空：</p>
<ul>
<li>取出最接近的顶点并标记</li>
<li>对每一个边v到w，若该边使得到达w的距离更优，则添加该边，并更新列表中的w</li>
</ul>
<style>.spbrniohsfxg{zoom:67%;}</style>
<img src="/CS61B/Lec24%20Shortest%20Paths/image-20250921140955695.png" class="spbrniohsfxg" alt="dij">
<h3 id="伪代码">伪代码</h3>
<p>整体思路：</p>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">pq.add(source, 0)</span></span>
<span class="line"><span style="color: #24292e">for other vertices v:</span></span>
<span class="line"><span style="color: #24292e">	pq.add(v, inf)</span></span>
<span class="line"><span style="color: #24292e">while !pq.empty():</span></span>
<span class="line"><span style="color: #24292e">	p = pq.removesmallest()</span></span>
<span class="line"><span style="color: #24292e">	relax all edges from p</span></span></code></pre></div></div></figure>
<p>松弛一个边权为w，从p指向q的边：</p>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">if distTo[p]+w&lt;distTo[q]:</span></span>
<span class="line"><span style="color: #24292e">	distTo[q] = distTo[p]+w;</span></span>
<span class="line"><span style="color: #24292e">	edgeTo[q] = p;</span></span>
<span class="line"><span style="color: #24292e">	pq.changePriority(q, distTo[q]);</span></span></code></pre></div></div></figure>
<ul>
<li>我们总是按照距离起点的距离访问顶点</li>
<li>松弛不对已访问过的节点起作用（查看更差路径之前先查看更好的路径）</li>
</ul>
<p>注意，<strong>dijkstra并不适用于负边权</strong></p>
<h3 id="复杂度">复杂度</h3>
<img src="/CS61B/Lec24%20Shortest%20Paths/image-20250921212705856.png" class="" title="image-20250921212705856">
<h2 id="a">A*</h2>
<p>若我们有一个想到达的终点，寻找最短路径，我们没有必要使用dijkstra将每条最短路径走一遍，而是在dijkstra的基础上添加一个启发式方法：预期到达终点需要的时间</p>
<p>设计一个启发式函数<code>h(v, goal)</code>，得到到达终点的预期时间</p>
<p>故我们可以按照<code>d(source, v)+h(v, goal)</code>的顺序来访问顶点</p>
<p>即我们已经知道到达v的最短路，且我们推断v也是到达终点的最短路</p>
<h3 id="启发式函数的设计">启发式函数的设计</h3>
<p>dijkstra可以看作将所有预期值设为0的启发式函数，任何启发式函数都可以实现算法，但我们需要遵循以下：</p>
<ul>
<li>低估距离：h(v,goal)要小于等于从v到goal的真实值</li>
<li>持续性：对每一个w的邻居节点
<ul>
<li><code>h(v, goal)&lt;=dist(v,w)+h(w,goal)</code></li>
<li><code>dist(v,w)</code>指从v到w的边权</li>
</ul></li>
</ul>
<p>最好的一种方法是使用地图上的直线距离，因为直线距离总会相等或比真实距离好</p>
]]></content>
      <categories>
        <category>CS61B</category>
      </categories>
      <tags>
        <tag>图论</tag>
        <tag>Java</tag>
        <tag>CS61B</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61B】Lec25 Minimum Spanning Trees</title>
    <url>/CS61B/Lec25%20Minimum%20Spanning%20Trees/</url>
    <content><![CDATA[<h1 id="lec25-minimum-spanning-trees">Lec25 Minimum Spanning Trees</h1>
<p>## 判断一个无向图是否存在环</p>
<h3 id="方法1dfs">方法1：DFS</h3>
<ul>
<li>持续搜索知道发现被标记的顶点</li>
<li>注意不要回头看刚来过的地方，防止提前结束</li>
</ul>
<p>最坏时间复杂度<span class="math inline">\(O(V+E)\)</span></p>
<h3 id="方法2加权并查集">方法2：加权并查集</h3>
<ul>
<li>对每一条边v-w，检查连通性
<ul>
<li>若不连通，则合并v与w</li>
<li>若连通，说明存在环</li>
</ul></li>
</ul>
<p>最坏时间复杂度<span
class="math inline">\(O(V+E\alpha(V))\)</span></p>
<h2 id="最小生成树">最小生成树</h2>
<h3 id="定义">定义</h3>
<p>给予一个无向图G，生成树T是G的一个子图，其中T：</p>
<ul>
<li>是连通的</li>
<li>是无环的</li>
<li>包括所有顶点</li>
</ul>
<style>.lzbrepellehn{zoom:50%;}</style>
<img src="/CS61B/Lec25%20Minimum%20Spanning%20Trees/image-20250929191702150.png" class="lzbrepellehn" alt="生成树">
<p>其中最小生成树是包含最小权值和的生成树</p>
<h3 id="割">割</h3>
<ul>
<li>割指的是将节点分配到两个非空集合</li>
<li>横切边指的是跨越割的两个集合的两个顶点间连成的边</li>
<li>切分定理：给定任意的割，横切边中权值最小的边一定属于最小生成树（假设边的权值互不相同）</li>
</ul>
<h2 id="生成最小生成树">生成最小生成树</h2>
<h3 id="朴素算法">朴素算法</h3>
<p>即按照割的性质，给所有顶点随机涂色，并找到最小权重的边</p>
<ul>
<li>寻找生成树中没有横切边的一个割</li>
<li>将最小权重的横切边加入最小生成树</li>
<li>重复直到V-1条边</li>
</ul>
<p>可以实现，但是效率很差</p>
<h3 id="prim">Prim</h3>
<p>从任意一个节点开始，均初始化为无穷</p>
<ul>
<li>添加已在最小生成树里的存在节点的边中的最短边</li>
<li>重复直到V-1条边</li>
</ul>
<p>这中间，用到了类似于dijkstra的松弛，不同之处在于每次试图添加每条边时，Prim算法按照到目前构建的最小生成树的距离的大小访问节点</p>
<p>代码如下：</p>
<style>.vvnbwhpgbulz{zoom: 50%;}</style>
<img src="/CS61B/Lec25%20Minimum%20Spanning%20Trees/image-20250929200958175.png" class="vvnbwhpgbulz" alt="code1">
<style>.uqkyfobbzgvs{zoom:50%;}</style>
<img src="/CS61B/Lec25%20Minimum%20Spanning%20Trees/image-20250929201014506.png" class="uqkyfobbzgvs" alt="code2">
<p>时间复杂度：</p>
<style>.odrzimlpllig{zoom:50%;}</style>
<img src="/CS61B/Lec25%20Minimum%20Spanning%20Trees/image-20250929201047333.png" class="odrzimlpllig" alt="image-20250929201047333">
<h3 id="kruskal">Kruskal</h3>
<p>该算法考虑按照每条边的权重顺序添加边到最小生成树中</p>
<ul>
<li>将每条边按照权重递增顺序考虑</li>
<li>每次添加最短边进入最小生成树，除非会产生环</li>
<li>重复直到v-1条边</li>
</ul>
<p>这里也使用了割的性质：我们将已经加入最小生成树的顶点设为同一颜色，未加入的设为另一颜色，寻找最小权重的横切边加入最小生成树，同时能够组成环的两个顶点一定是在同一颜色的集合中</p>
<p>代码如下：</p>
<style>.wdlrmexpkfak{zoom: 67%;}</style>
<img src="/CS61B/Lec25%20Minimum%20Spanning%20Trees/image-20250929202655100.png" class="wdlrmexpkfak" alt="code">
<p>时间复杂度：<span class="math inline">\(O(E\log E)\)</span></p>
<style>.jnxpsxmiixpu{zoom:67%;}</style>
<img src="/CS61B/Lec25%20Minimum%20Spanning%20Trees/image-20250929202803964.png" class="jnxpsxmiixpu" alt="时间复杂度">
]]></content>
      <categories>
        <category>CS61B</category>
      </categories>
      <tags>
        <tag>图论</tag>
        <tag>Java</tag>
        <tag>CS61B</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61B】Lec2-Java Basic 1</title>
    <url>/CS61B/Lec2-Java%20Basic%201/</url>
    <content><![CDATA[<h1 id="java-basic-1">Java Basic 1</h1>
<h2 id="关于类">关于类</h2>
<ul>
<li>每个方法(method)都与某些类相关</li>
<li>执行一个类需要主(main)方法，但不是所有类都有主方法</li>
</ul>
<p>e.g. 创建一个狗类</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Dog</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> size;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> String binmen </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;Canis&quot;</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D">// 构造函数</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Dog</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        size </span><span style="color: #D73A49">=</span><span style="color: #24292E"> s;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">makeNoise</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (size </span><span style="color: #D73A49">&gt;</span><span style="color: #005CC5">20</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">            System.out.</span><span style="color: #6F42C1">println</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;bark&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (size </span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">10</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">            System.out.</span><span style="color: #6F42C1">println</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;bark!&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">else</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">            System.out.</span><span style="color: #6F42C1">println</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;bark!!&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> Dog </span><span style="color: #6F42C1">maxDog</span><span style="color: #24292E">(Dog </span><span style="color: #E36209">otherDog</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        System.out.</span><span style="color: #6F42C1">println</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Being called&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #005CC5">this</span><span style="color: #24292E">.size </span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> otherDog.size){</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">this</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> otherDog;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>(Dog.java)</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">DogLauncher</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(</span><span style="color: #D73A49">String</span><span style="color: #24292E">[] </span><span style="color: #E36209">args</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        Dog maya </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Dog</span><span style="color: #24292E">(</span><span style="color: #005CC5">9</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        maya.</span><span style="color: #6F42C1">makeNoise</span><span style="color: #24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">        Dog hugeDog </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Dog</span><span style="color: #24292E">(</span><span style="color: #005CC5">100</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        Dog largerDog </span><span style="color: #D73A49">=</span><span style="color: #24292E"> maya.</span><span style="color: #6F42C1">maxDog</span><span style="color: #24292E">(hugeDog);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>DogLauncher,java文件</p>
<p>（将dog类放入Dog.java文件，主方法放入DogLauncher.java文件，调用主方法时从Dog类调用makeNoise方法）</p>
<p>该Dog类包含如下：</p>
<ul>
<li>实例变量：定义一个示例的多个属性</li>
<li>构造函数：定义如何实例化一个类</li>
<li>非静态方法（实例方法）：由特定实例调用的方法，不需要加static关键字</li>
</ul>
<h2 id="array">Array</h2>
<p>一种ADT的受限版本</p>
<ul>
<li>创建数组时需要声明大大小</li>
<li>大小不能更改</li>
<li>所有元素类型需要相同</li>
<li>没有方法</li>
</ul>
<h2 id="map">Map</h2>
<p>map是键值对的集合，每个键都保证是唯一的</p>
]]></content>
      <categories>
        <category>CS61B</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>CS61B</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61B】Lec26 Directed Acyclic Graphs</title>
    <url>/CS61B/Lec26%20Directed%20Acyclic%20Graphs/</url>
    <content><![CDATA[<h1 id="lec26-directed-acyclic-graphs">Lec26 Directed Acyclic
Graphs</h1>
<h2 id="拓扑排序">拓扑排序</h2>
<h3 id="思路">思路</h3>
<p>假设有一系列任务编号由A到H，v-&gt;w表示v必须发生在w之前，则我们需要一个算法来找到一个合适的任务执行顺序</p>
<img src="/CS61B/Lec26%20Directed%20Acyclic%20Graphs/image-20251005204639654.png" class="" title="topo">
<p>如该图，顺序如ACBDFEHG或CADFBEGH都是合理的</p>
<p>我们的解决方法是使用dfs遍历每个入度为0的顶点而不清除每次遍历中的标记</p>
<ul>
<li>按回溯顺序记录dfs结果</li>
<li>将结果反转，即为拓扑序</li>
</ul>
<h3 id="从哪里开始">从哪里开始？</h3>
<p>注意，实际上并不需要寻找入度为0的顶点的这一操作，实际可以进行如下操作</p>
<ul>
<li>从任意一个顶点开始</li>
<li>若没有全被标记，则选择一个未被标记的再进行dfs</li>
<li>直到全部被标记</li>
</ul>
<h3 id="限制">限制</h3>
<p>拓扑排序只存在于<strong>有向无环图（DAG）</strong>中</p>
<h2 id="dag上的最短路">DAG上的最短路</h2>
<p>对于负边权，使用Dijkstra算法在松弛时会失效</p>
<p>在DAG上，我们可以使用拓扑序来跑最短路</p>
<img src="/CS61B/Lec26%20Directed%20Acyclic%20Graphs/image-20251006094017332.png" class="" title="过程">
<p>时间复杂度：<span class="math inline">\(O(V+E)\)</span></p>
<h2 id="最长路">最长路</h2>
<p>寻找最长路已知最佳算法是指数级的</p>
<ul>
<li>拷贝一份已知图G‘，将边权取负</li>
<li>在图G’上跑一遍最短路，得到结果X</li>
<li>将X中1所有到达距离值符号取反，点权已经是正确的</li>
</ul>
]]></content>
      <categories>
        <category>CS61B</category>
      </categories>
      <tags>
        <tag>图论</tag>
        <tag>Java</tag>
        <tag>CS61B</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61B】Lec11-Asymptotics I</title>
    <url>/CS61B/Lec11%20-%20Asymptotics%20I/</url>
    <content><![CDATA[<h1 id="lec11---asymptotics-i">Lec11 - Asymptotics I</h1>
<h2 id="衡量计算花费的方法">衡量计算花费的方法</h2>
<h3 id="使用客户端程序测量执行时间">使用客户端程序测量执行时间</h3>
<p>优点：易测量，意义明显</p>
<p>缺点：可能需要大量计算时间，结果可能因机器、编译器、数据不同而不同</p>
<h3 id="计算可能的操作数">计算可能的操作数</h3>
<p>对于输出的大小为N的数组，计算可能的操作数</p>
<p>优点：独立于机器，输入基于给到的模型，显示了算法如何进行拓展</p>
<p>缺点：很难计算</p>
<h3
id="对给定n大小数组选择一个特定输入来代表输入规模计算该操作数">对给定N大小数组，选择一个特定输入来代表输入规模，计算该操作数</h3>
<p>特定输入包括：</p>
<ul>
<li>最差情况</li>
<li>最好情况</li>
</ul>
<img src="/CS61B/Lec11%20-%20Asymptotics%20I/image-20250718205311097.png" class="" title="复杂度">
<h2 id="渐进表现">渐进表现</h2>
<p>大多数情况下，对于很大的数据N，我们只关心其渐进表现</p>
<p>具有较好规模（如线性）的算法会比具有相对差规模（如抛物线型）有着更好的运行时间表现</p>
<h2 id="简化等式">简化等式</h2>
<ol type="1">
<li><p>将表格用多个变量的等式表示</p>
<img src="/CS61B/Lec11%20-%20Asymptotics%20I/image-20250718211619195.png" class="" title="简化"></li>
<li><p>忽略低阶项</p></li>
</ol>
<img src="/CS61B/Lec11%20-%20Asymptotics%20I/image-20250718211731707.png" class="" title="简化2">
<ol start="3" type="1">
<li>将所有系数转换为一个常数，即<span
class="math inline">\(CN^2\)</span>，将拥有这些常数的函数归到一类，称为<span
class="math inline">\(\Theta(N^2)\)</span></li>
</ol>
<p>即<span
class="math inline">\(\Theta(N^2)\)</span>是包含了最坏运行时间的函数集合，用于表达运行时间</p>
]]></content>
      <categories>
        <category>CS61B</category>
      </categories>
      <tags>
        <tag>算法</tag>
        <tag>Java</tag>
        <tag>CS61B</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61B】Lec28 Sorting I</title>
    <url>/CS61B/Lec28%20Sorting%20I/</url>
    <content><![CDATA[<h1 id="lec28-sorting-i">Lec28 Sorting I</h1>
<h2 id="排序的定义">排序的定义</h2>
<p>排序关系：小于号&lt;对于a，b，c有以下特性</p>
<ul>
<li>只有<span class="math inline">\(a&lt;b,
a=b,a&gt;b\)</span>三者其一为真</li>
<li>若<span class="math inline">\(a&lt;b \and b&lt;c\)</span>，则<span
class="math inline">\(a&lt;c\)</span></li>
</ul>
<p>排序实际上是序列元素的一个排列，使得其中的键按照相对于给定排序关系的非降序排列</p>
<p>如：string的长度，符合上述两个特性</p>
<p>Java中通常使用<code>compareTo</code>来定义排序关系</p>
<p>取决于正在处理的对象类型，或者自己选择不同排序方式，可以得到不同的排序</p>
<figure>
<img src="Lec28%20Sorting/image-20251031211139348.png"
alt="comparator" />
<figcaption aria-hidden="true">comparator</figcaption>
</figure>
<h2 id="逆序对">逆序对</h2>
<p>逆序对是一对元素，这对元素相对于当前操作是无序的</p>
<p>如0 1 1 2 3 4 8 6 9 5 7，对于&lt;操作</p>
<p>8-6 6-5 8-7 6-5 9-5 9-7都是无序的，称为逆序对</p>
<p>因此另一种排序的目标可以描述为：</p>
<ul>
<li>给予一个存在z个逆序对的元素序列</li>
<li>执行一系列操作使得逆序对的数量减少为0</li>
</ul>
<h2 id="选择排序">选择排序</h2>
<ul>
<li>在数组未排序部分找到最小元素</li>
<li>将它移动到数组已排序部分的末尾</li>
<li>继续对剩下未排序元素使用选择排序</li>
</ul>
<p>时间复杂度：<span class="math inline">\(O(n^2)\)</span></p>
<p>空间复杂度：<span class="math inline">\(O(1)\)</span></p>
<h2 id="堆排序">堆排序</h2>
<p>为了更快的获得最小元素，我们维护一个堆（大根堆）辅助寻找</p>
<ul>
<li><p>将所有元素放入一个大根堆，创建一个输入数组</p>
<figure>
<img src="Lec28%20Sorting/image-20251031212610216.png" alt="堆排序1" />
<figcaption aria-hidden="true">堆排序1</figcaption>
</figure></li>
<li><p>循环N次（N为元素个数）</p>
<ul>
<li>从大根堆中删除最大元素</li>
<li>将删除元素放在输出数组未使用部分的末尾</li>
</ul>
<figure>
<img src="Lec28%20Sorting/image-20251031212713606.png" alt="堆排序2" />
<figcaption aria-hidden="true">堆排序2</figcaption>
</figure></li>
</ul>
<p>时间复杂度：<span class="math inline">\(O(n\log n)\)</span></p>
<p>空间复杂度：<span class="math inline">\(O(n)\)</span></p>
<h3 id="优化">优化</h3>
<p>可以将堆存在原始输入空间中，避免使用两份空间，且在交换过程中产生多余的空位</p>
<ul>
<li>将输入转化成堆（最大堆）
<ul>
<li>上浮节点</li>
<li>确保当前节点为根的树是一个堆</li>
</ul></li>
<li>循环N次，从大根堆中删除最大元素，并移动到堆的最后一项（即与之交换）</li>
</ul>
<p>这样可以做到<span class="math inline">\(O(1)\)</span>的额外内存</p>
<p>时间复杂度：<span class="math inline">\(O(n\log n)\)</span></p>
<p>空间复杂度：<span class="math inline">\(O(1)\)</span></p>
]]></content>
      <categories>
        <category>CS61B</category>
      </categories>
      <tags>
        <tag>算法</tag>
        <tag>Java</tag>
        <tag>CS61B</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61B】Lec3-Java Basic2</title>
    <url>/CS61B/Lec3-Java%20Basic%202/</url>
    <content><![CDATA[<h1 id="java-basic-2">Java Basic 2</h1>
<h2 id="声明变量的原理">声明变量的原理</h2>
<ul>
<li>计算机留出对应变量类型的内存空间</li>
<li>Java创建一个内部表用来将变量名与各个位进行对应</li>
<li>首次声明时，Java不会在这些空间里写入任何东西，但你不可以使用一个未定义的变量，对变量赋值后，才会向里面填充内容</li>
</ul>
<h2 id="类的实例化">类的实例化</h2>
<p>当实例化一个对象时</p>
<ul>
<li>Java对类中的每个实例变量分配空间并初始化值</li>
<li>构造函数用其他一些值填充这些空间</li>
</ul>
<p>其中，new关键字的作用类似于寻找并返回新创建的对象的地址</p>
<h2 id="引用类型">引用类型</h2>
<p>不属于Java的八种基本类型的类型统称为引用类型</p>
<p>当声明一个引用类型时：</p>
<ul>
<li>Java会分配64bits空间，无论是哪一种对象</li>
<li>这些空间会被设置为
<ul>
<li>Null（二进制位全0）</li>
<li>该类特定实例的地址</li>
</ul></li>
</ul>
<img src="/CS61B/Lec3-Java%20Basic%202/image-20250708195819240.png" class="" title="内存">
<h2 id="参数传递">参数传递</h2>
<p>The Golden Rule of Equals：</p>
<p>给予变量a与b，<code>a=b</code>的意义为<strong>把b的bits值复制给a</strong></p>
<p>参数传递的方式按照此规律：即按值传递（有时候值为地址），而不能使用引用（如C++中的&amp;）</p>
<h2 id="数组的比较">数组的比较</h2>
<p>Java中，==运算符仅仅是比较两个数组的地址是否相同</p>
<p>如果需要比较内容是否已知，可以使用<code>Arrays.equals(x,y);</code>方法</p>
<h2 id="实例递归实现链表">实例：递归实现链表</h2>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">package</span><span style="color: #24292E"> lec3;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 无限长的整型链表</span></span>
<span class="line"><span style="color: #6A737D">// 使用递归写</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IntList</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> first;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> IntList rest;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IntList</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">f</span><span style="color: #24292E">, IntList </span><span style="color: #E36209">r</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">        first </span><span style="color: #D73A49">=</span><span style="color: #24292E"> f;</span></span>
<span class="line"><span style="color: #24292E">        rest </span><span style="color: #D73A49">=</span><span style="color: #24292E"> r;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">size</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (rest </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">null</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> rest.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (x </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">this</span><span style="color: #24292E">.first;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">this</span><span style="color: #24292E">.rest.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">(x </span><span style="color: #D73A49">-</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(</span><span style="color: #D73A49">String</span><span style="color: #24292E">[] </span><span style="color: #E36209">args</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">        IntList L </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IntList</span><span style="color: #24292E">(</span><span style="color: #005CC5">15</span><span style="color: #24292E">, </span><span style="color: #005CC5">null</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        L </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IntList</span><span style="color: #24292E">(</span><span style="color: #005CC5">10</span><span style="color: #24292E">, L);</span></span>
<span class="line"><span style="color: #24292E">        L </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IntList</span><span style="color: #24292E">(</span><span style="color: #005CC5">5</span><span style="color: #24292E">, L);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">        System.out.</span><span style="color: #6F42C1">println</span><span style="color: #24292E">(L.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">());</span></span>
<span class="line"><span style="color: #24292E">        System.out.</span><span style="color: #6F42C1">println</span><span style="color: #24292E">(L.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">(</span><span style="color: #005CC5">2</span><span style="color: #24292E">));</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>CS61B</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>CS61B</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61B】Lec27 Tries</title>
    <url>/CS61B/Lec27%20Tries/</url>
    <content><![CDATA[<h1 id="lec27-tries">Lec27 Tries</h1>
<p>假设我们有一个string类型的集合，我们可以构建一个特殊的数据结构Trie来高效存储与查找这些数据</p>
<h2 id="结构特征">结构特征</h2>
<p>Trie树将每个字符串的每个字母存储到每一个节点中，单词沿着从根向下的路径存储</p>
<p>如下图存储了单词sad与sam</p>
<style>.obyztciwgtwd{zoom: 67%;}</style>
<img src="/CS61B/Lec27%20Tries/image-20251013001225237.png" class="obyztciwgtwd" alt="trie">
<p>对于如何判定是一个单词，我们可以通过标记节点来获得节点结尾的位置，以判定遍历到了一整个单词</p>
<style>.ibmjwhpfcpnf{zoom:67%;}</style>
<img src="/CS61B/Lec27%20Tries/image-20251013001617276.png" class="ibmjwhpfcpnf" alt="trie2">
<h2 id="寻找特定单词">寻找特定单词</h2>
<p>从根节点向下寻找：</p>
<ul>
<li>若找不到特定单词节点，则无法找到特定单词</li>
<li>若找到了特定单词节点但并非标记的结尾节点，也无法找到特定单词</li>
</ul>
<style>.ufragcpklfqd{zoom:67%;}</style>
<img src="/CS61B/Lec27%20Tries/image-20251013002241761.png" class="ufragcpklfqd" alt="search">
<h2 id="其他特殊用处">其他特殊用处</h2>
<h3 id="匹配前缀">匹配前缀</h3>
<img src="/CS61B/Lec27%20Tries/image-20251013004002685.png" class="" title="前缀">
<h3 id="得到所有含有指定前缀的单词">得到所有含有指定前缀的单词</h3>
<ul>
<li>首先找到指定前缀的最后一个字母的节点位置</li>
<li>遍历该节点的下一个节点，调用函数将下一个节点的字母添加到当前前缀之后并继续遍历</li>
<li>若到达结尾则加入结果列表</li>
</ul>
<img src="/CS61B/Lec27%20Tries/image-20251013004403992.png" class="" title="所有指定前缀">
]]></content>
      <categories>
        <category>CS61B</category>
      </categories>
      <tags>
        <tag>字符串</tag>
        <tag>Java</tag>
        <tag>CS61B</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61B】Lec5-DLList</title>
    <url>/CS61B/Lec5-DLList/</url>
    <content><![CDATA[<h1 id="dllist">DLList</h1>
<h2 id="dllist-1">DLList</h2>
<p>为了让remove等操作更加高效，我们在SLList的基础上进行改进，变为双向链表，这样有利于提升操作效率</p>
<p>同时，对于头节点的操作，我们可以用两个头节点，但更好的方法是使用循环链表</p>
<p>具体实现详见Project1</p>
<h2 id="generic-lists">Generic Lists</h2>
<p>我们设计的SLList目前只接受int类型，通过修改可以实现接受各种类型</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">package</span><span style="color: #24292E"> lec5;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 数字列表</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">GenericList</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">T</span><span style="color: #24292E">&gt; {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">private</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">TNode</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">public</span><span style="color: #24292E"> T item;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">public</span><span style="color: #24292E"> TNode next;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">TNode</span><span style="color: #24292E">(T </span><span style="color: #E36209">i</span><span style="color: #24292E">, TNode </span><span style="color: #E36209">n</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">            item </span><span style="color: #D73A49">=</span><span style="color: #24292E"> i;</span></span>
<span class="line"><span style="color: #24292E">            next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> n;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D">//列表的第一项</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">private</span><span style="color: #24292E"> TNode sentinel;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">private</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> size;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">GenericList</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">        sentinel </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">TNode</span><span style="color: #24292E">(</span><span style="color: #005CC5">null</span><span style="color: #24292E">, </span><span style="color: #005CC5">null</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        size </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">addFirst</span><span style="color: #24292E">(T </span><span style="color: #E36209">x</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        size</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        sentinel.next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">TNode</span><span style="color: #24292E">(x, sentinel.next);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> T </span><span style="color: #6F42C1">getFirst</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> sentinel.next.item;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">addLast</span><span style="color: #24292E">(T </span><span style="color: #E36209">x</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        size</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        TNode p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> sentinel;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">while</span><span style="color: #24292E">(p.next</span><span style="color: #D73A49">!=</span><span style="color: #005CC5">null</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">            p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p.next;</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        p.next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">TNode</span><span style="color: #24292E">(x, </span><span style="color: #005CC5">null</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">size</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> size;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(</span><span style="color: #D73A49">String</span><span style="color: #24292E">[] </span><span style="color: #E36209">args</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        GenericList&lt;</span><span style="color: #D73A49">Integer</span><span style="color: #24292E">&gt; L </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> GenericList&lt;&gt;();</span></span>
<span class="line"><span style="color: #24292E">        L.</span><span style="color: #6F42C1">addFirst</span><span style="color: #24292E">(</span><span style="color: #005CC5">10</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        L.</span><span style="color: #6F42C1">addFirst</span><span style="color: #24292E">(</span><span style="color: #005CC5">5</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        L.</span><span style="color: #6F42C1">addLast</span><span style="color: #24292E">(</span><span style="color: #005CC5">20</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        System.out.</span><span style="color: #6F42C1">println</span><span style="color: #24292E">(L.</span><span style="color: #6F42C1">getFirst</span><span style="color: #24292E">());</span></span>
<span class="line"><span style="color: #24292E">        System.out.</span><span style="color: #6F42C1">println</span><span style="color: #24292E">(L.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">());</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>泛型的规则如下：</p>
<ul>
<li><p>.java文件中实现数据结构时，需要在文件开头设定泛型且只能设定一次</p></li>
<li><p>.java文件中使用数据结构时，设定需要的数据类型</p>
<p><code>类名&lt;引用类型&gt; 实例名 = new 类名&lt;&gt;();</code></p></li>
<li><p>声明和实例化时，需要使用引用类型</p>
<ul>
<li><p>int：Integer</p></li>
<li><h3 id="doubledouble">double：Double</h3></li>
<li><p>char：Character</p></li>
<li><p>boolean：Boolean</p></li>
<li><p>long：Long</p></li>
</ul></li>
</ul>
<h3 id="arrays">Arrays</h3>
<p>数组是一种拥有指定长度内存的对象，组成如下：</p>
<ul>
<li><h3 id="固定整型长度">固定整型长度</h3></li>
<li><p>N=length个内存空间</p>
<ul>
<li>所有内存空间有着相同数据类型</li>
<li>索引从0到length-1</li>
</ul></li>
</ul>
<h3 id="初始化方法">初始化方法</h3>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">x </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E">[</span><span style="color: #005CC5">3</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #24292E">y </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E">[]{</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">2</span><span style="color: #24292E">,</span><span style="color: #005CC5">3</span><span style="color: #24292E">,</span><span style="color: #005CC5">4</span><span style="color: #24292E">,</span><span style="color: #005CC5">5</span><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E">[] z </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span><span style="color: #005CC5">9</span><span style="color: #24292E">, </span><span style="color: #005CC5">10</span><span style="color: #24292E">, </span><span style="color: #005CC5">12</span><span style="color: #24292E">, </span><span style="color: #005CC5">13</span><span style="color: #24292E">};</span></span></code></pre></div></div></figure>
<h3 id="数组复制">数组复制</h3>
<ul>
<li>使用循环逐个复制</li>
<li>使用System.arraycopy()，包括五个参数
<ul>
<li>源数组</li>
<li>源数组起始位置</li>
<li>目标数组</li>
<li>目标数组起始位置</li>
<li>复制元素个数</li>
</ul></li>
</ul>
<h3 id="二维数组">二维数组</h3>
<figure>
<img src="Lec5-Java%20Basic%204/image-20250709203930693.png"
alt="二维数组" />
<figcaption aria-hidden="true">二维数组</figcaption>
</figure>
]]></content>
      <categories>
        <category>CS61B</category>
      </categories>
      <tags>
        <tag>数据结构</tag>
        <tag>Java</tag>
        <tag>CS61B</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61B】Lec4-SLList</title>
    <url>/CS61B/Lec4-SLList/</url>
    <content><![CDATA[<h1 id="sllist">SLList</h1>
<h2 id="sllist-1">SLList</h2>
<p>我们将对前面创建的链表进行封装与优化</p>
<p>对上节课的IntList的修改：</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">package</span><span style="color: #24292E"> lec4;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IntNode</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> item;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> IntNode next;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IntNode</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">i</span><span style="color: #24292E">, IntNode </span><span style="color: #E36209">n</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        item </span><span style="color: #D73A49">=</span><span style="color: #24292E"> i;</span></span>
<span class="line"><span style="color: #24292E">        next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> n;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>重构为IntNode</p>
<p>接下来创建类SLList并进行封装</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">package lec4;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 数字列表</span></span>
<span class="line"><span style="color: #24292E">public </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">SLList</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #6A737D">    //列表的第一项</span></span>
<span class="line"><span style="color: #24292E">    public IntNode first;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    public </span><span style="color: #6F42C1">SLList</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> x){</span></span>
<span class="line"><span style="color: #24292E">        first </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IntNode</span><span style="color: #24292E">(x,null);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    public </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">addFirst</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> x){</span></span>
<span class="line"><span style="color: #24292E">        first </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IntNode</span><span style="color: #24292E">(x, first);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    public </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">getFirst</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> first.item;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    public </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(String[] args){</span></span>
<span class="line"><span style="color: #24292E">        SLList L </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">SLList</span><span style="color: #24292E">(</span><span style="color: #005CC5">15</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        L.</span><span style="color: #6F42C1">addFirst</span><span style="color: #24292E">(</span><span style="color: #005CC5">10</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        L.</span><span style="color: #6F42C1">addFirst</span><span style="color: #24292E">(</span><span style="color: #005CC5">5</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        System.out.</span><span style="color: #6F42C1">println</span><span style="color: #24292E">(L.</span><span style="color: #6F42C1">getFirst</span><span style="color: #24292E">());</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>但接下来有一个问题：有些用户可能会不通过给定的方法，而是直接操纵内部属性，这样可能会导致一些致命性的错误，如<code>L.first = null</code>，这时我们需要加强抽象屏障</p>
<p>我们需要修改一些实例的权限，防止可以直接被操纵，具体操作为<strong>将public改为private</strong></p>
<p>private关键字使得其他类中的代码调用该类中的成员</p>
<p>隐藏实现细节：</p>
<ul>
<li>让用户理解更少</li>
<li>修改方法时是安全的（因为没有人可以调用）</li>
</ul>
<h2 id="嵌套类">嵌套类</h2>
<p>Java中可以将类进行嵌套，如我们可以将IntNode类放入SLList类中</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">package</span><span style="color: #24292E"> lec4;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 数字列表</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">SLList</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">private</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IntNode</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> item;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">public</span><span style="color: #24292E"> IntNode next;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IntNode</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">i</span><span style="color: #24292E">, IntNode </span><span style="color: #E36209">n</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">            item </span><span style="color: #D73A49">=</span><span style="color: #24292E"> i;</span></span>
<span class="line"><span style="color: #24292E">            next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> n;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D">//列表的第一项</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">private</span><span style="color: #24292E"> IntNode first;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">SLList</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        first </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IntNode</span><span style="color: #24292E">(x, </span><span style="color: #005CC5">null</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">addFirst</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        first </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IntNode</span><span style="color: #24292E">(x, first);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">getFirst</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> first.item;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(</span><span style="color: #D73A49">String</span><span style="color: #24292E">[] </span><span style="color: #E36209">args</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        SLList L </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">SLList</span><span style="color: #24292E">(</span><span style="color: #005CC5">15</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        L.</span><span style="color: #6F42C1">addFirst</span><span style="color: #24292E">(</span><span style="color: #005CC5">10</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        L.</span><span style="color: #6F42C1">addFirst</span><span style="color: #24292E">(</span><span style="color: #005CC5">5</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        System.out.</span><span style="color: #6F42C1">println</span><span style="color: #24292E">(L.</span><span style="color: #6F42C1">getFirst</span><span style="color: #24292E">());</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>当一个类无法独立存在（明显从属于另一个类）时，设为嵌套类是合适的。</p>
<p>对于第5行嵌套类是否设为静态：若嵌套类不使用外部类的任何内容，则可以设为static</p>
<h2 id="增加功能">增加功能</h2>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">addLast</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> x){</span></span>
<span class="line"><span style="color: #24292E">    IntNode p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> first;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E">(p.next</span><span style="color: #D73A49">!=</span><span style="color: #005CC5">null</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p.next;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    p.next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IntNode</span><span style="color: #24292E">(x, </span><span style="color: #005CC5">null</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">size</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">size</span><span style="color: #24292E">(first);</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">private</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">size</span><span style="color: #24292E">(IntNode p){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (p</span><span style="color: #D73A49">==</span><span style="color: #005CC5">null</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #6F42C1">size</span><span style="color: #24292E">(p.next);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>其中，计算size时使用了递归，是通过在一个非递归类里调用了递归方法实现的：</p>
<ul>
<li>创建一个私有的递归方法，以那些裸递归对象作为参数</li>
<li>在一个公共方法中直接调用该递归方法</li>
</ul>
<p>但这种方式很低效，我们需要优化为<span
class="math inline">\(O(1)\)</span>复杂度</p>
<h2 id="优化递归">优化递归</h2>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">package</span><span style="color: #24292E"> lec4;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 数字列表</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">SLList</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">private</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IntNode</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> item;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">public</span><span style="color: #24292E"> IntNode next;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IntNode</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">i</span><span style="color: #24292E">, IntNode </span><span style="color: #E36209">n</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">            item </span><span style="color: #D73A49">=</span><span style="color: #24292E"> i;</span></span>
<span class="line"><span style="color: #24292E">            next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> n;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D">//列表的第一项</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">private</span><span style="color: #24292E"> IntNode first;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">private</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> size;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">SLList</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        first </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IntNode</span><span style="color: #24292E">(x, </span><span style="color: #005CC5">null</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        size </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">addFirst</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        size</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        first </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IntNode</span><span style="color: #24292E">(x, first);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">getFirst</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> first.item;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">addLast</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        size</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        IntNode p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> first;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">while</span><span style="color: #24292E">(p.next</span><span style="color: #D73A49">!=</span><span style="color: #005CC5">null</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">            p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p.next;</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        p.next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IntNode</span><span style="color: #24292E">(x, </span><span style="color: #005CC5">null</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">size</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> size;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(</span><span style="color: #D73A49">String</span><span style="color: #24292E">[] </span><span style="color: #E36209">args</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        SLList L </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">SLList</span><span style="color: #24292E">(</span><span style="color: #005CC5">15</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        L.</span><span style="color: #6F42C1">addFirst</span><span style="color: #24292E">(</span><span style="color: #005CC5">10</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        L.</span><span style="color: #6F42C1">addFirst</span><span style="color: #24292E">(</span><span style="color: #005CC5">5</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        L.</span><span style="color: #6F42C1">addLast</span><span style="color: #24292E">(</span><span style="color: #005CC5">20</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        System.out.</span><span style="color: #6F42C1">println</span><span style="color: #24292E">(L.</span><span style="color: #6F42C1">getFirst</span><span style="color: #24292E">());</span></span>
<span class="line"><span style="color: #24292E">        System.out.</span><span style="color: #6F42C1">println</span><span style="color: #24292E">(L.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">());</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>我们创建了一个size变量，存储数据来方便检索，在add的时候同时更新该值</p>
<h2 id="创建空链表">创建空链表</h2>
<p>修改为空链表后，addLast方法会出现问题，因为此时的first为null，无法访问first.next</p>
<p>解决方法1：</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">addLast</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> x){</span></span>
<span class="line"><span style="color: #24292E">        size</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (first </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">null</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">            first </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IntNode</span><span style="color: #24292E">(x, </span><span style="color: #005CC5">null</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ;</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        IntNode p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> first;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">while</span><span style="color: #24292E">(p.next</span><span style="color: #D73A49">!=</span><span style="color: #005CC5">null</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">            p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p.next;</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        p.next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IntNode</span><span style="color: #24292E">(x, </span><span style="color: #005CC5">null</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span></code></pre></div></div></figure>
<p>这样需要一个特殊情况，使得代码更加复杂以及更难追踪</p>
<p>解决方法2：</p>
<p>在空链表初始化时加入头节点（sentinel）</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">package</span><span style="color: #24292E"> lec4;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// 数字列表</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">SLList</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">private</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IntNode</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> item;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">public</span><span style="color: #24292E"> IntNode next;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IntNode</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">i</span><span style="color: #24292E">, IntNode </span><span style="color: #E36209">n</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">            item </span><span style="color: #D73A49">=</span><span style="color: #24292E"> i;</span></span>
<span class="line"><span style="color: #24292E">            next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> n;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D">//列表的第一项</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">private</span><span style="color: #24292E"> IntNode sentinel;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">private</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> size;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">SLList</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        sentinel </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IntNode</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">, </span><span style="color: #005CC5">null</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        sentinel.next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IntNode</span><span style="color: #24292E">(x, </span><span style="color: #005CC5">null</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        size </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">SLList</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">        sentinel </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IntNode</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">, </span><span style="color: #005CC5">null</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        size </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">addFirst</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        size</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        sentinel.next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IntNode</span><span style="color: #24292E">(x, sentinel.next);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">getFirst</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> sentinel.next.item;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">addLast</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        size</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        IntNode p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> sentinel;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">while</span><span style="color: #24292E">(p.next</span><span style="color: #D73A49">!=</span><span style="color: #005CC5">null</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">            p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p.next;</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        p.next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IntNode</span><span style="color: #24292E">(x, </span><span style="color: #005CC5">null</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">size</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> size;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(</span><span style="color: #D73A49">String</span><span style="color: #24292E">[] </span><span style="color: #E36209">args</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        SLList L </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">SLList</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">        L.</span><span style="color: #6F42C1">addFirst</span><span style="color: #24292E">(</span><span style="color: #005CC5">10</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        L.</span><span style="color: #6F42C1">addFirst</span><span style="color: #24292E">(</span><span style="color: #005CC5">5</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        L.</span><span style="color: #6F42C1">addLast</span><span style="color: #24292E">(</span><span style="color: #005CC5">20</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        System.out.</span><span style="color: #6F42C1">println</span><span style="color: #24292E">(L.</span><span style="color: #6F42C1">getFirst</span><span style="color: #24292E">());</span></span>
<span class="line"><span style="color: #24292E">        System.out.</span><span style="color: #6F42C1">println</span><span style="color: #24292E">(L.</span><span style="color: #6F42C1">size</span><span style="color: #24292E">());</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>sentinal在这里的用处为占位，该节点永远不为空，且其值随意</p>
<h2 id="不变式invariants">不变式(Invariants)</h2>
<p>不变式就是代码运行中保证成立的条件</p>
<p>存在头节点的SLList有以下不变式：</p>
<ul>
<li>头节点的引用总指向头节点</li>
<li>第一个节点总存在<code>sentinal.next</code></li>
<li><code>size</code>变量总是表示添加节点的数目</li>
</ul>
]]></content>
      <categories>
        <category>CS61B</category>
      </categories>
      <tags>
        <tag>数据结构</tag>
        <tag>Java</tag>
        <tag>CS61B</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61B】Lec6-Testing</title>
    <url>/CS61B/Lec6-Testing/</url>
    <content><![CDATA[<h1 id="testing">Testing</h1>
<h2 id="unit-tests">Unit Tests</h2>
<h3 id="测试库">测试库</h3>
<p>可以使用一些库中的语句进行测试，如：Truth库、JUnits库等</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">package</span><span style="color: #24292E"> lec6;</span></span>
<span class="line"><span style="color: #D73A49">import</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> com.google.common.truth.Truth.assertThat;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">TestSort</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">testSort</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">String</span><span style="color: #24292E">[] input </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span><span style="color: #032F62">&quot;bob&quot;</span><span style="color: #24292E">, </span><span style="color: #032F62">&quot;luka&quot;</span><span style="color: #24292E">, </span><span style="color: #032F62">&quot;C++&quot;</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">String</span><span style="color: #24292E">[] expected </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span><span style="color: #032F62">&quot;bob&quot;</span><span style="color: #24292E">, </span><span style="color: #032F62">&quot;C++&quot;</span><span style="color: #24292E">, </span><span style="color: #032F62">&quot;luka&quot;</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">        Sort.</span><span style="color: #6F42C1">sort</span><span style="color: #24292E">(input);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">assertThat</span><span style="color: #24292E">(input).</span><span style="color: #6F42C1">isEqualTo</span><span style="color: #24292E">(expected);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(</span><span style="color: #D73A49">String</span><span style="color: #24292E">[] </span><span style="color: #E36209">args</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">testSort</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="test"><span class="citation" data-cites="test">@test</span></h3>
<p>使用标识符@test可以实现在文件中直接写入测试，而不需要在main函数中调用</p>
<p>IDEA中，使用该测试可以使用其自带的单元测试框架，可观列出测试结果</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">package</span><span style="color: #24292E"> lec6;</span></span>
<span class="line"><span style="color: #D73A49">import</span><span style="color: #24292E"> org.junit.jupiter.api.Test;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">import</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> com.google.common.truth.Truth.assertThat;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">TestSort</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    @</span><span style="color: #D73A49">Test</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">testSort</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">String</span><span style="color: #24292E">[] input </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span><span style="color: #032F62">&quot;bob&quot;</span><span style="color: #24292E">, </span><span style="color: #032F62">&quot;luka&quot;</span><span style="color: #24292E">, </span><span style="color: #032F62">&quot;C++&quot;</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">String</span><span style="color: #24292E">[] expected </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span><span style="color: #032F62">&quot;bob&quot;</span><span style="color: #24292E">, </span><span style="color: #032F62">&quot;C++&quot;</span><span style="color: #24292E">, </span><span style="color: #032F62">&quot;luka&quot;</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">        Sort.</span><span style="color: #6F42C1">sort</span><span style="color: #24292E">(input);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">assertThat</span><span style="color: #24292E">(input).</span><span style="color: #6F42C1">isEqualTo</span><span style="color: #24292E">(expected);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="example-building-selection-sort">Example: Building Selection
Sort</h2>
<p>原理：</p>
<ul>
<li>选择最小的元素</li>
<li>移至表头</li>
<li>对剩下n-1个元素进行选择排序</li>
</ul>
<p>思路：</p>
<img src="/CS61B/Lec6-Testing/image-20250710193340147.png" class="" title="思路">
<p>代码：测试部分</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">package</span><span style="color: #24292E"> lec6;</span></span>
<span class="line"><span style="color: #D73A49">import</span><span style="color: #24292E"> org.junit.jupiter.api.Test;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">import</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> com.google.common.truth.Truth.assertThat;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">TestSort</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    @</span><span style="color: #D73A49">Test</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">testFindSmallest</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">String</span><span style="color: #24292E">[] input </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span><span style="color: #032F62">&quot;bob&quot;</span><span style="color: #24292E">, </span><span style="color: #032F62">&quot;luka&quot;</span><span style="color: #24292E">, </span><span style="color: #032F62">&quot;c++&quot;</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">int</span><span style="color: #24292E"> expected </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">int</span><span style="color: #24292E"> actual </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Sort.</span><span style="color: #6F42C1">findSmallest</span><span style="color: #24292E">(input, </span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">assertThat</span><span style="color: #24292E">(actual).</span><span style="color: #6F42C1">isEqualTo</span><span style="color: #24292E">(expected);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    @</span><span style="color: #D73A49">Test</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">testSwap</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">String</span><span style="color: #24292E">[] input </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span><span style="color: #032F62">&quot;bob&quot;</span><span style="color: #24292E">, </span><span style="color: #032F62">&quot;luka&quot;</span><span style="color: #24292E">, </span><span style="color: #032F62">&quot;c++&quot;</span><span style="color: #24292E">};</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">String</span><span style="color: #24292E">[] expected </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span><span style="color: #032F62">&quot;luka&quot;</span><span style="color: #24292E">, </span><span style="color: #032F62">&quot;bob&quot;</span><span style="color: #24292E">, </span><span style="color: #032F62">&quot;c++&quot;</span><span style="color: #24292E">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">        Sort.</span><span style="color: #6F42C1">swap</span><span style="color: #24292E">(input, </span><span style="color: #005CC5">0</span><span style="color: #24292E">, </span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">assertThat</span><span style="color: #24292E">(input).</span><span style="color: #6F42C1">isEqualTo</span><span style="color: #24292E">(expected);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>实现部分</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">package</span><span style="color: #24292E"> lec6;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Sort</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">sort</span><span style="color: #24292E">(</span><span style="color: #D73A49">String</span><span style="color: #24292E">[] </span><span style="color: #E36209">x</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">sort</span><span style="color: #24292E">(x, </span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">sort</span><span style="color: #24292E">(</span><span style="color: #D73A49">String</span><span style="color: #24292E">[] </span><span style="color: #E36209">x</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (s </span><span style="color: #D73A49">==</span><span style="color: #24292E"> x.length){</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ;</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">int</span><span style="color: #24292E"> smallest </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">findSmallest</span><span style="color: #24292E">(x, s);</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">swap</span><span style="color: #24292E">(x, s, smallest);</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">sort</span><span style="color: #24292E">(x,s</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">findSmallest</span><span style="color: #24292E">(</span><span style="color: #D73A49">String</span><span style="color: #24292E">[] </span><span style="color: #E36209">x</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">int</span><span style="color: #24292E"> smallestIndex </span><span style="color: #D73A49">=</span><span style="color: #24292E"> s;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> s; i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">x.length; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">int</span><span style="color: #24292E"> cmp </span><span style="color: #D73A49">=</span><span style="color: #24292E"> x[i].</span><span style="color: #6F42C1">compareTo</span><span style="color: #24292E">(x[smallestIndex]);</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (cmp</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">0</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">                smallestIndex </span><span style="color: #D73A49">=</span><span style="color: #24292E"> i;</span></span>
<span class="line"><span style="color: #24292E">            }</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> smallestIndex;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">swap</span><span style="color: #24292E">(</span><span style="color: #D73A49">String</span><span style="color: #24292E">[] </span><span style="color: #E36209">x</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">a</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">b</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        String temp </span><span style="color: #D73A49">=</span><span style="color: #24292E"> x[a];</span></span>
<span class="line"><span style="color: #24292E">        x[a] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> x[b];</span></span>
<span class="line"><span style="color: #24292E">        x[b] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> temp;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>综上，测试可以增强代码的鲁棒性</p>
<ul>
<li>在单元测试中增加信心</li>
<li>确保之后的改变不会破坏代码</li>
<li>辅助代码的重构</li>
</ul>
]]></content>
      <categories>
        <category>CS61B</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>CS61B</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61B】Lec6-ArrayLists</title>
    <url>/CS61B/Lec7-ArrayLists/</url>
    <content><![CDATA[<h1 id="arraylist">ArrayList</h1>
<h2 id="array中的随机访问">Array中的随机访问</h2>
<p>根据指定位置获取a数组中的元素是很快的，原因如下：</p>
<ul>
<li>与数组大小无关</li>
<li>内存空间其实都是相同的大小</li>
</ul>
<h2 id="实现">实现</h2>
<h3 id="添加删除元素">添加删除元素</h3>
<p>观察发现：</p>
<ul>
<li>元素个数可以用size表示</li>
<li>在结尾添加元素时，添加的位置其实是第size位</li>
<li>而获得结尾元素时，结尾元素位于size-1的位置</li>
</ul>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">addLast</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> x){</span></span>
<span class="line"><span style="color: #24292E">        items[size] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> x;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">getLast</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> items[size</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> items[i];</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">removeLast</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> itemToReturn </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">getLast</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    size </span><span style="color: #D73A49">-=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> itemToReturn;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="扩容">扩容</h3>
<p>当列表满了以后，还想扩容并且增加容量，需要创建一个新数组，并调整size，将新元素加入数组</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">private</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">resize</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> capacity){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">int</span><span style="color: #24292E">[] a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E">[capacity];</span></span>
<span class="line"><span style="color: #24292E">        System.</span><span style="color: #6F42C1">arraycopy</span><span style="color: #24292E">(items, </span><span style="color: #005CC5">0</span><span style="color: #24292E">, a, </span><span style="color: #005CC5">0</span><span style="color: #24292E">, size);</span></span>
<span class="line"><span style="color: #24292E">        items </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">addLast</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> x){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (items.length </span><span style="color: #D73A49">==</span><span style="color: #24292E"> size){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">resize</span><span style="color: #24292E">(size</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    items[size] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> x;</span></span>
<span class="line"><span style="color: #24292E">    size</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>这里将resize作为一个private方法，即调用addLast时，若发现空间不够，则会自动调用resize扩容，而不用手动调用</p>
<p>但每次扩容都会复制一份数组，扩容次数多了，创建的数组空间就会变大，导致性能下降</p>
<p>我们可以在每次扩容时在原大小基础上乘一个常量以一次性扩大大量空间，可以有效解决性能问题（Python的列表就是这样的原理）</p>
<p>但有时候不需要那么多空间，会造成空间浪费，故在发现利用率不够时，我们需要缩小数组尺寸：</p>
<ul>
<li>定义一个使用比率：<span class="math inline">\(R =
\frac{\text{size}}{\text{items.length}}\)</span></li>
<li>常用方案位当<span
class="math inline">\(R&lt;0.25\)</span>时，将size减半</li>
</ul>
<h3 id="泛型化">泛型化</h3>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">package</span><span style="color: #24292E"> lec7;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ArrayList</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">T</span><span style="color: #24292E">&gt; {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">private</span><span style="color: #24292E"> </span><span style="color: #D73A49">T</span><span style="color: #24292E">[] items;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">private</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> size;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ArrayList</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">        size </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        items </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #D73A49">T</span><span style="color: #24292E">[]) </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #D73A49">Object</span><span style="color: #24292E">[</span><span style="color: #005CC5">100</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">private</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">resize</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">capacity</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">T</span><span style="color: #24292E">[] a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #D73A49">T</span><span style="color: #24292E">[])</span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #D73A49">Object</span><span style="color: #24292E">[capacity];</span></span>
<span class="line"><span style="color: #24292E">            System.</span><span style="color: #6F42C1">arraycopy</span><span style="color: #24292E">(items, </span><span style="color: #005CC5">0</span><span style="color: #24292E">, a, </span><span style="color: #005CC5">0</span><span style="color: #24292E">, size);</span></span>
<span class="line"><span style="color: #24292E">            items </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">addLast</span><span style="color: #24292E">(T </span><span style="color: #E36209">x</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (items.length </span><span style="color: #D73A49">==</span><span style="color: #24292E"> size){</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #6F42C1">resize</span><span style="color: #24292E">(size</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        items[size] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> x;</span></span>
<span class="line"><span style="color: #24292E">        size</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> T </span><span style="color: #6F42C1">getLast</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> items[size</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> T </span><span style="color: #6F42C1">get</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">i</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> items[i];</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> T </span><span style="color: #6F42C1">removeLast</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">        T itemToReturn </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">getLast</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">        items[size</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">null</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        size </span><span style="color: #D73A49">-=</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> itemToReturn;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>有一个问题：在创建泛型T的数组引用时，会用到<code>(T[]) new Object[100]</code>这样的创建方法，即对类型进行了强制类型转换，IDEA会报warning：未检查的转换，此时可以忽略</p>
<p>在泛型的情况下，对于删除元素最好在减小size的同时将数组对应位置设置为null，这样垃圾回收器可以发现并回收内存，因为泛型导致了存入数组的数据类型大小可能会很大，从而浪费空间</p>
]]></content>
      <categories>
        <category>CS61B</category>
      </categories>
      <tags>
        <tag>数据结构</tag>
        <tag>Java</tag>
        <tag>CS61B</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61B】Lec8-Interface &amp; Inheritance</title>
    <url>/CS61B/Lec8-Interface%20&amp;%20Inheritance/</url>
    <content><![CDATA[<h1 id="interface-inheritance">Interface &amp; Inheritance</h1>
<h2 id="重载">重载</h2>
<p>Java允许多个方法拥有相同名称，只要他们的参数不同，这就是Java中的重载</p>
<p>重载的优缺点：</p>
<ul>
<li>代码基本一样</li>
<li>对其余猎豹不适用，需要增加重载</li>
<li>难维护</li>
</ul>
<h2 id="hypernym-and-hyponym">Hypernym and Hyponym</h2>
<p>上位词与下位词</p>
<p>如Dog与poodle、malamute等狗的品种，前者为后者的上位词，后者为前者的下位词</p>
<p>Java中也有类似的概念，如我们可以把List作为SLList与ArrayList的上位词</p>
<p>在Java中表示这种属性：</p>
<ol type="1">
<li>给上位词定义一个引用属性</li>
<li>指定某些词为该上位词的下位词</li>
</ol>
<ul>
<li>使用关键词<code>interface</code>来定义上位词</li>
<li>使用关键词<code>implements</code>来定位下位词</li>
</ul>
<p>接口内容：</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">package</span><span style="color: #24292E"> lec8;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">interface</span><span style="color: #24292E"> </span><span style="color: #6F42C1">List61B</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">T</span><span style="color: #24292E">&gt; {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">addFirst</span><span style="color: #24292E">(T </span><span style="color: #E36209">x</span><span style="color: #24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">addLast</span><span style="color: #24292E">(T </span><span style="color: #E36209">x</span><span style="color: #24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> T </span><span style="color: #6F42C1">getFirst</span><span style="color: #24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> T </span><span style="color: #6F42C1">getLast</span><span style="color: #24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> T </span><span style="color: #6F42C1">get</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">i</span><span style="color: #24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> T </span><span style="color: #6F42C1">removeLast</span><span style="color: #24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">size</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>下位词部分修改：</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ArrayList</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">T</span><span style="color: #24292E">&gt; </span><span style="color: #D73A49">implements</span><span style="color: #24292E"> </span><span style="color: #6F42C1">List61B</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #24292E">    ...</span></span>
<span class="line"><span style="color: #24292E">public class </span><span style="color: #6F42C1">SLList</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">T</span><span style="color: #24292E">&gt; implements </span><span style="color: #6F42C1">List61B</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">T</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #24292E">    ...</span></span></code></pre></div></div></figure>
<p>这样在使用时我们只需要以该接口作为类型定义即可</p>
<h2 id="重写">重写</h2>
<p>若你有一个子类实现接口，其方法与超类的签名相同，则可以在子类中重写来覆盖该方法</p>
<p>有相同名称而不同签名的方法叫做重写</p>
<p>在要重写的方法上面添加<code>@override</code>标签，当该方法不是一个重写方法时，该代码不会被编译</p>
<p>使用该标签的优点：</p>
<ul>
<li>主要优点：防止拼写错误，当标记了@override，但方法并没有被重写，就会爆CE</li>
<li>提醒程序员方法来自于更高级的继承</li>
</ul>
<h2 id="interface-inheritance-1">Interface Inheritance</h2>
<p>使用implements关键字来指定子类所具备的能力叫作接口继承</p>
<ul>
<li>接口：所有方法签名的列表</li>
<li>继承：子类继承了来自超类的接口</li>
<li>接口继承指定了子类可以做什么，而没有指定怎么做</li>
<li>子类必须重写所有方法，否则会CE</li>
</ul>
<h2 id="implementation-inheritance">Implementation Inheritance</h2>
<p>接口继承只继承了签名，而没有继承实现</p>
<p>Java允许另一种继承：<strong>实现继承</strong>，使得子类可以继承签名与实现</p>
<p>使用<strong>default</strong>关键字来指定一个子类可以从接口继承的方法</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// implementation inheritance</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">default</span><span style="color: #24292E"> </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">print</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;i</span><span style="color: #D73A49">&lt;</span><span style="color: #6F42C1">size</span><span style="color: #24292E">();i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">            System.out.</span><span style="color: #6F42C1">print</span><span style="color: #24292E">(</span><span style="color: #6F42C1">get</span><span style="color: #24292E">(i)</span><span style="color: #D73A49">+</span><span style="color: #032F62">&quot; &quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        System.out.</span><span style="color: #6F42C1">println</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    }</span></span></code></pre></div></div></figure>
<p>（在接口文件中写默认的print方法，子类可以继承该方法）</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">// 重写接口中的print方法</span></span>
<span class="line"><span style="color: #24292E">   @</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #24292E">   </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">print</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">       IntNode p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> sentinel.next;</span></span>
<span class="line"><span style="color: #24292E">       </span><span style="color: #D73A49">while</span><span style="color: #24292E">(p</span><span style="color: #D73A49">!=</span><span style="color: #005CC5">null</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">           System.out.</span><span style="color: #6F42C1">print</span><span style="color: #24292E">(p.item</span><span style="color: #D73A49">+</span><span style="color: #032F62">&quot; &quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">           p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p.next;</span></span>
<span class="line"><span style="color: #24292E">       }</span></span>
<span class="line"><span style="color: #24292E">   }</span></span></code></pre></div></div></figure>
<p>（针对特定子类，可以对default方法进行重写）</p>
<h2 id="abstract-data-type">Abstract Data Type</h2>
<p>抽象数据类型(ADT)仅由其操作定义，而不由其实现定义</p>
]]></content>
      <categories>
        <category>CS61B</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>CS61B</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61B】Lec9-Subtype Polymorphism, Comparators, Comparables, Generic Functions</title>
    <url>/CS61B/Lec9-Subtype%20Polymorphism,%20Comparators,%20Comparables,%20Generic%20Functions/</url>
    <content><![CDATA[<h1
id="lec9-subtype-polymorphism-comparators-comparables-generic-functions">Lec9-Subtype
Polymorphism, Comparators, Comparables, Generic Functions</h1>
<h2 id="subtype-polymorphism">Subtype Polymorphism</h2>
<p>Java中没有重载运算符，故我们需要使用Comparable接口来实现类似功能</p>
<p>Java源码中对该接口的描述如下：</p>
<img src="/CS61B/Lec9-Subtype%20Polymorphism,%20Comparators,%20Comparables,%20Generic%20Functions/image-20250717190211451.png" class="" title="comparable.java">
<p>我们需要实现该接口</p>
<blockquote>
<p>e.g. 定义Dog类，通过size属性比较两只狗的大小</p>
</blockquote>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">package</span><span style="color: #24292E"> </span><span style="color: #B31D28; font-style: italic">L</span><span style="color: #24292E">ec9;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Dog</span><span style="color: #24292E"> </span><span style="color: #D73A49">implements</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Comparable</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">Dog</span><span style="color: #24292E">&gt;{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> String name;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> size;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Dog</span><span style="color: #24292E">(String </span><span style="color: #E36209">n</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">s</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        name </span><span style="color: #D73A49">=</span><span style="color: #24292E"> n;</span></span>
<span class="line"><span style="color: #24292E">        size </span><span style="color: #D73A49">=</span><span style="color: #24292E"> s;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    @</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">compareTo</span><span style="color: #24292E">(Dog </span><span style="color: #E36209">o</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (size </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> o.size){</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (size </span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> o.size){</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>另一种写法</p>
<p>java规定了若更小则返回负数</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">@</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">compareTo</span><span style="color: #24292E">(Dog o) {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> size </span><span style="color: #D73A49">-</span><span style="color: #24292E"> o.size;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>这种操作被称为子类型多态</p>
<ul>
<li>超类指定了可以干什么（如Comparable接口指定了比较功能）</li>
<li>子类通过重写超类的抽象方法，来使java根据调用方法的对象来决定运行时该做什么</li>
</ul>
<h2 id="comparator">Comparator</h2>
<p>Java提供了接口Comparator用来比较其他对象</p>
<p>语法：</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">interface</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Comparator</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">T</span><span style="color: #24292E">&gt;{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">compare</span><span style="color: #24292E">(T </span><span style="color: #E36209">o1</span><span style="color: #24292E">, T </span><span style="color: #E36209">o2</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    ...</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>Dog类中</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">NameComparator</span><span style="color: #24292E"> </span><span style="color: #D73A49">implements</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Comparator</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">Dog</span><span style="color: #24292E">&gt; {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    @</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">compare</span><span style="color: #24292E">(Dog </span><span style="color: #E36209">a</span><span style="color: #24292E">, Dog </span><span style="color: #E36209">b</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> a.name.</span><span style="color: #6F42C1">compareTo</span><span style="color: #24292E">(b.name);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>其中<code>Dog.NameComparator()</code>的数据类型为<code>Comparator&lt;Dog&gt;</code></p>
<p>更现代的方式是使用lambda表达式定义comparator</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">Comparator&lt;</span><span style="color: #D73A49">Dog</span><span style="color: #24292E">&gt; dc </span><span style="color: #D73A49">=</span><span style="color: #24292E">(d1, d2) </span><span style="color: #D73A49">-&gt;</span><span style="color: #24292E"> d1.name.</span><span style="color: #6F42C1">compareTo</span><span style="color: #24292E">(d2.name);</span></span>
<span class="line"><span style="color: #24292E">Dog maxNameDog </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Collection.</span><span style="color: #6F42C1">max</span><span style="color: #24292E">(dogs,dc);</span></span></code></pre></div></div></figure>
<h2 id="泛型函数">泛型函数</h2>
<p>如何编写自己的方法</p>
<blockquote>
<p>e.g. 实现一个方法，从数组中随机选择一个元素，并且接受各种类型</p>
</blockquote>
<p>在这里，选择随机元素的方法是静态的，正确方式是让方法本身变为泛型，而非让类变为泛型</p>
<p>即声明了一个公共静态函数，用于处理类型T的对象</p>
<p>因为如果让整个类泛型化，你需要实例化那个类来获得泛型行为，但把该方法作为一个静态方法来看，并不需要实例化</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">publicc </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">RandomPicker</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> &lt;</span><span style="color: #D73A49">T</span><span style="color: #24292E">&gt; T </span><span style="color: #6F42C1">pickRandom</span><span style="color: #24292E">(</span><span style="color: #D73A49">T</span><span style="color: #24292E">[] </span><span style="color: #E36209">x</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        Random random </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Random</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">int</span><span style="color: #24292E"> randomIndex </span><span style="color: #D73A49">=</span><span style="color: #24292E"> random.</span><span style="color: #6F42C1">nextInt</span><span style="color: #24292E">(x.length);</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> x[randomIndex];</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>CS61B</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>CS61B</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61B】Project0-2048</title>
    <url>/CS61B/Project0%20-%202048/</url>
    <content><![CDATA[<h1 id="project0---2048">Project0 - 2048</h1>
<blockquote>
<p>Hard Mode</p>
</blockquote>
<h2 id="项目结构">项目结构</h2>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">proj0_hardmode</span></span>
<span class="line"><span style="color: #24292e">├── game2048logic</span></span>
<span class="line"><span style="color: #24292e">|   ├── GameLogic.java</span></span>
<span class="line"><span style="color: #24292e">|   ├── MatrixUtils.java</span></span>
<span class="line"><span style="color: #24292e">├── game2048rendering</span></span>
<span class="line"><span style="color: #24292e">    ├── Board.java</span></span>
<span class="line"><span style="color: #24292e">    ... (some other files) ...</span></span>
<span class="line"><span style="color: #24292e">    ├── Main.java</span></span>
<span class="line"><span style="color: #24292e">    ├── Side.java</span></span>
<span class="line"><span style="color: #24292e">    ├── Tile.java</span></span></code></pre></div></div></figure>
<p>分为了两个包：负责逻辑与负责渲染的，主要更改在负责逻辑的包中</p>
<h2 id="task1游戏原理">Task1：游戏原理</h2>
<p>2048的核心规则为Tilting，项目需要主要实现该功能</p>
<p>当两个方格发生融合时，遵循以下规则</p>
<ol type="1">
<li><p>两相同值的方格融合为一个，数值翻倍</p></li>
<li><p>由合并产生的新方块在该次移动中不会再次合并。例如，当[X, 2, 2,
4]（X 代表空格）向左移动时，结果应为[4, 4, X, X]而非[8, X, X,
X]。这是因为最左侧的 4 已参与过合并，故不应二次合并</p></li>
<li><p>当融合方向上有三个相邻同值方块时，仅该方向最前方的两个方块会合并，第三个方块保不变。例如[X,
2, 2, 2]左移后应为[4, 2, X, X]，而非[2, 4, X, X]。</p></li>
<li><p>推论：若有四个相邻同值方块，则会合并出两个同值方块，如[2, 2, 2,
2]左移后应该为[4, 4, X, X]，但合并出的两个同值方块不会合并</p></li>
</ol>
<h2 id="task2实现">Task2：实现</h2>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">compress</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E">[][] board, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> c){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> n </span><span style="color: #D73A49">=</span><span style="color: #24292E"> board.length;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E">[] comp </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E">[n];</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> index </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E">[] ints </span><span style="color: #D73A49">:</span><span style="color: #24292E"> board) {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (ints[c] </span><span style="color: #D73A49">!=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">            comp[index</span><span style="color: #D73A49">++</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> ints[c];</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">n; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        board[i][c] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> comp[i];</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">merge</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E">[][] board, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> c){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> n </span><span style="color: #D73A49">=</span><span style="color: #24292E"> board.length;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">n</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E">(board[i][c]</span><span style="color: #D73A49">!=</span><span style="color: #005CC5">0</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E"> board[i][c]</span><span style="color: #D73A49">==</span><span style="color: #24292E">board[i</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">][c]){</span></span>
<span class="line"><span style="color: #24292E">            board[i][c] </span><span style="color: #D73A49">*=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">            board[i</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">][c] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">            i</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">moveColumn</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E">[][] board, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> c){</span></span>
<span class="line"><span style="color: #24292E">   </span><span style="color: #6F42C1">compress</span><span style="color: #24292E">(board, c);</span></span>
<span class="line"><span style="color: #24292E">   </span><span style="color: #6F42C1">merge</span><span style="color: #24292E">(board, c);</span></span>
<span class="line"><span style="color: #24292E">   </span><span style="color: #6F42C1">compress</span><span style="color: #24292E">(board, c);</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">moveUp</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E">[][] board){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">board.length; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">moveColumn</span><span style="color: #24292E">(board, i);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>compress函数用于压缩，即将所有数都移动到顶上，而不进行合并</p>
<p>merge函数用于将相邻的数进行合并</p>
<p>每次移动一列，然后循环处理每列，处理一列时移动后合并，合并后可能会出现中间合并剩下的空位置，需要再进行压缩</p>
]]></content>
      <categories>
        <category>CS61B</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>CS61B</tag>
        <tag>Project</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61B】Project1A-Linked List Deque 61B</title>
    <url>/CS61B/Project1A-Linked%20List%20Deque%2061B/</url>
    <content><![CDATA[<h1 id="project1a-linked-list-deque-61b">Project1A-Linked List Deque
61B</h1>
<p>这个项目要求我们用链表实现双端队列(Deque)</p>
<h2 id="javadoc-comment">Javadoc comment</h2>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D">/** ...</span></span>
<span class="line"><span style="color: #6A737D"> * </span><span style="color: #D73A49">@param</span><span style="color: #6A737D"> </span><span style="color: #E36209">index</span><span style="color: #6A737D"> index to get</span></span>
<span class="line"><span style="color: #6A737D"> * </span><span style="color: #D73A49">@return</span><span style="color: #6A737D"> element at {@code index} in the deque</span></span>
<span class="line"><span style="color: #6A737D"> */</span></span>
<span class="line"><span style="color: #24292E">T </span><span style="color: #6F42C1">get</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> index);</span></span></code></pre></div></div></figure>
<p>如以上注释，该形式的注释为java文档注释</p>
<ul>
<li><span class="citation"
data-cites="param表示方法的变量">@param表示方法的变量</span></li>
<li><span class="citation"
data-cites="return表示方法的返回值类型">@return表示方法的返回值类型</span></li>
<li><span class="citation" data-cites="code">@code</span>
用于格式化文本为代码风格</li>
</ul>
<h2 id="步骤">步骤</h2>
<h3 id="创建文件">创建文件</h3>
<p>我们希望创建的类可以接受多种数据类型，故需要实现泛型，在声明类时：</p>
<p><code>public class LinkedListDeque61B&lt;T&gt;</code></p>
<p>另外需要指定LinkedListDeque61B是Deque61B的子类，并且实现所有接口中的方法：</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">import</span><span style="color: #24292E"> java.util.List;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">LinkedListDeque61B</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">T</span><span style="color: #24292E">&gt; </span><span style="color: #D73A49">implements</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Deque61B</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">T</span><span style="color: #24292E">&gt;{</span></span>
<span class="line"><span style="color: #24292E">    @</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">addFirst</span><span style="color: #24292E">(T </span><span style="color: #E36209">x</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">        </span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    @</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">addLast</span><span style="color: #24292E">(T </span><span style="color: #E36209">x</span><span style="color: #24292E">) {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    @</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> List&lt;</span><span style="color: #D73A49">T</span><span style="color: #24292E">&gt; </span><span style="color: #6F42C1">toList</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> List.</span><span style="color: #6F42C1">of</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    @</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">boolean</span><span style="color: #24292E"> </span><span style="color: #6F42C1">isEmpty</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    @</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">size</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    @</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> T </span><span style="color: #6F42C1">removeFirst</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">null</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    @</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> T </span><span style="color: #6F42C1">removeLast</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">null</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    @</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> T </span><span style="color: #6F42C1">get</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">index</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">null</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    @</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> T </span><span style="color: #6F42C1">getRecursive</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">index</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">null</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>最后加入构造函数：</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">LinkedListDeque61B</span><span style="color: #24292E">(){</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="junit-tests">JUnit Tests</h3>
<p>打开LinkedListDeque61BTest文件，去除除最后一行的注释，就可以对编写代码进行本地测试</p>
<h3 id="writing-and-verifying-the-constructor">Writing and Verifying the
Constructor</h3>
<p>实现构造函数，更具体的，构造函数应传入0个参数，并在LinkedListDeque61B类中实现嵌套类Node</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">private</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Node</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> T item;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> Node next;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> Node previous;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Node</span><span style="color: #24292E">(T </span><span style="color: #E36209">i</span><span style="color: #24292E">, Node </span><span style="color: #E36209">p</span><span style="color: #24292E">, Node </span><span style="color: #E36209">n</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        item </span><span style="color: #D73A49">=</span><span style="color: #24292E"> i;</span></span>
<span class="line"><span style="color: #24292E">        next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> n;</span></span>
<span class="line"><span style="color: #24292E">        previous </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">private</span><span style="color: #24292E"> Node sentinelFront;</span></span>
<span class="line"><span style="color: #D73A49">private</span><span style="color: #24292E"> Node sentinelLast;</span></span>
<span class="line"><span style="color: #D73A49">private</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> size;</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">LinkedListDeque61B</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    sentinelFront </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Node</span><span style="color: #24292E">(</span><span style="color: #005CC5">null</span><span style="color: #24292E">, </span><span style="color: #005CC5">null</span><span style="color: #24292E">, </span><span style="color: #005CC5">null</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    sentinelLast </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Node</span><span style="color: #24292E">(</span><span style="color: #005CC5">null</span><span style="color: #24292E">, </span><span style="color: #005CC5">null</span><span style="color: #24292E">, </span><span style="color: #005CC5">null</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    size </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>这里我们在类中嵌套实现了Node类用于定义每个节点，并且对双端队列设置了两个sentinel节点，方便双端操作，同时引入size记录大小</p>
<p>其中，Node类包括两个指针，同时指向前一个节点与后一个节点</p>
<p>构造函数中，对两个sentinel节点进行初始化，并设置size为0</p>
<h3 id="writing-and-verifying-addfirst-and-addlast">Writing and
Verifying <code>addFirst</code> and <code>addLast</code></h3>
<p>addFirst与addLast需要以常数时间实现</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">@</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">addFirst</span><span style="color: #24292E">(T x) {</span></span>
<span class="line"><span style="color: #24292E">    Node newNode </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Node</span><span style="color: #24292E">(x, sentinelFront, sentinelFront.next);</span></span>
<span class="line"><span style="color: #24292E">    sentinelFront.next.previous </span><span style="color: #D73A49">=</span><span style="color: #24292E"> newNode;</span></span>
<span class="line"><span style="color: #24292E">    sentinelFront.next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> newNode;</span></span>
<span class="line"><span style="color: #24292E">    size</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">@</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">addLast</span><span style="color: #24292E">(T x) {</span></span>
<span class="line"><span style="color: #24292E">   Node newNode </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Node</span><span style="color: #24292E">(x, sentinelLast.previous, sentinelLast);</span></span>
<span class="line"><span style="color: #24292E">   sentinelLast.previous.next </span><span style="color: #D73A49">=</span><span style="color: #24292E"> newNode;</span></span>
<span class="line"><span style="color: #24292E">   sentinelLast.previous </span><span style="color: #D73A49">=</span><span style="color: #24292E">  newNode;</span></span>
<span class="line"><span style="color: #24292E">    size</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>我们直接操作sentinel节点的next与previous来添加节点</p>
<h3 id="writing-and-verifying-tolist">Writing and Verifying
<code>toList</code></h3>
<p>实现toList，当调用时会自动返回以列表形式表示的Deque61B</p>
<p>例如，如果Deque61B已经调用了addLast(5)、addLast(9)、addLast(10)，然后对其调用addFirst(3)，那么toList()的结果应该是一个以3开头，然后是5、9、10的列表。如果在Java中打印，它将显示为[3,
5, 9, 10]。</p>
<p>toList方法的第一行应该类似于<code>List&lt;T&gt; returnList = new ArrayList&lt;&gt;()</code>，标志着可以使用该结构的位置</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">@</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> List</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">T</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">toList</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">    List&lt;</span><span style="color: #D73A49">T</span><span style="color: #24292E">&gt; returnList </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> ArrayList&lt;&gt;();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (Node p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> sentinelFront.next; p</span><span style="color: #D73A49">!=</span><span style="color: #24292E">sentinelLast; p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p.next){</span></span>
<span class="line"><span style="color: #24292E">        returnList.</span><span style="color: #6F42C1">add</span><span style="color: #24292E">(p.item);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> returnList;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="writing-tests">Writing Tests</h3>
<p>写测试例的模板：<strong>Arrange-Act-Assert</strong></p>
<ul>
<li>Arrange：组织测试样例，如初始化数据结构或往里面填充元素</li>
<li>Act：执行想要执行的操作</li>
<li>Assert：评估Act中的结果</li>
</ul>
<p>在单个测试方法中通常有多个act与assert步骤</p>
<p>真值评估的模板：</p>
<p>格式：<code>assertThat(actual).isEqualTo(expected);</code></p>
<p>添加信息：</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6F42C1">assertWithMessage</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;actual is not expected&quot;</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">    .</span><span style="color: #6F42C1">that</span><span style="color: #24292E">(actual)</span></span>
<span class="line"><span style="color: #24292E">    .</span><span style="color: #6F42C1">isEqualTo</span><span style="color: #24292E">(expected);</span></span></code></pre></div></div></figure>
<p>判断列表包含内容：</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6F42C1">assertThat</span><span style="color: #24292E">(actualList)</span></span>
<span class="line"><span style="color: #24292E">    .</span><span style="color: #6F42C1">containsExactly</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">, </span><span style="color: #005CC5">1</span><span style="color: #24292E">, </span><span style="color: #005CC5">2</span><span style="color: #24292E">, </span><span style="color: #005CC5">3</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">    .</span><span style="color: #6F42C1">inOrder</span><span style="color: #24292E">();</span></span></code></pre></div></div></figure>
<p>对于引用类型：</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6F42C1">assertThat</span><span style="color: #24292E">(actualList)</span></span>
<span class="line"><span style="color: #24292E">    .</span><span style="color: #6F42C1">containsExactlyElementsIn</span><span style="color: #24292E">(expected)  </span><span style="color: #6A737D">// `expected` is a List</span></span>
<span class="line"><span style="color: #24292E">    .</span><span style="color: #6F42C1">inOrder</span><span style="color: #24292E">();</span></span></code></pre></div></div></figure>
<p>注意：assert一个布尔值时，记得在后面使用<code>.isTrue()</code> 或者
<code>.isFalse()</code>判断正误</p>
<h2 id="其余方法">其余方法</h2>
<h3 id="isempty与size">isEmpty()与size()</h3>
<p>要求常数时间实现</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">@</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">boolean</span><span style="color: #24292E"> </span><span style="color: #6F42C1">isEmpty</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> size</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">@</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">size</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> size;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="get与getrecursive">get()与getRecursive()</h3>
<p>给予下标寻找下标对应元素</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">@</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> T </span><span style="color: #6F42C1">get</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> index) {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (index</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">0</span><span style="color: #D73A49">||</span><span style="color: #24292E">index</span><span style="color: #D73A49">&gt;=</span><span style="color: #24292E">size){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">null</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    Node p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> sentinelFront.next;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">index; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> p.next;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> p.item;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">private</span><span style="color: #24292E"> T </span><span style="color: #6F42C1">getRecursiveHelper</span><span style="color: #24292E">(Node p, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> index){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (index </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> p.item;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">getRecursiveHelper</span><span style="color: #24292E">(p.next, index</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #24292E">@</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> T </span><span style="color: #6F42C1">getRecursive</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> index) {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (index</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">0</span><span style="color: #D73A49">||</span><span style="color: #24292E">index</span><span style="color: #D73A49">&gt;=</span><span style="color: #24292E">size){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">null</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">getRecursiveHelper</span><span style="color: #24292E">(sentinelFront.next, index);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>写了一个辅助递归函数，可以接受当前节点与下标，进行节点的推进</p>
<h3 id="removefirst与removelast">removeFirst()与removeLast()</h3>
<figure class="shiki JAVA"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div><div class="code"><pre><code>@Override
public T removeFirst() {
    if (isEmpty()){
        return null;
    }
   Node temp = sentinelFront.next;
    sentinelFront.next = temp.next;
    temp.next.previous = sentinelFront;
    size--;
    return temp.item;
}

@Override
public T removeLast() {
    if (isEmpty()){
        return null;
    }
    Node temp = sentinelLast.previous;
    sentinelLast.previous = temp.previous;
    temp.previous.next = sentinelLast;
    size--;
    return temp.item;
}</code></pre></div></div></figure>
]]></content>
      <categories>
        <category>CS61B</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>CS61B</tag>
        <tag>Project</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61B】Project1B-ArrayDeque 61B</title>
    <url>/CS61B/Project1B-ArrayDeque%2061B/</url>
    <content><![CDATA[<h1 id="project1b---arraydeque-61b">Project1B - ArrayDeque 61B</h1>
<p>这个项目中，我们需要用数组实现循环双端队列</p>
<h2 id="初始化">初始化</h2>
<p>创建类文件，并修改类声明以让该类是Deque61B接口的一个实现，且支持泛型</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">package</span><span style="color: #24292E"> deque;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">import</span><span style="color: #24292E"> java.util.List;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ArrayDeque61B</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">T</span><span style="color: #24292E">&gt; </span><span style="color: #D73A49">implements</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Deque61B</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">T</span><span style="color: #24292E">&gt; {</span></span>
<span class="line"><span style="color: #24292E">    @</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">addFirst</span><span style="color: #24292E">(T </span><span style="color: #E36209">x</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">        </span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    @</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">addLast</span><span style="color: #24292E">(T </span><span style="color: #E36209">x</span><span style="color: #24292E">) {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    @</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> List&lt;</span><span style="color: #D73A49">T</span><span style="color: #24292E">&gt; </span><span style="color: #6F42C1">toList</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> List.</span><span style="color: #6F42C1">of</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    @</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">boolean</span><span style="color: #24292E"> </span><span style="color: #6F42C1">isEmpty</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    @</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">size</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    @</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> T </span><span style="color: #6F42C1">removeFirst</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">null</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    @</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> T </span><span style="color: #6F42C1">removeLast</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">null</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    @</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> T </span><span style="color: #6F42C1">get</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">index</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">null</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    @</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> T </span><span style="color: #6F42C1">getRecursive</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">index</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">null</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="构造函数">构造函数</h2>
<p>使用到的成员有</p>
<ul>
<li>size：确定数组目前容量</li>
<li>capacity：确定数组最大容量</li>
<li>items：使用java内置数组存储数据</li>
<li>nextFirst：指向队首（第一个空位置）</li>
<li>nextLast：指向队尾（最后一个空位置）</li>
</ul>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ArrayDeque61B</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    size </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    capacity </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">8</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    items </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #D73A49">T</span><span style="color: #24292E">[])</span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #D73A49">Object</span><span style="color: #24292E">[capacity];</span></span>
<span class="line"><span style="color: #24292E">    nextFirst </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    nextLast </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="addfirst-addlast">addFirst() &amp; addLast()</h2>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">@</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">addFirst</span><span style="color: #24292E">(T x) {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (size</span><span style="color: #D73A49">==</span><span style="color: #24292E">capacity){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">resize</span><span style="color: #24292E">(size</span><span style="color: #D73A49">*</span><span style="color: #005CC5">2</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    items[nextFirst] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> x;</span></span>
<span class="line"><span style="color: #24292E">    size</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    nextFirst </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">floorMod</span><span style="color: #24292E">(nextFirst</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">, capacity);</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">@</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">addLast</span><span style="color: #24292E">(T x) {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (size</span><span style="color: #D73A49">==</span><span style="color: #24292E">capacity){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">resize</span><span style="color: #24292E">(size</span><span style="color: #D73A49">*</span><span style="color: #005CC5">2</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    items[nextLast] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> x;</span></span>
<span class="line"><span style="color: #24292E">    size</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    nextLast </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">floorMod</span><span style="color: #24292E">(nextLast</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">, capacity);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>这里在添加时要考虑循环，若到队头了要转到队尾加</p>
<p>另外，当队列满了需要手动扩容，一般可以扩到原来都两倍，防止过多调用</p>
<h2 id="get">get()</h2>
<p>按下标获得元素，若无效返回null</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">@</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> T </span><span style="color: #6F42C1">get</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> index) {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (index</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">0</span><span style="color: #D73A49">||</span><span style="color: #24292E">index</span><span style="color: #D73A49">&gt;=</span><span style="color: #24292E">size){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">null</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> realIndex </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">floorMod</span><span style="color: #24292E">(index</span><span style="color: #D73A49">+</span><span style="color: #24292E">nextFirst</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">, capacity);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> items[realIndex];</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>这里注意，get获得的是相对下标，我们需要转换成真实下标（即元素不一定是从0开始的，需要添加nextFirst偏移量）</p>
<p>getRecursive()没有什么必要，可以直接抛出一个异常</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">@</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> T </span><span style="color: #6F42C1">getRecursive</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> index) {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">throw</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">UnsupportedOperationException</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;No need to implement getRecursive for proj 1b&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="tolist">toList()</h2>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">@</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> List</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">T</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">toList</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">    List&lt;</span><span style="color: #D73A49">T</span><span style="color: #24292E">&gt; show </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> ArrayList&lt;&gt;(size);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> cnt </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">size;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        show.</span><span style="color: #6F42C1">add</span><span style="color: #24292E">(</span><span style="color: #6F42C1">get</span><span style="color: #24292E">(i));</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> show;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>结合get方法会更加方便</p>
<h2 id="removefirst-removelast">removeFirst() &amp; removeLast()</h2>
<figure class="shiki JAVA"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre><code>@Override
public T removeFirst() {
    if (isEmpty()){
        return null;
    }
    nextFirst = floorMod(nextFirst+1,capacity);
    size--;
    return items[nextFirst];
}

@Override
public T removeLast() {
    if (isEmpty()){
        return null;
    }
    nextLast = floorMod(nextLast-1,capacity);
    size--;
    return items[nextLast];
}</code></pre></div></div></figure>
<p>不要忘记判空以及减小size</p>
<h2 id="resize">resize()</h2>
<p>作为数组大小不够时的方案，一次扩容两倍使用</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">private</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">resize</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> newCapacity){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">T</span><span style="color: #24292E">[] a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #D73A49">T</span><span style="color: #24292E">[]) </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #D73A49">Object</span><span style="color: #24292E">[newCapacity];</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> cur </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">floorMod</span><span style="color: #24292E">(nextFirst</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">,capacity);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">size;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        a[i] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> items[cur];</span></span>
<span class="line"><span style="color: #24292E">        cur </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">floorMod</span><span style="color: #24292E">(cur</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">, capacity);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    items </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a;</span></span>
<span class="line"><span style="color: #24292E">    capacity </span><span style="color: #D73A49">=</span><span style="color: #24292E"> newCapacity;</span></span>
<span class="line"><span style="color: #24292E">    nextFirst </span><span style="color: #D73A49">=</span><span style="color: #24292E"> newCapacity </span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    nextLast </span><span style="color: #D73A49">=</span><span style="color: #24292E"> size;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>这里要将原数组复制到一个新容量的数组中使用</p>
<p>采用的方法是将原数组元素按从0开始的下标复制到新数组，再用新数组覆盖</p>
<p>同时调整nextFirst与nextLast</p>
<h2 id="iterator">iterator()</h2>
<p>实现迭代器，让我们的双端队列可以迭代</p>
<p>即在内部嵌套一个Iterator类的实现</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">@</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> Iterator</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">T</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">iterator</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ArrayDequeIterator</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ArrayDequeIterator</span><span style="color: #24292E"> </span><span style="color: #D73A49">implements</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Iterator</span><span style="color: #24292E">&lt;</span><span style="color: #D73A49">T</span><span style="color: #24292E">&gt;{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">private</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> pos;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">ArrayDequeIterator</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">        pos </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    @</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">boolean</span><span style="color: #24292E"> </span><span style="color: #6F42C1">hasNext</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> pos </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> size;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    @</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> T </span><span style="color: #6F42C1">next</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">        T returnItems </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">get</span><span style="color: #24292E">(pos);</span></span>
<span class="line"><span style="color: #24292E">        pos</span><span style="color: #D73A49">++</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> returnItems;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p><strong>注意：接口不允许提供覆盖Object方法的默认方法，故无法在接口中提供默认方法</strong></p>
<h2 id="equals">equals()</h2>
<p>重写equals方法，让该方法仅比较元素相等</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">@</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">boolean</span><span style="color: #24292E"> </span><span style="color: #6F42C1">equals</span><span style="color: #24292E">(Object o){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (o </span><span style="color: #D73A49">instanceof</span><span style="color: #24292E"> ArrayDeque61B</span><span style="color: #D73A49">&lt;?&gt;</span><span style="color: #24292E"> uAD){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #005CC5">this</span><span style="color: #24292E">.size</span><span style="color: #D73A49">!=</span><span style="color: #24292E">uAD.size){</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">size;i</span><span style="color: #D73A49">++</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">Objects.</span><span style="color: #6F42C1">equals</span><span style="color: #24292E">(</span><span style="color: #005CC5">this</span><span style="color: #24292E">.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">(i), uAD.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">(i))){</span></span>
<span class="line"><span style="color: #24292E">                </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">            }</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">true</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>若想在instanceof中使用泛型，需要使用<code>&lt;?&gt;</code>通配符</p>
<h2 id="tostring">toString()</h2>
<p>返回自定义的string输出表示双端队列</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">@</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> String </span><span style="color: #6F42C1">toString</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    StringBuilder stringToReturn </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">StringBuilder</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;[&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (T x</span><span style="color: #D73A49">:</span><span style="color: #24292E"> </span><span style="color: #005CC5">this</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        stringToReturn.</span><span style="color: #6F42C1">append</span><span style="color: #24292E">(x);</span></span>
<span class="line"><span style="color: #24292E">        stringToReturn.</span><span style="color: #6F42C1">append</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;, &quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    stringToReturn.</span><span style="color: #6F42C1">delete</span><span style="color: #24292E">(stringToReturn.</span><span style="color: #6F42C1">length</span><span style="color: #24292E">()</span><span style="color: #D73A49">-</span><span style="color: #005CC5">2</span><span style="color: #24292E">,stringToReturn.</span><span style="color: #6F42C1">length</span><span style="color: #24292E">());</span></span>
<span class="line"><span style="color: #24292E">    stringToReturn.</span><span style="color: #6F42C1">append</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;]&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> stringToReturn.</span><span style="color: #6F42C1">toString</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>CS61B</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>CS61B</tag>
        <tag>Project</tag>
      </tags>
  </entry>
  <entry>
    <title>【计算机网络】Web应用的请求与响应机制</title>
    <url>/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/Web%E5%BA%94%E7%94%A8%E7%9A%84%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94%E6%9C%BA%E5%88%B6/</url>
    <content><![CDATA[<h1 id="web应用的请求与响应机制">Web应用的请求与响应机制</h1>
<h2 id="http协议">HTTP协议</h2>
<p>HTTP是web通信的基础协议，是客户端与服务器进行交互的标准，所有www文件必须遵守这个标准，<strong>其端口号为80</strong></p>
<p>HTTPS是HTTP的安全版，在HTTP下加入SSL层
SSL是主要用于web的安全传输协议，在传输层对网络连接进行加密，<strong>其端口号为443</strong></p>
<h3 id="工作原理">工作原理</h3>
<p>HTTP通信由两部分组成：客户端请求信息、服务器响应信息 -
当用户在地址栏输入一个URL并回车后，客户端向web服务器发送HTTP请求，建立一个到服务器指定端口的TCP连接
-
服务器在那个端口监听客户端发送过来的请求，收到请求后，服务器根据内容与类型进行处理，并生成HTTP响应，包括一个状态行与相应的信息
- 客户端接受服务器返回的响应，并根据内容呈现给用户</p>
<h3 id="url">URL</h3>
<p>统一资源定位符（Uniform / Universal Resource
Locator），是用于完整描述网页和其他资源的地址的一种标识方法
<strong>基本格式：
<code>scheme://host[:port#]/path/…/[?query-string][#anchor]</code></strong>
- scheme：协议（如http与https） - host：服务器ip地址或域名 -
port：服务器端口（如果走协议默认端口，缺省端口80） -
path：访问资源的路径 - query-string：参数，发送给http服务器的数据 -
anchor：锚，跳转到网页的指定锚点位置</p>
<h3 id="http请求">HTTP请求</h3>
<p>HTTP用来提交和获取资源，客户端发送一个HTTP请求请求到服务器的请求信息，包括：请求行、请求头部、空行、请求数据四个部分，格式如下</p>
<figure>
<img
src="https://i-blog.csdnimg.cn/blog_migrate/925eb592741c87dae2107c846ddb5aba.png"
alt="HTTP请求" />
<figcaption aria-hidden="true">HTTP请求</figcaption>
</figure>
<p>一些常用的请求报头： -
Host：对应URL中的web名称与端口号，用于指定被请求资源的Internet主机与端口号
- Connection：表示客户端与服务器连接类型 Client 发起一个包含
Connection:keep-alive 的请求， HTTP/1.1 使用 keep-alive 为默认值。
Server 收到请求后：如果 Server 支持 keep-alive（长连接）， 回复一个包含
Connection:keep-alive 的响应， 不关闭连接；如果 Server 不支持
keep-alive， 回复一个包含 Connection:close 的响应， 关闭连接。如果
client 收到包含 Connection:keep-alive 的响应，
向同一个连接发送下一个请求， 直到一方主动关闭连接。 keep-alive
在很多情况下能够重用连接， 减少资源消耗， 缩短响应时间，
比如当浏览器需要多个文件时(比如一个 HTML 文件和相关的图形文件)，
不需要每次都去请求建立连接。 -
Upgrade-Insecure-Requests：升级不安全的请求， 意思是会在加载 http
资源时自动替换成 https 请求， 让浏览器不再显示 https 页面中的 http
请求警报。 -
User-Agent：客户浏览器的详细信息，服务器根据这条信息来判断来访用户是否为真实用户
- Accept：指浏览器或其他客户端可以接受的MIME（Multipurpose Internet Mail
Extensions）文件类型，服务器根据其判断并返回适当文件格式 - Accept: /：
表示什么都可以接收。 - Accept: text/html, application/xhtml+xml;q=0.9,
image/<em>;q=0.8： 表示浏览器支持的 MIME
类型分别是html文本、xhtml和xml文档、 所有的图像格式资源。 q是权重系数，
范围 <span class="math inline">\(0 =&lt; q &lt;=
1\)</span>，q值越大，请求越倾向于获得其“;”之前的类型表示的内容。若没有指定
q 值， 则默认为1，按从左到右排序顺序；若被赋值为
0，则用于表示浏览器不接受此内容类型。
Text：用于标准化地表示的文本信息，文本消息可以是多种字符集和或者多种格式的；
Application：用于传输应用程序数据或者二进制数据。 -
Referer：表明产生请求的网页来自于哪个URL，用户是从该referer页面访问到当前请求的页面，可以用来跟踪web请求来自哪个页面，哪个网站
- Accept-Encoding：指出浏览器可以接受的编码方式。
编码方式不同于文件格式， 它是为了压缩文件并加速文件传递速度。
浏览器在接收到 Web 响应之后先解码， 然后再检查文件格式，
许多情形下这可以减少大量的下载时间。 如Accept-Encoding:gzip;q=1.0,
identity; q=0.5, </em>;q=0 如果有多个 Encoding 同时匹配,
按照q值顺序排列，本例中按顺序支持 gzip, identity压缩编码，
支持gzip的浏览器会返回经过gzip编码的HTML页面。
如果请求消息中没有设置这个域服务器假定客户端对各种内容编码都可以接受。 -
Accept-Language：指语言可以接受的语言种类，如zh或zh-cn指中文 -
Accept-Charset：指浏览器可以接受的字符编码，缺省为任何字符集 -
Cookie：浏览器用这个属性向服务器发送 Cookie。 -
Content-Type：POST请求里用来表示的内容类型。</p>
<p>示例：</p>
<figure>
<img
src="https://i-blog.csdnimg.cn/blog_migrate/21c6fd7651fd37a38c96cdaebb1ba542.png"
alt="HTTP请求示例" />
<figcaption aria-hidden="true">HTTP请求示例</figcaption>
</figure>
<h3 id="常见http方法">常见HTTP方法</h3>
<ul>
<li><p>GET：请求指定资源，通常附加在URL中，不适合传递大量数据与隐私数据</p></li>
<li><p>POST：向服务器提交数据，通常用于提交表单与上传文件</p></li>
<li><p>PUT：更新指定资源内容</p></li>
<li><p>HEAD：只返回响应头，不返回响应体</p></li>
<li><p>OPTIONS：查询服务器支持的HTTP方法</p></li>
</ul>
<h3 id="http响应">HTTP响应</h3>
<p>由四部分组成，分别为状态行、消息报头、空行、响应正文，格式如下：</p>
<figure>
<img
src="https://i-blog.csdnimg.cn/blog_migrate/8c9e4d37f17a3b0e3706e5d10b280aa2.png"
alt="HTTP响应" />
<figcaption aria-hidden="true">HTTP响应</figcaption>
</figure>
<p>理论上所有响应头信息都是回应请求头的，但还会添加对应的响应头信息</p>
<p>示例：</p>
<figure>
<img
src="https://i-blog.csdnimg.cn/blog_migrate/ec31faa6f61a7d1a6c7495c60608eff2.png"
alt="HTTP响应示例" />
<figcaption aria-hidden="true">HTTP响应示例</figcaption>
</figure>
<h3 id="http状态码">HTTP状态码</h3>
<p>web服务器对HTTP请求的回应，表示请求是否成功处理</p>
<ul>
<li>1xx：服务器成功接受部分请求</li>
<li>2xx：成功（200 OK）</li>
<li>3xx：重定向（301 Moved Permanently）</li>
<li>4xx：客户端错误（404 Not Found）</li>
<li>5xx：服务器错误（500 Internal Server Error）</li>
</ul>
<h3 id="cookie与session">Cookie与Session：</h3>
<p>服务器和客户端的交互仅限于请求/响应过程，结束之后便断开，在下一次请求时，服务器会认为新的客户端。为了维护他们之间的链接，让服务器知道这是前一个用户发送的请求，必须在一个地方保存客户端的信息。
- Cookie：通过在 客户端 记录的信息确定用户的身份。 - Session：通过在
服务器端 记录的信息确定用户的身份</p>
<h2 id="请求参数的获取与处理">请求参数的获取与处理</h2>
<p>HTTP携带多种数据，这里通过python，使用urllib与requests库来处理这些数据</p>
<h3 id="处理url路径与查询参数">处理URL路径与查询参数</h3>
<p>​ URL 查询参数是指在 URL 中通过键值对的形式传递的参数，用于在 URL
中增加额外的信息，如查询条件、排序方式、页码等。查询参数通常使用键值对的形式定义，键和值之间用
= 符号分隔，多个参数之间用 &amp; 符号分隔。例如，定义一个查询参数 page
的值为 <em>2</em>，可以写成 page=2</p>
<p>​ 查询参数的主要用途是通过 URL
传递信息，实现搜索查询、过滤器等功能。例如，用户在输入框输入
<em>abc</em>，按下回车之后，会返回一条地址为
<em>https://www.example.com/?keyword=abc</em> 的
URL。在用户访问时，服务器会通过 URL 参数 keyword
检索相关内容，然后返回给用户</p>
<p>​
在python中，可以使用urllib库中urllib.parse模块中的<code>parse_qs</code>函数来解析查询字符串，以下为示例程序，程序返回字典，键值对分别为等号左右的内容</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">from</span><span style="color: #24292E"> urllib.parse </span><span style="color: #D73A49">import</span><span style="color: #24292E"> urlparse, parse_qs</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D"># 示例URL</span></span>
<span class="line"><span style="color: #24292E">url </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;http://example.com/path/to/resource?name=John&amp;age=30&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D"># 解析URL</span></span>
<span class="line"><span style="color: #24292E">parsed_url </span><span style="color: #D73A49">=</span><span style="color: #24292E"> urlparse(url)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D"># 获取路径</span></span>
<span class="line"><span style="color: #24292E">path </span><span style="color: #D73A49">=</span><span style="color: #24292E"> parsed_url.path</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Path:&quot;</span><span style="color: #24292E">, path)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D"># 解析查询参数</span></span>
<span class="line"><span style="color: #24292E">query_params </span><span style="color: #D73A49">=</span><span style="color: #24292E"> parse_qs(parsed_url.query)</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Query Parameters:&quot;</span><span style="color: #24292E">, query_params)</span></span></code></pre></div></div></figure>
<pre><code>Path: /path/to/resource
Query Parameters: &#123;&#39;name&#39;: [&#39;John&#39;], &#39;age&#39;: [&#39;30&#39;]&#125;</code></pre>
<h3 id="处理表单数据">处理表单数据</h3>
<pre><code>表单数据是通过网页上的表单收集并提交给服务器的信息，用户可以填写表单来提供各种信息。当用户点击表单上的提交按钮时，表单数据会被发送到服务器，服务器则根据接收到的数据执行相应操作
表单的基本结构如下
<figure class="shiki html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">&lt;</span><span style="color: #22863A">form</span><span style="color: #24292E"> </span><span style="color: #6F42C1">action</span><span style="color: #24292E">=</span><span style="color: #032F62">&quot;/submit&quot;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">method</span><span style="color: #24292E">=</span><span style="color: #032F62">&quot;post&quot;</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #24292E">    &lt;</span><span style="color: #22863A">label</span><span style="color: #24292E"> </span><span style="color: #6F42C1">for</span><span style="color: #24292E">=</span><span style="color: #032F62">&quot;username&quot;</span><span style="color: #24292E">&gt;用户名:&lt;/</span><span style="color: #22863A">label</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #24292E">    &lt;</span><span style="color: #22863A">input</span><span style="color: #24292E"> </span><span style="color: #6F42C1">type</span><span style="color: #24292E">=</span><span style="color: #032F62">&quot;text&quot;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">id</span><span style="color: #24292E">=</span><span style="color: #032F62">&quot;username&quot;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">name</span><span style="color: #24292E">=</span><span style="color: #032F62">&quot;username&quot;</span><span style="color: #24292E">&gt;&lt;</span><span style="color: #22863A">br</span><span style="color: #24292E">&gt;&lt;</span><span style="color: #22863A">br</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #24292E">    </span></span>
<span class="line"><span style="color: #24292E">    &lt;</span><span style="color: #22863A">label</span><span style="color: #24292E"> </span><span style="color: #6F42C1">for</span><span style="color: #24292E">=</span><span style="color: #032F62">&quot;password&quot;</span><span style="color: #24292E">&gt;密码:&lt;/</span><span style="color: #22863A">label</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #24292E">    &lt;</span><span style="color: #22863A">input</span><span style="color: #24292E"> </span><span style="color: #6F42C1">type</span><span style="color: #24292E">=</span><span style="color: #032F62">&quot;password&quot;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">id</span><span style="color: #24292E">=</span><span style="color: #032F62">&quot;password&quot;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">name</span><span style="color: #24292E">=</span><span style="color: #032F62">&quot;password&quot;</span><span style="color: #24292E">&gt;&lt;</span><span style="color: #22863A">br</span><span style="color: #24292E">&gt;&lt;</span><span style="color: #22863A">br</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #24292E">    </span></span>
<span class="line"><span style="color: #24292E">    &lt;</span><span style="color: #22863A">input</span><span style="color: #24292E"> </span><span style="color: #6F42C1">type</span><span style="color: #24292E">=</span><span style="color: #032F62">&quot;submit&quot;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">value</span><span style="color: #24292E">=</span><span style="color: #032F62">&quot;提交&quot;</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #24292E">&lt;/</span><span style="color: #22863A">form</span><span style="color: #24292E">&gt;</span></span></code></pre></div></div></figure></code></pre>
<p><code>&lt;form&gt;</code>标签定义了一个表单，action属性指定了表单数据提交的目标url，method属性制定了提交数据时使用的HTTP方法
-
GET：当method属性被设置为GET时，表单数据会被附加在url后面作为查询参数提交。这种方法适合提交少量的非敏感数据
-
POST：当method属性被设置为POST时，表单数据会在请求体中发送，不会出现在url中。这种方法适合提交敏感与大量数据
<code>&lt;input&gt;</code>标签用于创建输入控件，type属性定义了输入控件的类型，name属性为提交属性时的键名，id用于关联<code>&lt;label&gt;</code>标签
<code>&lt;label&gt;</code>标签用于描述每个输入控件的用途
表单数据的编码： -
application/x-www-form-urlencoded：这是默认的编码方式，表单数据被编码成键值对的形式，如
username=John&amp;password=Doe。 -
multipart/form-data：当表单中包含文件上传字段时，必须使用此编码方式。它允许将文件和其他数据一起发送。</p>
<p>我们可以在python中通过request库发送POST请求来获取表单数据并处理，返回的是html类型的表单数据</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">import</span><span style="color: #24292E"> requests</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D"># 示例表单数据</span></span>
<span class="line"><span style="color: #24292E">form_data </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&#39;username&#39;</span><span style="color: #24292E">: </span><span style="color: #032F62">&#39;john_doe&#39;</span><span style="color: #24292E">,</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&#39;password&#39;</span><span style="color: #24292E">: </span><span style="color: #032F62">&#39;securepassword&#39;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D"># 发送POST请求</span></span>
<span class="line"><span style="color: #24292E">response </span><span style="color: #D73A49">=</span><span style="color: #24292E"> requests.post(</span><span style="color: #032F62">&#39;https://www.baidu.com/&#39;</span><span style="color: #24292E">, </span><span style="color: #E36209">data</span><span style="color: #D73A49">=</span><span style="color: #24292E">form_data)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D"># 查看响应</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Response Status Code:&quot;</span><span style="color: #24292E">, response.status_code)</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Response Text:&quot;</span><span style="color: #24292E">, response.text)</span></span></code></pre></div></div></figure>
<h3 id="处理json数据">处理JSON数据</h3>
<p>python中可以使用request库来处理json数据</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">import</span><span style="color: #24292E"> requests</span></span>
<span class="line"><span style="color: #D73A49">import</span><span style="color: #24292E"> json</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D"># 示例JSON数据</span></span>
<span class="line"><span style="color: #24292E">json_data </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&#39;name&#39;</span><span style="color: #24292E">: </span><span style="color: #032F62">&#39;John&#39;</span><span style="color: #24292E">,</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&#39;age&#39;</span><span style="color: #24292E">: </span><span style="color: #005CC5">30</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D"># 发送POST请求</span></span>
<span class="line"><span style="color: #24292E">response </span><span style="color: #D73A49">=</span><span style="color: #24292E"> requests.post(</span><span style="color: #032F62">&#39;https://www.baidu.com/&#39;</span><span style="color: #24292E">, </span><span style="color: #E36209">json</span><span style="color: #D73A49">=</span><span style="color: #24292E">json_data)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D"># 查看响应</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Response Status Code:&quot;</span><span style="color: #24292E">, response.status_code)</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Response JSON:&quot;</span><span style="color: #24292E">, response.json())</span></span></code></pre></div></div></figure>
<h3 id="处理文件上传">处理文件上传</h3>
<pre><code>HTTP文件上传是通过HTTP协议将文件从客户端传输到服务器的一种方式。通常使用POST方法，并且数据格式为multipart/form-data。这种格式允许在同一个请求中传输多个字段和文件。
HTTP文件上传中，请求头需要包含Content-Type，其值为multipart/form-data，并指定一个边界（boundary），用于分隔不同的字段和文件。例如
<figure class="shiki html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">POST /upload HTTP/1.1</span></span>
<span class="line"><span style="color: #24292E">Host: www.example.com</span></span>
<span class="line"><span style="color: #24292E">Content-Type: multipart/form-data; boundary=----WebKitFormBoundarycz5DOEJKqu7XXB7k</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">------WebKitFormBoundarycz5DOEJKqu7XXB7k</span></span>
<span class="line"><span style="color: #24292E">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;example.png&quot;</span></span>
<span class="line"><span style="color: #24292E">Content-Type: image/png</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">&lt;</span><span style="color: #B31D28; font-style: italic">文件内容</span><span style="color: #24292E">&gt;</span></span>
<span class="line"><span style="color: #24292E">------WebKitFormBoundarycz5DOEJKqu7XXB7k--</span></span></code></pre></div></div></figure>
我们可以使用python的request库来处理文件上传响应</code></pre>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">import</span><span style="color: #24292E"> requests</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D"># 打开文件</span></span>
<span class="line"><span style="color: #24292E">files </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span><span style="color: #032F62">&#39;file&#39;</span><span style="color: #24292E">: </span><span style="color: #005CC5">open</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;example.txt&#39;</span><span style="color: #24292E">, </span><span style="color: #032F62">&#39;rb&#39;</span><span style="color: #24292E">)}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D"># 发送POST请求</span></span>
<span class="line"><span style="color: #24292E">response </span><span style="color: #D73A49">=</span><span style="color: #24292E"> requests.post(</span><span style="color: #032F62">&#39;http://example.com/upload&#39;</span><span style="color: #24292E">, </span><span style="color: #E36209">files</span><span style="color: #D73A49">=</span><span style="color: #24292E">files)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D"># 查看响应</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Response Status Code:&quot;</span><span style="color: #24292E">, response.status_code)</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Response Text:&quot;</span><span style="color: #24292E">, response.text)</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>计算机网络</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>计算机网络</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61B】Project2A-Ngordnet (NGrams)</title>
    <url>/CS61B/Project2A-Ngordnet%20(NGrams)/</url>
    <content><![CDATA[<h1 id="project2a-ngordnet-ngrams">Project2A-Ngordnet (NGrams)</h1>
<p>这个项目要求实现一个类似于Google Books Ngram
Viewer的查看器，这个系统提供了Google数据库的英文文本中所有被观察到的词汇和短语的历史频率，可以让用户可视化指定词汇与短语在历史上的流行程度</p>
<p>在这个项目中只需要实现一个单词的处理</p>
<h2 id="timeseries">TimeSeries</h2>
<p><code>TimeSeries</code>是TreeMap的一个拓展，键总是int，值总是double，分别对应一个年份与那个年份对应的数值数据点，如下面的设置：</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">TimeSeries ts </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">TimeSeries</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">ts.</span><span style="color: #6F42C1">put</span><span style="color: #24292E">(</span><span style="color: #005CC5">1992</span><span style="color: #24292E">,</span><span style="color: #005CC5">3.6</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">ts.</span><span style="color: #6F42C1">put</span><span style="color: #24292E">(</span><span style="color: #005CC5">1993</span><span style="color: #24292E">,</span><span style="color: #005CC5">9.2</span><span style="color: #24292E">);</span></span></code></pre></div></div></figure>
<p>注意：</p>
<ul>
<li>该对象不具有实例变量</li>
<li>需要比较两个数据，若某年份或数值不可用，不能用零替代</li>
<li>进行比较时，由于双精度数之间的比较在舍入时容易产生误差，故可以使用<code>assertThat(x).isWithin(1E-10).of(y)</code>来进行比较</li>
</ul>
<h3
id="额外知识如何对treemap进行遍历">额外知识：如何对TreeMap进行遍历</h3>
<h3 id="拷贝构造">拷贝构造</h3>
<p>要求创建传入ts的拷贝，且数据只包括startYear到endYear之间的数据</p>
<p>这里使用foreach遍历，对每个key进行判断，若在给定范围内，则加入拷贝TimeSeries</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">TimeSeries</span><span style="color: #24292E">(TimeSeries ts, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> startYear, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> endYear) {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">super</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    ts.</span><span style="color: #6F42C1">forEach</span><span style="color: #24292E">((key, val)</span><span style="color: #D73A49">-&gt;</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E">(key</span><span style="color: #D73A49">&gt;=</span><span style="color: #24292E">startYear</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E">key</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">endYear)</span><span style="color: #005CC5">this</span><span style="color: #24292E">.</span><span style="color: #6F42C1">put</span><span style="color: #24292E">(key, val);</span></span>
<span class="line"><span style="color: #24292E">    });</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="years">years()</h3>
<p>要求升序返回当前time series中所有的年份</p>
<p>years为键，使用treemap的keySet方法生成对键的拷贝set，并放入列表并返回</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> List</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">Integer</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">years</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">    List&lt;</span><span style="color: #D73A49">Integer</span><span style="color: #24292E">&gt; yearsList </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> ArrayList&lt;&gt;();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> it </span><span style="color: #D73A49">:</span><span style="color: #24292E"> </span><span style="color: #005CC5">this</span><span style="color: #24292E">.</span><span style="color: #6F42C1">keySet</span><span style="color: #24292E">()) {</span></span>
<span class="line"><span style="color: #24292E">        yearsList.</span><span style="color: #6F42C1">add</span><span style="color: #24292E">(it);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> yearsList;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="data">data()</h3>
<p>要求返回当前time series中的所有数据，要与years()中的年份顺序一致</p>
<p>生成yearslist，遍历并使用treemap的get方法获取每个键对应的data值并存入列表并返回</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> List</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">Double</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> </span><span style="color: #6F42C1">data</span><span style="color: #24292E">() {</span></span>
<span class="line"><span style="color: #24292E">    List&lt;</span><span style="color: #D73A49">Double</span><span style="color: #24292E">&gt; dataList </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> ArrayList&lt;&gt;();</span></span>
<span class="line"><span style="color: #24292E">    List&lt;</span><span style="color: #D73A49">Integer</span><span style="color: #24292E">&gt; yearsList </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">years</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> it</span><span style="color: #D73A49">:</span><span style="color: #24292E"> yearsList){</span></span>
<span class="line"><span style="color: #24292E">        dataList.</span><span style="color: #6F42C1">add</span><span style="color: #24292E">(</span><span style="color: #005CC5">this</span><span style="color: #24292E">.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">(it));</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> dataList;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="plus">plus()</h3>
<p>返回传入ts与当前ts对应年份的data之和，若一方存在年份而另一方不存在，则结果为存在一方的data值，若都不存在就忽略</p>
<p>为了能将当前与ts的time series，我们新建一个hashset，将两个time
series的keyset全放入新建的set，遍历，若一边不存在直接将另一边对应value，若都在则相加</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> TimeSeries </span><span style="color: #6F42C1">plus</span><span style="color: #24292E">(TimeSeries ts) {</span></span>
<span class="line"><span style="color: #24292E">        TimeSeries returnedTs </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">TimeSeries</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">        Set&lt;</span><span style="color: #D73A49">Integer</span><span style="color: #24292E">&gt; totSet </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> HashSet&lt;&gt;();</span></span>
<span class="line"><span style="color: #24292E">        totSet.</span><span style="color: #6F42C1">addAll</span><span style="color: #24292E">(ts.</span><span style="color: #6F42C1">keySet</span><span style="color: #24292E">());</span></span>
<span class="line"><span style="color: #24292E">        totSet.</span><span style="color: #6F42C1">addAll</span><span style="color: #24292E">(</span><span style="color: #005CC5">this</span><span style="color: #24292E">.</span><span style="color: #6F42C1">keySet</span><span style="color: #24292E">());</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> it</span><span style="color: #D73A49">:</span><span style="color: #24292E"> totSet ){</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">if</span><span style="color: #24292E">(ts.</span><span style="color: #6F42C1">containsKey</span><span style="color: #24292E">(it)</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E">(</span><span style="color: #D73A49">!</span><span style="color: #005CC5">this</span><span style="color: #24292E">.</span><span style="color: #6F42C1">containsKey</span><span style="color: #24292E">(it))){</span></span>
<span class="line"><span style="color: #24292E">                returnedTs.</span><span style="color: #6F42C1">put</span><span style="color: #24292E">(it, ts.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">(it));</span></span>
<span class="line"><span style="color: #24292E">            }</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">if</span><span style="color: #24292E"> ((</span><span style="color: #D73A49">!</span><span style="color: #24292E">ts.</span><span style="color: #6F42C1">containsKey</span><span style="color: #24292E">(it))</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #005CC5">this</span><span style="color: #24292E">.</span><span style="color: #6F42C1">containsKey</span><span style="color: #24292E">(it)){</span></span>
<span class="line"><span style="color: #24292E">                returnedTs.</span><span style="color: #6F42C1">put</span><span style="color: #24292E">(it, </span><span style="color: #005CC5">this</span><span style="color: #24292E">.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">(it));</span></span>
<span class="line"><span style="color: #24292E">            }</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">else</span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">                returnedTs.</span><span style="color: #6F42C1">put</span><span style="color: #24292E">(it, ts.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">(it)</span><span style="color: #D73A49">+</span><span style="color: #005CC5">this</span><span style="color: #24292E">.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">(it));</span></span>
<span class="line"><span style="color: #24292E">            }</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> returnedTs;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span></code></pre></div></div></figure>
<h3 id="dividedby">dividedby()</h3>
<p>返回当前time
series除以ts的对应的data，若ts存在当前表不存在的年份，抛出异常</p>
<p>若ts存在而当前不存在则跳过</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> TimeSeries </span><span style="color: #6F42C1">dividedBy</span><span style="color: #24292E">(TimeSeries ts) {</span></span>
<span class="line"><span style="color: #24292E">    TimeSeries result </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">TimeSeries</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> it</span><span style="color: #D73A49">:</span><span style="color: #24292E"> </span><span style="color: #005CC5">this</span><span style="color: #24292E">.</span><span style="color: #6F42C1">keySet</span><span style="color: #24292E">()){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E">(</span><span style="color: #D73A49">!</span><span style="color: #24292E">ts.</span><span style="color: #6F42C1">containsKey</span><span style="color: #24292E">(it)){</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">throw</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IllegalArgumentException</span><span style="color: #24292E">(it</span><span style="color: #D73A49">+</span><span style="color: #032F62">&quot;is missing in this TimeSeries&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        result.</span><span style="color: #6F42C1">put</span><span style="color: #24292E">(it, </span><span style="color: #005CC5">this</span><span style="color: #24292E">.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">(it)</span><span style="color: #D73A49">/</span><span style="color: #24292E">ts.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">(it));</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> result;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h2 id="ngrammap">NGramMap</h2>
<p>该类是实现NGramMap的主要类</p>
<p>该类提供了许多方便的方法用于NGram实现，不需要extend其他类</p>
<p>这个类的主要任务是实现constructor，便于解析数据文件并存在合适的数据结构中</p>
<h3 id="输入文件格式">输入文件格式</h3>
<p>有两种文件类型，</p>
<p>第一种是words
file，提供了有关特定单词在特定年份的英语历史记录的制表符分割信息</p>
<p>第一个条目为单词，第二个为年份，第三个为该单词在当年在任何书中出现的次数，第四个为包含该单词的不同来源的数量，程序需要<strong>忽略第四列</strong></p>
<p>第二种为counts
file，每一行都提供了每一年可用数据总语料库的信息，用逗号分隔</p>
<p>第一个条目是年份，第二个条目是当年从所有语料中记录的总单词数，第三个条目是该年的文本总页数，第四个是该年的不同来源总数，程序需要<strong>忽略第三四列</strong></p>
<h3 id="使用in类读取文件">使用In类读取文件</h3>
<p>Java中可以使用In类读取文件</p>
<p>可以在<a
href="https://introcs.cs.princeton.edu/java/stdlib/javadoc/In.html">这里</a>看到详细文档</p>
<p>这是一个读取文件的例子</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">package</span><span style="color: #24292E"> main;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">import</span><span style="color: #24292E"> edu.princeton.cs.algs4.In;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">import</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> utils.Utils.</span><span style="color: #005CC5">*</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">FileReadDemo</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">main</span><span style="color: #24292E">(</span><span style="color: #D73A49">String</span><span style="color: #24292E">[] </span><span style="color: #E36209">args</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">        In in </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">In</span><span style="color: #24292E">(SHORT_WORDS_FILE);</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">int</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">while</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">in.</span><span style="color: #6F42C1">isEmpty</span><span style="color: #24292E">()) {</span></span>
<span class="line"><span style="color: #24292E">            i </span><span style="color: #D73A49">+=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">            String nextLine </span><span style="color: #D73A49">=</span><span style="color: #24292E"> in.</span><span style="color: #6F42C1">readLine</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">            System.out.</span><span style="color: #6F42C1">print</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Line &quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> i </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot; is: &quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">            System.out.</span><span style="color: #6F42C1">println</span><span style="color: #24292E">(nextLine);</span></span>
<span class="line"><span style="color: #24292E">            System.out.</span><span style="color: #6F42C1">print</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;After splitting on tab characters, the first word is: &quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">String</span><span style="color: #24292E">[] splitLine </span><span style="color: #D73A49">=</span><span style="color: #24292E"> nextLine.</span><span style="color: #6F42C1">split</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">\t</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">            System.out.</span><span style="color: #6F42C1">println</span><span style="color: #24292E">(splitLine[</span><span style="color: #005CC5">0</span><span style="color: #24292E">]);</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="构造函数">构造函数</h3>
<p>由于计算频率需要知道每个单词每年的数量与当年所有单词的总数量，我们需要map来存储年份-&gt;总单词量的映射与单词-&gt;对应Time
Series的映射（提示中写道尽量避免使用map嵌套，故我们使用自己的Time
Series，这样也可以方便操作数据与提高性能）</p>
<p>读取文件使用的类是课程给定的In类</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">NGramMap</span><span style="color: #24292E">(String wordsFilename, String countsFilename) {</span></span>
<span class="line"><span style="color: #24292E">    yearCount </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">TimeSeries</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    wordsCount </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> HashMap&lt;&gt;();</span></span>
<span class="line"><span style="color: #24292E">    In inWords </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">In</span><span style="color: #24292E">(wordsFilename);</span></span>
<span class="line"><span style="color: #24292E">    In inCounts </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">In</span><span style="color: #24292E">(countsFilename);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E">(</span><span style="color: #D73A49">!</span><span style="color: #24292E">inWords.</span><span style="color: #6F42C1">isEmpty</span><span style="color: #24292E">()){</span></span>
<span class="line"><span style="color: #24292E">        String nextLine1 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> inWords.</span><span style="color: #6F42C1">readLine</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">String</span><span style="color: #24292E">[] splitLine1 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> nextLine1.</span><span style="color: #6F42C1">split</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">\t</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        TimeSeries temp </span><span style="color: #D73A49">=</span><span style="color: #24292E"> wordsCount.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">(splitLine1[</span><span style="color: #005CC5">0</span><span style="color: #24292E">]);</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">wordsCount.</span><span style="color: #6F42C1">containsKey</span><span style="color: #24292E">(splitLine1[</span><span style="color: #005CC5">0</span><span style="color: #24292E">])){</span></span>
<span class="line"><span style="color: #24292E">            temp </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">TimeSeries</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">            wordsCount.</span><span style="color: #6F42C1">put</span><span style="color: #24292E">(splitLine1[</span><span style="color: #005CC5">0</span><span style="color: #24292E">], temp);</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">        temp.</span><span style="color: #6F42C1">put</span><span style="color: #24292E">(Integer.</span><span style="color: #6F42C1">parseInt</span><span style="color: #24292E">(splitLine1[</span><span style="color: #005CC5">1</span><span style="color: #24292E">]), Double.</span><span style="color: #6F42C1">parseDouble</span><span style="color: #24292E">(splitLine1[</span><span style="color: #005CC5">2</span><span style="color: #24292E">]));</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E">(</span><span style="color: #D73A49">!</span><span style="color: #24292E">inCounts.</span><span style="color: #6F42C1">isEmpty</span><span style="color: #24292E">()){</span></span>
<span class="line"><span style="color: #24292E">        String nextLine2 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> inCounts.</span><span style="color: #6F42C1">readLine</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">String</span><span style="color: #24292E">[] splitLine2 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> nextLine2.</span><span style="color: #6F42C1">split</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;,&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        yearCount.</span><span style="color: #6F42C1">put</span><span style="color: #24292E">(Integer.</span><span style="color: #6F42C1">parseInt</span><span style="color: #24292E">(splitLine2[</span><span style="color: #005CC5">0</span><span style="color: #24292E">]), Double.</span><span style="color: #6F42C1">parseDouble</span><span style="color: #24292E">(splitLine2[</span><span style="color: #005CC5">1</span><span style="color: #24292E">]));</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>我们创建了两个存储文件内容的结构</p>
<ul>
<li>yearCount－负责记录每一年的总次数作为分母，使用TImeSeries类而非普通的map，方便后续进行操作</li>
<li>wordsCount -
负责记录每一个单词在不同年份出现的次数，故使用了int与TimeSeries的嵌套</li>
</ul>
<p>wordsCount的读入有些麻烦，首先需要读取当前单词对应的TimeSeries，若为空则证明还未存在过，则创建新的TimeSeries并存入，最后将对应单词的年份－个数组成的TimeSeries（temp）存入wordsCount</p>
<h3 id="counthistory">countHIstory()</h3>
<p>返回一个TimeSeries，记录了给定单词在STARTYEAR到ENDYEAR间的出现次数</p>
<p>注意，这里返回的TimeSeries要求深拷贝以避免对原数据造成影响</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> TimeSeries </span><span style="color: #6F42C1">countHistory</span><span style="color: #24292E">(String word, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> startYear, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> endYear) {</span></span>
<span class="line"><span style="color: #24292E">   TimeSeries tempSeries </span><span style="color: #D73A49">=</span><span style="color: #24292E"> wordsCount.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">(word);</span></span>
<span class="line"><span style="color: #24292E">   </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (tempSeries </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">null</span><span style="color: #24292E">) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">TimeSeries</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">   TimeSeries returnedSeries </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">TimeSeries</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">   </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> it </span><span style="color: #D73A49">:</span><span style="color: #24292E"> tempSeries.</span><span style="color: #6F42C1">keySet</span><span style="color: #24292E">()){</span></span>
<span class="line"><span style="color: #24292E">       </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (it </span><span style="color: #D73A49">&gt;=</span><span style="color: #24292E">startYear</span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E">it</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">endYear){</span></span>
<span class="line"><span style="color: #24292E">           returnedSeries.</span><span style="color: #6F42C1">put</span><span style="color: #24292E">(it, tempSeries.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">(it));</span></span>
<span class="line"><span style="color: #24292E">       }</span></span>
<span class="line"><span style="color: #24292E">   }</span></span>
<span class="line"><span style="color: #24292E">   </span><span style="color: #D73A49">return</span><span style="color: #24292E"> returnedSeries;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>首先获得对应单词的TimeSeries，判断是否为空，为空则返回一个空的</p>
<p>否则遍历keySet，选择在规定区间内的year对应的计数数据存入新的TimeSeries</p>
<p>对应的重载版本取消了年份区间的要求，即深拷贝所有对应word对应年份的数据</p>
<p>这里转移数据时可以使用putAll方法，方便的把所有数据转移到新TimeSeries中</p>
<h3 id="weighthistory">weightHistory()</h3>
<p>返回一个TimeSeries，记录了给定单词在STARTYEAR与ENDYEAR间的单词出现频率（该单词在每年出现次数占该年所有单词出现次数的比例）</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> TimeSeries </span><span style="color: #6F42C1">weightHistory</span><span style="color: #24292E">(String word, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> startYear, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> endYear) {</span></span>
<span class="line"><span style="color: #24292E">    TimeSeries years </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">countHistory</span><span style="color: #24292E">(word, startYear, endYear);</span></span>
<span class="line"><span style="color: #24292E">    TimeSeries result </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">TimeSeries</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> year</span><span style="color: #D73A49">:</span><span style="color: #24292E">years.</span><span style="color: #6F42C1">keySet</span><span style="color: #24292E">()){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E">(</span><span style="color: #D73A49">!</span><span style="color: #24292E">yearCount.</span><span style="color: #6F42C1">containsKey</span><span style="color: #24292E">(year)) </span><span style="color: #D73A49">continue</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">double</span><span style="color: #24292E"> weight </span><span style="color: #D73A49">=</span><span style="color: #24292E"> yearCount.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">(year);</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (weight</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0.0</span><span style="color: #24292E">) </span><span style="color: #D73A49">continue</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        result.</span><span style="color: #6F42C1">put</span><span style="color: #24292E">(year, years.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">(year)</span><span style="color: #D73A49">/</span><span style="color: #24292E">weight);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> result;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>这里我们就可以使用已经创建的countHIstory方法获取该单词在对应年份中的所有计数数据</p>
<p>若年份不存在则跳过，否则我们获取当年的所有单词数（yearCount），这里要额外判断一下，让分母不为0</p>
<p>若符合所有条件，则计算频率并存入TimeSeries</p>
<p>对应的重载版本取消了年份区间的要求，对应调用不同函数即可</p>
<h3 id="summedweighthistory">summedWeightHistory()</h3>
<p>返回一个TimeSeries，记录了在STARTYEAR与ENDYEAR间给定所有单词在每一年的出现频率之和，若不存在则忽略</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> TimeSeries </span><span style="color: #6F42C1">summedWeightHistory</span><span style="color: #24292E">(Collection</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">String</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> words,</span></span>
<span class="line"><span style="color: #24292E">                                      </span><span style="color: #D73A49">int</span><span style="color: #24292E"> startYear, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> endYear) {</span></span>
<span class="line"><span style="color: #24292E">    TimeSeries result </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">TimeSeries</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (String word</span><span style="color: #D73A49">:</span><span style="color: #24292E">words){</span></span>
<span class="line"><span style="color: #24292E">        TimeSeries single </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">weightHistory</span><span style="color: #24292E">(word, startYear, endYear);</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E"> year</span><span style="color: #D73A49">:</span><span style="color: #24292E"> single.</span><span style="color: #6F42C1">keySet</span><span style="color: #24292E">()){</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">result.</span><span style="color: #6F42C1">containsKey</span><span style="color: #24292E">(year)) result.</span><span style="color: #6F42C1">put</span><span style="color: #24292E">(year, single.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">(year));</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">else</span><span style="color: #24292E"> result.</span><span style="color: #6F42C1">put</span><span style="color: #24292E">(year, result.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">(year)</span><span style="color: #D73A49">+</span><span style="color: #24292E">single.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">(year));</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> result;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>这里给的是一个words的collection，我们首先需要解包成每一个word，并使用weightHistory计算该单词在规定区间内的权重</p>
<p>遍历single的keySet，若year不存在则先放入第一组的single值，若存在则累加</p>
<p>对应的重载版本取消了年份区间的要求，对应调用不同重载函数就行</p>
<h2 id="historytexthandler">HistoryTextHandler</h2>
<p>下面需要设计一个前端以便用户交互</p>
<p>运行Main.java，可以发现服务器成功启动的提示，打开<code>ngordnet_2a.html</code>输入数据cat,dog，点击history(text)按钮，显示如下：</p>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">You entered the following info into the browser:</span></span>
<span class="line"><span style="color: #24292e">Words: [cat, dog]</span></span>
<span class="line"><span style="color: #24292e">Start Year: 2000</span></span>
<span class="line"><span style="color: #24292e">End Year: 2020</span></span></code></pre></div></div></figure>
<p>这时调用了DummyHistoryTextHandler中的handle方法，最后的期望结果如下：</p>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">cat: {2000=1.71568475416827E-5, 2001=1.6120939684412677E-5, 2002=1.61742010630623E-5, 2003=1.703155141714967E-5, 2004=1.7418408946715716E-5, 2005=1.8042211615010028E-5, 2006=1.8126126955841936E-5, 2007=1.9411504094739293E-5, 2008=1.9999492186117545E-5, 2009=2.1599428349729816E-5, 2010=2.1712564894218663E-5, 2011=2.4857238078766228E-5, 2012=2.4198586699546612E-5, 2013=2.3131865569578688E-5, 2014=2.5344693375481996E-5, 2015=2.5237182007765998E-5, 2016=2.3157514119191215E-5, 2017=2.482102172595473E-5, 2018=2.3556758130732888E-5, 2019=2.4581322086049953E-5}</span></span>
<span class="line"><span style="color: #24292e">dog: {2000=3.127517699525712E-5, 2001=2.99511426723737E-5, 2002=3.0283458650225453E-5, 2003=3.1470761877596034E-5, 2004=3.2890514515432536E-5, 2005=3.753038415155302E-5, 2006=3.74430614362125E-5, 2007=3.987077208249744E-5, 2008=4.267197824115907E-5, 2009=4.81026086549733E-5, 2010=5.30567576173992E-5, 2011=6.048536820577008E-5, 2012=5.179787485962082E-5, 2013=5.0225599367200654E-5, 2014=5.5575537540090384E-5, 2015=5.44261096781696E-5, 2016=4.805214145459557E-5, 2017=5.4171157785607686E-5, 2018=5.206751570646653E-5, 2019=5.5807040409297486E-5}</span></span></code></pre></div></div></figure>
<p>即显示了每一年对应的出现权重</p>
<p>创建一个java文件<code>HistoryTextHandler</code>实现</p>
<h3 id="构造函数-1">构造函数</h3>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">NGramMap map;</span></span>
<span class="line"><span style="color: #24292E">Map&lt;</span><span style="color: #D73A49">String</span><span style="color: #24292E">, </span><span style="color: #D73A49">TimeSeries</span><span style="color: #24292E">&gt; wordsHistory;</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">HistoryTextHandler</span><span style="color: #24292E">(NGramMap map){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">.map </span><span style="color: #D73A49">=</span><span style="color: #24292E"> map;</span></span>
<span class="line"><span style="color: #24292E">    wordsHistory </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> HashMap&lt;&gt;();</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>使用NGramMap存储存入的map，并用map存储得到的结果以便字符串输出</p>
<h3 id="handle">handle()</h3>
<p>handle负责收集输入的数据，在前端页面按下history(text)便会调用该方法，我们在这里计算并存储每个汉字对应的年份与权重</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">@</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> String </span><span style="color: #6F42C1">handle</span><span style="color: #24292E">(NgordnetQuery q) {</span></span>
<span class="line"><span style="color: #24292E">    List&lt;</span><span style="color: #D73A49">String</span><span style="color: #24292E">&gt; words </span><span style="color: #D73A49">=</span><span style="color: #24292E"> q.</span><span style="color: #6F42C1">words</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> startYear </span><span style="color: #D73A49">=</span><span style="color: #24292E"> q.</span><span style="color: #6F42C1">startYear</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> endYear </span><span style="color: #D73A49">=</span><span style="color: #24292E"> q.</span><span style="color: #6F42C1">endYear</span><span style="color: #24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (String word</span><span style="color: #D73A49">:</span><span style="color: #24292E">words){</span></span>
<span class="line"><span style="color: #24292E">        TimeSeries SingleWeight </span><span style="color: #D73A49">=</span><span style="color: #24292E"> map.</span><span style="color: #6F42C1">weightHistory</span><span style="color: #24292E">(word, startYear, endYear);</span></span>
<span class="line"><span style="color: #24292E">        wordsHistory.</span><span style="color: #6F42C1">put</span><span style="color: #24292E">(word, SingleWeight);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">this</span><span style="color: #24292E">.</span><span style="color: #6F42C1">toString</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>遍历words，取出每一个word通过map的方法计算指定年份间的权重，并存入wordsHistory</p>
<p>以字符串形式返回数据，这里需要重写toString方法</p>
<h3 id="override-tostring"><span class="citation"
data-cites="Override">@Override</span> toString()</h3>
<p>为了可以直接在handle中返回最终结果，需要重写toString方法</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">@</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> String </span><span style="color: #6F42C1">toString</span><span style="color: #24292E">(){</span></span>
<span class="line"><span style="color: #24292E">    StringBuilder returnedString </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">StringBuilder</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E">(String word</span><span style="color: #D73A49">:</span><span style="color: #24292E">wordsHistory.</span><span style="color: #6F42C1">keySet</span><span style="color: #24292E">()){</span></span>
<span class="line"><span style="color: #24292E">        returnedString.</span><span style="color: #6F42C1">append</span><span style="color: #24292E">(word).</span><span style="color: #6F42C1">append</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;: {&quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        TimeSeries wordWeight </span><span style="color: #D73A49">=</span><span style="color: #24292E"> wordsHistory.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">(word);</span></span>
<span class="line"><span style="color: #24292E">        Iterator&lt;</span><span style="color: #D73A49">Integer</span><span style="color: #24292E">&gt; it </span><span style="color: #D73A49">=</span><span style="color: #24292E"> wordWeight.</span><span style="color: #6F42C1">keySet</span><span style="color: #24292E">().</span><span style="color: #6F42C1">iterator</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">while</span><span style="color: #24292E">(it.</span><span style="color: #6F42C1">hasNext</span><span style="color: #24292E">()){</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">int</span><span style="color: #24292E"> year </span><span style="color: #D73A49">=</span><span style="color: #24292E"> it.</span><span style="color: #6F42C1">next</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">            returnedString.</span><span style="color: #6F42C1">append</span><span style="color: #24292E">(year).</span><span style="color: #6F42C1">append</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;=&quot;</span><span style="color: #24292E">).</span><span style="color: #6F42C1">append</span><span style="color: #24292E">(wordWeight.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">(year));</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (it.</span><span style="color: #6F42C1">hasNext</span><span style="color: #24292E">()){</span></span>
<span class="line"><span style="color: #24292E">                returnedString.</span><span style="color: #6F42C1">append</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;, &quot;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        returnedString.</span><span style="color: #6F42C1">append</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;}&quot;</span><span style="color: #24292E">).</span><span style="color: #6F42C1">append</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;</span><span style="color: #005CC5">\n</span><span style="color: #032F62">&#39;</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> returnedString.</span><span style="color: #6F42C1">toString</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>使用StringBuilder以方便构建字符串，通过遍历wordsHistory的键一点点构建列表</p>
<p>注意，这里在遍历值的时候使用了迭代器，因为最后一个值不能留逗号，故使用迭代器判断还有没有下一个值，有的情况下才加逗号</p>
<h2 id="historyhandler">HistoryHandler</h2>
<p>图形实现是靠base64码解码成为图像的</p>
<p>该项目提供了Plot库，有两个重要方法：</p>
<ul>
<li><code>ngordnet.Plotter.generateTimeSeriesChart</code>提供string列表与TimeSeries，返回对应图像（XYChart类），其中不同TimeSeries有不同颜色，按照string列表分配</li>
<li><code>ngordnet.Plotter.encodeChartAsString</code>将上面方法生成的图像编码为base64码</li>
<li><code>ngordnet.Plotter.displayChart</code>对base64解码并显示图像</li>
</ul>
<p>创建一个HistoryHandler文件实现图像显示</p>
<figure class="shiki java"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">HistoryHandler</span><span style="color: #24292E"> </span><span style="color: #D73A49">extends</span><span style="color: #24292E"> </span><span style="color: #6F42C1">NgordnetQueryHandler</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    NGramMap map;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">HistoryHandler</span><span style="color: #24292E">(NGramMap </span><span style="color: #E36209">map</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">this</span><span style="color: #24292E">.map </span><span style="color: #D73A49">=</span><span style="color: #24292E"> map;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    @</span><span style="color: #D73A49">Override</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> String </span><span style="color: #6F42C1">handle</span><span style="color: #24292E">(NgordnetQuery </span><span style="color: #E36209">q</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">        List&lt;</span><span style="color: #D73A49">String</span><span style="color: #24292E">&gt; words </span><span style="color: #D73A49">=</span><span style="color: #24292E"> q.</span><span style="color: #6F42C1">words</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">        List&lt;</span><span style="color: #D73A49">TimeSeries</span><span style="color: #24292E">&gt; lts </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> ArrayList&lt;&gt;();</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">int</span><span style="color: #24292E"> startYear </span><span style="color: #D73A49">=</span><span style="color: #24292E"> q.</span><span style="color: #6F42C1">startYear</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">int</span><span style="color: #24292E"> endYear </span><span style="color: #D73A49">=</span><span style="color: #24292E"> q.</span><span style="color: #6F42C1">endYear</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (String word</span><span style="color: #D73A49">:</span><span style="color: #24292E"> words){</span></span>
<span class="line"><span style="color: #24292E">            lts.</span><span style="color: #6F42C1">add</span><span style="color: #24292E">(map.</span><span style="color: #6F42C1">weightHistory</span><span style="color: #24292E">(word,startYear,endYear));</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">        XYChart chart </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Plotter.</span><span style="color: #6F42C1">generateTimeSeriesChart</span><span style="color: #24292E">(words, lts);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> Plotter.</span><span style="color: #6F42C1">encodeChartAsString</span><span style="color: #24292E">(chart);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<p>模仿demo即可，通过构造函数拷贝传入的map，接受输入的数据，通过map的方法计算权重并加入一个TimeSeries列表，通过内置的Plot库方法生成图表-加密为base64并返回</p>
]]></content>
      <categories>
        <category>CS61B</category>
      </categories>
      <tags>
        <tag>CS61B</tag>
        <tag>Project</tag>
      </tags>
  </entry>
  <entry>
    <title>【计算机组成原理】比特、字节与整数</title>
    <url>/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E6%AF%94%E7%89%B9%E3%80%81%E5%AD%97%E8%8A%82%E4%B8%8E%E6%95%B4%E6%95%B0/</url>
    <content><![CDATA[<h1 id="比特字节与整数">比特、字节与整数</h1>
<h2 id="信息存储">信息存储</h2>
<h3 id="表示方法">表示方法</h3>
<ul>
<li><p>计算机中的数据是以<strong>位(bit)</strong>为基本单元存储的</p></li>
<li><p>最小的可寻址的存储器单位为<strong>字节(byte)</strong>，由8bits的块表示，而不是在存储器中访问单独的位</p></li>
<li><p>机器级程序将存储器视为一个非常大的字节数组，称为<strong>虚拟存储器</strong>，每个字节都有唯一地址标识，所有可能地址的集合称为虚拟地址空间</p></li>
<li><p>通常将4bits的数据分组并使用<strong>十六进制</strong>表示</p>
<img src="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E6%AF%94%E7%89%B9%E3%80%81%E5%AD%97%E8%8A%82%E4%B8%8E%E6%95%B4%E6%95%B0/image-20250828152314345.png" class="" title="0x">
<p>进行十六转二进制转换时，可以一次进行一个十六进制值的转换</p>
<p>进行二转十六进制转换时，可以将二进制四位分一组进行转换，若少于四位前面用0补足</p>
<p>当值x是2的非负整数2次幂时，我们只需要记住此时x的二进制就是1后面n个0，而十六进制0代表四个二进制0，故我们可以将数分为<span
class="math inline">\(i+4j\)</span>的形式（<span
class="math inline">\(0\leq i\leq3\)</span>）再转化为十六进制</p></li>
</ul>
<h3 id="字数据大小">字数据大小</h3>
<ul>
<li><p>每台计算机都有一个字长，指明了指针数据的标称大小，决定着虚拟地址空间的最大大小，即对于一个字长为w的机器而言，虚拟地址的范围为0~<span
class="math inline">\(2^w-1\)</span>，程序最多访问<span
class="math inline">\(2^w\)</span>个字节</p></li>
<li><p>但计算机程序一般只能访问<span
class="math inline">\(2^{47}\)</span>的地址大小，某些内存是无法访问的，如果程序试图访问，则会抛出段错误（Segmentation
Fault）</p></li>
<li><p>32位、64位机器之分就是按照字长大小进行区分的。大多64位机器可以向后兼容32位下编写的程式。而对32位与64位程序的区分是根据程序如何编译来决定的，而不是运行的机器类型</p></li>
<li><p>C中不同数据类型在32位和64位下的大小也是不同的</p></li>
</ul>
<style>.ytqfboupclsr{zoom:50%;}</style>
<img src="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E6%AF%94%E7%89%B9%E3%80%81%E5%AD%97%E8%8A%82%E4%B8%8E%E6%95%B4%E6%95%B0/image-20250828155618365.png" class="ytqfboupclsr" alt="字节与数据类新">
<ul>
<li><code>int32_t</code>与<code>int64_t</code>是固定的数据大小，不随编译器和机器设置变化，分别为4字节与8字节</li>
<li>大部分数据类型都编码为有符号值，除非有前缀<code>unsigned</code>或对确定大小的数据使用特定声明。char类型是例外，大多编译器和机器将其认为是有符号数，C标准不保证</li>
<li>单精度float使用4字节，双精度double使用8字节</li>
<li>gcc编译器下，，可以使用<code>-m32</code>
<code>-m64</code>来指定用多少位编译</li>
<li>某个程序使用的字长是由硬件和编译器共同决定的</li>
</ul>
<h3 id="寻址与字节顺序">寻址与字节顺序</h3>
<ul>
<li><p>在几乎所有机器上，多字节对象都被存储为连续的字节序列，地址为所使用字节</p></li>
<li><p>32位下字的地址是4的倍数，，64位下字的地址是8的倍数，这被称为对齐字节，编译器尽可能保持字对齐，使得硬件运行效率更高</p></li>
<li><p>考虑一个w位的整数，<span
class="math inline">\(x_{w-1}\)</span>为最高有效位<span
class="math inline">\(x_0\)</span>为最低有效位，若w是8的倍数，则这些位可以分为字节</p>
<ul>
<li><p>机器选择在内存中按从最低有效字节到最高有效字节的顺序存储对象，即最低有效字节在前的方法称为<strong>小端法</strong></p></li>
<li><p>机器选择在内存中按从最高有效字节到最低有效字节的顺序存储对象，即最高有效字节在前的方法称为<strong>大端法</strong></p>
<style>.caicrlwmtirt{zoom:67%;}</style>
<img src="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E6%AF%94%E7%89%B9%E3%80%81%E5%AD%97%E8%8A%82%E4%B8%8E%E6%95%B4%E6%95%B0/image-20250828161618220.png" class="caicrlwmtirt" alt="大小端"></li>
</ul></li>
</ul>
<p>​
大多数程序员来说，机器使用的字节顺序是完全不可见的，无论为哪种类型的机器所编译的程序都会得到同样的结果，但以下情况字节顺序会成为问题</p>
<p>​
一是不同类型的机器之间通过网络传输二进制数据时，小端机器产生的数据被发送到大端机器或反过来时，接收程序会发现字节称为反序，这时网络应用程序的代码编写需要遵循已建立的关于字节顺序的规则</p>
<p>​
二是当阅读表示整数数据的字节序列时，顺序也很重要，通常发生在检查机器级程序时。</p>
<p>如该行汇编代码<code>4004d3: 01 05 43 0b 20 00 add %eax, 0x200b43(%rip)</code>，左侧的十六进制字节串的后四个字节反过来就是右侧的数值</p>
<p>​
三是当编写规避正常的类型系统的程序时，如在C语言中使用强制类型转换或联合来允许一种数据类型引用一个对象，而这种数据类型与创建对象时定义的数据类型不同</p>
<h3 id="布尔代数">布尔代数</h3>
<p>表示逻辑为将1表示为True，0表示为False</p>
<ul>
<li><p>And(&amp;)：A&amp;B=1当且仅当A=1且B=1</p></li>
<li><p>Or(|)：A|B=1当A=1或B=1</p></li>
<li><p>Not(<sub>)：</sub>A=1当A=0</p></li>
<li><p>Xor(^)：A^B=1当A=1或B=1且AB不同时为1</p></li>
<li><p>左移(&lt;&lt;)：x&lt;&lt;y表示将x的二进制左移y个位置</p>
<p>左端多出的bits丢弃，右端用0填充</p></li>
<li><p>右移(&gt;&gt;)：x&gt;&gt;y表示将x的二进制右移y个位置</p>
<p>右端多出的bits丢弃，对于左端有两种方法</p>
<ul>
<li>逻辑移动：左端用0填充</li>
<li>算术移动：左端用最高有效位的值填充（默认使用该方法）</li>
</ul></li>
</ul>
<blockquote>
<p>Java中，&gt;&gt;表示算术右移，&gt;&gt;&gt;表示逻辑右移</p>
</blockquote>
<p><strong>注意：移位操作中移位量应该是一个0~n-1之间的数</strong></p>
<blockquote>
<p>若移位量<span class="math inline">\(y\geq
x\)</span>的位数（设为w），移位指令只考虑位移量的低<span
class="math inline">\(\log_2w\)</span>位</p>
<p>因为实际上位移量就是靠计算<span
class="math inline">\(k\bmod{w}\)</span>得到的</p>
<p>但这其实是一个未定义行为，故移位量最好还是要保证在范围内</p>
</blockquote>
<h3 id="位级运算">位级运算</h3>
<p>C语言支持位布尔运算，确定一个位级表达式的最好方法就是将十六进制的参数扩展成二进制并执行二进制运算，再转换回十六进制</p>
<p>一个常见用法是实现<strong>掩码</strong>运算</p>
<p>掩码是一个位模式，表从一个字中选出的位的集合</p>
<p>例：掩码0xFF表示一个字的低位字节，位级运算x&amp;0x89ABCDEF生成一个由x的最低有效字节组成的值，而其他字节置零，如0x89ABCDEF变为0x000000EF。</p>
<p>表达式~0可以生成一个全1的掩码，不管机器的字大小是多少，等等</p>
<p>即掩码0xFF实现了选中x最低八位保留，掩码~0实现了获取所有位全一的掩码</p>
<h2 id="整数表示">整数表示</h2>
<p>以下是会用到的术语</p>
<style>.xwfuordfollu{zoom:67%;}</style>
<img src="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E6%AF%94%E7%89%B9%E3%80%81%E5%AD%97%E8%8A%82%E4%B8%8E%E6%95%B4%E6%95%B0/image-20250828180920501.png" class="xwfuordfollu" alt="术语">
<h3 id="整型">整型</h3>
<p>整型数据类型指的是表示有限范围的整数</p>
<p>每种类型可以用关键字指定大小（char, short,
long），同时可以只是被表示的数字是否有符号，分配的字节数根据机器字长决定，如下面是64位程序C语言整型的取值范围</p>
<style>.cdqqiqvwqjcd{zoom:67%;}</style>
<img src="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E6%AF%94%E7%89%B9%E3%80%81%E5%AD%97%E8%8A%82%E4%B8%8E%E6%95%B4%E6%95%B0/image-20250830102123836.png" class="cdqqiqvwqjcd" alt="整型">
<p>同时C语言标准定义了每种数据类型必须能表示的最小的取值范围，与上面的一样或小一些，只要求正数与负数的取值范围对称（除了int_t这种固定大小的）</p>
<blockquote>
<p><strong>定宽数据类型：</strong></p>
<p>某些数据类型在不同的机器上有不同的取值范围，为了能够保持一致，我们需要定宽，即不能让某些整数类型随不同字节的机器而变化</p>
<p>故C99标准中引入了一组定宽整数类型，他们的声明类似于<code>intN_t</code>与<code>uintN_t</code>，其中N可以为8、16、32、64等，与实现相关</p>
<p>通过这种类型我们可以声明一个指定位数下的整数类型</p>
<p>除了类型本身，头文件中还定义了一套相匹配的宏，使用printf打印他们时，需要使用<strong>格式化宏</strong>，他们的名字类似于<code>PRIdN</code>（有符号）与<code>PRIuN</code>（无符号），代码中表示如下：</p>
<p><code>printf("x = %" PRId32 ", y = %" PRIu64 "\n", x, y);</code></p>
<p>他们本身就是字符串字面量，在不同系统中会被重定义为对应类型，如64位系统下，PRId32展开为d，PRId64展开为lu，故代码变为</p>
<p><code>printf("x = %d, y = %lu\n", x, y);</code></p>
<p>这样保证了在不同机器上无论代码如何被编译都能生成正确的格式字符串</p>
</blockquote>
<h3 id="无符号数的编码">无符号数的编码</h3>
<p>假设一个整数数据类型有w位，位向量为<span
class="math inline">\(\vec{x}\)</span>。将其看为一个二进制表示的数，就得到了无符号表示。</p>
<p>其中每一位<span
class="math inline">\(x_i\)</span>取值为0或1，取值1表示该位下<span
class="math inline">\(2^i\)</span>应成为数字值的一部分</p>
<p>即<span class="math inline">\(B2U_w(\vec{x})\doteq \sum_{i=0}^{w-1}
x_i2^i\)</span></p>
<p>其中<strong>最小值</strong>位全是0，故为0；<strong>最大值</strong>位全是1，故为<span
class="math inline">\(2^{w}-1\)</span></p>
<p>无符号的二进制表示有一个很重要的特性：<strong>每个介于范围之间的数都有唯一一个w位的值编码</strong></p>
<p>因为函数<span class="math inline">\(B2U_w\)</span>是一个双射</p>
<h3 id="补码编码">补码编码</h3>
<p>计算机最常见的有符号数的表示方式是<strong>补码</strong>，在补码形式中，字的最高有效位<span
class="math inline">\(x_{w-1}\)</span>称为负权，也称为符号位，权重为<span
class="math inline">\(-2^{w-1}\)</span></p>
<p>当符号位被设置为1时，表示值为负，设置为0时，表示值为非负</p>
<p>即<span class="math inline">\(B2T_w(\vec{x})\doteq
-x_{w-1}2^{w-1}+\sum_{i=0}^{w-2} x_i2^i\)</span></p>
<p>其中<strong>最小值</strong>符号位为1，其余位为0，值为<span
class="math inline">\(-2^{w-1}\)</span>，<strong>最大值</strong>符号位为0，其余位为1，值为<span
class="math inline">\(2^{w-1}\)</span></p>
<p>同无符号，补码编码<strong>在可表示的取值范围内每一个数字都有一个唯一的w位补码编码</strong></p>
<p>因为函数<span class="math inline">\(B2T_w\)</span>也是一个双射</p>
<p>以下为一些比较重要的数字的表示</p>
<style>.lndvhvwkgttt{zoom: 50%;}</style>
<img src="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E6%AF%94%E7%89%B9%E3%80%81%E5%AD%97%E8%8A%82%E4%B8%8E%E6%95%B4%E6%95%B0/image-20250830104550102.png" class="lndvhvwkgttt" alt="较重要的表示">
<p>其中值得注意的是：</p>
<ol type="1">
<li>补码的范围是不对称的，这导致了补码运算中某些的特殊性质</li>
<li><span class="math inline">\(|TMin|=TMax+1\)</span></li>
<li>最大的无符号数刚好比补码最大值的两倍多1，即<span
class="math inline">\(UMax_w=2TMax_w+1\)</span></li>
</ol>
<h3 id="其他表示方法">其他表示方法</h3>
<h4 id="反码">反码</h4>
<p>除了最高有效位的权是<span
class="math inline">\(-(2^{w-1}-1)\)</span>，其余与补码一致</p>
<p><span class="math inline">\(B2O_w(\vec{x})\doteq
-x_{w-1}(2^{w-1}-1)+\sum_{i=0}^{w-2} x_i2^i\)</span></p>
<h4 id="原码">原码</h4>
<p>最高位为有效位，用来确定剩下的位该取负权还是正权</p>
<p><span class="math inline">\(B2S_w(\vec{x})\doteq
(-1)^{x_{w-1}}+\sum_{i=0}^{w-2} x_i2^i\)</span></p>
<p>这两种表示对于0有两种不同的编码方式：</p>
<ul>
<li>将00…0都解释为+0</li>
<li>而-0在原码中表示为10…0，反码中表示为11…11</li>
</ul>
<h3 id="有符号与无符号数之间的转换">有符号与无符号数之间的转换</h3>
<p>C语言允许在不同数据类型之间进行强制类型转换</p>
<p>对于有无符号数间的强转, 结果保持位值不变, 只是改变了解释位的方式</p>
<p>这可以总结为T2U函数的一个属性:</p>
<p>对满足<span class="math inline">\(TMin_w\leq x \leq
TMax_w\)</span>的x有:</p>
<p><span class="math inline">\(T2U_w(x)=\left\{\begin{matrix} x+2^w,
&amp; x&lt;0\\ x,&amp;x\geq0\end{matrix}\right.\)</span></p>
<p>反过来, U2T函数的属性即为:</p>
<p>对满足<span class="math inline">\(0\leq u\leq
UMax_w\)</span>的u有:</p>
<p><span class="math inline">\(U2T_w(u)=\left\{\begin{matrix}
u, &amp; x\leq TMax_w
\\ u-2^w,&amp;x&gt;TMax_w
\end{matrix}\right.\)</span></p>
<p>综上, 对于<span class="math inline">\(0\leq x\leq
TMax_w\)</span>之内的值x有着相同的无符号和补码表示</p>
<p>对于这个范围以外的值, 转换需要加上或减去<span
class="math inline">\(2^w\)</span></p>
<style>.fbxlwepksdgw{zoom: 50%;}</style>
<img src="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E6%AF%94%E7%89%B9%E3%80%81%E5%AD%97%E8%8A%82%E4%B8%8E%E6%95%B4%E6%95%B0/image-20250902131358261.png" class="fbxlwepksdgw" alt="转换图">
<h3 id="c语言中的有符号和无符号数">C语言中的有符号和无符号数</h3>
<ul>
<li>C语言标准没有指定符号数用何种方式表示, 但几乎所有机器都使用补码</li>
<li>通常大部分数字默认为有符号数,
要创建一个无符号常量需要加上后缀u或U</li>
<li>进行转换时, 大多系统遵循的是底层的位保持不变, 即应用<span
class="math inline">\(U2T_w\)</span>与<span
class="math inline">\(T2U_w\)</span>函数,其中w为数据类型的位数</li>
<li>当一种类型的表达式被赋值给另一种类型的变量时, 发生隐式转换</li>
<li>在printf中使用%d, %u, %x分别表示有符号十进制, 无符号十进制,
十六进制. 当然也可以用%u输出int, 用%d输出unsigned,
此时会按照格式化的进行转换输出</li>
<li>若进行运算时一个运算数是有符号的另一个是无符号的,
那么C语言会<strong>隐式的将有符号强转为无符号</strong>,
并假设两个数都是非负来进行运算</li>
</ul>
<blockquote>
<p><strong>C语言中TMin的写法:</strong></p>
<p>C的头文件limits.h中,
INT_MIN的宏定义为<code>#define INT_MIN (-INT_MAX - 1)</code></p>
<p>这是补码的不对称性与C语言的转换规则结合起来迫使我们这么定义的</p>
</blockquote>
<h3 id="扩展一个数字的位表示">扩展一个数字的位表示</h3>
<p>要将一个无符号数拓展为一个更大的数据类型, 只需要在开头添加0,
这种运算被称为<strong>零拓展</strong>，零拓展后数值大小不变，宽度变大</p>
<p>要将一个补码数拓展为一个更大的数据类型，可以执行<strong>符号拓展</strong>，在开头添加最高有效位的值（符号位的值），符号拓展后数值大小不变，宽度变大</p>
<p>注意：将一个数据向另一个数据转换以及无符号和有符号间转换的相对顺序会影响一个程序的行为，如将<code>short</code>转换为<code>unsigned</code>时，首先要改变大小再完成符号转换，即<code>short-&gt;unsigned int</code>而不是<code>short-&gt;unsigned short</code></p>
<h3 id="截断数字">截断数字</h3>
<p>当将一个w位的数截断为一个k位的数时，我们会丢弃高w-k位，此时可能会改变它的值</p>
<ul>
<li><p>对于一个无符号数x，截断为k位后数值<span
class="math inline">\(x&#39;=x\bmod{2^k}\)</span></p></li>
<li><p>对于一个有符号数x的补码，截断为k位后数值<span
class="math inline">\(x&#39;=U2T_k(x\bmod2^k)\)</span></p>
<p>即将最高位转换为符号位，按照之前的定义需要减一个<span
class="math inline">\(2^k\)</span></p></li>
</ul>
<h2 id="整数运算">整数运算</h2>
<h3 id="无符号加法">无符号加法</h3>
<p>考虑两个整数<span class="math inline">\(0\leq
x,y\leq2^w\)</span>，他们的和的范围可能是<span
class="math inline">\(0\leq
x+y\leq2^{w+1}-2\)</span>，显然一个w位的数字可能需要w+1位才能表示。这种持续的字节膨胀意味着要完整表示算术运算的结果，我们不能对字长做任何限制</p>
<p>为参数x与y定义运算<span
class="math inline">\(+^{u}_{w}\)</span>，其中<span
class="math inline">\(0\leq x,y\leq2^w\)</span>，该操作是将<span
class="math inline">\(x+y\)</span>截断w位得到的结果，再把结果看作无符号数，即将原和模<span
class="math inline">\(2^w\)</span>，具体的可以描述为</p>
<p><span
class="math inline">\(x+^{u}_{w}=\left\{\begin{matrix}x+y  ,&amp;
x+y&lt;2^w\\ x+y-2^w ,&amp; 2^w\leq x+y\leq
2^{w+1}\end{matrix}\right.\)</span></p>
<p>C语言中不会将溢出作为错误发出信号，故我们可以写代码检测是否溢出：</p>
<p><strong>对<span class="math inline">\(0\leq x,y \leq
UMax_w\)</span>，令<span class="math inline">\(s\doteq
x+^{u}_{w}y\)</span>，则对s，当且仅当<span
class="math inline">\(s&lt;x\)</span>或等价的<span
class="math inline">\(s&lt;y\)</span>时发生溢出</strong></p>
<p><strong>阿贝尔群：</strong></p>
<p>模数加法形成了一种数学结构叫阿贝尔群，它是可交换和可结合的。有一个单位元0，并且每个元素有一个加法逆元</p>
<p>考虑w位的无符号数的集合，执行<span
class="math inline">\(+^{u}_{w}\)</span>，对于每个值x，必然有某个值<span
class="math inline">\(-^{u}_{w}x\)</span>满足<span
class="math inline">\(-^{u}_{w}x+^{u}_{w}x=0\)</span>，逆操作如下：</p>
<p>对满足<span class="math inline">\(0\leq
x\leq2^w\)</span>的任意x，其w位的无符号逆元<span
class="math inline">\(-^{u}_{w}x\)</span>由下式给出：</p>
<p><span class="math inline">\(-^{u}_{w}x=\left\{\begin{matrix}x,&amp;
x=0\\2^w-x ,&amp; x&gt;0\end{matrix}\right.\)</span></p>
<h3 id="补码加法">补码加法</h3>
<p>同样考虑两个整数<span class="math inline">\(-2^{w-1}\leq
x,y\leq2^{w-1}-1\)</span>，他们的和的范围可能是<span
class="math inline">\(-2^w\leq
x+y\leq2^{w}-2\)</span>，要准确表示可能需要w+1位，但结果不太一样</p>
<p>定义<span class="math inline">\(x+^{t}_{w}y\)</span>为<span
class="math inline">\(x+y\)</span>被截断w位的结果，并看作补码，则有：</p>
<p><span class="math inline">\(x+^{t}_{w}y=\left\{\begin{matrix}x+y-2^w,
&amp; 2^{w-1}\leq x+y\\x+y,&amp; -2^{w-1}\leq x+y&lt;2^{w-1}\\x+y+2^w
,&amp; x+y&lt;-2^{w-1}\end{matrix}\right.\)</span></p>
<p>其中当和<span class="math inline">\(x+y\)</span>超过<span
class="math inline">\(TMax_w\)</span>时，称发生了<strong>正溢出</strong>，结果会变为负数</p>
<p>当和<span class="math inline">\(x+y\)</span>小于<span
class="math inline">\(TMin_w\)</span>时，称发生了**负溢出，结果会变为整数</p>
<p>检测补码加法中的溢出：</p>
<p><strong>对满足<span class="math inline">\(TMin_w\leq x\leq
TMax_w\)</span>的x与y，令<span class="math inline">\(s\doteq
x+^{u}_{w}y\)</span>，当且仅当<span
class="math inline">\(x&gt;0,y&gt;0\)</span>但<span
class="math inline">\(s\leq0\)</span>时发生了正溢出，当且仅当<span
class="math inline">\(x&lt;0, y&lt;0\)</span>但<span
class="math inline">\(s\geq0\)</span>时发生了负溢出</strong></p>
<h3 id="补码的非">补码的非</h3>
<p>注意到在<span class="math inline">\(TMin_w\leq x\leq
TMax_w\)</span>下的每个数字x都有<span
class="math inline">\(+^{t}_{w}\)</span>下的加法逆元，我们将补码的非<span
class="math inline">\(-^{t}_{w}x\)</span>表示如下：</p>
<p><span
class="math inline">\(-^{t}_{w}x=\left\{\begin{matrix}TMin_w,  &amp;
x=TMin_w\\-x,  &amp; x&gt;TMin_w\end{matrix}\right.\)</span></p>
<p>即对w位的补码加法来说，<span
class="math inline">\(TMin_w\)</span>是自己加法的逆，而对其他任何数值x都有-x作为其加法的逆</p>
<blockquote>
<p>对于一个数的位级表示，计算补码非可以采取取反+1的方法，即<span
class="math inline">\(-x=\textasciitilde x+1\)</span></p>
<p>还有一种方法是找到最低位1，将该位左边的所有位取反（不包括该位）</p>
</blockquote>
<h3 id="无符号乘法">无符号乘法</h3>
<p><span class="math inline">\(0\leq
x,y\leq2^w\)</span>的两个数的乘积<span class="math inline">\(x\cdot
y\)</span>的取值范围<span class="math inline">\(0\leq x\cdot y \leq
(2^w-1)^2\)</span>，这可能需要<span
class="math inline">\(2w\)</span>位表示，但C语言中的无符号乘积被定义为低w位表示的值，我们定义为<span
class="math inline">\(x \times^{u}_{w}y\)</span>，则有：<span
class="math inline">\(x \times^{u}_{w}y=(x\cdot
y)\bmod{2^w}\)</span></p>
<h3 id="补码乘法">补码乘法</h3>
<p><span class="math inline">\(-2^{w-1}\leq
x,y\leq2^{w-1}-1\)</span>的两个数的乘积的取值范围可能需要<span
class="math inline">\(2w\)</span>位表示，但C语言中表示的是截断后低w位的值，我们定义为<span
class="math inline">\(x
\times^{t}_{w}y\)</span>。截断w位相当于先计算该值（无符号）模<span
class="math inline">\(2^w\)</span>，再把无符号数转换为补码，即<span
class="math inline">\(x \times^{t}_{w}y=U2T_w((x\cdot
y)\bmod{2^w})\)</span></p>
<p>另外，我们认为对于无符号和补码乘法来说，他们结果的二进制表示都是一样的，即<span
class="math inline">\(T2B_w(x \times^{t}_{w}y)=U2B_w(x
\times^{u}_{w}y)\)</span></p>
<p>检测补码乘法中的溢出可以使用如下代码：</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">tmult_ok</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">x</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #E36209">y</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">int</span><span style="color: #24292E"> p </span><span style="color: #D73A49">=</span><span style="color: #24292E"> x</span><span style="color: #D73A49">*</span><span style="color: #24292E">y;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">!</span><span style="color: #24292E">x</span><span style="color: #D73A49">||</span><span style="color: #24292E">p</span><span style="color: #D73A49">/</span><span style="color: #24292E">x</span><span style="color: #D73A49">==</span><span style="color: #24292E">y;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre></div></div></figure>
<h3 id="乘以常数">乘以常数</h3>
<p>在乘以常数因子时，编译器会尝试使用移位与加法来代替单纯相乘，可以提高运算速度</p>
<h4 id="乘以2的幂">乘以2的幂</h4>
<p>设x为w位的无符号整数，则对于任何<span
class="math inline">\(k\geq0\)</span>，<span
class="math inline">\(x2^w\)</span>的<span
class="math inline">\(w+k\)</span>位的无符号表示表示为在原x二进制的右侧增加了k个0</p>
<p>如<span class="math inline">\(w=4\)</span>，11表示为1011，<span
class="math inline">\(k=2\)</span>时将其左移得到六位的101100，无符号数为44</p>
<p>进一步，结论还能简化为：</p>
<ul>
<li>无符号乘法：变量x与k分别有无符号数值<span
class="math inline">\(x\)</span>与<span
class="math inline">\(k\)</span>，且<span class="math inline">\(0\leq
k&lt;w\)</span>，则表达式<code>x&lt;&lt;k</code>可以得到<span
class="math inline">\(x \times^{u}_{w}2^k\)</span></li>
<li>补码乘法：变量x与k分别有补码值<span
class="math inline">\(x\)</span>与无符号数值<span
class="math inline">\(k\)</span>，且<span class="math inline">\(0\leq
k&lt;w\)</span>，则表达式<code>x&lt;&lt;k</code>可以得到<span
class="math inline">\(x \times^{t}_{w}2^k\)</span></li>
</ul>
<p>如计算表达式<code>x*14</code>，编译器会将乘法重写为<code>(x&lt;&lt;3)+(x&lt;&lt;2)+(x&lt;&lt;1)</code>或者<code>(x&lt;&lt;4)-(x&lt;&lt;1)</code></p>
<p>注意：乘以2的幂可能导致溢出，但结果表明，即使溢出得到的结果也是一样的，如1011移位得到101100，截断四位得到1100（<span
class="math inline">\(12=44\bmod 16\)</span>）</p>
<h4 id="乘以k">乘以k</h4>
<p>归纳上述例子，对于某个常数k的表达式<code>x*k</code>，编译器会把k的二进制表示表达为一组0和1交替的序列</p>
<p>如14可以写成[(0…0)(111)(0)]</p>
<p>考虑一组从位位置n到位位置m的连续的1，我们可以用以下两种形式中的一种来计算位对乘积的影响</p>
<ul>
<li>A：<code>(x&lt;&lt;n)+(x&lt;&lt;(n-1))+...+(x&lt;&lt;n)</code></li>
<li>B：<code>(x&lt;&lt;(n+1))-(x&lt;&lt;m)</code>（当有效位最高位为n时，表达式改为<code>-(x&lt;&lt;m)</code>）</li>
</ul>
<p>把每个这样连续的1的结果加起来，不用做任何乘法就能计算出<code>x*k</code></p>
<p>编译器对两种方式的选择：假设加减法有同样的性能</p>
<ul>
<li>当n=m时，选择A，因为A只需要一个移位，而B需要两个移位和一个减法</li>
<li>当n=m+1时，选两者均可，都需要两个移位和一个加法或减法</li>
<li>当n&gt;m+1时，选B，因为B只需要两个移位和一个减法，而A需要n-m+1&gt;2个移位，B需要(n-m)&gt;1个加法</li>
</ul>
<h3 id="补码除法除以二的幂">补码除法（除以二的幂）</h3>
<p>除以二的幂可以使用右移运算来实现，无符号和补码数分别使用逻辑移位与算术移位来达到目的</p>
<h4 id="无符号运算">无符号运算</h4>
<p><strong>C语言下变量x与k分别有无符号数值<span
class="math inline">\(x\)</span>和<span
class="math inline">\(k\)</span>，且<span class="math inline">\(0\leq
k&lt;w\)</span>，则C表达式<code>x&gt;&gt;k</code>的值<span
class="math inline">\(**\lfloor \frac{x}{2^k}
\rfloor\)</span>，此时右移获得的位向量左侧补零，是</strong>逻辑移位**</p>
<h3 id="补码运算">补码运算</h3>
<p>为了使负数仍为负数，需要执行<strong>算术移位</strong></p>
<p>对于<span
class="math inline">\(x\geq0\)</span>，最高有效位为0，故效果与逻辑右移是一样的</p>
<p>对于<span
class="math inline">\(x&lt;0\)</span>，若需要进行舍入，结果会导致向下舍入，如右移四位时将会把-771.25向下舍为-772</p>
<p>故我们需要在移位之前通过<strong>偏置</strong>这个值，来修正不合适的舍入，即</p>
<p><strong>C语言下变量x与k分别有无符号数值<span
class="math inline">\(x\)</span>和<span
class="math inline">\(k\)</span>，且<span class="math inline">\(0\leq
k&lt;w\)</span>，执行算术移位，C表达式<code>(x+(1&lt;&lt;k)-1)&gt;&gt;k</code>的值为<span
class="math inline">\(\lceil \frac{x}{2^k} \rceil\)</span></strong></p>
<p>其中偏置使用了如下属性：<span class="math inline">\(\lceil
\frac{x}{y} \rceil=\lfloor \frac{(x+y-1)}{y}
\rfloor\)</span>，而<code>(x+(1&lt;&lt;k)-1)</code>得到的数值即为<span
class="math inline">\(x+2^k-1\)</span>，将该数右移k位就得到了<span
class="math inline">\(\lceil \frac{x}{2^k} \rceil\)</span></p>
<p>在C语言中，使用<code>(x&lt;0? x+(1&lt;&lt;k)-1 : x)&gt;&gt;k</code>可以计算<span
class="math inline">\(\frac{x}{2^k}\)</span></p>
<p><strong>注意：这种方法不能推广到除以任意常数k</strong></p>
<h2 id="使用建议">使用建议</h2>
<h3 id="for循环中">for循环中</h3>
<p>在进行类似于for循环逆序遍历时，推荐使用<code>size_t</code>的64位数字类型来定义遍历变量，，防止无限循环
<figure class="shiki C++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre><code>size_t i;
for(i = cnt-2; i<cnt; i--}{
	a[i]+=a[i-1]
}</code></pre></div></div></figure></p>
<h4 id="何时使用无符号整数">何时使用无符号整数</h4>
<ul>
<li>进行模运算时时</li>
<li>当bits表示集合时</li>
</ul>
]]></content>
      <categories>
        <category>计算机组成原理</category>
      </categories>
      <tags>
        <tag>CSAPP</tag>
        <tag>计算机组成原理</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61A】CS61A——Attributes</title>
    <url>/CS61A/CS61A%20Attributes/</url>
    <content><![CDATA[<h1 id="attributes">Attributes</h1>
<h2 id="class-attributes">Class Attributes</h2>
<p>语法： <figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">name</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">suite</span><span style="color: #D73A49">&gt;</span></span></code></pre></div></div></figure>
class声明将会创建一个新类并将其绑定到<code>&lt;name&gt;</code>上，作为当前环境的第一个作用域
类语句内部，赋值语句和def语句创建类属性，此时它们作为类属性放入类中，而非在作用域中
当class声明执行时，内部语句才会执行</p>
<p>类属性在类的所有实例之间共享
这样我们不必在每个创建的实例中存储此值，而只需要在类中存储一次</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Account</span><span style="color: #24292E">:</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    interest </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0.02</span><span style="color: #24292E"> </span><span style="color: #6A737D"># 类属性</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #005CC5">__init__</span><span style="color: #24292E">(self, account_holder):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.balance </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.holder </span><span style="color: #D73A49">=</span><span style="color: #24292E"> account_holder</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">deposit</span><span style="color: #24292E">(self, amount):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.balance </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">self</span><span style="color: #24292E">.balance </span><span style="color: #D73A49">+</span><span style="color: #24292E"> amount</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">self</span><span style="color: #24292E">.balance  </span></span>
<span class="line"><span style="color: #24292E">tom </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Account(</span><span style="color: #032F62">&#39;Tom&#39;</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">jim </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Account(</span><span style="color: #032F62">&#39;Jim&#39;</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(tom.interest)</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(jim.interest)</span></span></code></pre></div></div></figure>
<pre><code>0.02
0.02</code></pre>
<h2 id="attribute-lookup">Attribute Lookup</h2>
<h3 id="by-name">By Name</h3>
<p>表达式提供对象，名称提供要查找的属性名称
但通过name查找将会查找多个位置，这取决于点表达式： -
首先执行点左侧表达式，生成该对象 -
<code>&lt;name&gt;</code>与该对象的实例属性匹配，如果存在该名称的属性，则返回值
- 如果没有找到，则在该对象的类中查找（类属性） -
返回的值是整个表达式的值，除非是一个函数，函数将会返回一个绑定的方法，对象填充为self</p>
<h3 id="by-function">By Function</h3>
<p>使用<code>getatter</code>函数，可以用属性名的字符串来查找对应属性
使用<code>hasatter</code>函数，可以判断是否具有该属性
<code>getatter</code>函数与点表达式查询方式相同
在对象中查询属性可能会返回实例属性或类属性之一</p>
<h2 id="attribute-assignment">Attribute Assignment</h2>
<p>左侧有点表达式的赋值语句会影响点表达式对应对象的属性 -
如果对象是一个实例，则赋值将设置一个实例属性 -
如果对象是一个类，则赋值将设置一个类属性</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">tom.interest </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0.08</span></span>
<span class="line"><span style="color: #24292E">Account.interest </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0.04</span></span></code></pre></div></div></figure>
<p>第一个语句将会在tom实例中寻找interest属性，没有找到，则在其中添加该属性
第二个语句将会在Account类中寻找interest属性，找到后将值修改为对应值</p>
<h2 id="method-calls">Method Calls</h2>
<p>方法可使用点表达式调用 其中表达式可以是任何有效的python表达式
表达式的值是通过该表达式值对象中查找<code>&lt;name&gt;</code>而计算的属性值</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">tom.deposit(</span><span style="color: #005CC5">10</span><span style="color: #24292E">)</span></span></code></pre></div></div></figure>
<h2 id="bound-methods">Bound Methods</h2>
<h3 id="terminlology">Terminlology</h3>
<ul>
<li>所有对象都有属性，均为name-value二元组</li>
<li>类是对象的一种， 故类也有属性</li>
<li>实例属性：一个实例的属性</li>
<li>类属性：类本身的属性，但仍可以从实例访问</li>
<li>python中函数也是对象</li>
<li>绑定方法也是对象，即第一个参数为self的函数，该参数已经绑定到了一个实例</li>
<li>点表达式执行那些类属性是函数的绑定方法</li>
</ul>
<h2 id="methods-and-functions">Methods and Functions</h2>
<p>python区分方法与函数 - 函数是从一开始就定义的 -
绑定方法在方法被调用时将一个函数和其对象绑定起来，
即<strong>Object+Function = Bound Method</strong></p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(</span><span style="color: #005CC5">type</span><span style="color: #24292E">(Account.deposit))</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(</span><span style="color: #005CC5">type</span><span style="color: #24292E">(tom.deposit))</span></span></code></pre></div></div></figure>
<pre><code>&lt;class &#39;function&#39;&gt;
&lt;class &#39;method&#39;&gt;</code></pre>
<p>此时我们有两种方法调用 1.
作为函数调用，此时需要传递self和amount两个参数 2.
作为绑定方法调用，此时只需要传递amount参数</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">Account.deposit(tom, </span><span style="color: #005CC5">1001</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">tom.deposit(</span><span style="color: #005CC5">1007</span><span style="color: #24292E">)</span></span></code></pre></div></div></figure>
<pre><code>2008</code></pre>
]]></content>
      <categories>
        <category>CS61A</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>CS61A</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61A】CS61A——Composition</title>
    <url>/CS61A/CS61A%20Composition/</url>
    <content><![CDATA[<h1 id="composition">Composition</h1>
<h2 id="linked-list">Linked List</h2>
<p>用Python实现链表 -
每个节点由<code>first</code>与<code>rest</code>组成，前者表示值，后者表示链接的剩余链表
- 将每个节点当作一堆二元组看待 -
最后一个节点指向空链表<code>Link.empty</code>，使用类属性表示 -
构造方式：<code>Link(3, Link(4, Link(5, Link.empty)))</code> ###
创建链表</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Link</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># 使用空元组实现空节点，类属性</span></span>
<span class="line"><span style="color: #24292E">    empty </span><span style="color: #D73A49">=</span><span style="color: #24292E"> ()</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #005CC5">__init__</span><span style="color: #24292E">(self, first, rest</span><span style="color: #D73A49">=</span><span style="color: #24292E">empty):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6A737D"># 判断rest是否是空节点或是一个Link类</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">assert</span><span style="color: #24292E"> rest </span><span style="color: #D73A49">is</span><span style="color: #24292E"> Link.empty </span><span style="color: #D73A49">or</span><span style="color: #24292E"> </span><span style="color: #005CC5">isinstance</span><span style="color: #24292E">(rest, Link)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.first </span><span style="color: #D73A49">=</span><span style="color: #24292E"> first</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.rest </span><span style="color: #D73A49">=</span><span style="color: #24292E"> rest</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">s </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Link(</span><span style="color: #005CC5">3</span><span style="color: #24292E">, Link(</span><span style="color: #005CC5">4</span><span style="color: #24292E">, Link(</span><span style="color: #005CC5">5</span><span style="color: #24292E">)))</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(s.first)</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(s.rest.first)</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(s.rest.rest.first)</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(s.rest.rest.rest </span><span style="color: #D73A49">is</span><span style="color: #24292E"> Link.empty)</span></span></code></pre></div></div></figure>
<h3 id="操作列表">操作列表</h3>
<p>实现如下行为：<code>range</code>, <code>map</code>,
<code>filter</code> 我们使用递归实现</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Link</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># 使用空元组实现空节点，类属性</span></span>
<span class="line"><span style="color: #24292E">    empty </span><span style="color: #D73A49">=</span><span style="color: #24292E"> ()</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #005CC5">__init__</span><span style="color: #24292E">(self, first, rest</span><span style="color: #D73A49">=</span><span style="color: #24292E">empty):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6A737D"># 判断rest是否是空节点或是一个Link类</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">assert</span><span style="color: #24292E"> rest </span><span style="color: #D73A49">is</span><span style="color: #24292E"> Link.empty </span><span style="color: #D73A49">or</span><span style="color: #24292E"> </span><span style="color: #005CC5">isinstance</span><span style="color: #24292E">(rest, Link)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.first </span><span style="color: #D73A49">=</span><span style="color: #24292E"> first</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.rest </span><span style="color: #D73A49">=</span><span style="color: #24292E"> rest</span></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">range_link</span><span style="color: #24292E">(start, end):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> start</span><span style="color: #D73A49">&gt;=</span><span style="color: #24292E">end:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> Link.empty</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> Link(start, range_link(start</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">, end))</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">map_link</span><span style="color: #24292E">(f, s):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> s </span><span style="color: #D73A49">is</span><span style="color: #24292E"> Link.empty:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> s</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> Link(f(s.first), map_link(f, s.rest))</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">filter_link</span><span style="color: #24292E">(f, s):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> s </span><span style="color: #D73A49">is</span><span style="color: #24292E"> Link.empty:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> s</span></span>
<span class="line"><span style="color: #24292E">    filter_rest </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">filter</span><span style="color: #24292E">(f, s.rest)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> f(s.first):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> Link(s.first, filter_rest)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> filter_rest</span></span></code></pre></div></div></figure>
<h3 id="链表的改变">链表的改变</h3>
<p>可以通过对属性赋值来改变链表的<code>first</code>和<code>rest</code>属性</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">&gt;&gt;&gt;</span><span style="color: #24292E"> s </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Link(</span><span style="color: #005CC5">1</span><span style="color: #24292E">, Link(</span><span style="color: #005CC5">2</span><span style="color: #24292E">, Link(</span><span style="color: #005CC5">3</span><span style="color: #24292E">)))</span></span>
<span class="line"><span style="color: #D73A49">&gt;&gt;&gt;</span><span style="color: #24292E"> s.first </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">5</span></span>
<span class="line"><span style="color: #D73A49">&gt;&gt;&gt;</span><span style="color: #24292E"> t </span><span style="color: #D73A49">=</span><span style="color: #24292E"> s.rest</span></span>
<span class="line"><span style="color: #D73A49">&gt;&gt;&gt;</span><span style="color: #24292E"> t.rest </span><span style="color: #D73A49">=</span><span style="color: #24292E"> s</span><span style="color: #B31D28; font-style: italic">;</span></span>
<span class="line"><span style="color: #D73A49">&gt;&gt;&gt;</span><span style="color: #24292E"> s.first</span></span>
<span class="line"><span style="color: #005CC5">5</span></span>
<span class="line"><span style="color: #D73A49">&gt;&gt;&gt;</span><span style="color: #24292E"> s.rest.rest.rest.rest.rest.first</span></span>
<span class="line"><span style="color: #005CC5">2</span></span></code></pre></div></div></figure>
<p>此赋值将s的后段与前段相接，创建了一个循环链表</p>
<h3 id="插入节点">插入节点</h3>
<p>向一个有序链表中添加节点，保证链表仍有序</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">add</span><span style="color: #24292E">(s, v):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">assert</span><span style="color: #24292E"> s </span><span style="color: #D73A49">is</span><span style="color: #24292E"> </span><span style="color: #D73A49">not</span><span style="color: #24292E"> Link.empty</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> s.first </span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> v:</span></span>
<span class="line"><span style="color: #24292E">        s.first, s.rest </span><span style="color: #D73A49">=</span><span style="color: #24292E"> v, Link(s.first, s.rest)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">elif</span><span style="color: #24292E"> s.first </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> v </span><span style="color: #D73A49">and</span><span style="color: #24292E"> s.rest </span><span style="color: #D73A49">is</span><span style="color: #24292E"> Link.empty:</span></span>
<span class="line"><span style="color: #24292E">        s.rest </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Link(v)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">elif</span><span style="color: #24292E"> s.first </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> v:</span></span>
<span class="line"><span style="color: #24292E">        add(s.rest, v)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> s</span></span></code></pre></div></div></figure>
<h2 id="tree-class">Tree Class</h2>
<p>使用类实现树 ### 创建树</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Tree</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #005CC5">__init__</span><span style="color: #24292E">(self, label, branches </span><span style="color: #D73A49">=</span><span style="color: #24292E"> []):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.label </span><span style="color: #D73A49">=</span><span style="color: #24292E"> label</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E"> branch </span><span style="color: #D73A49">in</span><span style="color: #24292E"> branches:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">assert</span><span style="color: #24292E"> </span><span style="color: #005CC5">isinstance</span><span style="color: #24292E">(branch, Tree)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.branches </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">list</span><span style="color: #24292E">(branches)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #005CC5">__repr__</span><span style="color: #24292E">(self):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> </span><span style="color: #005CC5">self</span><span style="color: #24292E">.branches:</span></span>
<span class="line"><span style="color: #24292E">            branches_str </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;, &#39;</span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">repr</span><span style="color: #24292E">(</span><span style="color: #005CC5">self</span><span style="color: #24292E">.branches)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">            branch_str </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;&#39;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;Tree(</span><span style="color: #005CC5">{0}{1}</span><span style="color: #032F62">)&#39;</span><span style="color: #24292E">.format(</span><span style="color: #005CC5">repr</span><span style="color: #24292E">(</span><span style="color: #005CC5">self</span><span style="color: #24292E">.label), branch_str)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #005CC5">__str__</span><span style="color: #24292E">(self):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;</span><span style="color: #005CC5">\n</span><span style="color: #032F62">&#39;</span><span style="color: #24292E">.join(</span><span style="color: #005CC5">self</span><span style="color: #24292E">.indented())</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">indented</span><span style="color: #24292E">(self):</span></span>
<span class="line"><span style="color: #24292E">        lines </span><span style="color: #D73A49">=</span><span style="color: #24292E"> []</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E"> b </span><span style="color: #D73A49">in</span><span style="color: #24292E"> </span><span style="color: #005CC5">self</span><span style="color: #24292E">.branches:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">for</span><span style="color: #24292E"> line </span><span style="color: #D73A49">in</span><span style="color: #24292E"> b.indented():</span></span>
<span class="line"><span style="color: #24292E">                lines.append(</span><span style="color: #032F62">&#39;    &#39;</span><span style="color: #D73A49">+</span><span style="color: #24292E">line)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> [</span><span style="color: #005CC5">str</span><span style="color: #24292E">(</span><span style="color: #005CC5">self</span><span style="color: #24292E">.label)] </span><span style="color: #D73A49">+</span><span style="color: #24292E"> lines</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">is_leaf</span><span style="color: #24292E">(self):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">not</span><span style="color: #24292E"> </span><span style="color: #005CC5">self</span><span style="color: #24292E">.branches</span></span></code></pre></div></div></figure>
<h3 id="实现一些操作">实现一些操作</h3>
<p>如下代码实现了创建斐波那契树以及输出叶子节点</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fib_tree</span><span style="color: #24292E">(n):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> n</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E"> </span><span style="color: #D73A49">or</span><span style="color: #24292E"> n</span><span style="color: #D73A49">==</span><span style="color: #005CC5">1</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> Tree(n)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        left </span><span style="color: #D73A49">=</span><span style="color: #24292E"> fib_tree(n</span><span style="color: #D73A49">-</span><span style="color: #005CC5">2</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">        right </span><span style="color: #D73A49">=</span><span style="color: #24292E"> fib_tree(n</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">        fib_n </span><span style="color: #D73A49">=</span><span style="color: #24292E"> left.label </span><span style="color: #D73A49">+</span><span style="color: #24292E"> right.label</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> Tree(fib_n, [left, right])</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">leaves</span><span style="color: #24292E">(t):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> t.is_leaf():</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> [t.label]</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        all_leaves </span><span style="color: #D73A49">=</span><span style="color: #24292E"> []</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E"> b </span><span style="color: #D73A49">in</span><span style="color: #24292E"> t.branches:</span></span>
<span class="line"><span style="color: #24292E">            all_leaves.extend(leaves(b))</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> all_leaves</span></span></code></pre></div></div></figure>
<h3 id="剪枝">剪枝</h3>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D"># 通过每次重新构建branches列表，将等于n的值排除在列表外以实现</span></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">prune</span><span style="color: #24292E">(t, n):</span></span>
<span class="line"><span style="color: #24292E">    t.branches </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [b </span><span style="color: #D73A49">for</span><span style="color: #24292E"> b </span><span style="color: #D73A49">in</span><span style="color: #24292E"> t.branches </span><span style="color: #D73A49">if</span><span style="color: #24292E"> b.label</span><span style="color: #D73A49">!=</span><span style="color: #24292E">n]</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> b </span><span style="color: #D73A49">in</span><span style="color: #24292E"> t.branches:</span></span>
<span class="line"><span style="color: #24292E">        prune(b, n)</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>CS61A</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>CS61A</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61A】CS61A——Design</title>
    <url>/CS61A/CS61A%20Design/</url>
    <content><![CDATA[<h1 id="functional-abstraction">Functional Abstraction</h1>
<h2
id="lambda表达式所在的environment关系">Lambda表达式所在的environment关系</h2>
<p>如下例子</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(g):</span></span>
<span class="line"><span style="color: #24292E">    a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">lambda</span><span style="color: #24292E"> y:a</span><span style="color: #D73A49">*</span><span style="color: #24292E">g(y)</span></span>
<span class="line"><span style="color: #24292E">f(</span><span style="color: #D73A49">lambda</span><span style="color: #24292E"> y: a</span><span style="color: #D73A49">+</span><span style="color: #24292E">y)(a)</span></span></code></pre></div></div></figure>
<p>注意行4与行5的lambda函数的区别：</p>
<ul>
<li>行4的lambda函数是f函数内定义的函数，他的父级为f，因此此时传入的a=2</li>
<li>行5的lambda函数是f函数外定义的函数，他的父级为global，因此此时传入的a=1</li>
</ul>
<h2 id="choosing-names">Choosing Names</h2>
<p>给函数或变量命名时，要注重传达意思</p>
<ul>
<li><p>命名需要传达与之相关值的意义或目的</p></li>
<li><p>值的类型最好记录在函数的docstring中</p></li>
<li><p>函数名一般包括它们的作用，表现或返回值</p></li>
<li><p>为一些重复使用的复合表达式命名</p></li>
<li><p>如果需要注释代码，命名可以长一些</p></li>
<li><p>如果用于数字，数学运算与函数抽象，命名可以短一些</p></li>
</ul>
<h2 id="errortraceback">Error&amp;Traceback</h2>
<p>报错有三种形式：</p>
<ul>
<li>Syntax errors：执行前即可发现，通常由于表达式不正确引起</li>
<li>Runtime
errors：执行时由python解释器发现的错误。当这些错误发生时，会得到一个Traceback，来提示是在哪里发生了何种错误，错误发生时程序在做什么</li>
<li>Logical error：不会被解释器发现，需要自己进行测试发现问题</li>
</ul>
<h2 id="decorator">Decorator</h2>
<p>装饰器用于给现有模块（原函数）进行功能拓展，通过接受一个函数来返回一个新的函数或修改原来的函数</p>
<p>例如：</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">trace1</span><span style="color: #24292E">(fn):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #032F62">    return a version of fn that first print before it is called</span></span>
<span class="line"><span style="color: #032F62">    fn - a function of 1 argument</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">traced</span><span style="color: #24292E">(x):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">print</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Calling&quot;</span><span style="color: #24292E">,fn,</span><span style="color: #032F62">&quot;on argument&quot;</span><span style="color: #24292E">,x)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> fn(x)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> traced</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6F42C1">@trace1</span></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">square</span><span style="color: #24292E">(x):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> x</span><span style="color: #D73A49">*</span><span style="color: #24292E">x</span></span></code></pre></div></div></figure>
<p>等同于</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">trace1</span><span style="color: #24292E">(fn):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #032F62">    return a version of fn that first print before it is called</span></span>
<span class="line"><span style="color: #032F62">    fn - a function of 1 argument</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">traced</span><span style="color: #24292E">(x):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">print</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;Calling&quot;</span><span style="color: #24292E">,fn,</span><span style="color: #032F62">&quot;on argument&quot;</span><span style="color: #24292E">,x)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> fn(x)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> traced</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">square</span><span style="color: #24292E">(x):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> x</span><span style="color: #D73A49">*</span><span style="color: #24292E">x</span></span>
<span class="line"><span style="color: #24292E">square </span><span style="color: #D73A49">=</span><span style="color: #24292E"> trace1(square)</span></span></code></pre></div></div></figure>
<p>返回值都相同</p>
<figure class="shiki pythong"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre><code>>>> square(5)
Calling <function square at 0x000001C1247A9240> on argument 5
25</code></pre></div></div></figure>
]]></content>
      <categories>
        <category>CS61A</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>CS61A</tag>
      </tags>
  </entry>
  <entry>
    <title>【计算机组成原理】浮点数</title>
    <url>/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E6%B5%AE%E7%82%B9%E6%95%B0/</url>
    <content><![CDATA[<h1 id="floating-point">Floating Point</h1>
<h2 id="二进制小数定点表示">二进制小数（定点表示）</h2>
<p>对于十进制表示，
小数点左边对应的数的权值为10的正幂，右边对应的权值为10的负幂
则二进制也可以用该方式表示，即<strong>小数点左边的位的权是2的正幂，右边的位的权是2的负幂</strong>，用公式表示为<span
class="math inline">\(b=\displaystyle\sum^{m}_{i=-n} 2^i\times
b_i\)</span>
从公式中容易看出，二进制小数点左移一位相当于这个数被2除，右移一位相当于将这个数乘2
形如0.11…11的二进制小数表示刚好小于1的数，可以用1.0-<span
class="math inline">\(\epsilon\)</span>来表示这种值
考虑有限长度的编码，二进制表示法只能表示那些能被写成<span
class="math inline">\(x\times 2^y\)</span>的数，其他值只能近似表示</p>
<p>如<span
class="math inline">\(\frac{1}{10}\)</span>的二进制表示为0.0001100110011[0011]…</p>
<p>简单换算方法：<strong>将一个数表示为形似<span
class="math inline">\(\frac{x}{2^k}\)</span>的分数形式，将x用二进制表示，然后将小数点插入从右算起的第k个位置</strong></p>
<h2 id="浮点表示法">浮点表示法</h2>
<p>浮点表示法通过移动二进制小数点来表示尽可能大的范围，同时兼顾精度</p>
<p>IEEE浮点标准使用<span class="math inline">\(V=(-1)^s\times M\times
2^E\)</span>的形式来表示一个数 -
符号：s决定是负数(s=1)还是正数(s=0)，数值0的符号位解释作为特殊情况处理</p>
<ul>
<li><p>尾数：M是一个二进制小数，范围为1至2-<span
class="math inline">\(\epsilon\)</span>或0至1-<span
class="math inline">\(\epsilon\)</span></p></li>
<li><p>阶码：E的作用是对浮点数加权，权为2的E次幂，用于扩大或缩小尾数值
将浮点数的位表示划分为三个字段，分别编码：</p></li>
<li><p>一个单独的符号位s直接编码s</p></li>
<li><p>k位的阶码字段exp编码阶码E</p></li>
<li><p>n位小数字段frac编码尾数M，编码出来的值也依赖于阶码字段的值是否为0
单精度浮点下，k=8位，n=23位，得到一个32位表示
双精度浮点下，k=11位，n=52位，得到一个64位表示</p>
<img src="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E6%B5%AE%E7%82%B9%E6%95%B0/image-20250912110102403.png" class="" title="不同表示"></li>
</ul>
<p>给定位表示，根据exp的值，被编码的值可以分为三种不同的情况： ###
规格化的值
当exp的位模式既不全为0,也不全为1（单精度为255，双精度为2047）,都属于这种情况，这种情况下：</p>
<p><strong>阶码字段</strong>被解释为以偏置形式表示的有符号整数，值为<span
class="math inline">\(E=e-Bias\)</span>，其中e为无符号数，<span
class="math inline">\(Bias=2^{k-1}-1\)</span>（单精度下为127，双精度下为1023），这样将有符号的指数位全迁移到了正区间，方便大小比较</p>
<p><strong>小数字段</strong>被解释为描述小数值<span
class="math inline">\(f(0\leq
f&lt;1)\)</span>，二进制小数点在最高有效位的左边，尾数定义为<span
class="math inline">\(M=1+f\)</span>，也称<strong>隐含的以1开头</strong>的表示，因此可以把M看作一个二进制表示为<span
class="math inline">\(1.f_{n-1}f_{n-2}\cdots f_0\)</span>的数字</p>
<ul>
<li>当frac全为0时，有最小值M=1.0</li>
<li>当frac全为1时，有最大值M=2.0-<span
class="math inline">\(\epsilon\)</span></li>
</ul>
<h3 id="非规格化的值">非规格化的值</h3>
<p>当阶码域全为0时，表示的数是<strong>非规格化</strong>形式，这种情况下，阶码值为<span
class="math inline">\(E=1-Bias\)</span>，尾数的值是<span
class="math inline">\(M=f\)</span>，即小数字段的值，不包含隐含的开头的1</p>
<p>非规格化的值有两个用途：</p>
<ol type="1">
<li><p>用来表示数值0，因为规格化值要求下<span
class="math inline">\(M\geq1\)</span>，不能表示0</p>
<p>但是对于+0.0，它的位模式为全0，而-0.0的符号位是1，其余位全为0，因此在某些方面，这两个书被认为是不同的，而在其他方面是相同的</p></li>
<li><p>用于表示那些非常接近于0.0的数，它们提供了一种属性称为逐渐下溢，可能的数值分布均匀地接近于0.0</p></li>
</ol>
<h3 id="特殊值">特殊值</h3>
<p>当阶码全为1，小数域全为0时，得到的值表示无穷，<span
class="math inline">\(s=0\)</span>时是<span
class="math inline">\(+\infin\)</span>，<span
class="math inline">\(s=1\)</span>时是<span
class="math inline">\(-\infin\)</span>，当我们把两个非常大的数相乘或除以0时，使用无穷来表示<strong>溢出</strong>的结果。</p>
<p>当阶码全为1，小数域为非0时，结果值表示NaN（Not a
Number），一些运算的结果不能是实数或无穷时，或表示未初始化的数据时可以使用</p>
<h3 id="重要浮点数的表示">重要浮点数的表示</h3>
<img src="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E6%B5%AE%E7%82%B9%E6%95%B0/image-20250910110410633.png" class="" title="浮点数">
<ul>
<li><p>+0.0总有一个全为0的位表示</p></li>
<li><p>最小的正非规格化值的位表示是由最低有效位为1而其他所有位为0构成的，其<span
class="math inline">\(M=f=2^{-n}\)</span>，<span
class="math inline">\(E=-2^{k-1}+2\)</span>，故数字值为<span
class="math inline">\(V=2^{-n-2^{k-1}+2}\)</span></p></li>
<li><p>最大的非规格化值的为模式是由全为0的阶码字段和全为1的小数字段组成的，其<span
class="math inline">\(M=f=1-2^{-n}\)</span>（写作<span
class="math inline">\(1-\epsilon\)</span>），<span
class="math inline">\(E=-2^{k-1}+2\)</span>，故数字值为<span
class="math inline">\(V=(1-2^{-n})\times2^{-2^{k-1}+2}\)</span>，比最小规格化数小一点点</p></li>
<li><p>最小的正规格化值的位模式阶码字段的最低有效位为1，其他位全为0，其<span
class="math inline">\(M=1\)</span>，<span
class="math inline">\(E=-2^{k-1}+2\)</span>，因此数值<span
class="math inline">\(V=2^{-2^{k-1}+2}\)</span></p></li>
<li><p>值1.0的位表示解码字段除了最高有效位为0外，所有其他都等于1，其<span
class="math inline">\(M=1\)</span>, <span
class="math inline">\(E=0\)</span></p></li>
<li><p>最大的规格化值的位表示的符号位为0，阶码最低有效位为0，其他位为1。
其<span class="math inline">\(f=1-2^{-n}\)</span>，<span
class="math inline">\(M=2-2^{-n}\)</span>（写作<span
class="math inline">\(2-\epsilon\)</span>），<span
class="math inline">\(E=2^{k-1}-1\)</span>，因此数值<span
class="math inline">\(V=(1-2^{-n-1})\times 2^{2^{k-1}}\)</span></p></li>
</ul>
<h3 id="整数值转换浮点形式">整数值转换浮点形式</h3>
<p>例：12345具有二进制表示[11000000111001]，将二进制小数点左移13位，得到规格化表示<span
class="math inline">\(12345=1.1000000111001_2\times  2^{13}\)</span>，为了使用IEEE单精度表示，丢弃开头的1并在末尾增加10个0来构造小数字段，得到二进制[10000001110010000000000]，构造阶码字段，用13加偏置值127，得到140[10001100]，加上符号位0，得到二进制浮点表示[01000110010000001110010000000000]</p>
<p>再对12345和12345.0进行比较</p>
<style>.wvcyhjpmskop{zoom:67%;}</style>
<img src="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E6%B5%AE%E7%82%B9%E6%95%B0/image-20250910113335913.png" class="wvcyhjpmskop" alt="关系">
<p>发现相关区域对于整数的地位，正好在最高有效位1前停下，和浮点表示小数部分的高位相匹配，其中这个最高有效位1就是隐含的开头的位1</p>
<h2 id="舍入">舍入</h2>
<p>由于表示方法限制了浮点数的范围与精度，所以浮点数只能近似地表示实数运算，因此舍入可以找到一个值x最接近的匹配值x’</p>
<p>IEEE浮点格式定义了四种不同的舍入方式，默认的方法是找到最接近的匹配，而其他三种可以用于计算上下界</p>
<p>其中<strong>向偶数舍入（向最接近的值舍入）</strong>是默认的方式，试图找到一个最接近的匹配值，采用的方法为：<strong>将数字向上或向下舍入，使得结果的最低有效数字是偶数</strong>，如1.5和2.5都被舍入为2</p>
<p>具体的，若一个小数要精确的位数后面类似于xxx5000…（后面全是0），此时要看前一位是奇还是偶，向偶数舍入。而若后面的大于5则向上舍入，小于5则向下舍入，如：</p>
<ul>
<li>7.894999：小于.xx5000，向下舍入为7.89</li>
<li>7.895001：大于.xx5000，向上舍入为7.90</li>
<li>7.895000：等于.xx5000，向偶数舍入为7.90</li>
<li>7.885000：等于.xx5000，向偶数舍入为7.88</li>
</ul>
<p>也可以用于二进制小数，将最低有效位的值<strong>0认为是偶数，1认为是奇数</strong>，一般来说，只有对形如XX…X.
YY…Y100…的二进制位模式的数（即舍弃的那位为1，后面都为0），这种舍入方式才有效，其中X与Y表示任意位值，最右边的Y是要被舍入的位置。而大于100…向上舍入，小于100…向下舍入，如（舍入有效位4位）：</p>
<ul>
<li>10.00011：小于xx100，向下舍入为10.00=2</li>
<li>10.00110：大于xx100，向上舍入为10.01=2.25</li>
<li>10.11100：等于xx100，向偶数舍入为11.000=3</li>
<li>10.10100：等于xx100，向偶数舍入为10.10=2.5</li>
</ul>
<p>其他三种方式：向零舍入、向下舍入、向上舍入产生实际值的确界</p>
<ul>
<li>向零舍入把正数向下舍入，把负数向上舍入，得到<span
class="math inline">\(|\hat{x}|\leq|x|\)</span></li>
<li>向下舍入把正数和负数都向下舍入，得到<span
class="math inline">\(x^-\leq x\)</span></li>
<li>向上舍入把正数和负数都向上舍入，得到<span
class="math inline">\(x^+\geq x\)</span></li>
</ul>
<h2 id="浮点运算">浮点运算</h2>
<p>IEEE标准指定了一个简单的规则，将浮点数x与y看作实数，某个运算<span
class="math inline">\(\odot\)</span>定义为<span
class="math inline">\(Round(x\odot
y)\)</span>，即对实际运算的精确结果进行<strong>舍入</strong>后的结果</p>
<p>当参数中有一个是特殊值（-0，<span
class="math inline">\(-\infin\)</span>或NaN）时，IEEE标准定义了一些更合理的规则，如<span
class="math inline">\(\frac{1}{0}=-\infin\)</span>，<span
class="math inline">\(\frac{1}{+0}=+\infin\)</span></p>
<h3 id="运算性质">运算性质</h3>
<p>实数的加法也形成了阿贝尔群，但必须考虑舍入的影响，将<span
class="math inline">\(x+^fy\)</span>定义为<span
class="math inline">\(Round(x+y)\)</span>这个运算是<strong>可交换</strong>的，但<strong>不可结合</strong>。作为阿贝尔群，大多值在浮点加法下都有逆元，即<span
class="math inline">\(x+^f-x=0\)</span>，无穷和NaN例外</p>
<p>另一方面，浮点加法满足了单调性属性：若<span
class="math inline">\(a\geq
b\)</span>，那么对于任何a、b以及x的值，除了NaN，都有<span
class="math inline">\(x+a\geq x+b\)</span></p>
<p>对于浮点乘法，同样可交换但不能结合，对于任何a、b和c都不为NaN，满足单调性：</p>
<ul>
<li><span class="math inline">\(a\geq b且c\geq0 \Rightarrow
a\times^fc\geq b\times^fc\)</span></li>
<li><span class="math inline">\(a\geq b且c\leq0 \Rightarrow
a\times^fc\leq b\times^fc\)</span></li>
<li>并且保证只要<span class="math inline">\(a\neq
NaN\)</span>，就有<span
class="math inline">\(a\times^fa\geq0\)</span></li>
</ul>
<h3 id="比较运算">比较运算</h3>
<p>对于浮点数间的比较，除了NaN，其余浮点数间都可以互相比较，包括inf（将其视为无符号）</p>
<ul>
<li>首先比较符号位</li>
<li><span class="math inline">\(-0=0\)</span></li>
<li>NaN大于其余任何值</li>
<li>其余均可以比较，包括规格、非规格、无穷大</li>
</ul>
<h3 id="乘法">乘法</h3>
<p><span class="math inline">\(V_1=(-1)^{s_1}\times M_1\times
2^{E_1}\)</span>与<span class="math inline">\(V_2=(-1)^{s_2}\times
M_2\times 2^{E_2}\)</span>相乘，得到的结果<span
class="math inline">\(V=(-1)^{s}\times M\times 2^{E}\)</span></p>
<ul>
<li><span class="math inline">\(s=s_1\oplus s_2\)</span></li>
<li><span class="math inline">\(M=M_1\times M_2\)</span></li>
<li><span class="math inline">\(E=E_1+E_2\)</span></li>
</ul>
<p>修正：</p>
<ul>
<li>若<span
class="math inline">\(M\geq2\)</span>，右移M到范围内，增加E</li>
<li>若E超出范围，则溢出</li>
<li>舍入M至让frac能准确表示</li>
</ul>
<h3 id="加法">加法</h3>
<p><span class="math inline">\(V_1=(-1)^{s_1}\times M_1\times
2^{E_1}\)</span>与<span class="math inline">\(V_2=(-1)^{s_2}\times
M_2\times 2^{E_2}\)</span>相加，得到的结果<span
class="math inline">\(V=(-1)^{s}\times M\times 2^{E}\)</span>（假设<span
class="math inline">\(E_1&gt;E_2\)</span>）</p>
<ul>
<li>将二进制小数点对齐</li>
<li>s与M均为直接相加</li>
<li><span class="math inline">\(E=E_1\)</span></li>
</ul>
<p>修正：</p>
<ul>
<li>若<span
class="math inline">\(M\geq2\)</span>，右移M到范围内，增加E</li>
<li>若<span
class="math inline">\(M&lt;1\)</span>，左移k位M，减小k的E</li>
<li>若E超出范围，则溢出</li>
<li>舍入M至让frac能准确表示</li>
</ul>
<h2 id="c语言中的浮点数">C语言中的浮点数</h2>
<p>C语言提供了单精度浮点float与双精度浮点double，使用向偶数舍入</p>
<p>但C语言标准不要求机器使用IEEE浮点，故没有标准方法改变摄入方式或得到特殊值</p>
<p>当在int，float与double间进行强制类型转换时，程序改变数值和位模式的原则如下：</p>
<ul>
<li>从int转为float：不会溢出，可能被舍入</li>
<li>从int或float转换成double：能保留精确数值</li>
<li>从double转换成float：值可能溢出或舍入</li>
<li>从float或double转换成int：向零舍入，可能会溢出</li>
</ul>
]]></content>
      <categories>
        <category>计算机组成原理</category>
      </categories>
      <tags>
        <tag>CSAPP</tag>
        <tag>计算机组成原理</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61A】CS61A——Decomposition</title>
    <url>/CS61A/CS61A%20Decomposition/</url>
    <content><![CDATA[<h1 id="decomposition">Decomposition</h1>
<h2 id="modular-design">Modular Design</h2>
<p>程序的设计原则：将程序的不同部分分离开来，使得每个模块可以独立开发与测试
以以下餐厅搜索代码为例，实现从文件中读取评分与评论（使用<code>similarity</code>评估相似性）搜索对应评分前k个餐厅去过的其他餐厅的功能：</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">search</span><span style="color: #24292E">(query, ranking </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">lambda</span><span style="color: #24292E"> r: </span><span style="color: #D73A49">-</span><span style="color: #24292E">r.stars):</span></span>
<span class="line"><span style="color: #24292E">    results  </span><span style="color: #D73A49">=</span><span style="color: #24292E">[r </span><span style="color: #D73A49">for</span><span style="color: #24292E"> r </span><span style="color: #D73A49">in</span><span style="color: #24292E"> Restaurant.all </span><span style="color: #D73A49">if</span><span style="color: #24292E"> query </span><span style="color: #D73A49">in</span><span style="color: #24292E"> r.name]</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">sorted</span><span style="color: #24292E">(results, </span><span style="color: #E36209">key</span><span style="color: #D73A49">=</span><span style="color: #24292E"> ranking)</span></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">reviewed_both</span><span style="color: #24292E">(r, s):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">len</span><span style="color: #24292E">([x </span><span style="color: #D73A49">for</span><span style="color: #24292E"> x </span><span style="color: #D73A49">in</span><span style="color: #24292E"> r.reviewers </span><span style="color: #D73A49">if</span><span style="color: #24292E"> x </span><span style="color: #D73A49">in</span><span style="color: #24292E"> s.reviewers])</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Restaurant</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">all</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> []</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #005CC5">__init__</span><span style="color: #24292E">(self, name, star, reviewer):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.name </span><span style="color: #D73A49">=</span><span style="color: #24292E"> name</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.star </span><span style="color: #D73A49">=</span><span style="color: #24292E"> star</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.reviewer </span><span style="color: #D73A49">=</span><span style="color: #24292E"> reviewer</span></span>
<span class="line"><span style="color: #24292E">        Restaurant.all.append(</span><span style="color: #005CC5">self</span><span style="color: #24292E">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">similar</span><span style="color: #24292E">(self, k, similarity</span><span style="color: #D73A49">=</span><span style="color: #24292E">reviewed_both):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #032F62">&quot;&quot;&quot;Return the k most similar restaurants to self&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">        others </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Restaurant.all</span></span>
<span class="line"><span style="color: #24292E">        others.remove(</span><span style="color: #005CC5">self</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">        different </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">lambda</span><span style="color: #24292E"> r: </span><span style="color: #D73A49">-</span><span style="color: #24292E">similarity(r, </span><span style="color: #005CC5">self</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">sorted</span><span style="color: #24292E">(others, </span><span style="color: #E36209">key</span><span style="color: #D73A49">=</span><span style="color: #24292E">different)[:k]</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #005CC5">__repr__</span><span style="color: #24292E">(self):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;&lt;&#39;</span><span style="color: #D73A49">+</span><span style="color: #005CC5">self</span><span style="color: #24292E">.name</span><span style="color: #D73A49">+</span><span style="color: #032F62">&#39;&gt;&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">import</span><span style="color: #24292E"> json</span></span>
<span class="line"><span style="color: #24292E">reviewers_for_restaurant </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {}</span></span>
<span class="line"><span style="color: #D73A49">for</span><span style="color: #24292E"> line </span><span style="color: #D73A49">in</span><span style="color: #24292E"> </span><span style="color: #005CC5">open</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;reviews.json&#39;</span><span style="color: #24292E">):</span></span>
<span class="line"><span style="color: #24292E">    r </span><span style="color: #D73A49">=</span><span style="color: #24292E"> json.loads(line)</span></span>
<span class="line"><span style="color: #24292E">    biz </span><span style="color: #D73A49">=</span><span style="color: #24292E"> r[</span><span style="color: #032F62">&#39;business_id&#39;</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> biz </span><span style="color: #D73A49">not</span><span style="color: #24292E"> </span><span style="color: #D73A49">in</span><span style="color: #24292E"> reviewers_for_restaurant:</span></span>
<span class="line"><span style="color: #24292E">        reviewers_for_restaurant[biz] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [r[</span><span style="color: #032F62">&#39;user_id&#39;</span><span style="color: #24292E">]]</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        reviewers_for_restaurant[biz].append(r[</span><span style="color: #032F62">&#39;user_id&#39;</span><span style="color: #24292E">])</span></span>
<span class="line"><span style="color: #D73A49">for</span><span style="color: #24292E"> line </span><span style="color: #D73A49">in</span><span style="color: #24292E"> </span><span style="color: #005CC5">open</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;restaurant.json&#39;</span><span style="color: #24292E">):</span></span>
<span class="line"><span style="color: #24292E">    r </span><span style="color: #D73A49">=</span><span style="color: #24292E"> json.loads(line)</span></span>
<span class="line"><span style="color: #24292E">    reviewers </span><span style="color: #D73A49">=</span><span style="color: #24292E"> reviewers_for_restaurant[r[</span><span style="color: #032F62">&#39;business_id&#39;</span><span style="color: #24292E">]]</span></span>
<span class="line"><span style="color: #24292E">    Restaurant(r[</span><span style="color: #032F62">&#39;name&#39;</span><span style="color: #24292E">], r[</span><span style="color: #032F62">&#39;stars&#39;</span><span style="color: #24292E">], reviewers)</span></span>
<span class="line"><span style="color: #24292E">results </span><span style="color: #D73A49">=</span><span style="color: #24292E"> search(</span><span style="color: #032F62">&#39;Thai&#39;</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #D73A49">for</span><span style="color: #24292E"> r </span><span style="color: #D73A49">in</span><span style="color: #24292E"> results:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">print</span><span style="color: #24292E">(r,</span><span style="color: #032F62">&#39;share reviewer with&#39;</span><span style="color: #24292E">, r.similar(</span><span style="color: #005CC5">3</span><span style="color: #24292E">))</span></span></code></pre></div></div></figure>
<h2 id="优化时间复杂度">优化时间复杂度</h2>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">reviewed_both</span><span style="color: #24292E">(r, s):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> fast_overlap(r.reviewers, s.reviewers)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fast_overlap</span><span style="color: #24292E">(s, t):</span></span>
<span class="line"><span style="color: #24292E">    count, i, j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">, </span><span style="color: #005CC5">0</span><span style="color: #24292E">, </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E"> i</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">len</span><span style="color: #24292E">(s) </span><span style="color: #D73A49">and</span><span style="color: #24292E"> j</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">len</span><span style="color: #24292E">(t):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> s[i]</span><span style="color: #D73A49">==</span><span style="color: #24292E">t[j]:</span></span>
<span class="line"><span style="color: #24292E">            count, i, j </span><span style="color: #D73A49">=</span><span style="color: #24292E"> count</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">, i</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">, j</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #B31D28; font-style: italic">;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">elif</span><span style="color: #24292E"> s[i]</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">t[i]:</span></span>
<span class="line"><span style="color: #24292E">            i</span><span style="color: #D73A49">+=</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">            j</span><span style="color: #D73A49">+=</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> count</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>CS61A</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>CS61A</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61A】CS61A——Containers</title>
    <url>/CS61A/CS61A%20Containers/</url>
    <content><![CDATA[<h1 id="containers">Containers</h1>
<h2 id="slicing">Slicing</h2>
<p>切片可以简洁的获取列表中的子列表，实质是创建了新的列表而不影响原始列表</p>
<p>如列表odds = [3,5,7,9,11]</p>
<ul>
<li>odds[1:3] -&gt; [5,7] 默认也是包括起始值不包括结束值</li>
<li>odds[:3] -&gt; [3,5,7] 省略开头将从列表头开始算起</li>
<li>odds[1:] -&gt; [5,7,9,11] 省略结尾将覆盖至列表尾</li>
</ul>
<h2 id="内置函数">内置函数</h2>
<h3 id="sum">sum</h3>
<p><code>sum(&lt;可迭代对象&gt;, [起始值])</code></p>
<p>返回所有可迭代元素和并加上起始值，起始值默认为0</p>
<p>sum还可以实现列表相加：<code>sum([[2,3],[4]],[])</code>
<strong>注意起始值类型要和前面相同</strong></p>
<h3 id="max">max</h3>
<p><code>max(&lt;可迭代对象&gt;, [键函数])</code></p>
<p><code>max(a,b,c,..., [键函数])</code></p>
<p>返回对象中的最大值或返回若干值中的最大值</p>
<p>键函数：考虑对每个元素执行键函数并根据返回值比较大小（返回原始值）</p>
<p>e.g. <code>max(range(10), key=lambda x: 7-(x-4)*(x-2))</code></p>
<h3 id="all">all</h3>
<p><code>all(&lt;可迭代对象&gt;)</code></p>
<p>对每个元素执行bool(x)操作，若所有元素都返回True则返回True，否则返回False，空列表返回True</p>
<p>e.g. <code>all([x&lt;5 for x in range(5)])</code> 返回True</p>
<h3 id="len">len</h3>
<p><code>len(&lt;可迭代对象&gt;)</code></p>
<p>获取某个序列长度</p>
<h2 id="有关string">有关string</h2>
<p>string可以用于表示：数据、语言、程序</p>
<h3 id="表示字符串">表示字符串</h3>
<ul>
<li>使用单引号</li>
<li>使用双引号</li>
<li>使用一对连续的三个双引号：可以跨行</li>
</ul>
<h3 id="string也是一种sequence">string也是一种sequence</h3>
<p>求解长度与选择元素与列表相同</p>
<p><strong>获取到的string中的元素本身也是一个字符串，但只有它本身一个元素</strong></p>
<p>in与not in可以在字符串中寻找连续字符</p>
<p>e.g. <code>'here' in 'where's waldo?</code> 返回True</p>
<h2 id="dictionary">Dictionary</h2>
<p>dictionary用于存储键值对，使用花括号和冒号分隔键值</p>
<p>创建：</p>
<p><code>numerals = &#123;'I':1, 'V':5, 'X':10&#125;</code></p>
<p>可以用数字，字符串当键值，列表或字典 当值</p>
<p><strong>注意：键本身不能是列表或字典，键不能重复</strong></p>
<p>查找：</p>
<p>输入对应的键来查找对应的值，但不能通过值查找键</p>
<p><code>numerals['V'] &gt;&gt;&gt; 5</code></p>
<p>遍历：</p>
<p>dictionary是键的序列，通过list()创建列表可以获得所有的键，因此可以用for循环遍历所有的键</p>
<p>使用<code>numerals.value()</code>获得字典中所有的值，存储在一个序列中（非列表）</p>
<h2 id="dictionary-comprehensions">Dictionary Comprehensions</h2>
<p>可以使用表达式来创建列表</p>
<p>格式：<code>&#123;&lt;key exp&gt;: &lt;val exp&gt; for &lt;name&gt; in &lt;iter exp&gt; if &lt;filter exp&gt;&#125;</code></p>
<p>过程：</p>
<ol type="1">
<li>添加以当前作用域为父作用域的新作用域</li>
<li>建立一个空的result字典存储表达式的值</li>
<li>对每个<iter exp>中的元素：
<ol type="1">
<li>在新作用域中将<name>绑定到每一个元素</li>
<li>若<filter exp>为真，则将<key exp>与<val exp>配对并添加到result字典中</li>
</ol></li>
</ol>
<p>e.g.</p>
<p><code>&#123;x*x: x for x in [1,2,3,4,5] if x&gt;2&#125;</code>
结果为<code>&#123;9:3, 16:4, 25:3&#125;</code></p>
]]></content>
      <categories>
        <category>CS61A</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>CS61A</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61A】CS61A——Environments</title>
    <url>/CS61A/CS61A%20Environments/</url>
    <content><![CDATA[<h1 id="environments">Environments</h1>
<h2 id="environments-in-higher-orde-function">Environments in
Higher-orde function</h2>
<figure>
<img src="CS61A——Environments/image-20250130162319674.png"
alt="Environments" />
<figcaption aria-hidden="true">Environments</figcaption>
</figure>
<h2 id="local-names">Local Names</h2>
<p>e.g.</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(x,y):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> g(x)</span></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">g</span><span style="color: #24292E">(a):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> a</span><span style="color: #D73A49">+</span><span style="color: #24292E">y</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">result </span><span style="color: #D73A49">=</span><span style="color: #24292E"> f(</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">2</span><span style="color: #24292E">)</span></span></code></pre></div></div></figure>
<p>该代码会报错<code>NameError: global name 'y' is not defined</code></p>
<p>原因很明显：当执行到行4时，系统在g的作用域中找不到y，接着去全局作用域中也找不到y，因而报错</p>
<p>而对于嵌套函数，函数中定义的函数是可以直接使用嵌套外函数的参数的，因为在同一个作用于下</p>
<h2 id="function-composition">Function Composition</h2>
<p>e.g.</p>
<figure class="shiki python	"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre><code>def make_adder(n):
    def adder(k):
        return k+n
    return adder
def square(x):
    return x*x
def triple(x):
    return 3*x
def compose1(f,g):
    def h(x):
        return f(g(x))
    return h</code></pre></div></div></figure>
<p>compose1函数将两个函数结合起来计算</p>
<p><code>compose1(triple,square)(5)</code>的结果为225</p>
<p><code>compose1(square,triple)(5)</code>的结果为75</p>
<p><code>compose1(square, makek_adder(2))(3)</code>的结果为25</p>
<p>该函数实际上开辟了两个environments用来分别计算两个函数的return值</p>
<figure>
<img src="CS61A——Environments/image-20250130170617058.png"
alt="Composition" />
<figcaption aria-hidden="true">Composition</figcaption>
</figure>
<p>如图中蓝色和绿色的两个environments，每个中都包含了三个作用域，分别用来计算square与make_adder(2)的值，其中make_adder还会先进入adder函数的作用域</p>
<h2 id="self-reference">Self-Reference</h2>
<p>e.g.1</p>
<figure class="shiki py"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">print_all</span><span style="color: #24292E">(x):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">print</span><span style="color: #24292E">(x)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> print_all</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">print_all(</span><span style="color: #005CC5">1</span><span style="color: #24292E">)(</span><span style="color: #005CC5">3</span><span style="color: #24292E">)(</span><span style="color: #005CC5">5</span><span style="color: #24292E">)</span></span></code></pre></div></div></figure>
<p>该函数执行后会输出1</p>
<p>即print_all函数可以在函数体内以return值形式返回自身，因此该函数被调用的次数与第五行后面的括号数一致（即被调用几次）</p>
<p>e.g.2</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">print_sums</span><span style="color: #24292E">(x):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">print</span><span style="color: #24292E">(x)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">next_sum</span><span style="color: #24292E">(y):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> print_sums(x</span><span style="color: #D73A49">+</span><span style="color: #24292E">y)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> next_sum</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">print_sums(</span><span style="color: #005CC5">1</span><span style="color: #24292E">)(</span><span style="color: #005CC5">3</span><span style="color: #24292E">)(</span><span style="color: #005CC5">5</span><span style="color: #24292E">)</span></span></code></pre></div></div></figure>
<p>函数会把括号后面的数依次相加，输出每次相加的和</p>
<p>首先传入x=1，打印1，定义next_sum函数，print_sums函数返回该函数，并传入y=3，next_sum返回print_sums函数，传入值为x+y=4</p>
<p>再次打印4，定义next_sum函数，print_sums函数返回该函数，并传入y=5，next_sum返回print_sums函数，传入值为x+y=9</p>
<p>再次打印9，没有参数传入，结束</p>
<p>因此要注意调用表达式中传入的参数去了哪里：</p>
<p>1传入了print_sums，而3和5传入了print_sums的返回值next_sum函数用于求和</p>
<h2 id="currying">Currying</h2>
<p>注意以下两种函数</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">make_adder</span><span style="color: #24292E">(n):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">lambda</span><span style="color: #24292E"> k:n</span><span style="color: #D73A49">+</span><span style="color: #24292E">k</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">add</span><span style="color: #24292E">(x,y):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> x</span><span style="color: #D73A49">+</span><span style="color: #24292E">y</span></span></code></pre></div></div></figure>
<p>make_adder函数一次调用一个参数，返回一个函数再调用参数</p>
<p>add函数调用多个参数，返回最终结果</p>
<p>我们可以用以下函数将add函数转换为make_adder函数</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">curry</span><span style="color: #24292E">(f):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">g</span><span style="color: #24292E">(x):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">h</span><span style="color: #24292E">(y):</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> f(x,y)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> h</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> g</span></span></code></pre></div></div></figure>
<p>这样，当我们把add函数传入curry函数，我们就可以通过一次调用一个参数的方法实现相同效果</p>
<p><code>add_three = curry(add)</code></p>
<p><code>add_three(3)(2) &gt;&gt;&gt; 5</code></p>
<p>定义：柯里化（Currying）是一种处理多元函数的方法。它产生一系列连锁函数，其中每个函数固定部分参数，并返回一个新函数，用于传回其它剩余参数的功能。</p>
<p><strong>即它可以把一个多元函数转换为一系列函数，每个函数传入一个参数，即将f(a,b,c)转换为f(a)(b)(c)</strong></p>
]]></content>
      <categories>
        <category>CS61A</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>CS61A</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61A】CS61A——Data Abstraction</title>
    <url>/CS61A/CS61A%20Data%20Abstraction/</url>
    <content><![CDATA[<h1 id="data-abstraction">Data Abstraction</h1>
<h2 id="data-abstraction-1">Data Abstraction</h2>
<p>大多数值都是复合值，由多种对象组成</p>
<p>抽象数据类型可以让我们将符合对象作为一个单元操作，允许我们隔离使用数据的程序的两个部分：</p>
<ul>
<li>数据的表示</li>
<li>数据的操作</li>
</ul>
<p>即在数据的表示与操作之间建立一个抽象屏障</p>
<h2 id="examplerational-numbers">Example——Rational Numbers</h2>
<h3 id="表示">表示</h3>
<p>任何有理数可以表示为一个最简分数</p>
<p>这为小数提供了更精确的表示方法</p>
<p>故我们需要分开分子分母，作为一个复合数据类型：</p>
<ul>
<li><code>rational(n,d)</code>返回一个有理数x</li>
<li><code>numer(x)</code>返回有理数x的分子</li>
<li><code>denom(x)</code>返回有理数的分母</li>
</ul>
<p>第一个函数称为构造函数（constructor），它用于构造一个新值作为抽象数据类型的实例（instance）</p>
<p>第二、三个函数称为选择器（selectors），它们返回得到的有理数的整数部分</p>
<p>这三个函数作为有理数的抽象数据类型使用，用它们进行数字操作</p>
<h3 id="算术">算术</h3>
<p>根据小学二年级知识，我们根据分数来执行有理数加乘，公式如下</p>
<figure>
<img src="Lecture13——Data%20Abstraction/image-20250303192132061.png"
alt="有理数算术" />
<figcaption aria-hidden="true">有理数算术</figcaption>
</figure>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">mul_rational</span><span style="color: #24292E">(x,y):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> rational(numer(x)</span><span style="color: #D73A49">*</span><span style="color: #24292E">numer(y),denom(x)</span><span style="color: #D73A49">*</span><span style="color: #24292E">denom(y))</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">add_rational</span><span style="color: #24292E">(x,y):</span></span>
<span class="line"><span style="color: #24292E">    nx, dx </span><span style="color: #D73A49">=</span><span style="color: #24292E"> numer(x), denom(y)</span></span>
<span class="line"><span style="color: #24292E">    ny, dy </span><span style="color: #D73A49">=</span><span style="color: #24292E"> numer(y), denom(y)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> rational(nx</span><span style="color: #D73A49">*</span><span style="color: #24292E">dy</span><span style="color: #D73A49">+</span><span style="color: #24292E">ny</span><span style="color: #D73A49">*</span><span style="color: #24292E">dx, dx</span><span style="color: #D73A49">*</span><span style="color: #24292E">dy)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">equal_rational</span><span style="color: #24292E">(x,y):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> numer(x)</span><span style="color: #D73A49">*</span><span style="color: #24292E">denom(y)</span><span style="color: #D73A49">==</span><span style="color: #24292E">numer(y)</span><span style="color: #D73A49">*</span><span style="color: #24292E">denom(x)</span></span></code></pre></div></div></figure>
<h2 id="abstraction-barriers">Abstraction Barriers</h2>
<p>拿上方的有理数函数作为例子</p>
<figure>
<img src="Lecture13——Data%20Abstraction/image-20250303193211301.png"
alt="抽象屏障" />
<figcaption aria-hidden="true">抽象屏障</figcaption>
</figure>
<p>抽象屏障表示使用由有理数计算时使用的函数只能是对应相关的，而不能越界表示</p>
<ul>
<li>用有理数计算时只需要使用计算相关函数</li>
<li>用来表示有理数和进行操作时只需要使用对应构造函数与选择器</li>
<li>用来构建构造函数与选择器时需要用到列表与元素选择</li>
</ul>
<p>一种跨越了抽象屏障的反例：</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">add_rational([</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">2</span><span style="color: #24292E">],[</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">4</span><span style="color: #24292E">])</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">divide_rational</span><span style="color: #24292E">(x,y):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> [x[</span><span style="color: #005CC5">0</span><span style="color: #24292E">]</span><span style="color: #D73A49">*</span><span style="color: #24292E">y[</span><span style="color: #005CC5">1</span><span style="color: #24292E">], x[</span><span style="color: #005CC5">1</span><span style="color: #24292E">]</span><span style="color: #D73A49">*</span><span style="color: #24292E">y[</span><span style="color: #005CC5">0</span><span style="color: #24292E">]]</span></span></code></pre></div></div></figure>
<h2 id="pair">Pair</h2>
<h3 id="创建与访问">创建与访问</h3>
<p>通常使用列表表示一个pair</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">&gt;&gt;&gt;</span><span style="color: #24292E"> pair </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">2</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #D73A49">&gt;&gt;&gt;</span><span style="color: #24292E"> pair</span></span>
<span class="line"><span style="color: #24292E">[</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">2</span><span style="color: #24292E">]</span></span></code></pre></div></div></figure>
<p>通过序列解包或列表下标获得pair中的两个值</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">&gt;&gt;&gt;</span><span style="color: #24292E"> x,y</span><span style="color: #D73A49">=</span><span style="color: #24292E">pair</span></span>
<span class="line"><span style="color: #D73A49">&gt;&gt;&gt;</span><span style="color: #24292E"> x</span></span>
<span class="line"><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #D73A49">&gt;&gt;&gt;</span><span style="color: #24292E"> y</span></span>
<span class="line"><span style="color: #005CC5">2</span></span>
<span class="line"><span style="color: #D73A49">&gt;&gt;&gt;</span><span style="color: #24292E"> pair[</span><span style="color: #005CC5">0</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #005CC5">1</span></span></code></pre></div></div></figure>
<p>还可以用getitem函数获得值，在operator库中</p>
<p>用法：<code>getitem(&lt;list&gt;, &lt;index&gt;)</code></p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">&gt;&gt;&gt;</span><span style="color: #24292E"> getitem(pair, </span><span style="color: #005CC5">0</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #D73A49">&gt;&gt;&gt;</span><span style="color: #24292E"> getitem(pair, </span><span style="color: #005CC5">1</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #005CC5">2</span></span></code></pre></div></div></figure>
<h3 id="用pair表示有理数">用pair表示有理数</h3>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">rational</span><span style="color: #24292E">(n,d):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Construct a rational number that represents N/D&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> [n, d]</span></span></code></pre></div></div></figure>
<p>返回一个列表，记录分子分母用来表示有理数</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">numer</span><span style="color: #24292E">(x):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Return the numerator of rational number x&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> x[</span><span style="color: #005CC5">0</span><span style="color: #24292E">]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">denom</span><span style="color: #24292E">(x):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Return the denominator of rational number x&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> x[</span><span style="color: #005CC5">1</span><span style="color: #24292E">]</span></span></code></pre></div></div></figure>
<p>通过访问列表中的元素返回分子分母</p>
<h2 id="应用">应用</h2>
<h3 id="分数通分">分数通分</h3>
<p>有理数的分子分母应互质，故我们可以用gcd获取它们的最大公因数来同时除以分子分母以确保获得互质的分子分母</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">from</span><span style="color: #24292E"> fractions </span><span style="color: #D73A49">import</span><span style="color: #24292E"> gcd</span></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">rational</span><span style="color: #24292E">(n,d):</span></span>
<span class="line"><span style="color: #24292E">    g </span><span style="color: #D73A49">=</span><span style="color: #24292E"> gcd(n,d)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> [n</span><span style="color: #D73A49">//</span><span style="color: #24292E">g, d</span><span style="color: #D73A49">//</span><span style="color: #24292E">g]</span></span></code></pre></div></div></figure>
<h2 id="data-representation">Data Representation</h2>
<p>数据抽象的基本思想：通过它的行为来识别该抽象数据类型</p>
<p>改变有理数的表现形式</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">rational</span><span style="color: #24292E">(n,d):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">select</span><span style="color: #24292E">(name):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> name </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;n&#39;</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> n</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">elif</span><span style="color: #24292E"> name </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;d&#39;</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> d</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> select</span></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">numer</span><span style="color: #24292E">(x):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Return the numerator of rational number x&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> x(</span><span style="color: #032F62">&#39;n&#39;</span><span style="color: #24292E">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">denom</span><span style="color: #24292E">(x):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Return the denominator of rational number x&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> x(</span><span style="color: #032F62">&#39;d&#39;</span><span style="color: #24292E">)</span></span></code></pre></div></div></figure>
<p>这里使x成为一个函数，这样就可以不需要内置的列表数据类型了</p>
<p>此时rational是一个高阶函数，返回一个表示有理数的函数</p>
]]></content>
      <categories>
        <category>CS61A</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>CS61A</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61A】CS61A——Generators</title>
    <url>/CS61A/CS61A%20Generators/</url>
    <content><![CDATA[<h1 id="generators">Generators</h1>
<h2 id="generator-functions">Generator Functions</h2>
<ul>
<li>生成器函数是用来<strong>生成(yields)</strong>值而非返回值的函数</li>
<li>生成器函数使用yield关键字返回生成的值</li>
<li>生成器可以多次生成值，而普通函数只能返回一次值</li>
<li>生成器是调用生成器函数时自动创建的迭代器</li>
<li>调用生成器函数，它会返回一个生成器来迭代该函数生成的值</li>
<li>当函数执行到yield时，生成的值将会作为下次迭代器的数值，而此时执行在yield处执行，但会记住当前环境，以便下次继续执行
e.g.</li>
</ul>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">evens</span><span style="color: #24292E">(start, end):</span></span>
<span class="line"><span style="color: #24292E">    even </span><span style="color: #D73A49">=</span><span style="color: #24292E"> start </span><span style="color: #D73A49">+</span><span style="color: #24292E"> (start</span><span style="color: #D73A49">%</span><span style="color: #005CC5">2</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E"> even</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">end:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> even</span></span>
<span class="line"><span style="color: #24292E">        even</span><span style="color: #D73A49">+=</span><span style="color: #005CC5">2</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">if</span><span style="color: #24292E"> </span><span style="color: #005CC5">__name__</span><span style="color: #24292E"> </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;__main__&quot;</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    t </span><span style="color: #D73A49">=</span><span style="color: #24292E"> evens(</span><span style="color: #005CC5">2</span><span style="color: #24292E">,</span><span style="color: #005CC5">10</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> i </span><span style="color: #D73A49">in</span><span style="color: #24292E"> t:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">print</span><span style="color: #24292E">(i)</span></span></code></pre></div></div></figure>
<pre><code>2
4
6
8</code></pre>
<h2 id="generators-iterators">Generators &amp; Iterators</h2>
<p>yield from语句 yield from语句允许从一个迭代器或可迭代变量中生成所有值
两个例子：</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">countdown</span><span style="color: #24292E">(k):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> k</span><span style="color: #D73A49">&gt;</span><span style="color: #005CC5">0</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> k</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">yield from</span><span style="color: #24292E"> countdown(k</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #032F62">&#39;&#39;&#39;</span></span>
<span class="line"><span style="color: #032F62">        等价于 </span></span>
<span class="line"><span style="color: #032F62">        for i in countdown(k-1):</span></span>
<span class="line"><span style="color: #032F62">            yield i</span></span>
<span class="line"><span style="color: #032F62">        &#39;&#39;&#39;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;Blast off&#39;</span></span>
<span class="line"><span style="color: #D73A49">if</span><span style="color: #24292E"> </span><span style="color: #005CC5">__name__</span><span style="color: #24292E"> </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;__main__&quot;</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    t </span><span style="color: #D73A49">=</span><span style="color: #24292E"> countdown(</span><span style="color: #005CC5">3</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> i </span><span style="color: #D73A49">in</span><span style="color: #24292E"> t:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">print</span><span style="color: #24292E">(i)</span></span></code></pre></div></div></figure>
<pre><code>3
2
1
Blast of</code></pre>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">prefixes</span><span style="color: #24292E">(s):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> s:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">yield from</span><span style="color: #24292E"> prefixes(s[:</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">])</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> s</span></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">substrings</span><span style="color: #24292E">(s):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> s:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">yield from</span><span style="color: #24292E"> prefixes(s)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">yield from</span><span style="color: #24292E"> substrings(s[</span><span style="color: #005CC5">1</span><span style="color: #24292E">:])</span></span>
<span class="line"><span style="color: #D73A49">if</span><span style="color: #24292E"> </span><span style="color: #005CC5">__name__</span><span style="color: #24292E"> </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;__main__&quot;</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">print</span><span style="color: #24292E">(</span><span style="color: #005CC5">list</span><span style="color: #24292E">(prefixes(</span><span style="color: #032F62">&quot;both&quot;</span><span style="color: #24292E">)))</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">print</span><span style="color: #24292E">(</span><span style="color: #005CC5">list</span><span style="color: #24292E">(substrings(</span><span style="color: #032F62">&quot;top&quot;</span><span style="color: #24292E">)))</span></span></code></pre></div></div></figure>
<pre><code>[&#39;b&#39;, &#39;bo&#39;, &#39;bot&#39;, &#39;both&#39;]
[&#39;t&#39;, &#39;to&#39;, &#39;top&#39;, &#39;o&#39;, &#39;op&#39;, &#39;p&#39;]</code></pre>
<h2 id="example-partitions">Example: Partitions</h2>
<p>详见递归时的数字分割例子 使用列表：</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">partitions</span><span style="color: #24292E">(n,m):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> n</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">0</span><span style="color: #24292E"> </span><span style="color: #D73A49">or</span><span style="color: #24292E"> m</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> []</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        exact_match </span><span style="color: #D73A49">=</span><span style="color: #24292E"> []</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> n</span><span style="color: #D73A49">==</span><span style="color: #24292E">m:</span></span>
<span class="line"><span style="color: #24292E">            exact_match </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [</span><span style="color: #005CC5">str</span><span style="color: #24292E">(m)]</span></span>
<span class="line"><span style="color: #24292E">        with_m </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [p</span><span style="color: #D73A49">+</span><span style="color: #032F62">&#39;+&#39;</span><span style="color: #D73A49">+</span><span style="color: #005CC5">str</span><span style="color: #24292E">(m) </span><span style="color: #D73A49">for</span><span style="color: #24292E"> p </span><span style="color: #D73A49">in</span><span style="color: #24292E"> partitions(n</span><span style="color: #D73A49">-</span><span style="color: #24292E">m,m)]</span></span>
<span class="line"><span style="color: #24292E">        without_m </span><span style="color: #D73A49">=</span><span style="color: #24292E"> partitions(n,m</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> exact_match</span><span style="color: #D73A49">+</span><span style="color: #24292E">with_m</span><span style="color: #D73A49">+</span><span style="color: #24292E">without_m</span></span>
<span class="line"><span style="color: #D73A49">if</span><span style="color: #24292E"> </span><span style="color: #005CC5">__name__</span><span style="color: #24292E"> </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;__main__&quot;</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> p </span><span style="color: #D73A49">in</span><span style="color: #24292E"> partitions(</span><span style="color: #005CC5">6</span><span style="color: #24292E">,</span><span style="color: #005CC5">4</span><span style="color: #24292E">):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">print</span><span style="color: #24292E">(p)</span></span></code></pre></div></div></figure>
<pre><code>2+4
1+1+4
3+3
1+2+3
1+1+1+3
2+2+2
1+1+2+2
1+1+1+1+2
1+1+1+1+1+1</code></pre>
<p>使用生成器： 使代码更优雅，而且可以输出指定个数的可能结果</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">partitions</span><span style="color: #24292E">(n,m):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> n</span><span style="color: #D73A49">&gt;</span><span style="color: #005CC5">0</span><span style="color: #24292E"> </span><span style="color: #D73A49">and</span><span style="color: #24292E"> m</span><span style="color: #D73A49">&gt;</span><span style="color: #005CC5">0</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> n</span><span style="color: #D73A49">==</span><span style="color: #24292E">m:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #005CC5">str</span><span style="color: #24292E">(m)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E"> p </span><span style="color: #D73A49">in</span><span style="color: #24292E"> partitions(n</span><span style="color: #D73A49">-</span><span style="color: #24292E">m,m):</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> p</span><span style="color: #D73A49">+</span><span style="color: #032F62">&#39;+&#39;</span><span style="color: #D73A49">+</span><span style="color: #005CC5">str</span><span style="color: #24292E">(m)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">yield from</span><span style="color: #24292E"> partitions(n,m</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #D73A49">if</span><span style="color: #24292E"> </span><span style="color: #005CC5">__name__</span><span style="color: #24292E"> </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;__main__&quot;</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    t </span><span style="color: #D73A49">=</span><span style="color: #24292E"> partitions(</span><span style="color: #005CC5">6</span><span style="color: #24292E">,</span><span style="color: #005CC5">4</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> p </span><span style="color: #D73A49">in</span><span style="color: #24292E"> </span><span style="color: #005CC5">range</span><span style="color: #24292E">(</span><span style="color: #005CC5">5</span><span style="color: #24292E">):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">print</span><span style="color: #24292E">(</span><span style="color: #005CC5">next</span><span style="color: #24292E">(t))</span></span></code></pre></div></div></figure>
<pre><code>2+4
1+1+4
3+3
1+2+3
1+1+1+3</code></pre>
]]></content>
      <categories>
        <category>CS61A</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>CS61A</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61A】CS61A——Higher-Order Functions</title>
    <url>/CS61A/CS61A%20Higher-order%20Functions/</url>
    <content><![CDATA[<h1 id="higher-order-functions">Higher-Order Functions</h1>
<h2 id="函数特征">函数特征</h2>
<ul>
<li>一个函数的定义域(domain)即为所有可能的输入</li>
<li>一个函数的值域(range)即为所有可能的输出</li>
<li>一个纯函数表现即为建立输入与输出之间的映射</li>
</ul>
<h2 id="assert语句">assert语句</h2>
<p>格式：<code>assert &lt;bool expression&gt; &lt;output information&gt;</code></p>
<p>用处：当布尔表达式成立时，语句继续执行；当布尔表达式不成立时，程序跳出并提示指定的报错信息。</p>
<h2 id="函数作为形参">函数作为形参</h2>
<p>设计一个计算求和、立方项求和的函数，我们可以通过在对求和函数中传入对每一位数的操作对应的函数来简化代码，而非为不同种类求和分别设计函数，如下：</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">from</span><span style="color: #24292E"> math </span><span style="color: #D73A49">import</span><span style="color: #24292E"> </span><span style="color: #005CC5">pow</span></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">identity</span><span style="color: #24292E">(k):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> k</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">cube</span><span style="color: #24292E">(k):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">int</span><span style="color: #24292E">(</span><span style="color: #005CC5">pow</span><span style="color: #24292E">(k,</span><span style="color: #005CC5">3</span><span style="color: #24292E">))</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">summation</span><span style="color: #24292E">(n,term):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;sum the first N terms of a sequence.</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">summation(5,cube)</span></span>
<span class="line"><span style="color: #032F62">    225</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    total,k</span><span style="color: #D73A49">=</span><span style="color: #005CC5">0</span><span style="color: #24292E">,</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E"> k</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n:</span></span>
<span class="line"><span style="color: #24292E">        total,k </span><span style="color: #D73A49">=</span><span style="color: #24292E"> total </span><span style="color: #D73A49">+</span><span style="color: #24292E"> term(k), k</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> total</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">sum_naturals</span><span style="color: #24292E">(n):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;sum the first N natural numbers</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">sum_naturals(5)</span></span>
<span class="line"><span style="color: #032F62">    15</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> summation(n,identity) </span><span style="color: #6A737D"># 传入返回原值函数进行计算</span></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">sum_cubes</span><span style="color: #24292E">(n):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;sum the first N cubes of natural numbers</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">sum_cubes(5)</span></span>
<span class="line"><span style="color: #032F62">    225</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> summation(n,cube) </span><span style="color: #6A737D"># 传入返回每个值的立方函数进行计算</span></span></code></pre></div></div></figure>
<p>其中，summation函数中的term参数与传入的函数有关</p>
<p>identity与cube函数作为单个参数传入summation函数，以处理不同情况下的求和</p>
<p>形参term函数在计算total时被回调，回调的是传入的对应函数</p>
<h2 id="函数作为返回值">函数作为返回值</h2>
<p>当一个函数在另一个函数体内定义，该函数的名称绑定在本地作用域中</p>
<p>如下：</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">make_adder</span><span style="color: #24292E">(n):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;return a function that takes one argument called k and return k+N</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">add_three = make_adder(3)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">add_three(4)</span></span>
<span class="line"><span style="color: #032F62">    7</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">adder</span><span style="color: #24292E">(k):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> k</span><span style="color: #D73A49">+</span><span style="color: #24292E">n </span><span style="color: #6A737D"># adder函数返回数值k+n</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> adder </span><span style="color: #6A737D"># make_adder函数返回adder函数</span></span></code></pre></div></div></figure>
<p>make_adder函数返回一个函数adder，而函数adder是局部定义的函数，它可以使用make_adder内部的变量（k与n）</p>
<p>对于语句<code>make_adder(1)(2)</code>，实现的效果即为1+2</p>
<h2 id="作用">作用</h2>
<ol type="1">
<li>函数是第一类值(first-class)：函数可以作为参数传递，作为返回值返回</li>
<li>higher-order函数指代以函数作为参数或返回值的函数
<ol type="1">
<li>它可以表示计算的一般情况</li>
<li>它可以防止程序代码过于重复冗杂</li>
<li>它可以将不同功能分离成多个函数</li>
</ol></li>
</ol>
<h2 id="匿名函数lambda-expressions">匿名函数(Lambda Expressions )</h2>
<p>格式：<code>lambda &lt;formal parameter&gt;: &lt;return value&gt;</code></p>
<p>lambda指定义一个匿名函数</p>
<p>lambda后紧跟一个形式参数，冒号后为返回值（无return关键字）</p>
<p><strong>返回值只能是一句表达式</strong></p>
<p>使用时将其赋值给一个变量并按照def函数方式调用或直接按照def函数方式调用</p>
<p>与def不同的一点是：def定义的函数拥有一个内部名称(intrinsic
name)，而lambda定义的函数即使赋值给了另一个名字的变量，它的名称仍为lambda</p>
<h2 id="返回语句return-statements">返回语句(Return Statements)</h2>
<p>函数中的return语句让程序返回到先前的environment，并给函数一个值</p>
<p>在执行函数体时，遇到return语句函数即结束</p>
<p>看如下例子：</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">search</span><span style="color: #24292E">(f):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;find a number that one more than the square root of</span></span>
<span class="line"><span style="color: #032F62">    the number put in the positive function</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">search(positive)</span></span>
<span class="line"><span style="color: #032F62">    11</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    x</span><span style="color: #D73A49">=</span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E"> </span><span style="color: #D73A49">not</span><span style="color: #24292E"> f(x): </span><span style="color: #6A737D"># 当positive函数返回为0时进入循环</span></span>
<span class="line"><span style="color: #24292E">        x</span><span style="color: #D73A49">+=</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> x</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">square</span><span style="color: #24292E">(x):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> x</span><span style="color: #D73A49">**</span><span style="color: #005CC5">2</span></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">positive</span><span style="color: #24292E">(x):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">max</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">,square(x)</span><span style="color: #D73A49">-</span><span style="color: #005CC5">100</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">inverse</span><span style="color: #24292E">(f):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;return g(y) such that g(f(x)) -&gt;x</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">inverse(square)(16)</span></span>
<span class="line"><span style="color: #032F62">    4</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">lambda</span><span style="color: #24292E"> y: search(</span><span style="color: #D73A49">lambda</span><span style="color: #24292E"> x:f(x)</span><span style="color: #D73A49">==</span><span style="color: #24292E">y) </span><span style="color: #6A737D"># 返回某个完全平方数的平方根</span></span></code></pre></div></div></figure>
<ul>
<li>positive函数：</li>
</ul>
<p>​ 传入search后，寻找的是第一个比positive函数中减数的平方根大的数</p>
<p>​
因为若数x的平方比减数小，return值肯定是0，while条件成立，x++继续寻找</p>
<ul>
<li><p>inverse函数：</p>
<p>inverse用于寻找完全平方数y的平方根</p>
<p>传入square函数用于计算search函数中x的平方，与inverse函数返回的lambda函数中传入的y比较是否相等，若不相等，满足while循环条件，x++继续比较，若相等则找到，跳出循环返回此时x值。</p></li>
</ul>
<h2 id="控制语句control-statements">控制语句(Control Statements)</h2>
<h3 id="条件语句">条件语句</h3>
<p>执行条件：每一句clause按序执行</p>
<ol type="1">
<li>判断条件判断语句是否成立（若存在）</li>
<li>若值为true或遇到else的clause，执行语句块并跳过其余clauses</li>
</ol>
<p>但为何没有一个函数能实现条件判断呢？</p>
<p>对于调用表达式(call expression)的执行如下：</p>
<figure>
<img src="CS61A——Higher-order%20Functions/image-20250118151740899.png"
alt="调用表达式的执行" />
<figcaption aria-hidden="true">调用表达式的执行</figcaption>
</figure>
<p>而在if语句中，只有其中一句会被执行，因此使用函数替代并不合适，如下代码：</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">if_</span><span style="color: #24292E">(c,t,f):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> c:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> t</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> f</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">from</span><span style="color: #24292E"> math </span><span style="color: #D73A49">import</span><span style="color: #24292E"> sqrt</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">real_sqrt</span><span style="color: #24292E">(x):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> if_(x</span><span style="color: #D73A49">&gt;</span><span style="color: #005CC5">0</span><span style="color: #24292E">,sqrt(x),</span><span style="color: #005CC5">0.0</span><span style="color: #24292E">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">if</span><span style="color: #24292E"> </span><span style="color: #005CC5">__name__</span><span style="color: #24292E"> </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;__main__&#39;</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">print</span><span style="color: #24292E">(real_sqrt(</span><span style="color: #D73A49">-</span><span style="color: #005CC5">4</span><span style="color: #24292E">))</span></span></code></pre></div></div></figure>
<p>我们需要实现返回一个实数平方根结果的实部，众所周知，负数开平方后实部为0，因此负数应输出0</p>
<p>但执行后发现却出现了sqrt的 ValueError: math domain error</p>
<p>因为在函数调用时，sqrt(x)同时也会执行，此时x小于0故触发了sqrt的assert</p>
<p>因此没有了控制语句，我们只能在值之间选择而不能在条件之间选择</p>
<h4 id="条件语句的简单形式">条件语句的简单形式</h4>
<p><code>&lt;consequent&gt; if &lt;predicate&gt; else &lt;alternative&gt;</code></p>
<ol type="1">
<li>执行predicate语句</li>
<li>若为真，则整个表达式的值为consequent的值</li>
<li>若为假，则整个表达式的值为alternative的值</li>
</ol>
<h3 id="逻辑运算符的短路效应">逻辑运算符的短路效应</h3>
<p>执行一个语句<code>&lt;left&gt; and &lt;right&gt;</code></p>
<ol type="1">
<li>计算left语句</li>
<li>若结果是false，则整个表达式的结果是false</li>
<li>若结果是true，则整个表达式的结果是right语句的结果</li>
</ol>
<p>执行一个语句<code>&lt;left&gt; or &lt;right&gt;</code></p>
<ol type="1">
<li>计算left语句</li>
<li>若结果为true，则整个表达式的结果是true</li>
<li>若结果为false，则整个表达式的结果是right语句的结果</li>
</ol>
<h1 id="hw">HW</h1>
<p>Lecture4的作业部分</p>
<h2 id="柯里化currying">柯里化(Currying)</h2>
<p>定义：柯里化（Currying）是一种处理多元函数的方法。它产生一系列连锁函数，其中每个函数固定部分参数，并返回一个新函数，用于传回其它剩余参数的功能。</p>
<p><strong>即它可以把一个多元函数转换为一系列函数，每个函数传入一个参数，即将f(a,b,c)转换为f(a)(b)(c)</strong></p>
<p>如上文中的<code>makeadder</code>函数，返回的是在内部定义的adder函数，每个函数接受一个参数，等同于makeadder(k,n)</p>
<p>柯里化是函数式编程的一个体现，使得函数代码更简洁</p>
<h2 id="product">1-Product</h2>
<p>My solution:</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">x </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">re </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #D73A49">while</span><span style="color: #24292E"> x</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n:</span></span>
<span class="line"><span style="color: #24292E">    re</span><span style="color: #D73A49">*=</span><span style="color: #24292E">term(x)</span></span>
<span class="line"><span style="color: #24292E">    x</span><span style="color: #D73A49">+=</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #D73A49">return</span><span style="color: #24292E"> re</span></span></code></pre></div></div></figure>
<p>product函数有一个term参数用于接收函数，根据不同计算需要可以传入不同计算相关函数(square，identity等)</p>
<h2 id="accumulate">2- Accumulate</h2>
<p>My solution:</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">a</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">   re</span><span style="color: #D73A49">=</span><span style="color: #24292E">start</span></span>
<span class="line"><span style="color: #24292E">   </span><span style="color: #D73A49">while</span><span style="color: #24292E"> a</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n:</span></span>
<span class="line"><span style="color: #24292E">       re </span><span style="color: #D73A49">=</span><span style="color: #24292E"> fuse(re,term(a))</span></span>
<span class="line"><span style="color: #24292E">       a</span><span style="color: #D73A49">+=</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">   </span><span style="color: #D73A49">return</span><span style="color: #24292E"> re</span></span></code></pre></div></div></figure>
<hr />
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">return</span><span style="color: #24292E"> accumulate(add, </span><span style="color: #005CC5">0</span><span style="color: #24292E">, n, term)</span></span></code></pre></div></div></figure>
<hr />
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">return</span><span style="color: #24292E"> accumulate(mul, </span><span style="color: #005CC5">1</span><span style="color: #24292E">, n, term)</span></span></code></pre></div></div></figure>
<p>在上一题的基础上添加了选择每个数之间使用加法还是乘法的参数fuse，fuse同时也是接收函数来指定每个term运算之间的运算方式(add,mul
等)</p>
<h2 id="make-repeater">3-Make repeater</h2>
<p>My solution:</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">if</span><span style="color: #24292E"> n </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">: </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">lambda</span><span style="color: #24292E"> x: x</span></span>
<span class="line"><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">lambda</span><span style="color: #24292E"> x: f(make_repeater(f,n</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">)(x))</span></span></code></pre></div></div></figure>
<p>这里需要将传入的数值执行n次指定运算f，即<code>f(f(...f(x)...))</code></p>
<p>本人使用了递归实现，即<code>make_repeater(f,n)(x)=f(make_repeater(f,n-1)(x))=f(f(make_repeater(f,n-2)))=...=f(f(...f(x)...))</code></p>
<p>每次加一层f()，直到<span
class="math inline">\(n=0\)</span>时替换为x</p>
]]></content>
      <categories>
        <category>CS61A</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>CS61A</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61A】CS61A——Homework 5</title>
    <url>/CS61A/CS61A%20Homework5/</url>
    <content><![CDATA[<h1 id="homework-5">Homework 5</h1>
<h2 id="q1-infinite-hailstone">Q1: Infinite Hailstone</h2>
<p>写一个生成器函数来生成从n开始的冰雹猜想序列，当到达序列尾后，生成器会一直声称1</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">hailstone</span><span style="color: #24292E">(n):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Q1: Yields the elements of the hailstone sequence starting at n.</span></span>
<span class="line"><span style="color: #032F62">       At the end of the sequence, yield 1 infinitely.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">hail_gen = hailstone(10)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">[next(hail_gen) for _ in range(10)]</span></span>
<span class="line"><span style="color: #032F62">    [10, 5, 16, 8, 4, 2, 1, 1, 1, 1]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">next(hail_gen)</span></span>
<span class="line"><span style="color: #032F62">    1</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> n</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> n</span><span style="color: #D73A49">==</span><span style="color: #005CC5">1</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        n</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">elif</span><span style="color: #24292E"> n</span><span style="color: #D73A49">%</span><span style="color: #005CC5">2</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        n</span><span style="color: #D73A49">=</span><span style="color: #005CC5">int</span><span style="color: #24292E">(n</span><span style="color: #D73A49">/</span><span style="color: #005CC5">2</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        n</span><span style="color: #D73A49">=</span><span style="color: #005CC5">3</span><span style="color: #D73A49">*</span><span style="color: #24292E">n</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">yield from</span><span style="color: #24292E"> hailstone(n)</span></span></code></pre></div></div></figure>
<p>使用递归，结合yield from生成迭代器</p>
<h2 id="q2-merge">Q2: Merge</h2>
<p>写一个merge函数，传入两个无限生成器a,b按照给定起始位置与步长生成非重复上升序列，返回一个生成器包含两个生成器中的所有元素，且去重</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">merge</span><span style="color: #24292E">(a, b):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Q2:</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">def sequence(start, step):</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">... </span><span style="color: #032F62">    while True:</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">... </span><span style="color: #032F62">        yield start</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">... </span><span style="color: #032F62">        start += step</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">a = sequence(2, 3) # 2, 5, 8, 11, 14, ...</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">b = sequence(3, 2) # 3, 5, 7, 9, 11, 13, 15, ...</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">result = merge(a, b) # 2, 3, 5, 7, 8, 9, 11, 13, 14, 15</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">[next(result) for _ in range(10)]</span></span>
<span class="line"><span style="color: #032F62">    [2, 3, 5, 7, 8, 9, 11, 13, 14, 15]</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    gene_a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">next</span><span style="color: #24292E">(a)</span></span>
<span class="line"><span style="color: #24292E">    gene_b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">next</span><span style="color: #24292E">(b)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E"> </span><span style="color: #005CC5">True</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> gene_a </span><span style="color: #D73A49">==</span><span style="color: #24292E"> gene_b:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> gene_a</span></span>
<span class="line"><span style="color: #24292E">            gene_a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">next</span><span style="color: #24292E">(a)</span></span>
<span class="line"><span style="color: #24292E">            gene_b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">next</span><span style="color: #24292E">(b)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">elif</span><span style="color: #24292E"> gene_a</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> gene_b:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> gene_b</span></span>
<span class="line"><span style="color: #24292E">            gene_b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">next</span><span style="color: #24292E">(b)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> gene_a</span></span>
<span class="line"><span style="color: #24292E">            gene_a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">next</span><span style="color: #24292E">(a)</span></span></code></pre></div></div></figure>
<h2 id="q3-yield-paths">Q3: Yield Paths</h2>
<p>定义一个生成器函数，传入一棵树与一个值v，返回生成器从树的根到含有v的节点的每一条路径</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">yield_paths</span><span style="color: #24292E">(t, value):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Q4: Yields all possible paths from the root of t to a node with the label</span></span>
<span class="line"><span style="color: #032F62">    value as a list.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">t1 = tree(1, [tree(2, [tree(3), tree(4, [tree(6)]), tree(5)]), tree(5)])</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">print_tree(t1)</span></span>
<span class="line"><span style="color: #032F62">    1</span></span>
<span class="line"><span style="color: #032F62">      2</span></span>
<span class="line"><span style="color: #032F62">        3</span></span>
<span class="line"><span style="color: #032F62">        4</span></span>
<span class="line"><span style="color: #032F62">          6</span></span>
<span class="line"><span style="color: #032F62">        5</span></span>
<span class="line"><span style="color: #032F62">      5</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">next(yield_paths(t1, 6))</span></span>
<span class="line"><span style="color: #032F62">    [1, 2, 4, 6]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">path_to_5 = yield_paths(t1, 5)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">sorted(list(path_to_5))</span></span>
<span class="line"><span style="color: #032F62">    [[1, 2, 5], [1, 5]]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">t2 = tree(0, [tree(2, [t1])])</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">print_tree(t2)</span></span>
<span class="line"><span style="color: #032F62">    0</span></span>
<span class="line"><span style="color: #032F62">      2</span></span>
<span class="line"><span style="color: #032F62">        1</span></span>
<span class="line"><span style="color: #032F62">          2</span></span>
<span class="line"><span style="color: #032F62">            3</span></span>
<span class="line"><span style="color: #032F62">            4</span></span>
<span class="line"><span style="color: #032F62">              6</span></span>
<span class="line"><span style="color: #032F62">            5</span></span>
<span class="line"><span style="color: #032F62">          5</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">path_to_2 = yield_paths(t2, 2)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">sorted(list(path_to_2))</span></span>
<span class="line"><span style="color: #032F62">    [[0, 2], [0, 2, 1, 2]]</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> label(t) </span><span style="color: #D73A49">==</span><span style="color: #24292E"> value:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> [value]</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> b </span><span style="color: #D73A49">in</span><span style="color: #24292E"> branches(t):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E"> p </span><span style="color: #D73A49">in</span><span style="color: #24292E"> yield_paths(b, value):</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> [label(t)]</span><span style="color: #D73A49">+</span><span style="color: #24292E">p</span></span></code></pre></div></div></figure>
<blockquote>
<p>If our current label is equal to <code>value</code>, we’ve found a
path from the root to a node containing <code>value</code> containing
only our current label, so we should yield that. From there, we’ll see
if there are any paths starting from one of our branches that ends at a
node containing <code>value</code>. If we find these “partial paths” we
can simply add our current label to the beginning of a path to obtain a
path starting from the root.</p>
<p>In order to do this, we’ll create a generator for each of the
branches which yields these “partial paths”. By calling
<code>yield_paths</code> on each of the branches, we’ll create exactly
this generator! Then, since a generator is also an iterable, we can
iterate over the paths in this generator and yield the result of
concatenating it with our current label.</p>
</blockquote>
]]></content>
      <categories>
        <category>CS61A</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>CS61A</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61A】CS61A——Efficiency</title>
    <url>/CS61A/CS61A%20Efficiency/</url>
    <content><![CDATA[<h1 id="efficiency">Efficiency</h1>
<h2 id="memorization">Memorization</h2>
<p>使用记忆化优化斐波那契数组<br />
memo函数用来记录已经计算过的数，当有相同计算需求时直接赋值<br />
count函数记录调用函数次数（包括递归）</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fib</span><span style="color: #24292E">(n):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> n</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E"> </span><span style="color: #D73A49">or</span><span style="color: #24292E"> n</span><span style="color: #D73A49">==</span><span style="color: #005CC5">1</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> n</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> fib(n</span><span style="color: #D73A49">-</span><span style="color: #005CC5">2</span><span style="color: #24292E">)</span><span style="color: #D73A49">+</span><span style="color: #24292E">fib(n</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">count</span><span style="color: #24292E">(f):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">counted</span><span style="color: #24292E">(n):</span></span>
<span class="line"><span style="color: #24292E">        counted.call_count </span><span style="color: #D73A49">+=</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> f(n)</span></span>
<span class="line"><span style="color: #24292E">    counted.call_count </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> counted</span></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">memo</span><span style="color: #24292E">(f):</span></span>
<span class="line"><span style="color: #24292E">    cache</span><span style="color: #D73A49">=</span><span style="color: #24292E">{}</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">memoized</span><span style="color: #24292E">(n):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> n </span><span style="color: #D73A49">not</span><span style="color: #24292E"> </span><span style="color: #D73A49">in</span><span style="color: #24292E"> cache:</span></span>
<span class="line"><span style="color: #24292E">            cache[n] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> f(n)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> cache[n]</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> memoized</span></span>
<span class="line"><span style="color: #24292E">fib </span><span style="color: #D73A49">=</span><span style="color: #24292E"> count(fib)</span></span>
<span class="line"><span style="color: #24292E">counted_fib </span><span style="color: #D73A49">=</span><span style="color: #24292E">fib</span></span>
<span class="line"><span style="color: #24292E">fib </span><span style="color: #D73A49">=</span><span style="color: #24292E"> memo(fib)</span></span>
<span class="line"><span style="color: #24292E">fib </span><span style="color: #D73A49">=</span><span style="color: #24292E"> count(fib)</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(fib(</span><span style="color: #005CC5">30</span><span style="color: #24292E">))</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;origin:&quot;</span><span style="color: #24292E">, fib.call_count, </span><span style="color: #032F62">&quot;memorized:&quot;</span><span style="color: #24292E">, counted_fib.call_count)</span></span></code></pre></div></div></figure>
<pre><code>832040
origin: 59 memorized: 31</code></pre>
<h2 id="exponentiation">Exponentiation</h2>
<p>优化指数运算至<span class="math inline">\(o(\log n)\)</span><br />
以下显示了进行优化后的算法在不同数据量下的运行时间图，呈现对数曲线趋势</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">%</span><span style="color: #24292E">matplotlib inline</span></span>
<span class="line"><span style="color: #D73A49">import</span><span style="color: #24292E"> matplotlib.pyplot </span><span style="color: #D73A49">as</span><span style="color: #24292E"> plt</span></span>
<span class="line"><span style="color: #24292E">plt.style.use(</span><span style="color: #032F62">&#39;ggplot&#39;</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">plt.rc(</span><span style="color: #032F62">&#39;font&#39;</span><span style="color: #24292E">, </span><span style="color: #E36209">size</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">16</span><span style="color: #24292E">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">from</span><span style="color: #24292E"> timeit </span><span style="color: #D73A49">import</span><span style="color: #24292E"> repeat</span></span>
<span class="line"><span style="color: #D73A49">from</span><span style="color: #24292E"> numpy </span><span style="color: #D73A49">import</span><span style="color: #24292E"> median, percentile</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">plot_times</span><span style="color: #24292E">(name, xs, n</span><span style="color: #D73A49">=</span><span style="color: #005CC5">15</span><span style="color: #24292E">):</span></span>
<span class="line"><span style="color: #24292E">    f </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">lambda</span><span style="color: #24292E"> x: name</span><span style="color: #D73A49">+</span><span style="color: #032F62">&#39;(&#39;</span><span style="color: #D73A49">+</span><span style="color: #005CC5">str</span><span style="color: #24292E">(x)</span><span style="color: #D73A49">+</span><span style="color: #032F62">&#39;)&#39;</span></span>
<span class="line"><span style="color: #24292E">    g </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">globals</span><span style="color: #24292E">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    samples </span><span style="color: #D73A49">=</span><span style="color: #24292E"> []</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> _ </span><span style="color: #D73A49">in</span><span style="color: #24292E"> </span><span style="color: #005CC5">range</span><span style="color: #24292E">(n):</span></span>
<span class="line"><span style="color: #24292E">        times </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">lambda</span><span style="color: #24292E"> x: repeat(f(x), </span><span style="color: #E36209">globals</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> g, </span><span style="color: #E36209">number</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">, </span><span style="color: #E36209">repeat</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> n)</span></span>
<span class="line"><span style="color: #24292E">        samples.append([median(times(x)) </span><span style="color: #D73A49">for</span><span style="color: #24292E"> x </span><span style="color: #D73A49">in</span><span style="color: #24292E"> xs])</span></span>
<span class="line"><span style="color: #24292E">    ys </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [</span><span style="color: #005CC5">10e3</span><span style="color: #D73A49">*</span><span style="color: #24292E">median(sample) </span><span style="color: #D73A49">for</span><span style="color: #24292E"> sample </span><span style="color: #D73A49">in</span><span style="color: #24292E"> </span><span style="color: #005CC5">zip</span><span style="color: #24292E">(</span><span style="color: #D73A49">*</span><span style="color: #24292E">samples)]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    plt.figure(</span><span style="color: #E36209">figsize</span><span style="color: #D73A49">=</span><span style="color: #24292E">(</span><span style="color: #005CC5">8</span><span style="color: #24292E">, </span><span style="color: #005CC5">8</span><span style="color: #24292E">))</span></span>
<span class="line"><span style="color: #24292E">    plt.plot(xs, ys)</span></span>
<span class="line"><span style="color: #24292E">    plt.xlabel(</span><span style="color: #032F62">&#39;n&#39;</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">    plt.ylabel(</span><span style="color: #032F62">&#39;ms&#39;</span><span style="color: #24292E">)</span></span></code></pre></div></div></figure>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">exp_fast</span><span style="color: #24292E">(b,n):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> n</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">elif</span><span style="color: #24292E"> n</span><span style="color: #D73A49">%</span><span style="color: #005CC5">2</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> square(exp_fast(b,n</span><span style="color: #D73A49">//</span><span style="color: #005CC5">2</span><span style="color: #24292E">))</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> b</span><span style="color: #D73A49">*</span><span style="color: #24292E">exp_fast(b, n</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">square</span><span style="color: #24292E">(x):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> x</span><span style="color: #D73A49">*</span><span style="color: #24292E">x</span></span></code></pre></div></div></figure>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">exp_2_fast </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">lambda</span><span style="color: #24292E"> n: exp_fast(</span><span style="color: #005CC5">2.0</span><span style="color: #24292E">, n)</span></span>
<span class="line"><span style="color: #24292E">plot_times(</span><span style="color: #032F62">&#39;exp_2_fast&#39;</span><span style="color: #24292E">, </span><span style="color: #005CC5">range</span><span style="color: #24292E">(</span><span style="color: #005CC5">20</span><span style="color: #24292E">, </span><span style="color: #005CC5">1600</span><span style="color: #24292E">, </span><span style="color: #005CC5">10</span><span style="color: #24292E">))</span></span></code></pre></div></div></figure>
<figure>
<img src="CS61A——Efficiency/output_5_0.png" alt="output_5_0" />
<figcaption aria-hidden="true">output_5_0</figcaption>
</figure>
<h2 id="order-of-growth-notation">Order of Growth Notation</h2>
<p>时间复杂度常用大O与大<span
class="math inline">\(\Theta\)</span>表示法表示<br />
- 大O描述了运行时间上限 - 大<span
class="math inline">\(\Theta\)</span>则对同时表示了上限与下限
常见的时间复杂度表示（大O与大<span
class="math inline">\(\Theta\)</span>自行替换符号）： - 指数增长：<span
class="math inline">\(o(b^n)\)</span> - 二次增长：<span
class="math inline">\(o(b^2)\)</span> - 线性增长：<span
class="math inline">\(o(n)\)</span> - 对数增长：<span
class="math inline">\(o(\log n)\)</span> - 常数增长：<span
class="math inline">\(o(1)\)</span></p>
<h2 id="space">Space</h2>
<p>Active environment: - 正在被调用的函数的环境 -
函数的父函数在活动环境中（即嵌套函数内层调用时）
python会自动检测非活动环境并将其回收</p>
]]></content>
      <categories>
        <category>CS61A</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>CS61A</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61A】CS61A——Homework 4</title>
    <url>/CS61A/CS61A%20Homework4/</url>
    <content><![CDATA[<h1 id="homework-4">Homework 4</h1>
<h2 id="sequence">Sequence</h2>
<h3 id="q1-deep-map">Q1: Deep Map</h3>
<p>写一个函数<code>deep_map</code>，使得传入的列表s（s可能是嵌套列表）中的每一个元素替换为该元素传入函数f后的返回值</p>
<p><strong>每一个元素包括嵌套列表中的每一个元素</strong></p>
<blockquote>
<p>提示：<code>type(a)==list</code>会返回True如果a是列表</p>
</blockquote>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">deep_map</span><span style="color: #24292E">(f, s):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Replace all non-list elements x with f(x) in the nested list s.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">six = [1, 2, [3, [4], 5], 6]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">deep_map(lambda x: x * x, six)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">six</span></span>
<span class="line"><span style="color: #032F62">    [1, 4, [9, [16], 25], 36]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62"># Check that you&#39;re not making new lists</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">s = [3, [1, [4, [1]]]]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">s1 = s[1]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">s2 = s1[1]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">s3 = s2[1]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">deep_map(lambda x: x + 1, s)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">s</span></span>
<span class="line"><span style="color: #032F62">    [4, [2, [5, [2]]]]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">s1 is s[1]</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">s2 is s1[1]</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">s3 is s2[1]</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> i </span><span style="color: #D73A49">in</span><span style="color: #24292E"> </span><span style="color: #005CC5">range</span><span style="color: #24292E">(</span><span style="color: #005CC5">len</span><span style="color: #24292E">(s)):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> </span><span style="color: #005CC5">type</span><span style="color: #24292E">(s[i])</span><span style="color: #D73A49">==</span><span style="color: #005CC5">list</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">            deep_map(f,s[i])</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">            s[i]</span><span style="color: #D73A49">=</span><span style="color: #24292E">f(s[i])</span></span></code></pre></div></div></figure>
<p>遍历列表下标i，如果发现内部有嵌套列表，就递归进入遍历嵌套列表，若当前位置为一般元素，则调用函数并将结果替换</p>
<h2 id="data-abstraction">Data Abstraction</h2>
<h3 id="要用到的adt">要用到的ADT</h3>
<p>Mobile：一种悬挂雕像</p>
<ul>
<li>一个mobile一定有一个左arm和一个右arm</li>
<li>一个arm有一个正数大小的长度，且尾端一定挂着一个mobile或一个planet</li>
<li>一个planet有一个正数大小的质量，且没有东西挂在上面</li>
</ul>
<h3 id="q2-mass">Q2: Mass</h3>
<p>补充完成构造器planet与选择器mass</p>
<p>使得每一格planet用一个二元列表表示：<code>['planet', mass]</code></p>
<p>其中<code>total_mass</code>函数可以用来计算一个planet或一个mobile的质量</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6F42C1">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">planet</span><span style="color: #24292E">(</span><span style="color: #6F42C1">mass</span><span style="color: #24292E">):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Construct a planet of some mass.&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    assert mass </span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> [</span><span style="color: #032F62">&#39;planet&#39;</span><span style="color: #24292E">, </span><span style="color: #E36209">mass</span><span style="color: #24292E">]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">def mass(</span><span style="color: #6F42C1">p</span><span style="color: #24292E">):</span></span>
<span class="line"><span style="color: #24292E">    &quot;&quot;&quot;Select the mass of a planet.&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    assert is_planet(</span><span style="color: #6F42C1">p</span><span style="color: #24292E">), &#39;must call mass on a planet&#39;</span></span>
<span class="line"><span style="color: #24292E">    return p[1]</span></span></code></pre></div></div></figure>
<p>按照提示构造即可</p>
<h3 id="q3-balanced">Q3: Balanced</h3>
<p>实现balanced函数，判断m是否是一个”balanced mobile”</p>
<p>“balanced mobile”的定义如下：</p>
<ul>
<li>左arm的扭矩等于右arm的扭矩，其中扭矩为左arm的长度与挂在左arm上的质量之积</li>
<li>挂在arm尾端的mobile自身为balanced
mobile，planet自身也是balanced的</li>
</ul>
<blockquote>
<p>提示：使用<code>total_mass</code>函数，选择器函数，不要逾越ADT的屏障</p>
</blockquote>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">balanced</span><span style="color: #24292E">(m):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Return whether m is balanced.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">t, u, v = examples()</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">balanced(t)</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">balanced(v)</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">p = mobile(arm(3, t), arm(2, u))</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">balanced(p)</span></span>
<span class="line"><span style="color: #032F62">    False</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">balanced(mobile(arm(1, v), arm(1, p)))</span></span>
<span class="line"><span style="color: #032F62">    False</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">balanced(mobile(arm(1, p), arm(1, v)))</span></span>
<span class="line"><span style="color: #032F62">    False</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">from construct_check import check</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62"># checking for abstraction barrier violations by banning indexing</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">check(HW_SOURCE_FILE, &#39;balanced&#39;, [&#39;Index&#39;])</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> is_planet(m):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">True</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        torque_left </span><span style="color: #D73A49">=</span><span style="color: #24292E"> length(left(m))</span><span style="color: #D73A49">*</span><span style="color: #24292E">total_mass(end(left(m)))</span></span>
<span class="line"><span style="color: #24292E">        torque_right </span><span style="color: #D73A49">=</span><span style="color: #24292E"> length(right(m))</span><span style="color: #D73A49">*</span><span style="color: #24292E">total_mass(end(right(m)))</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> torque_left </span><span style="color: #D73A49">==</span><span style="color: #24292E"> torque_right </span><span style="color: #D73A49">and</span><span style="color: #24292E"> balanced(end(left(m))) </span><span style="color: #D73A49">and</span><span style="color: #24292E"> balanced(end(right(m)))</span></span></code></pre></div></div></figure>
<p>这个结构类似树，我们可以递归的求解这个问题</p>
<ul>
<li>Base
case：若传入的是一个planet，则返回True，因为planet在这个结构中类似叶子节点，是整个mobile的终点</li>
<li>递归：每次需要比较mobile的左右扭矩是否相等，同时递归比较左右arm下的左右扭矩是否相等，直到递归到planet直接返回True</li>
</ul>
<h2 id="trees">Trees</h2>
<h3 id="q4-maximum-path-sum">Q4: Maximum Path Sum</h3>
<p>写一个函数，返回树上从根节点到叶子节点的所有路径中节点权值总和最大值</p>
<figure class="shiki c++"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6F42C1">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">max_path_sum</span><span style="color: #24292E">(</span><span style="color: #6F42C1">t</span><span style="color: #24292E">):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Return the maximum root-to-leaf path sum of a tree.</span></span>
<span class="line"><span style="color: #032F62">    &gt;&gt;&gt; t = tree(1, [tree(5, [tree(1), tree(3)]), tree(10)])</span></span>
<span class="line"><span style="color: #032F62">    &gt;&gt;&gt; max_path_sum(t) # 1, 10</span></span>
<span class="line"><span style="color: #032F62">    11</span></span>
<span class="line"><span style="color: #032F62">    &gt;&gt;&gt; t2 = tree(5, [tree(4, [tree(1), tree(3)]), tree(2, [tree(10), tree(3)])])</span></span>
<span class="line"><span style="color: #032F62">    &gt;&gt;&gt; max_path_sum(t2) # 5, 2, 10</span></span>
<span class="line"><span style="color: #032F62">    17</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    max_n </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> </span><span style="color: #6F42C1">is_leaf</span><span style="color: #24292E">(t):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">label</span><span style="color: #24292E">(t)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> b in </span><span style="color: #6F42C1">branches</span><span style="color: #24292E">(t):</span></span>
<span class="line"><span style="color: #24292E">        max_n</span><span style="color: #D73A49">=</span><span style="color: #6F42C1">max</span><span style="color: #24292E">(</span><span style="color: #6F42C1">max_path_sum</span><span style="color: #24292E">(b),max_n)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> max_n</span><span style="color: #D73A49">+</span><span style="color: #6F42C1">label</span><span style="color: #24292E">(t)</span></span></code></pre></div></div></figure>
<p>使用递归遍历</p>
<p>先直接深入到叶子节点，发现叶子节点则返回节点权值，再往前返回，每上一个节点返回已经求和的值+当前节点权值，且每次遍历取当前不同路径的最大值</p>
]]></content>
      <categories>
        <category>CS61A</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>CS61A</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61A】CS61A——Iterators</title>
    <url>/CS61A/CS61A%20Iterators/</url>
    <content><![CDATA[<h1 id="iterators">Iterators</h1>
<h2 id="iterators-1">Iterators</h2>
<p>迭代器是一种常见的接口，python中常用作一种访问不同容器元素的方式 -
容器可以提供一个迭代器，以按照某种顺序访问容器内元素 -
<code>iter(iterable)</code>：创建迭代器，接受任何可迭代的东西，返回可迭代元素的迭代器
- <code>next(iterator)</code>：推进迭代器，返回迭代器的下一个元素 -
不同迭代器可以迭代相同值，但它们彼此之间是独立的 -
使用list，tuple或sorted函数可以查看一个迭代器的剩余元素 -
当迭代器到达末尾，Python会返回一个StopIteration的异常 -
所有迭代器都是可变对象</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">s </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [[</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">2</span><span style="color: #24292E">],</span><span style="color: #005CC5">3</span><span style="color: #24292E">,</span><span style="color: #005CC5">4</span><span style="color: #24292E">,</span><span style="color: #005CC5">5</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #24292E">t </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">iter</span><span style="color: #24292E">(s)</span></span>
<span class="line"><span style="color: #24292E">u </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">iter</span><span style="color: #24292E">(s)</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;t:&quot;</span><span style="color: #24292E">,</span><span style="color: #005CC5">next</span><span style="color: #24292E">(t))</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;u:&quot;</span><span style="color: #24292E">,</span><span style="color: #005CC5">next</span><span style="color: #24292E">(u))</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(</span><span style="color: #032F62">&quot;t:&quot;</span><span style="color: #24292E">,</span><span style="color: #005CC5">next</span><span style="color: #24292E">(t))</span></span>
<span class="line"><span style="color: #005CC5">list</span><span style="color: #24292E">(t)</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(</span><span style="color: #005CC5">next</span><span style="color: #24292E">(t))</span></span></code></pre></div></div></figure>
<pre><code>t: [1, 2]
u: [1, 2]
t: 3

---------------------------------------------------------------------------
StopIteration                             Traceback (most recent call last)

Cell In[4], line 8
      6 print(&quot;t:&quot;,next(t))
      7 list(t)
----&gt; 8 print(next(t))
StopIteration: </code></pre>
<h2 id="dictionary-itertion">Dictionary Itertion</h2>
<p>字典的键，值以及键值对都是可遍历的 ，可以生成迭代器
字典中的键值对顺序取决于它们的添加顺序（Python3.6+）
迭代各项目的方法如下</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">d </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span><span style="color: #032F62">&#39;one&#39;</span><span style="color: #24292E">:</span><span style="color: #005CC5">1</span><span style="color: #24292E">, </span><span style="color: #032F62">&#39;two&#39;</span><span style="color: #24292E">:</span><span style="color: #005CC5">2</span><span style="color: #24292E">, </span><span style="color: #032F62">&#39;three&#39;</span><span style="color: #24292E">:</span><span style="color: #005CC5">3</span><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #24292E">d[</span><span style="color: #032F62">&#39;zero&#39;</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #6A737D"># 遍历键</span></span>
<span class="line"><span style="color: #24292E">k </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">iter</span><span style="color: #24292E">(d.keys()) </span><span style="color: #6A737D"># iter(d)</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(</span><span style="color: #005CC5">next</span><span style="color: #24292E">(k))</span></span>
<span class="line"><span style="color: #6A737D"># 遍历值</span></span>
<span class="line"><span style="color: #24292E">v </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">iter</span><span style="color: #24292E">(d.values())</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(</span><span style="color: #005CC5">next</span><span style="color: #24292E">(v))</span></span>
<span class="line"><span style="color: #6A737D"># 遍历键值对</span></span>
<span class="line"><span style="color: #24292E">i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">iter</span><span style="color: #24292E">(d.items()) </span><span style="color: #6A737D"># 以元组形式迭代</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(</span><span style="color: #005CC5">next</span><span style="color: #24292E">(i))</span></span></code></pre></div></div></figure>
<pre><code>one
1
(&#39;one&#39;, 1)</code></pre>
<p><strong>注意：若在迭代器创建后，字典发生了结构上的改变（增加，减少元素等），迭代器会失效。若只是改变键对应的值则不会。</strong></p>
<h2 id="for-statement">For Statement</h2>
<p>for循环可以遍历迭代器本身，可以从迭代器当前位置遍历到迭代器末尾，但这会推进迭代器，故不能重复使用
而可迭代对象可以从头到尾遍历多次</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">r </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">range</span><span style="color: #24292E">(</span><span style="color: #005CC5">3</span><span style="color: #24292E">,</span><span style="color: #005CC5">6</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">ri </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">iter</span><span style="color: #24292E">(r)</span></span>
<span class="line"><span style="color: #D73A49">for</span><span style="color: #24292E"> i </span><span style="color: #D73A49">in</span><span style="color: #24292E"> ri:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">print</span><span style="color: #24292E">(i)</span></span>
<span class="line"><span style="color: #D73A49">for</span><span style="color: #24292E"> i </span><span style="color: #D73A49">in</span><span style="color: #24292E"> ri:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">print</span><span style="color: #24292E">(i)</span></span></code></pre></div></div></figure>
<pre><code>3
4
5</code></pre>
<h2 id="built-in-function-for-iteration">Built-in Function for
Iteration</h2>
<p>许多python内置的序列操作使用迭代器作为返回值，以惰性方式计算
惰性计算意味着只有被请求时才计算结果 e.g.
<code>map(func, iterable)</code>：接受一个函数与一个可迭代对象，将该函数应用于可迭代对象中的每一个元素，返回一个迭代器遍历可迭代对象中所有x在func下的值
<code>filter(func, iterable)</code>：接受一个断言函数与一个可迭代对象，返回一个迭代器遍历可迭代对象中所有在func下为真的x
<code>zip(first_iter, second_iter)</code>：接受两个可迭代对象，返回迭代器遍历相同索引的(x,y)对
<code>reversed(sequence)</code>：接受一个序列，返回迭代器反向遍历该序列</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">bcd </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [</span><span style="color: #032F62">&#39;b&#39;</span><span style="color: #24292E">, </span><span style="color: #032F62">&#39;c&#39;</span><span style="color: #24292E">, </span><span style="color: #032F62">&#39;d&#39;</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #24292E">m </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">map</span><span style="color: #24292E">(</span><span style="color: #D73A49">lambda</span><span style="color: #24292E"> x: x.upper(), bcd) </span><span style="color: #6A737D"># 返回一个迭代器</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(</span><span style="color: #005CC5">next</span><span style="color: #24292E">(m))</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(</span><span style="color: #005CC5">next</span><span style="color: #24292E">(m))</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(</span><span style="color: #005CC5">next</span><span style="color: #24292E">(m))</span></span></code></pre></div></div></figure>
<pre><code>B
C
D</code></pre>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">double</span><span style="color: #24292E">(x):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">print</span><span style="color: #24292E">(x, </span><span style="color: #032F62">&#39;=&gt;&#39;</span><span style="color: #24292E">,</span><span style="color: #005CC5">2</span><span style="color: #D73A49">*</span><span style="color: #24292E">x)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #D73A49">*</span><span style="color: #24292E">x</span></span>
<span class="line"><span style="color: #24292E">m </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">map</span><span style="color: #24292E">(double, </span><span style="color: #005CC5">range</span><span style="color: #24292E">(</span><span style="color: #005CC5">3</span><span style="color: #24292E">,</span><span style="color: #005CC5">7</span><span style="color: #24292E">))</span></span>
<span class="line"><span style="color: #24292E">f </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">lambda</span><span style="color: #24292E"> y: y</span><span style="color: #D73A49">&gt;=</span><span style="color: #005CC5">10</span></span>
<span class="line"><span style="color: #24292E">t </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">filter</span><span style="color: #24292E">(f,m) </span><span style="color: #6A737D"># 仅遍历满足f函数下的返回值</span></span>
<span class="line"><span style="color: #005CC5">list</span><span style="color: #24292E">(</span><span style="color: #005CC5">filter</span><span style="color: #24292E">(f,m)) </span><span style="color: #6A737D"># 将所有可能的返回值存入列表</span></span></code></pre></div></div></figure>
<pre><code>3 =&gt; 6
4 =&gt; 8
5 =&gt; 10
6 =&gt; 12





[10, 12]</code></pre>
<h2 id="zip">Zip</h2>
<p>zip函数返回迭代器，遍历相同索引的值组成的元组
若一个可迭代对象比另一个长，zip会跳过多余的
zip可以接受多个可迭代对象</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(</span><span style="color: #005CC5">list</span><span style="color: #24292E">(</span><span style="color: #005CC5">zip</span><span style="color: #24292E">([</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">2</span><span style="color: #24292E">],[</span><span style="color: #005CC5">3</span><span style="color: #24292E">,</span><span style="color: #005CC5">4</span><span style="color: #24292E">])))</span></span>
<span class="line"></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(</span><span style="color: #005CC5">list</span><span style="color: #24292E">(</span><span style="color: #005CC5">zip</span><span style="color: #24292E">([</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">2</span><span style="color: #24292E">],[</span><span style="color: #005CC5">3</span><span style="color: #24292E">,</span><span style="color: #005CC5">4</span><span style="color: #24292E">,</span><span style="color: #005CC5">5</span><span style="color: #24292E">])))</span></span>
<span class="line"></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(</span><span style="color: #005CC5">list</span><span style="color: #24292E">(</span><span style="color: #005CC5">zip</span><span style="color: #24292E">([</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">2</span><span style="color: #24292E">],[</span><span style="color: #005CC5">3</span><span style="color: #24292E">,</span><span style="color: #005CC5">4</span><span style="color: #24292E">,</span><span style="color: #005CC5">5</span><span style="color: #24292E">], [</span><span style="color: #005CC5">6</span><span style="color: #24292E">,</span><span style="color: #005CC5">7</span><span style="color: #24292E">])))</span></span></code></pre></div></div></figure>
<pre><code>[(1, 3), (2, 4)]
[(1, 3), (2, 4)]
[(1, 3, 6), (2, 4, 7)]</code></pre>
<blockquote>
<p>e.g. 检测任意一个序列是否为回文序列，使用zip</p>
</blockquote>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">palindrome</span><span style="color: #24292E">(s):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># &gt;&gt;&gt; palindrome([3,1,4,1,5])</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># False</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># &gt;&gt;&gt; palindrome([3,1,4,1,3])</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># True</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># &gt;&gt;&gt; palindrome(&#39;seveneves&#39;)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># True</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">all</span><span style="color: #24292E">([a</span><span style="color: #D73A49">==</span><span style="color: #24292E">b </span><span style="color: #D73A49">for</span><span style="color: #24292E"> a,b </span><span style="color: #D73A49">in</span><span style="color: #24292E"> </span><span style="color: #005CC5">zip</span><span style="color: #24292E">(s,</span><span style="color: #005CC5">reversed</span><span style="color: #24292E">(s))])</span></span>
<span class="line"><span style="color: #D73A49">if</span><span style="color: #24292E"> </span><span style="color: #005CC5">__name__</span><span style="color: #24292E"> </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;__main__&#39;</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">print</span><span style="color: #24292E">(palindrome([</span><span style="color: #005CC5">3</span><span style="color: #24292E">,</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">4</span><span style="color: #24292E">,</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">3</span><span style="color: #24292E">]))</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">print</span><span style="color: #24292E">(palindrome(</span><span style="color: #032F62">&#39;seveneves&#39;</span><span style="color: #24292E">))</span></span></code></pre></div></div></figure>
<pre><code>True
True</code></pre>
<h2 id="using-iterators">Using Iterators</h2>
<p>使用迭代器的代码对数据本身更改不大 -
当数据表示形式改变时，使用迭代器可以不必重写代码 -
其他人更可能在他们的数据上使用你的代码
迭代器将序列中的元素与所在位置绑定 -
将对象传递给其他函数时始终保留着位置 -
可以确保序列中的每个元素只执行一次 -
传递迭代器限制了对序列执行的操作，即只能请求下一个值</p>
]]></content>
      <categories>
        <category>CS61A</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>CS61A</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61A】CS61A——Inheritance</title>
    <url>/CS61A/CS61A%20Inheritance/</url>
    <content><![CDATA[<h1 id="inheritance">Inheritance</h1>
<p>继承是将多个类关联起来的一种方法
当两个类相似时，可以使用继承，相似的类可能具有与通用类相同的所有属性，外加自带的特殊属性
<strong>语法：</strong> <figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">class &lt;name&gt;(&lt;base class&gt;):</span></span>
<span class="line"><span style="color: #24292e">    &lt;suite&gt;</span></span></code></pre></div></div></figure>
通过该语句创建的子类与其基类共享所有属性，子类可能会覆盖某些继承的属性，但未更改的保持不变
当编写子类是，只需要指出其与基类不同之处即可 ## 例
创建一个支票账户(CheckingAccount)类，作为账户(Account)类的子类</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D"># 类的继承</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">CheckingAccount</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Account</span><span style="color: #24292E">):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;A bank account that charges for withdrawals&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    withdraw_fee </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">    interest </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0.01</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">withdraw</span><span style="color: #24292E">(self, amount):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> Account.withdraw(</span><span style="color: #005CC5">self</span><span style="color: #24292E">, amount </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">self</span><span style="color: #24292E">.withdraw_fee)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">ch </span><span style="color: #D73A49">=</span><span style="color: #24292E"> CheckingAccount(</span><span style="color: #032F62">&#39;Tom&#39;</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(ch.interest)</span></span>
<span class="line"><span style="color: #24292E">ch.deposit(</span><span style="color: #005CC5">20</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">ch.withdraw(</span><span style="color: #005CC5">5</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(ch.balance)</span></span></code></pre></div></div></figure>
<p>此处我们在Account类的基础上修改了interest属性与withdraw方法，而其余属性与方法可以继续使用</p>
<h2 id="在类上寻找属性名称">在类上寻找属性名称</h2>
<p><strong>基类属性不会复制到子类中</strong>，确保了未经修改的属性与基类保持一致，在类中寻找名称遵循如下规则
- 如果名称为类中的属性，则返回属性值 - 若不在，在其基类中寻找该名称</p>
<h2 id="面向对象设计">面向对象设计</h2>
<p>在进行面向对象编程时，建议遵循如下原则 -
不要重复复制粘贴已经存在的，而是利用已经存在的实现 -
已被覆盖的属性仍需要通过类来访问</p>
<p>如以上代码，在计算提款时最佳方式是查找实例本身上的withdraw_fee
这样，如果当前实例有一个特定的withdraw_fee，我们就使用它，否则使用Account类中的</p>
<h2 id="继承与组合">继承与组合</h2>
<p>继承最适合<strong>is-a</strong>关系，如支票账户是(is
a)账户的特定类型，故适合使用继承
组合最适合<strong>has-a</strong>关系，如一个银行具有(has
a)有一组他管理的账户，该组账户是它的一个属性，而不会继承</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Bank</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;a bank has accounts&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #005CC5">__init__</span><span style="color: #24292E">(self):</span></span>
<span class="line"><span style="color: #24292E">     </span><span style="color: #005CC5">self</span><span style="color: #24292E">.accounts</span><span style="color: #D73A49">=</span><span style="color: #24292E">[]   </span><span style="color: #6A737D"># 账户列表</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">open_account</span><span style="color: #24292E">(self, holder, amount, kind </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Account):</span></span>
<span class="line"><span style="color: #24292E">        account </span><span style="color: #D73A49">=</span><span style="color: #24292E"> kind(holder)   </span><span style="color: #6A737D"># 创建某种类型的账户</span></span>
<span class="line"><span style="color: #24292E">        account.deposit(amount)   </span><span style="color: #6A737D"># 存入amount的钱</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.accounts.append(account)   </span><span style="color: #6A737D"># 将创建的账户加入当前银行的账户列表</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> account</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">pay_interest</span><span style="color: #24292E">(self):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6A737D"># 计算列表中的利息</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E"> a </span><span style="color: #D73A49">in</span><span style="color: #24292E"> </span><span style="color: #005CC5">self</span><span style="color: #24292E">.accounts:</span></span>
<span class="line"><span style="color: #24292E">            a.deposit(a.balance</span><span style="color: #D73A49">*</span><span style="color: #24292E">a.interest)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">bank </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Bank()</span></span>
<span class="line"><span style="color: #24292E">john </span><span style="color: #D73A49">=</span><span style="color: #24292E"> bank.open_account(</span><span style="color: #032F62">&#39;john&#39;</span><span style="color: #24292E">, </span><span style="color: #005CC5">10</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">jack </span><span style="color: #D73A49">=</span><span style="color: #24292E"> bank.open_account(</span><span style="color: #032F62">&#39;jack&#39;</span><span style="color: #24292E">, </span><span style="color: #005CC5">5</span><span style="color: #24292E">, CheckingAccount)</span></span>
<span class="line"><span style="color: #24292E">bank.pay_interest()</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(jack.balance)</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(john.balance)</span></span></code></pre></div></div></figure>
<h2 id="多重继承">多重继承</h2>
<p>一个子类可以有多个基类
其中，这里直接调用父类<code>account_holder</code>时，使用<code>super()</code>实现了超类调用，防止破坏多重继承的调用逻辑</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #6A737D"># 类的多重继承</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">SavingsAccount</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Account</span><span style="color: #24292E">):</span></span>
<span class="line"><span style="color: #24292E">    deposit_fee </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">deposit</span><span style="color: #24292E">(self, amount):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> Account.deposit(</span><span style="color: #005CC5">self</span><span style="color: #24292E">, amount</span><span style="color: #D73A49">-</span><span style="color: #005CC5">self</span><span style="color: #24292E">.deposit_fee)</span></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">GoodAccount</span><span style="color: #24292E">(</span><span style="color: #6F42C1">CheckingAccount</span><span style="color: #24292E">, </span><span style="color: #6F42C1">SavingsAccount</span><span style="color: #24292E">):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #005CC5">__init__</span><span style="color: #24292E">(self, account_holder):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">super</span><span style="color: #24292E">().</span><span style="color: #005CC5">__init__</span><span style="color: #24292E">(account_holder)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.holder </span><span style="color: #D73A49">=</span><span style="color: #24292E"> account_holder</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.balance </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>CS61A</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>CS61A</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61A】CS61A——Homework 3</title>
    <url>/CS61A/CS61A%20Homework3/</url>
    <content><![CDATA[<h1 id="homework-3">Homework 3</h1>
<h2 id="q1-num-eights">Q1: Num Eights</h2>
<p>用递归函数求一个数中有几位8</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">num_eights</span><span style="color: #24292E">(n):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Returns the number of times 8 appears as a digit of n.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">num_eights(3)</span></span>
<span class="line"><span style="color: #032F62">    0</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">num_eights(8)</span></span>
<span class="line"><span style="color: #032F62">    1</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">num_eights(88888888)</span></span>
<span class="line"><span style="color: #032F62">    8</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">num_eights(2638)</span></span>
<span class="line"><span style="color: #032F62">    1</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">num_eights(86380)</span></span>
<span class="line"><span style="color: #032F62">    2</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">num_eights(12345)</span></span>
<span class="line"><span style="color: #032F62">    0</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">num_eights(8782089)</span></span>
<span class="line"><span style="color: #032F62">    3</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">from construct_check import check</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62"># ban all assignment statements</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">check(HW_SOURCE_FILE, &#39;num_eights&#39;,</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">... </span><span style="color: #032F62">      [&#39;Assign&#39;, &#39;AnnAssign&#39;, &#39;AugAssign&#39;, &#39;NamedExpr&#39;, &#39;For&#39;, &#39;While&#39;])</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> n</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> n</span><span style="color: #D73A49">%</span><span style="color: #005CC5">10</span><span style="color: #24292E"> </span><span style="color: #D73A49">==</span><span style="color: #005CC5">8</span><span style="color: #24292E">: </span><span style="color: #D73A49">return</span><span style="color: #24292E"> num_eights(n</span><span style="color: #D73A49">//</span><span style="color: #005CC5">10</span><span style="color: #24292E">)</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">else</span><span style="color: #24292E">: </span><span style="color: #D73A49">return</span><span style="color: #24292E"> num_eights(n</span><span style="color: #D73A49">//</span><span style="color: #005CC5">10</span><span style="color: #24292E">)</span></span></code></pre></div></div></figure>
<p>递归出口：每一位都减完后n==0时</p>
<p>每次返回时递归调用自身，传入未判断的部分</p>
<p>若发现该位是8，则返回值加一，否则不变</p>
<h2 id="q2-digit-distance">Q2: Digit Distance</h2>
<p>用递归函数求每两位的差的绝对值之和</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">digit_distance</span><span style="color: #24292E">(n):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Determines the digit distance of n.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">digit_distance(3)</span></span>
<span class="line"><span style="color: #032F62">    0</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">digit_distance(777)</span></span>
<span class="line"><span style="color: #032F62">    0</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">digit_distance(314)</span></span>
<span class="line"><span style="color: #032F62">    5</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">digit_distance(31415926535)</span></span>
<span class="line"><span style="color: #032F62">    32</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">digit_distance(3464660003)</span></span>
<span class="line"><span style="color: #032F62">    16</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">from construct_check import check</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62"># ban all loops</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">check(HW_SOURCE_FILE, &#39;digit_distance&#39;,</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">... </span><span style="color: #032F62">      [&#39;For&#39;, &#39;While&#39;])</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> n</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">10</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        res,last </span><span style="color: #D73A49">=</span><span style="color: #24292E"> n</span><span style="color: #D73A49">//</span><span style="color: #005CC5">10</span><span style="color: #24292E">,n</span><span style="color: #D73A49">%</span><span style="color: #005CC5">10</span></span>
<span class="line"><span style="color: #24292E">        sec_last </span><span style="color: #D73A49">=</span><span style="color: #24292E"> res</span><span style="color: #D73A49">%</span><span style="color: #005CC5">10</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> digit_distance(res)</span><span style="color: #D73A49">+</span><span style="color: #005CC5">abs</span><span style="color: #24292E">(sec_last</span><span style="color: #D73A49">-</span><span style="color: #24292E">last)</span></span></code></pre></div></div></figure>
<p>递归出口：当查到最后一位时绝对值为0，返回0</p>
<p>否则将最后一位与倒数第二位取出，将取完最后一位的剩余部分传入递归函数继续判断，返回值加上两位数绝对值之差</p>
<h2 id="q3-interleaved-sum">Q3: Interleaved Sum</h2>
<p>写一个函数，要求对1-n中的所有奇数传入odd_func，所有偶数传入even_func，返回所有数计算后和</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">interleaved_sum</span><span style="color: #24292E">(n, odd_func, even_func):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Compute the sum odd_func(1) + even_func(2) + odd_func(3) + ..., up</span></span>
<span class="line"><span style="color: #032F62">    to n.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">identity = lambda x: x</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">square = lambda x: x * x</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">triple = lambda x: x * 3</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">interleaved_sum(5, identity, square) # 1   + 2*2 + 3   + 4*4 + 5</span></span>
<span class="line"><span style="color: #032F62">    29</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">interleaved_sum(5, square, identity) # 1*1 + 2   + 3*3 + 4   + 5*5</span></span>
<span class="line"><span style="color: #032F62">    41</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">interleaved_sum(4, triple, square)   # 1*3 + 2*2 + 3*3 + 4*4</span></span>
<span class="line"><span style="color: #032F62">    32</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">interleaved_sum(4, square, triple)   # 1*1 + 2*3 + 3*3 + 4*3</span></span>
<span class="line"><span style="color: #032F62">    28</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">from construct_check import check</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">check(HW_SOURCE_FILE, &#39;interleaved_sum&#39;, [&#39;While&#39;, &#39;For&#39;, &#39;Mod&#39;]) # ban loops and %</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">check_num</span><span style="color: #24292E">(k):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> k</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">n:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">elif</span><span style="color: #24292E"> k</span><span style="color: #D73A49">==</span><span style="color: #24292E">n:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> odd_func(k)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> check_num(k</span><span style="color: #D73A49">+</span><span style="color: #005CC5">2</span><span style="color: #24292E">)</span><span style="color: #D73A49">+</span><span style="color: #24292E">odd_func(k)</span><span style="color: #D73A49">+</span><span style="color: #24292E">even_func(k</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> check_num(</span><span style="color: #005CC5">1</span><span style="color: #24292E">)</span></span></code></pre></div></div></figure>
<p>由于题目不让使用循环与取模运算判断奇偶，我们只能使用递归函数</p>
<p>由于奇数与偶数是分开的，我们可以发现，奇数+2=奇数，奇数+1=偶数</p>
<p>因此我们可以写一个内嵌函数，让一个计数变量k从1开始，将k传入odd_func，k+1传入even_func</p>
<p>然后递归调用该函数从k+2开始</p>
<p>递归出口即k&gt;n或k=n（此时k一定为奇数，直接传入odd_func并返回）</p>
<h2 id="q4-count-coins">Q4: Count Coins</h2>
<p>给予n刀乐，把他分为面值分别为1刀乐，5刀乐，10刀乐，25刀乐的四种货币，输出分法数</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">count_coins</span><span style="color: #24292E">(total):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Return the number of ways to make change using coins of value of 1, 5, 10, 25.</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">count_coins(15)</span></span>
<span class="line"><span style="color: #032F62">    6</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">count_coins(10)</span></span>
<span class="line"><span style="color: #032F62">    4</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">count_coins(20)</span></span>
<span class="line"><span style="color: #032F62">    9</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">count_coins(100) # How many ways to make change for a dollar?</span></span>
<span class="line"><span style="color: #032F62">    242</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">count_coins(200)</span></span>
<span class="line"><span style="color: #032F62">    1463</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">from construct_check import check</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62"># ban iteration</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">check(HW_SOURCE_FILE, &#39;count_coins&#39;, [&#39;While&#39;, &#39;For&#39;])</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">cal</span><span style="color: #24292E">(total,spl_coin):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> total</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">elif</span><span style="color: #24292E"> total</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">0</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">elif</span><span style="color: #24292E"> spl_coin</span><span style="color: #D73A49">==</span><span style="color: #005CC5">None</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">            with_coin </span><span style="color: #D73A49">=</span><span style="color: #24292E"> cal(total</span><span style="color: #D73A49">-</span><span style="color: #24292E">spl_coin,spl_coin)</span></span>
<span class="line"><span style="color: #24292E">            without_coin </span><span style="color: #D73A49">=</span><span style="color: #24292E"> cal(total,next_smaller_coin(spl_coin))</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> with_coin</span><span style="color: #D73A49">+</span><span style="color: #24292E">without_coin</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> cal(total,</span><span style="color: #005CC5">25</span><span style="color: #24292E">)</span></span></code></pre></div></div></figure>
<h2 id="q5-towers-of-hanoi">Q5: Towers of Hanoi</h2>
<p>实现汉诺塔游戏并描述每次移动过程</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">move_stack</span><span style="color: #24292E">(n, start, end):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Print the moves required to move n disks on the start pole to the end</span></span>
<span class="line"><span style="color: #032F62">    pole without violating the rules of Towers of Hanoi.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    n -- number of disks</span></span>
<span class="line"><span style="color: #032F62">    start -- a pole position, either 1, 2, or 3</span></span>
<span class="line"><span style="color: #032F62">    end -- a pole position, either 1, 2, or 3</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    There are exactly three poles, and start and end must be different. Assume</span></span>
<span class="line"><span style="color: #032F62">    that the start pole has at least n disks of increasing size, and the end</span></span>
<span class="line"><span style="color: #032F62">    pole is either empty or has a top disk larger than the top n start disks.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">move_stack(1, 1, 3)</span></span>
<span class="line"><span style="color: #032F62">    Move the top disk from rod 1 to rod 3</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">move_stack(2, 1, 3)</span></span>
<span class="line"><span style="color: #032F62">    Move the top disk from rod 1 to rod 2</span></span>
<span class="line"><span style="color: #032F62">    Move the top disk from rod 1 to rod 3</span></span>
<span class="line"><span style="color: #032F62">    Move the top disk from rod 2 to rod 3</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">move_stack(3, 1, 3)</span></span>
<span class="line"><span style="color: #032F62">    Move the top disk from rod 1 to rod 3</span></span>
<span class="line"><span style="color: #032F62">    Move the top disk from rod 1 to rod 2</span></span>
<span class="line"><span style="color: #032F62">    Move the top disk from rod 3 to rod 2</span></span>
<span class="line"><span style="color: #032F62">    Move the top disk from rod 1 to rod 3</span></span>
<span class="line"><span style="color: #032F62">    Move the top disk from rod 2 to rod 1</span></span>
<span class="line"><span style="color: #032F62">    Move the top disk from rod 2 to rod 3</span></span>
<span class="line"><span style="color: #032F62">    Move the top disk from rod 1 to rod 3</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">assert</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E"> start </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E"> </span><span style="color: #005CC5">3</span><span style="color: #24292E"> </span><span style="color: #D73A49">and</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E"> end </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E"> </span><span style="color: #005CC5">3</span><span style="color: #24292E"> </span><span style="color: #D73A49">and</span><span style="color: #24292E"> start </span><span style="color: #D73A49">!=</span><span style="color: #24292E"> end, </span><span style="color: #032F62">&quot;Bad start/end&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">hanoi</span><span style="color: #24292E">(n,start,mid,end):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> n </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">            print_move(start, end)</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">            hanoi(n </span><span style="color: #D73A49">-</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">, start,end, mid)</span></span>
<span class="line"><span style="color: #24292E">            hanoi(</span><span style="color: #005CC5">1</span><span style="color: #24292E">,start,mid,end)</span></span>
<span class="line"><span style="color: #24292E">            hanoi(n </span><span style="color: #D73A49">-</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">, mid, start,end)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> hanoi(n,start,</span><span style="color: #005CC5">6</span><span style="color: #D73A49">-</span><span style="color: #24292E">start</span><span style="color: #D73A49">-</span><span style="color: #24292E">end,end)</span></span></code></pre></div></div></figure>
<p>详见五点七边讲解<a
href="https://www.bilibili.com/video/BV1C14y1V77j/?share_source=copy_web&amp;vd_source=d51bc147506d4e930a5fca5c791cb3d8">视频</a></p>
]]></content>
      <categories>
        <category>CS61A</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>CS61A</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61A】CS61A——Lab4</title>
    <url>/CS61A/CS61A%20Lab4/</url>
    <content><![CDATA[<p><em>Dictionaries 部分跳过</em></p>
<h1 id="divide">Divide</h1>
<p>传入一组商数与一组除数，返回字典，键为每个商数，值为表示每个商数能整除的除数的列表</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">divide</span><span style="color: #24292E">(quotients, divisors):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Return a dictonary in which each quotient q is a key for the list of</span></span>
<span class="line"><span style="color: #032F62">    divisors that it divides evenly.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">divide([3, 4, 5], [8, 9, 10, 11, 12])</span></span>
<span class="line"><span style="color: #032F62">    {3: [9, 12], 4: [8, 12], 5: [10]}</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">divide(range(1, 5), range(20, 25))</span></span>
<span class="line"><span style="color: #032F62">    {1: [20, 21, 22, 23, 24], 2: [20, 22, 24], 3: [21, 24], 4: [20, 24]}</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> {i: [x </span><span style="color: #D73A49">for</span><span style="color: #24292E"> x </span><span style="color: #D73A49">in</span><span style="color: #24292E"> divisors </span><span style="color: #D73A49">if</span><span style="color: #24292E"> x</span><span style="color: #D73A49">%</span><span style="color: #24292E">i</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">] </span><span style="color: #D73A49">for</span><span style="color: #24292E"> i </span><span style="color: #D73A49">in</span><span style="color: #24292E"> quotients}</span></span></code></pre></div></div></figure>
<p>注意用表达式建立列表与字典的方法</p>
<h1 id="buying-fruit">Buying Fruit</h1>
<p>实现buy函数，通过给定的水果与价格，用恰好为传入的total_amount的价格购买指定的水果（每种指定水果至少买一次）
用display函数输出所有结果</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">buy</span><span style="color: #24292E">(required_fruits, prices, total_amount):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Print ways to buy some of each fruit so that the sum of prices is amount.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">prices = {&#39;oranges&#39;: 4, &#39;apples&#39;: 3, &#39;bananas&#39;: 2, &#39;kiwis&#39;: 9}</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">buy([&#39;apples&#39;, &#39;oranges&#39;, &#39;bananas&#39;], prices, 12)</span></span>
<span class="line"><span style="color: #032F62">    [2 apples][1 orange][1 banana]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">buy([&#39;apples&#39;, &#39;oranges&#39;, &#39;bananas&#39;], prices, 16)</span></span>
<span class="line"><span style="color: #032F62">    [2 apples][1 orange][3 bananas]</span></span>
<span class="line"><span style="color: #032F62">    [2 apples][2 oranges][1 banana]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">buy([&#39;apples&#39;, &#39;kiwis&#39;], prices, 36)</span></span>
<span class="line"><span style="color: #032F62">    [3 apples][3 kiwis]</span></span>
<span class="line"><span style="color: #032F62">    [6 apples][2 kiwis]</span></span>
<span class="line"><span style="color: #032F62">    [9 apples][1 kiwi]</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">add</span><span style="color: #24292E">(fruits, amount, cart):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> fruits </span><span style="color: #D73A49">==</span><span style="color: #24292E"> [] </span><span style="color: #D73A49">and</span><span style="color: #24292E"> amount </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #005CC5">print</span><span style="color: #24292E">(cart)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">elif</span><span style="color: #24292E"> fruits </span><span style="color: #D73A49">and</span><span style="color: #24292E"> amount </span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">            fruit </span><span style="color: #D73A49">=</span><span style="color: #24292E"> fruits[</span><span style="color: #005CC5">0</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #24292E">            price </span><span style="color: #D73A49">=</span><span style="color: #24292E"> prices[fruit]</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">for</span><span style="color: #24292E"> k </span><span style="color: #D73A49">in</span><span style="color: #24292E"> </span><span style="color: #005CC5">range</span><span style="color: #24292E">(</span><span style="color: #005CC5">1</span><span style="color: #24292E">,amount</span><span style="color: #D73A49">//</span><span style="color: #24292E">price</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">):</span></span>
<span class="line"><span style="color: #24292E">                add(fruits[</span><span style="color: #005CC5">1</span><span style="color: #24292E">:], amount</span><span style="color: #D73A49">-</span><span style="color: #24292E">k</span><span style="color: #D73A49">*</span><span style="color: #24292E">price, cart</span><span style="color: #D73A49">+</span><span style="color: #24292E">display(fruit,k))</span></span>
<span class="line"><span style="color: #24292E">    add(required_fruits, total_amount, </span><span style="color: #032F62">&#39;&#39;</span><span style="color: #24292E">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">display</span><span style="color: #24292E">(fruit, count):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Display a count of a fruit in square brackets.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">display(&#39;apples&#39;, 3)</span></span>
<span class="line"><span style="color: #032F62">    &#39;[3 apples]&#39;</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">display(&#39;apples&#39;, 1)</span></span>
<span class="line"><span style="color: #032F62">    &#39;[1 apple]&#39;</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">assert</span><span style="color: #24292E"> count </span><span style="color: #D73A49">&gt;=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E"> </span><span style="color: #D73A49">and</span><span style="color: #24292E"> fruit[</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">] </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;s&#39;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> count </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        fruit </span><span style="color: #D73A49">=</span><span style="color: #24292E"> fruit[:</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">]  </span><span style="color: #6A737D"># get rid of the plural s</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;[&#39;</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">str</span><span style="color: #24292E">(count) </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39; &#39;</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> fruit </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;]&#39;</span></span></code></pre></div></div></figure>
<p>返回条件是fruits为空或钱被花光，且递归时每次都取fruits的首个元素
可以推断递归时对fruits数组进行了切片，每次往后切一个元素
for循环遍历选择每个水果的个数，从至少选一个到最多能选的个数<span
class="math inline">\(\frac{amount}{price}+1\)</span>
递归时传入总价格减去已经使用的价格数的不同情况，并使用display函数进行字符串拼接来显示</p>
<h1 id="cities-adt">Cities ADT</h1>
<p>以下问题基于建立的该ADT
一个城市由以下参数描述：<strong>名称、经度、维度</strong>
包括一个构造函数 -
<code>make_city(name, lat, lon)</code>：建立一个城市对象，存储其名称、经度、维度
以下选择器 - <code>get_name(city)</code>：获取城市名称 -
<code>get_lat(city)</code>：获取城市经度 -
<code>get_lon(city)</code>：获取城市维度
该抽象数据类型已经在文件中实现，你不需要知道是怎么实现的</p>
<h1 id="distance">Distance</h1>
<p>计算并返回两城市的距离</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">from</span><span style="color: #24292E"> math </span><span style="color: #D73A49">import</span><span style="color: #24292E"> sqrt</span></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">distance</span><span style="color: #24292E">(city_a, city_b):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">city_a = make_city(&#39;city_a&#39;, 0, 1)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">city_b = make_city(&#39;city_b&#39;, 0, 2)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">distance(city_a, city_b)</span></span>
<span class="line"><span style="color: #032F62">    1.0</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">city_c = make_city(&#39;city_c&#39;, 6.5, 12)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">city_d = make_city(&#39;city_d&#39;, 2.5, 15)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">distance(city_c, city_d)</span></span>
<span class="line"><span style="color: #032F62">    5.0</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> sqrt(</span><span style="color: #005CC5">abs</span><span style="color: #24292E">(get_lat(city_a)</span><span style="color: #D73A49">-</span><span style="color: #24292E">get_lat(city_b))</span><span style="color: #D73A49">**</span><span style="color: #005CC5">2</span><span style="color: #D73A49">+</span><span style="color: #005CC5">abs</span><span style="color: #24292E">(get_lon(city_a)</span><span style="color: #D73A49">-</span><span style="color: #24292E">get_lon(city_b))</span><span style="color: #D73A49">**</span><span style="color: #005CC5">2</span><span style="color: #24292E">)</span></span></code></pre></div></div></figure>
<h1 id="closer-city">Closer City</h1>
<p>比较两个城市离给定经纬度的远近，返回更近的那个城市</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">closer_city</span><span style="color: #24292E">(lat, lon, city_a, city_b):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #032F62">    Returns the name of either city_a or city_b, whichever is closest to</span></span>
<span class="line"><span style="color: #032F62">    coordinate (lat, lon). If the two cities are the same distance away</span></span>
<span class="line"><span style="color: #032F62">    from the coordinate, consider city_b to be the closer city.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">berkeley = make_city(&#39;Berkeley&#39;, 37.87, 112.26)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">stanford = make_city(&#39;Stanford&#39;, 34.05, 118.25)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">closer_city(38.33, 121.44, berkeley, stanford)</span></span>
<span class="line"><span style="color: #032F62">    &#39;Stanford&#39;</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">bucharest = make_city(&#39;Bucharest&#39;, 44.43, 26.10)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">vienna = make_city(&#39;Vienna&#39;, 48.20, 16.37)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">closer_city(41.29, 174.78, bucharest, vienna)</span></span>
<span class="line"><span style="color: #032F62">    &#39;Bucharest&#39;</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    fake_city </span><span style="color: #D73A49">=</span><span style="color: #24292E"> make_city(</span><span style="color: #032F62">&#39;fake&#39;</span><span style="color: #24292E">, lat, lon)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> distance(fake_city,city_a)</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">distance(fake_city,city_b):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> get_name(city_a)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> get_name(city_b)</span></span></code></pre></div></div></figure>
<p>可以将指定的经纬度看作第三个城市并构造这么一个对象
通过上面已经写完的distance函数计算两城市与第三个城市的距离并比较，输出更近的
若相同输出city_b</p>
]]></content>
      <categories>
        <category>CS61A</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>CS61A</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61A】CS61A——Lab3</title>
    <url>/CS61A/CS61A%20Lab3/</url>
    <content><![CDATA[<p><em>WWPD部分省略</em></p>
<h1 id="print-if">Print If</h1>
<p>返回列表中满足函数f的元素</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">print_if</span><span style="color: #24292E">(s, f):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Print each element of s for which f returns a true value.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">print_if([3, 4, 5, 6], lambda x: x &gt; 4)</span></span>
<span class="line"><span style="color: #032F62">    5</span></span>
<span class="line"><span style="color: #032F62">    6</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">result = print_if([3, 4, 5, 6], lambda x: x % 2 == 0)</span></span>
<span class="line"><span style="color: #032F62">    4</span></span>
<span class="line"><span style="color: #032F62">    6</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">print(result)  # print_if should return None</span></span>
<span class="line"><span style="color: #032F62">    None</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> x </span><span style="color: #D73A49">in</span><span style="color: #24292E"> s:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> f(x):</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #005CC5">print</span><span style="color: #24292E">(x)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">None</span></span></code></pre></div></div></figure>
<h1 id="close">Close</h1>
<p>返回列表中元素大小与下标差的绝对值小于规定值的元素个数</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">close</span><span style="color: #24292E">(s, k):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Return how many elements of s that are within k of their index.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">t = [6, 2, 4, 3, 5]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">close(t, 0)  # Only 3 is equal to its index</span></span>
<span class="line"><span style="color: #032F62">    1</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">close(t, 1)  # 2, 3, and 5 are within 1 of their index</span></span>
<span class="line"><span style="color: #032F62">    3</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">close(t, 2)  # 2, 3, 4, and 5 are all within 2 of their index</span></span>
<span class="line"><span style="color: #032F62">    4</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">close(list(range(10)), 0)</span></span>
<span class="line"><span style="color: #032F62">    10</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    count </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> i </span><span style="color: #D73A49">in</span><span style="color: #24292E"> </span><span style="color: #005CC5">range</span><span style="color: #24292E">(</span><span style="color: #005CC5">len</span><span style="color: #24292E">(s)):  </span><span style="color: #6A737D"># Use a range to loop over indices</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> </span><span style="color: #005CC5">abs</span><span style="color: #24292E">(s[i]</span><span style="color: #D73A49">-</span><span style="color: #24292E">i)</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">k :</span></span>
<span class="line"><span style="color: #24292E">            count</span><span style="color: #D73A49">+=</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> count</span></span></code></pre></div></div></figure>
<h1 id="close-list">Close List</h1>
<p>返回一个列表，元素为给定列表中元素大小与下标差的绝对值小于规定值的元素</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">close_list</span><span style="color: #24292E">(s, k):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Return a list of the elements of s that are within k of their index.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">t = [6, 2, 4, 3, 5]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">close_list(t, 0)  # Only 3 is equal to its index</span></span>
<span class="line"><span style="color: #032F62">    [3]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">close_list(t, 1)  # 2, 3, and 5 are within 1 of their index</span></span>
<span class="line"><span style="color: #032F62">    [2, 3, 5]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">close_list(t, 2)  # 2, 3, 4, and 5 are all within 2 of their index</span></span>
<span class="line"><span style="color: #032F62">    [2, 4, 3, 5]</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> [s[i] </span><span style="color: #D73A49">for</span><span style="color: #24292E"> i </span><span style="color: #D73A49">in</span><span style="color: #24292E"> </span><span style="color: #005CC5">range</span><span style="color: #24292E">(</span><span style="color: #005CC5">len</span><span style="color: #24292E">(s)) </span><span style="color: #D73A49">if</span><span style="color: #24292E"> s[i]</span><span style="color: #D73A49">-</span><span style="color: #24292E">i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">k]</span></span></code></pre></div></div></figure>
<h1 id="squares-only">Squares Only</h1>
<p>返回一个列表，元素为给定列表中为完全平方数的元素</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">from</span><span style="color: #24292E"> math </span><span style="color: #D73A49">import</span><span style="color: #24292E"> sqrt</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">squares</span><span style="color: #24292E">(s):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Returns a new list containing square roots of the elements of the</span></span>
<span class="line"><span style="color: #032F62">    original list that are perfect squares.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">seq = [8, 49, 8, 9, 2, 1, 100, 102]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">squares(seq)</span></span>
<span class="line"><span style="color: #032F62">    [7, 3, 1, 10]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">seq = [500, 30]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">squares(seq)</span></span>
<span class="line"><span style="color: #032F62">    []</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> [</span><span style="color: #005CC5">int</span><span style="color: #24292E">(sqrt(n)) </span><span style="color: #D73A49">for</span><span style="color: #24292E"> n </span><span style="color: #D73A49">in</span><span style="color: #24292E"> s </span><span style="color: #D73A49">if</span><span style="color: #24292E"> sqrt(n)</span><span style="color: #D73A49">==</span><span style="color: #005CC5">round</span><span style="color: #24292E">(sqrt(n))]</span></span></code></pre></div></div></figure>
<p>注意返回的是开方后的数，是整数</p>
<h1 id="double-eights">Double Eights</h1>
<p>使用递归判断给定的数中是否存在相邻的两个8</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">double_eights</span><span style="color: #24292E">(n):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot; Returns whether or not n has two digits in row that</span></span>
<span class="line"><span style="color: #032F62">    are the number 8. Assume n has at least two digits in it.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">double_eights(1288)</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">double_eights(880)</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">double_eights(538835)</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">double_eights(284682)</span></span>
<span class="line"><span style="color: #032F62">    False</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">double_eights(588138)</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">double_eights(78)</span></span>
<span class="line"><span style="color: #032F62">    False</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">from construct_check import check</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62"># ban iteration</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">check(LAB_SOURCE_FILE, &#39;double_eights&#39;, [&#39;While&#39;, &#39;For&#39;])</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> n</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">False</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> n</span><span style="color: #D73A49">%</span><span style="color: #005CC5">100</span><span style="color: #D73A49">==</span><span style="color: #005CC5">88</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">True</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> double_eights(n</span><span style="color: #D73A49">//</span><span style="color: #005CC5">10</span><span style="color: #24292E">)</span></span></code></pre></div></div></figure>
<h1 id="making-onions">Making Onions</h1>
<p>判断是否能通过f函数与g函数进行至多limit次操作实现将x转化为y</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">make_onion</span><span style="color: #24292E">(f, g):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Return a function can_reach(x, y, limit) that returns</span></span>
<span class="line"><span style="color: #032F62">    whether some call expression containing only f, g, and x with</span></span>
<span class="line"><span style="color: #032F62">    up to limit calls will give the result y.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">up = lambda x: x + 1</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">double = lambda y: y * 2</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">can_reach = make_onion(up, double)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">can_reach(5, 25, 4)      # 25 = up(double(double(up(5))))</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">can_reach(5, 25, 3)      # Not possible</span></span>
<span class="line"><span style="color: #032F62">    False</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">can_reach(1, 1, 0)      # 1 = 1</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">add_ing = lambda x: x + &quot;ing&quot;</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">add_end = lambda y: y + &quot;end&quot;</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">can_reach_string = make_onion(add_ing, add_end)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">can_reach_string(&quot;cry&quot;, &quot;crying&quot;, 1)      # &quot;crying&quot; = add_ing(&quot;cry&quot;)</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">can_reach_string(&quot;un&quot;, &quot;unending&quot;, 3)     # &quot;unending&quot; = add_ing(add_end(&quot;un&quot;))</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">can_reach_string(&quot;peach&quot;, &quot;folding&quot;, 4)   # Not possible</span></span>
<span class="line"><span style="color: #032F62">    False</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">can_reach</span><span style="color: #24292E">(x, y, limit):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> limit </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">False</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">elif</span><span style="color: #24292E"> x </span><span style="color: #D73A49">==</span><span style="color: #24292E"> y:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">True</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> can_reach(f(x), y, limit </span><span style="color: #D73A49">-</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">) </span><span style="color: #D73A49">or</span><span style="color: #24292E"> can_reach(g(x), y, limit </span><span style="color: #D73A49">-</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> can_reach</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>CS61A</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>CS61A</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61A】CS61A——Lab2</title>
    <url>/CS61A/CS61A%20Lab2/</url>
    <content><![CDATA[<p><em>WWPD部分省略</em></p>
<h1 id="composite-identity-function">Composite Identity Function</h1>
<p>题意：写一个函数，传入f与g两个函数，返回一个含有参数x的函数，用于判断<span
class="math inline">\(f(g(x))\)</span>是否等于<span
class="math inline">\(g(f(x))\)</span></p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">composite_identity</span><span style="color: #24292E">(f, g):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #032F62">    Return a function with one parameter x that returns True if f(g(x)) is</span></span>
<span class="line"><span style="color: #032F62">    equal to g(f(x)). You can assume the result of g(x) is a valid input for f</span></span>
<span class="line"><span style="color: #032F62">    and vice versa.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">add_one = lambda x: x + 1        # adds one to x</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">square = lambda x: x**2          # squares x [returns x^2]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">b1 = composite_identity(square, add_one)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">b1(0)                            # (0 + 1) ** 2 == 0 ** 2 + 1</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">b1(4)                            # (4 + 1) ** 2 != 4 ** 2 + 1</span></span>
<span class="line"><span style="color: #032F62">    False</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">lambda</span><span style="color: #24292E"> x: f(g(x))</span><span style="color: #D73A49">==</span><span style="color: #24292E">g(f(x))</span></span></code></pre></div></div></figure>
<p>按照题意返回一个lambda函数，传入x即可</p>
<h1 id="count-cond">Count Cond</h1>
<blockquote>
<p>predicate function: 返回True或False的函数</p>
</blockquote>
<p>题意：写一个函数，传入一个两个参数的predicate function
<em>condition</em>，返回一个含有参数n的函数，判断1-n中有几个数满足condition函数</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">count_cond</span><span style="color: #24292E">(condition):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Returns a function with one parameter N that counts all the numbers from</span></span>
<span class="line"><span style="color: #032F62">    1 to N that satisfy the two-argument predicate function Condition, where</span></span>
<span class="line"><span style="color: #032F62">    the first argument for Condition is N and the second argument is the</span></span>
<span class="line"><span style="color: #032F62">    number from 1 to N.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">count_fives = count_cond(lambda n, i: sum_digits(n * i) == 5)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">count_fives(10)   # 50 (10 * 5)</span></span>
<span class="line"><span style="color: #032F62">    1</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">count_fives(50)   # 50 (50 * 1), 500 (50 * 10), 1400 (50 * 28), 2300 (50 * 46)</span></span>
<span class="line"><span style="color: #032F62">    4</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">is_i_prime = lambda n, i: is_prime(i) # need to pass 2-argument function into count_cond</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">count_primes = count_cond(is_i_prime)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">count_primes(2)    # 2</span></span>
<span class="line"><span style="color: #032F62">    1</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">count_primes(3)    # 2, 3</span></span>
<span class="line"><span style="color: #032F62">    2</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">count_primes(4)    # 2, 3</span></span>
<span class="line"><span style="color: #032F62">    2</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">count_primes(5)    # 2, 3, 5</span></span>
<span class="line"><span style="color: #032F62">    3</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">count_primes(20)   # 2, 3, 5, 7, 11, 13, 17, 19</span></span>
<span class="line"><span style="color: #032F62">    8</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">judge</span><span style="color: #24292E">(n):</span></span>
<span class="line"><span style="color: #24292E">        cnt </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E"> i </span><span style="color: #D73A49">in</span><span style="color: #24292E"> </span><span style="color: #005CC5">range</span><span style="color: #24292E">(</span><span style="color: #005CC5">1</span><span style="color: #24292E">,n</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">):</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">if</span><span style="color: #24292E"> condition(n,i):</span></span>
<span class="line"><span style="color: #24292E">                cnt</span><span style="color: #D73A49">+=</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> cnt</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> judge</span></span></code></pre></div></div></figure>
<p>遍历1-n，传入condition函数并计数即可</p>
<p>注意返回的是函数，传入n</p>
<h1 id="multiple">Multiple</h1>
<p>题意：写一个函数求参数a，b的最小公倍数</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">multiple</span><span style="color: #24292E">(a, b):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Return the smallest number n that is a multiple of both a and b.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">multiple(3, 4)</span></span>
<span class="line"><span style="color: #032F62">    12</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">multiple(14, 21)</span></span>
<span class="line"><span style="color: #032F62">    42</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">gcd</span><span style="color: #24292E">(a,b):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> b</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> a</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> gcd(b,a</span><span style="color: #D73A49">%</span><span style="color: #24292E">b)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> a</span><span style="color: #D73A49">*</span><span style="color: #24292E">b</span><span style="color: #D73A49">//</span><span style="color: #24292E">gcd(a,b)</span></span></code></pre></div></div></figure>
<p>辗转相除法求gcd，用gcd求lcm</p>
<h1 id="i-heard-you-liked-functions">I Heard You Liked Functions…</h1>
<p>题意：定义一个函数传入三个函数f1,f2,f3，返回一个参数为n的函数g，函数g返回一个参数为x的函数h</p>
<p>函数x将会循环传给函数f1，f2，f3，具体如下：</p>
<p>n=0时返回x，n=1时返回f1(x)，n=2时返回f2(f1(x))，n=3时返回f3(f2(f1(x)))，n=4时返回f1(f3(f2(f1(x))))，以此类推</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">cycle</span><span style="color: #24292E">(f1, f2, f3):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Returns a function that is itself a higher-order function.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">def add1(x):</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">... </span><span style="color: #032F62">    return x + 1</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">def times2(x):</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">... </span><span style="color: #032F62">    return x * 2</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">def add3(x):</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">... </span><span style="color: #032F62">    return x + 3</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">my_cycle = cycle(add1, times2, add3)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">identity = my_cycle(0)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">identity(5)</span></span>
<span class="line"><span style="color: #032F62">    5</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">add_one_then_double = my_cycle(2)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">add_one_then_double(1)</span></span>
<span class="line"><span style="color: #032F62">    4</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">do_all_functions = my_cycle(3)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">do_all_functions(2)</span></span>
<span class="line"><span style="color: #032F62">    9</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">do_more_than_a_cycle = my_cycle(4)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">do_more_than_a_cycle(2)</span></span>
<span class="line"><span style="color: #032F62">    10</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">do_two_cycles = my_cycle(6)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">do_two_cycles(1)</span></span>
<span class="line"><span style="color: #032F62">    19</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">g</span><span style="color: #24292E">(n):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">h</span><span style="color: #24292E">(f,g):</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">lambda</span><span style="color: #24292E"> x: f(g(x))</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> n</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">lambda</span><span style="color: #24292E"> x : x</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">elif</span><span style="color: #24292E"> n</span><span style="color: #D73A49">==</span><span style="color: #005CC5">1</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> f1</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">            temp </span><span style="color: #D73A49">=</span><span style="color: #24292E"> f1</span></span>
<span class="line"><span style="color: #24292E">            i</span><span style="color: #D73A49">=</span><span style="color: #005CC5">2</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">while</span><span style="color: #24292E"> i</span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E">n:</span></span>
<span class="line"><span style="color: #24292E">                </span><span style="color: #D73A49">if</span><span style="color: #24292E"> i</span><span style="color: #D73A49">%</span><span style="color: #005CC5">3</span><span style="color: #D73A49">==</span><span style="color: #005CC5">1</span><span style="color: #24292E">: temp</span><span style="color: #D73A49">=</span><span style="color: #24292E"> h(f1,temp)</span></span>
<span class="line"><span style="color: #24292E">                </span><span style="color: #D73A49">elif</span><span style="color: #24292E"> i</span><span style="color: #D73A49">%</span><span style="color: #005CC5">3</span><span style="color: #D73A49">==</span><span style="color: #005CC5">2</span><span style="color: #24292E">: temp</span><span style="color: #D73A49">=</span><span style="color: #24292E"> h(f2,temp)</span></span>
<span class="line"><span style="color: #24292E">                </span><span style="color: #D73A49">else</span><span style="color: #24292E">: temp</span><span style="color: #D73A49">=</span><span style="color: #24292E"> h(f3,temp)</span></span>
<span class="line"><span style="color: #24292E">                i</span><span style="color: #D73A49">+=</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> temp</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> g</span></span></code></pre></div></div></figure>
<p>遍历1-n，每次取模3来判断该套哪个函数，注意0和1时特判，2开始从f1往外套</p>
<p>即执行顺序为<span class="math inline">\(i\%3=2 -&gt; i\%3=0 -&gt;
i\%3=1 -&gt; ...\)</span></p>
]]></content>
      <categories>
        <category>CS61A</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>CS61A</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61A】CS61A——Lab5</title>
    <url>/CS61A/CS61A%20Lab5/</url>
    <content><![CDATA[<p><em>WWPD部分省略</em></p>
<h1 id="q2-insert-items">Q2: Insert Items</h1>
<p>实现一个函数，传入列表，一个值<code>before</code>，一个值<code>after</code>，在列表中每个等于<code>before</code>的之后插入<code>after</code></p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">insert_items</span><span style="color: #24292E">(s, before, after):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Insert after into s after each occurrence of before and then return s.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">test_s = [1, 5, 8, 5, 2, 3]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">new_s = insert_items(test_s, 5, 7)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">new_s</span></span>
<span class="line"><span style="color: #032F62">    [1, 5, 7, 8, 5, 7, 2, 3]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">test_s</span></span>
<span class="line"><span style="color: #032F62">    [1, 5, 7, 8, 5, 7, 2, 3]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">new_s is test_s</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">double_s = [1, 2, 1, 2, 3, 3]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">double_s = insert_items(double_s, 3, 4)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">double_s</span></span>
<span class="line"><span style="color: #032F62">    [1, 2, 1, 2, 3, 4, 3, 4]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">large_s = [1, 4, 8]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">large_s2 = insert_items(large_s, 4, 4)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">large_s2</span></span>
<span class="line"><span style="color: #032F62">    [1, 4, 4, 8]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">large_s3 = insert_items(large_s2, 4, 6)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">large_s3</span></span>
<span class="line"><span style="color: #032F62">    [1, 4, 6, 4, 6, 8]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">large_s3 is large_s</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    idx </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E"> idx</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">len</span><span style="color: #24292E">(s):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> s[idx]</span><span style="color: #D73A49">==</span><span style="color: #24292E">before:</span></span>
<span class="line"><span style="color: #24292E">            s.insert(idx</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">,after)</span></span>
<span class="line"><span style="color: #24292E">            idx</span><span style="color: #D73A49">+=</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">        idx</span><span style="color: #D73A49">+=</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> s</span></span></code></pre></div></div></figure>
<p>注意：</p>
<ul>
<li>在<code>before==after</code>时，可能会一直在相同元素后添加相同元素，导致死循环</li>
<li>需要在每次相等时手动让idx向后移动一位</li>
<li>且需要判断长度防止死循环</li>
</ul>
<h1 id="q3-group-by">Q3: Group By</h1>
<p>实现函数，传入列表s与函数fn，返回一个字典</p>
<p>字典的值为s的元素，键为fn(e)，且对相同fn(e)的的元素在同一个列表中</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">group_by</span><span style="color: #24292E">(s, fn):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Return a dictionary of lists that together contain the elements of s.</span></span>
<span class="line"><span style="color: #032F62">    The key for each list is the value that fn returns when called on any of the</span></span>
<span class="line"><span style="color: #032F62">    values of that list.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">group_by([12, 23, 14, 45], lambda p: p // 10)</span></span>
<span class="line"><span style="color: #032F62">    {1: [12, 14], 2: [23], 4: [45]}</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">group_by(range(-3, 4), lambda x: x * x)</span></span>
<span class="line"><span style="color: #032F62">    {9: [-3, 3], 4: [-2, 2], 1: [-1, 1], 0: [0]}</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    grouped </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {}</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> val </span><span style="color: #D73A49">in</span><span style="color: #24292E"> s:</span></span>
<span class="line"><span style="color: #24292E">        key </span><span style="color: #D73A49">=</span><span style="color: #24292E"> fn(val)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> key </span><span style="color: #D73A49">in</span><span style="color: #24292E"> grouped:</span></span>
<span class="line"><span style="color: #24292E">            grouped[key].append(val)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">            grouped[key] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [val]</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> grouped</span></span></code></pre></div></div></figure>
<p>遍历s，计算key值，若存在则直接添加到key对应val的列表中，若无则创建列表并填入该值</p>
<h1 id="q5-count-occurrences">Q5: Count Occurrences</h1>
<p>实现一个函数，传入一个迭代器t，整数n和值x，返回前n个t中和x相等的的数值的个数</p>
<blockquote>
<p>注意：在t上调用next n次，确保至少在t中有n个元素</p>
</blockquote>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">count_occurrences</span><span style="color: #24292E">(t, n, x):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Return the number of times that x is equal to one of the</span></span>
<span class="line"><span style="color: #032F62">    first n elements of iterator t.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">s = iter([10, 9, 10, 9, 9, 10, 8, 8, 8, 7])</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">count_occurrences(s, 10, 9)</span></span>
<span class="line"><span style="color: #032F62">    3</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">t = iter([10, 9, 10, 9, 9, 10, 8, 8, 8, 7])</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">count_occurrences(t, 3, 10)</span></span>
<span class="line"><span style="color: #032F62">    2</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">u = iter([3, 2, 2, 2, 1, 2, 1, 4, 4, 5, 5, 5])</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">count_occurrences(u, 1, 3)  # Only iterate over 3</span></span>
<span class="line"><span style="color: #032F62">    1</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">count_occurrences(u, 3, 2)  # Only iterate over 2, 2, 2</span></span>
<span class="line"><span style="color: #032F62">    3</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">list(u)                     # Ensure that the iterator has advanced the right amount</span></span>
<span class="line"><span style="color: #032F62">    [1, 2, 1, 4, 4, 5, 5, 5]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">v = iter([4, 1, 6, 6, 7, 7, 6, 6, 2, 2, 2, 5])</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">count_occurrences(v, 6, 6)</span></span>
<span class="line"><span style="color: #032F62">    2</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    cnt </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">    times </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E"> cnt</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">n:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> </span><span style="color: #005CC5">next</span><span style="color: #24292E">(t)</span><span style="color: #D73A49">==</span><span style="color: #24292E"> x:</span></span>
<span class="line"><span style="color: #24292E">            times</span><span style="color: #D73A49">+=</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">        cnt</span><span style="color: #D73A49">+=</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> times</span></span></code></pre></div></div></figure>
<p>注意提前跳出循环一次，防止迭代器到尾后返回traceback</p>
<h1 id="q6-repeated">Q6: Repeated</h1>
<p>实现函数，传入迭代器t与一个大于1的整数k，返回t中第一个连续出现k次的元素</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">repeated</span><span style="color: #24292E">(t, k):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Return the first value in iterator t that appears k times in a row,</span></span>
<span class="line"><span style="color: #032F62">    calling next on t as few times as possible.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">s = iter([10, 9, 10, 9, 9, 10, 8, 8, 8, 7])</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">repeated(s, 2)</span></span>
<span class="line"><span style="color: #032F62">    9</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">t = iter([10, 9, 10, 9, 9, 10, 8, 8, 8, 7])</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">repeated(t, 3)</span></span>
<span class="line"><span style="color: #032F62">    8</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">u = iter([3, 2, 2, 2, 1, 2, 1, 4, 4, 5, 5, 5])</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">repeated(u, 3)</span></span>
<span class="line"><span style="color: #032F62">    2</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">repeated(u, 3)</span></span>
<span class="line"><span style="color: #032F62">    5</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">v = iter([4, 1, 6, 6, 7, 7, 8, 8, 2, 2, 2, 5])</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">repeated(v, 3)</span></span>
<span class="line"><span style="color: #032F62">    2</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">assert</span><span style="color: #24292E"> k </span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">    pre </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">    cnt </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E"> </span><span style="color: #005CC5">True</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        cur </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">next</span><span style="color: #24292E">(t)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> cur </span><span style="color: #D73A49">==</span><span style="color: #24292E"> pre:</span></span>
<span class="line"><span style="color: #24292E">            cnt</span><span style="color: #D73A49">+=</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">            cnt</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">        pre </span><span style="color: #D73A49">=</span><span style="color: #24292E"> cur</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> cnt </span><span style="color: #D73A49">==</span><span style="color: #24292E"> k:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> cur</span></span></code></pre></div></div></figure>
<p>一开始想用两个迭代器，但是不会复制</p>
<p>每次调用迭代器的next值，并保存前一个值，每次比较</p>
<p>若前后相同，则计数重复+1，否则还原为1（自身重复一次）</p>
<h1 id="q7-sprout-leaves">Q7: Sprout Leaves</h1>
<p>传入一颗树，与新的叶子节点，使该树延伸出对应叶子节点，通过print_tree输出</p>
<p>如<code>t = tree(1, [tree(2), tree(3, [tree(4)])])</code></p>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">  1</span></span>
<span class="line"><span style="color: #24292e"> / \</span></span>
<span class="line"><span style="color: #24292e">2   3</span></span>
<span class="line"><span style="color: #24292e">    |</span></span>
<span class="line"><span style="color: #24292e">    4</span></span></code></pre></div></div></figure>
<p>调用<code>sprout_leaves(t, [5, 6])</code>后打印出树如下</p>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292e">     1</span></span>
<span class="line"><span style="color: #24292e">   /   \</span></span>
<span class="line"><span style="color: #24292e">  2     3</span></span>
<span class="line"><span style="color: #24292e"> / \    |</span></span>
<span class="line"><span style="color: #24292e">5   6   4</span></span>
<span class="line"><span style="color: #24292e">       / \</span></span>
<span class="line"><span style="color: #24292e">      5   6</span></span></code></pre></div></div></figure>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">sprout_leaves</span><span style="color: #24292E">(t, leaves):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Sprout new leaves containing the labels in leaves at each leaf of</span></span>
<span class="line"><span style="color: #032F62">    the original tree t and return the resulting tree.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">t1 = tree(1, [tree(2), tree(3)])</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">print_tree(t1)</span></span>
<span class="line"><span style="color: #032F62">    1</span></span>
<span class="line"><span style="color: #032F62">      2</span></span>
<span class="line"><span style="color: #032F62">      3</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">new1 = sprout_leaves(t1, [4, 5])</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">print_tree(new1)</span></span>
<span class="line"><span style="color: #032F62">    1</span></span>
<span class="line"><span style="color: #032F62">      2</span></span>
<span class="line"><span style="color: #032F62">        4</span></span>
<span class="line"><span style="color: #032F62">        5</span></span>
<span class="line"><span style="color: #032F62">      3</span></span>
<span class="line"><span style="color: #032F62">        4</span></span>
<span class="line"><span style="color: #032F62">        5</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">t2 = tree(1, [tree(2, [tree(3)])])</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">print_tree(t2)</span></span>
<span class="line"><span style="color: #032F62">    1</span></span>
<span class="line"><span style="color: #032F62">      2</span></span>
<span class="line"><span style="color: #032F62">        3</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">new2 = sprout_leaves(t2, [6, 1, 2])</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">print_tree(new2)</span></span>
<span class="line"><span style="color: #032F62">    1</span></span>
<span class="line"><span style="color: #032F62">      2</span></span>
<span class="line"><span style="color: #032F62">        3</span></span>
<span class="line"><span style="color: #032F62">          6</span></span>
<span class="line"><span style="color: #032F62">          1</span></span>
<span class="line"><span style="color: #032F62">          2</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> is_leaf(t):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> tree(label(t), [tree(leaf) </span><span style="color: #D73A49">for</span><span style="color: #24292E"> leaf </span><span style="color: #D73A49">in</span><span style="color: #24292E"> leaves])</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> tree(label(t), [sprout_leaves(s, leaves) </span><span style="color: #D73A49">for</span><span style="color: #24292E"> s </span><span style="color: #D73A49">in</span><span style="color: #24292E"> branches(t)])</span></span></code></pre></div></div></figure>
<h1 id="q8-partial-reverse">Q8: Partial Reverse</h1>
<p>实现函数，传入列表s与起始元素start，将start到列表末尾的元素反转</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">partial_reverse</span><span style="color: #24292E">(s, start):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Reverse part of a list in-place, starting with start up to the end of</span></span>
<span class="line"><span style="color: #032F62">    the list.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">a = [1, 2, 3, 4, 5, 6, 7]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">partial_reverse(a, 2)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">a</span></span>
<span class="line"><span style="color: #032F62">    [1, 2, 7, 6, 5, 4, 3]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">partial_reverse(a, 5)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">a</span></span>
<span class="line"><span style="color: #032F62">    [1, 2, 7, 6, 5, 3, 4]</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    end </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">len</span><span style="color: #24292E">(s)</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E"> start </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> end:</span></span>
<span class="line"><span style="color: #24292E">        s[start], s[end] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> s[end], s[start]</span></span>
<span class="line"><span style="color: #24292E">        start</span><span style="color: #D73A49">+=</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">        end</span><span style="color: #D73A49">-=</span><span style="color: #005CC5">1</span></span></code></pre></div></div></figure>
<p>使用序列解包，交换两个元素可以通过<code>a,b=b,a</code>实现</p>
]]></content>
      <categories>
        <category>CS61A</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>CS61A</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61A】CS61A——Lab6</title>
    <url>/CS61A/CS61A%20Lab6/</url>
    <content><![CDATA[<h1 id="lab-6">Lab 6</h1>
<h2 id="q1-bank-account">Q1: Bank Account</h2>
<p>扩充Account类，添加属性<code>transaction</code>，即一个<code>transaction</code>列表实例，每一次调用都会创建一个该实例，记录每次调用<code>deposit</code>和<code>withdraw</code>前后的余额。另外，每个<code>transaction</code>有一个<code>id</code>属性，记录之前账户对<code>deposit</code>或<code>withdraw</code>的调用次数。<code>id</code>对于每个账户内是唯一的，而不是在所有<code>transaction</code>中的全局标识符</p>
<p><code>transaction</code>有两个方法：</p>
<ul>
<li>changed：若在调用前后balance发生变化则返回True，否则返回False</li>
<li>report：返回一个字符串用来描述该次transaction，以id开始，之后返回消息</li>
</ul>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Transaction</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #005CC5">__init__</span><span style="color: #24292E">(self, id, before, after):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.id </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">id</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.before </span><span style="color: #D73A49">=</span><span style="color: #24292E"> before</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.after </span><span style="color: #D73A49">=</span><span style="color: #24292E"> after</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">changed</span><span style="color: #24292E">(self):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #032F62">&quot;&quot;&quot;Return whether the transaction resulted in a changed balance.&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> </span><span style="color: #005CC5">self</span><span style="color: #24292E">.before </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">self</span><span style="color: #24292E">.after:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">False</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">else</span><span style="color: #24292E"> :</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">True</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">report</span><span style="color: #24292E">(self):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #032F62">&quot;&quot;&quot;Return a string describing the transaction.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">        </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">Transaction(3, 20, 10).report()</span></span>
<span class="line"><span style="color: #032F62">        &#39;3: decreased 20-&gt;10&#39;</span></span>
<span class="line"><span style="color: #032F62">        </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">Transaction(4, 20, 50).report()</span></span>
<span class="line"><span style="color: #032F62">        &#39;4: increased 20-&gt;50&#39;</span></span>
<span class="line"><span style="color: #032F62">        </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">Transaction(5, 50, 50).report()</span></span>
<span class="line"><span style="color: #032F62">        &#39;5: no change&#39;</span></span>
<span class="line"><span style="color: #032F62">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">        msg </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;no change&#39;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> </span><span style="color: #005CC5">self</span><span style="color: #24292E">.changed():</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">if</span><span style="color: #24292E"> </span><span style="color: #005CC5">self</span><span style="color: #24292E">.before </span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">self</span><span style="color: #24292E">.after:</span></span>
<span class="line"><span style="color: #24292E">                msg </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;decreased &#39;</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">str</span><span style="color: #24292E">(</span><span style="color: #005CC5">self</span><span style="color: #24292E">.before)</span><span style="color: #D73A49">+</span><span style="color: #032F62">&#39;-&gt;&#39;</span><span style="color: #D73A49">+</span><span style="color: #005CC5">str</span><span style="color: #24292E">(</span><span style="color: #005CC5">self</span><span style="color: #24292E">.after)</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">else</span><span style="color: #24292E"> :</span></span>
<span class="line"><span style="color: #24292E">                msg </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;increased &#39;</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">str</span><span style="color: #24292E">(</span><span style="color: #005CC5">self</span><span style="color: #24292E">.before) </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;-&gt;&#39;</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">str</span><span style="color: #24292E">(</span><span style="color: #005CC5">self</span><span style="color: #24292E">.after)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">str</span><span style="color: #24292E">(</span><span style="color: #005CC5">self</span><span style="color: #24292E">.id) </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;: &#39;</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> msg</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Account</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;A bank account that tracks its transaction history.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">a = Account(&#39;Eric&#39;)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">a.deposit(100)    # Transaction 0 for a</span></span>
<span class="line"><span style="color: #032F62">    100</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">b = Account(&#39;Erica&#39;)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">a.withdraw(30)    # Transaction 1 for a</span></span>
<span class="line"><span style="color: #032F62">    70</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">a.deposit(10)     # Transaction 2 for a</span></span>
<span class="line"><span style="color: #032F62">    80</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">b.deposit(50)     # Transaction 0 for b</span></span>
<span class="line"><span style="color: #032F62">    50</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">b.withdraw(10)    # Transaction 1 for b</span></span>
<span class="line"><span style="color: #032F62">    40</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">a.withdraw(100)   # Transaction 3 for a</span></span>
<span class="line"><span style="color: #032F62">    &#39;Insufficient funds&#39;</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">len(a.transactions)</span></span>
<span class="line"><span style="color: #032F62">    4</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">len([t for t in a.transactions if t.changed()])</span></span>
<span class="line"><span style="color: #032F62">    3</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">for t in a.transactions:</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">... </span><span style="color: #032F62">    print(t.report())</span></span>
<span class="line"><span style="color: #032F62">    0: increased 0-&gt;100</span></span>
<span class="line"><span style="color: #032F62">    1: decreased 100-&gt;70</span></span>
<span class="line"><span style="color: #032F62">    2: increased 70-&gt;80</span></span>
<span class="line"><span style="color: #032F62">    3: no change</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">b.withdraw(100)   # Transaction 2 for b</span></span>
<span class="line"><span style="color: #032F62">    &#39;Insufficient funds&#39;</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">b.withdraw(30)    # Transaction 3 for b</span></span>
<span class="line"><span style="color: #032F62">    10</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">for t in b.transactions:</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">... </span><span style="color: #032F62">    print(t.report())</span></span>
<span class="line"><span style="color: #032F62">    0: increased 0-&gt;50</span></span>
<span class="line"><span style="color: #032F62">    1: decreased 50-&gt;40</span></span>
<span class="line"><span style="color: #032F62">    2: no change</span></span>
<span class="line"><span style="color: #032F62">    3: decreased 40-&gt;10</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># *** YOU NEED TO MAKE CHANGES IN SEVERAL PLACES IN THIS CLASS ***</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #005CC5">__init__</span><span style="color: #24292E">(self, account_holder):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.balance </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.holder </span><span style="color: #D73A49">=</span><span style="color: #24292E"> account_holder</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.counter </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.transactions </span><span style="color: #D73A49">=</span><span style="color: #24292E"> []</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">id_gene</span><span style="color: #24292E">(self):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.counter</span><span style="color: #D73A49">+=</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #005CC5">self</span><span style="color: #24292E">.counter</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">deposit</span><span style="color: #24292E">(self, amount):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #032F62">&quot;&quot;&quot;Increase the account balance by amount, add the deposit</span></span>
<span class="line"><span style="color: #032F62">        to the transaction history, and return the new balance.</span></span>
<span class="line"><span style="color: #032F62">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">        pre </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">self</span><span style="color: #24292E">.balance</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.balance </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">self</span><span style="color: #24292E">.balance </span><span style="color: #D73A49">+</span><span style="color: #24292E"> amount</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.transactions.append(Transaction(</span><span style="color: #005CC5">next</span><span style="color: #24292E">(</span><span style="color: #005CC5">self</span><span style="color: #24292E">.id_gene()),pre, </span><span style="color: #005CC5">self</span><span style="color: #24292E">.balance))</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">self</span><span style="color: #24292E">.balance</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">withdraw</span><span style="color: #24292E">(self, amount):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #032F62">&quot;&quot;&quot;Decrease the account balance by amount, add the withdraw</span></span>
<span class="line"><span style="color: #032F62">        to the transaction history, and return the new balance.</span></span>
<span class="line"><span style="color: #032F62">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> amount </span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">self</span><span style="color: #24292E">.balance:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #005CC5">self</span><span style="color: #24292E">.transactions.append(Transaction(</span><span style="color: #005CC5">next</span><span style="color: #24292E">(</span><span style="color: #005CC5">self</span><span style="color: #24292E">.id_gene()), </span><span style="color: #005CC5">self</span><span style="color: #24292E">.balance, </span><span style="color: #005CC5">self</span><span style="color: #24292E">.balance))</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;Insufficient funds&#39;</span></span>
<span class="line"><span style="color: #24292E">        pre </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">self</span><span style="color: #24292E">.balance</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.balance </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">self</span><span style="color: #24292E">.balance </span><span style="color: #D73A49">-</span><span style="color: #24292E"> amount</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.transactions.append(Transaction(</span><span style="color: #005CC5">next</span><span style="color: #24292E">(</span><span style="color: #005CC5">self</span><span style="color: #24292E">.id_gene()), pre, </span><span style="color: #005CC5">self</span><span style="color: #24292E">.balance))</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">self</span><span style="color: #24292E">.balance</span></span></code></pre></div></div></figure>
<h2 id="q2-email">Q2: Email</h2>
<p>一个邮箱系统包括三个类：<code>Email</code>, <code>Server</code>,
<code>Client</code></p>
<p><code>Client</code>类可以<code>compose</code>邮件，该邮件会被<code>send</code>到<code>Server</code>类中</p>
<p><code>Server</code>类会把该邮件运到对应<code>Client</code>的<code>inbox</code>中，为了实现这个，一个<code>Server</code>类拥有一个字典<code>clients</code>，将<code>Email</code>中的<code>recipient_name</code>与拥有该名称的<code>Client</code>对象绑定</p>
<p>注意：client永远不会更改其使用的<code>server</code></p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Email</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;An email has the following instance attributes:</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">        msg (str): the contents of the message</span></span>
<span class="line"><span style="color: #032F62">        sender (Client): the client that sent the email</span></span>
<span class="line"><span style="color: #032F62">        recipient_name (str): the name of the recipient (another client)</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #005CC5">__init__</span><span style="color: #24292E">(self, msg, sender, recipient_name):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.msg </span><span style="color: #D73A49">=</span><span style="color: #24292E"> msg</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.sender </span><span style="color: #D73A49">=</span><span style="color: #24292E"> sender</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.recipient_name </span><span style="color: #D73A49">=</span><span style="color: #24292E"> recipient_name</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Server</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Each Server has one instance attribute called clients that is a</span></span>
<span class="line"><span style="color: #032F62">    dictionary from client names to client objects.</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #005CC5">__init__</span><span style="color: #24292E">(self):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.clients </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">send</span><span style="color: #24292E">(self, email):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #032F62">&quot;&quot;&quot;Append the email to the inbox of the client it is addressed to.&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.clients[email.recipient_name].inbox.append(email)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">register_client</span><span style="color: #24292E">(self, client):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #032F62">&quot;&quot;&quot;Add a client to the dictionary of clients.&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.clients[client.name] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> client</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Client</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;A client has a server, a name (str), and an inbox (list).</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">s = Server()</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">a = Client(s, &#39;Alice&#39;)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">b = Client(s, &#39;Bob&#39;)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">a.compose(&#39;Hello, World!&#39;, &#39;Bob&#39;)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">b.inbox[0].msg</span></span>
<span class="line"><span style="color: #032F62">    &#39;Hello, World!&#39;</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">a.compose(&#39;CS 61A Rocks!&#39;, &#39;Bob&#39;)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">len(b.inbox)</span></span>
<span class="line"><span style="color: #032F62">    2</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">b.inbox[1].msg</span></span>
<span class="line"><span style="color: #032F62">    &#39;CS 61A Rocks!&#39;</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">b.inbox[1].sender.name</span></span>
<span class="line"><span style="color: #032F62">    &#39;Alice&#39;</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #005CC5">__init__</span><span style="color: #24292E">(self, server, name):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.inbox </span><span style="color: #D73A49">=</span><span style="color: #24292E"> []</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.server </span><span style="color: #D73A49">=</span><span style="color: #24292E"> server</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.name </span><span style="color: #D73A49">=</span><span style="color: #24292E"> name</span></span>
<span class="line"><span style="color: #24292E">        server.register_client(</span><span style="color: #005CC5">self</span><span style="color: #24292E">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">compose</span><span style="color: #24292E">(self, message, recipient_name):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #032F62">&quot;&quot;&quot;Send an email with the given message to the recipient.&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">        email </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Email(message, </span><span style="color: #005CC5">self</span><span style="color: #24292E">, recipient_name)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.server.send(email)</span></span></code></pre></div></div></figure>
<p>这里的inbox存储的是每一个email实例，故传参时应传入self</p>
<h2 id="q3-make-change">Q3: Make Change</h2>
<p>实现<code>make_change</code>函数，输入amount和coins字典</p>
<p>coins字典的键是一个正整数，表示面额；值也是一个正整数，表示硬币数量，如<code>&#123;1:4, 5:2&#125;</code>表示四个便士和两个五分</p>
<p>函数返回列表，其中元素是求和能达到amount数量的硬币列表，其中每种面额k最多使用<code>coins[k]</code>次</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">make_change</span><span style="color: #24292E">(amount, coins):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Return a list of coins that sum to amount, preferring the smallest coins</span></span>
<span class="line"><span style="color: #032F62">    available and placing the smallest coins first in the returned list.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    The coins argument is a dictionary with keys that are positive integer</span></span>
<span class="line"><span style="color: #032F62">    denominations and values that are positive integer coin counts.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">make_change(2, {2: 1})</span></span>
<span class="line"><span style="color: #032F62">    [2]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">make_change(2, {1: 2, 2: 1})</span></span>
<span class="line"><span style="color: #032F62">    [1, 1]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">make_change(4, {1: 2, 2: 1})</span></span>
<span class="line"><span style="color: #032F62">    [1, 1, 2]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">make_change(4, {2: 1}) == None</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">coins = {2: 2, 3: 2, 4: 3, 5: 1}</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">make_change(4, coins)</span></span>
<span class="line"><span style="color: #032F62">    [2, 2]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">make_change(8, coins)</span></span>
<span class="line"><span style="color: #032F62">    [2, 2, 4]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">make_change(25, coins)</span></span>
<span class="line"><span style="color: #032F62">    [2, 3, 3, 4, 4, 4, 5]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">coins[8] = 1</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">make_change(25, coins)</span></span>
<span class="line"><span style="color: #032F62">    [2, 2, 4, 4, 5, 8]</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> </span><span style="color: #D73A49">not</span><span style="color: #24292E"> coins:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">None</span></span>
<span class="line"><span style="color: #24292E">    smallest </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">min</span><span style="color: #24292E">(coins)</span></span>
<span class="line"><span style="color: #24292E">    rest </span><span style="color: #D73A49">=</span><span style="color: #24292E"> remove_one(coins, smallest)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> amount </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> smallest:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">None</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">elif</span><span style="color: #24292E"> amount </span><span style="color: #D73A49">==</span><span style="color: #24292E"> smallest:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> [smallest]</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        temp </span><span style="color: #D73A49">=</span><span style="color: #24292E"> make_change(amount</span><span style="color: #D73A49">-</span><span style="color: #24292E">smallest, rest)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> </span><span style="color: #D73A49">not</span><span style="color: #24292E"> temp:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> make_change(amount, rest)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">else</span><span style="color: #24292E"> :</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> [smallest]</span><span style="color: #D73A49">+</span><span style="color: #24292E">temp</span></span></code></pre></div></div></figure>
<p>首先尝试使用最小面额的coin，但若无法实现则尝试使用更大面额</p>
<p>具体步骤：</p>
<ul>
<li><p>进入函数默认使用一个最小面额硬币</p></li>
<li><p>若<code>amount==samllest</code>：最小面额硬币即可满足需求，返回包含该值的列表</p></li>
<li><p>否则，递归调用<code>make_change(amount-smallest, rest)</code>，减去一次最小面额</p></li>
<li><p>若返回一个列表，则将该最小面额放入列表，并继续递归调用，将其返回的列表接在后面</p></li>
<li><p>若返回None，则表明使用最小面额无法实现，故递归调用<code>make_change(amount, rest)</code>，让函数把最小面额硬币去除后使用更大面额尝试</p></li>
</ul>
<h2 id="q4-change-machine">Q4: Change Machine</h2>
<p>完成<code>ChangeMachine</code>类中的<code>change</code>方法，每个该类的实例包含了一些coins，一开始都是便士。<code>change</code>方法传入正整数coin，把他添加到<code>coins</code>中，并返回列表，其中的硬币面额之和要达到cin</p>
<p>该类倾向于使用尽可能多的最小面额硬币</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ChangeMachine</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;A change machine holds a certain number of coins, initially all pennies.</span></span>
<span class="line"><span style="color: #032F62">    The change method adds a single coin of some denomination X and returns a</span></span>
<span class="line"><span style="color: #032F62">    list of coins that sums to X. The machine prefers to return the smallest</span></span>
<span class="line"><span style="color: #032F62">    coins available. The total value in the machine never changes, and it can</span></span>
<span class="line"><span style="color: #032F62">    always make change for any coin (perhaps by returning the coin passed in).</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    The coins attribute is a dictionary with keys that are positive integer</span></span>
<span class="line"><span style="color: #032F62">    denominations and values that are positive integer coin counts.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">m = ChangeMachine(2)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">m.coins == {1: 2}</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">m.change(2)</span></span>
<span class="line"><span style="color: #032F62">    [1, 1]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">m.coins == {2: 1}</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">m.change(2)</span></span>
<span class="line"><span style="color: #032F62">    [2]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">m.coins == {2: 1}</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">m.change(3)</span></span>
<span class="line"><span style="color: #032F62">    [3]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">m.coins == {2: 1}</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">m = ChangeMachine(10) # 10 pennies</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">m.coins == {1: 10}</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">m.change(5) # takes a nickel &amp; returns 5 pennies</span></span>
<span class="line"><span style="color: #032F62">    [1, 1, 1, 1, 1]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">m.coins == {1: 5, 5: 1} # 5 pennies &amp; a nickel remain</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">m.change(3)</span></span>
<span class="line"><span style="color: #032F62">    [1, 1, 1]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">m.coins == {1: 2, 3: 1, 5: 1}</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">m.change(2)</span></span>
<span class="line"><span style="color: #032F62">    [1, 1]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">m.change(2) # not enough 1&#39;s remaining; return a 2</span></span>
<span class="line"><span style="color: #032F62">    [2]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">m.coins == {2: 1, 3: 1, 5: 1}</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">m.change(8) # cannot use the 2 to make 8, so use 3 &amp; 5</span></span>
<span class="line"><span style="color: #032F62">    [3, 5]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">m.coins == {2: 1, 8: 1}</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">m.change(1) # return the penny passed in (it&#39;s the smallest)</span></span>
<span class="line"><span style="color: #032F62">    [1]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">m.change(9) # return the 9 passed in (no change possible)</span></span>
<span class="line"><span style="color: #032F62">    [9]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">m.coins == {2: 1, 8: 1}</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">m.change(10)</span></span>
<span class="line"><span style="color: #032F62">    [2, 8]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">m.coins == {10: 1}</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">m = ChangeMachine(9)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">[m.change(k) for k in [2, 2, 3]]</span></span>
<span class="line"><span style="color: #032F62">    [[1, 1], [1, 1], [1, 1, 1]]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">m.coins == {1: 2, 2: 2, 3: 1}</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">m.change(5) # Prefers [1, 1, 3] to [1, 2, 2] (more pennies)</span></span>
<span class="line"><span style="color: #032F62">    [1, 1, 3]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">m.change(7)</span></span>
<span class="line"><span style="color: #032F62">    [2, 5]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">m.coins == {2: 1, 7: 1}</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #005CC5">__init__</span><span style="color: #24292E">(self, pennies):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.coins </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span><span style="color: #005CC5">1</span><span style="color: #24292E">: pennies}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">change</span><span style="color: #24292E">(self, coin):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #032F62">&quot;&quot;&quot;Return change for coin, removing the result from self.coins.&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.coins[coin] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">self</span><span style="color: #24292E">.coins.get(coin, </span><span style="color: #005CC5">0</span><span style="color: #24292E">)</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">        result </span><span style="color: #D73A49">=</span><span style="color: #24292E"> make_change(coin, </span><span style="color: #005CC5">self</span><span style="color: #24292E">.coins)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E"> c </span><span style="color: #D73A49">in</span><span style="color: #24292E"> result:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #005CC5">self</span><span style="color: #24292E">.coins </span><span style="color: #D73A49">=</span><span style="color: #24292E"> remove_one(</span><span style="color: #005CC5">self</span><span style="color: #24292E">.coins, c)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> result</span></span></code></pre></div></div></figure>
<ul>
<li>将加入的coin放入coins字典，注意，这里的键为面额对应数量，而值为面额，故我们用get方法获取传入coin的键，并在此基础上+1（我们可以在第二个参数设置默认值，当没有对应面额时，get会返回设定值而非None）</li>
<li>之后调用<code>make_change</code>方法，获得最小面额能实现达到coin数的硬币列表</li>
<li>使用<code>remove_one</code>将类中已经用过的硬币移除</li>
<li>返回列表</li>
</ul>
]]></content>
      <categories>
        <category>CS61A</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>CS61A</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61A】CS61A——Mutablity</title>
    <url>/CS61A/CS61A%20Mutablity/</url>
    <content><![CDATA[<h1 id="mutablity">Mutablity</h1>
<h2 id="objects">Objects</h2>
<ul>
<li>对象用于表达信息，是一种包含了数据与行为的数据抽象</li>
<li>有属性的东西都可以作为对象，python中一切皆对象</li>
<li>Python中，优先级最高的对象被称为类（class）</li>
<li>面向对象编程（OOP）：
<ul>
<li>对象是OOP的核心</li>
<li>OOP使用一种暗喻来组织大型程序</li>
<li>使用一种特殊语法可以提高程序的可读性与组织</li>
</ul></li>
<li>很多数据操作都是通过对象实现的</li>
<li>对象可以做许多相关的事情，而函数只能做一件事</li>
</ul>
<h2 id="e.g.-string">e.g. String</h2>
<p>字符串是一种表达文本的数据抽象 ### 字符串的表示
目前常见的表示方法是用ASCII与Unicode字符集表示字符
前者包含了控制字符、数字、字母与标点，后者则包含了不同语言中的更多字符</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">from</span><span style="color: #24292E"> unicodedata </span><span style="color: #D73A49">import</span><span style="color: #24292E"> name, lookup</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(name(</span><span style="color: #032F62">&#39;A&#39;</span><span style="color: #24292E">)) </span><span style="color: #6A737D"># 查询字符集中的字符名称</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(lookup(</span><span style="color: #032F62">&#39;BABY&#39;</span><span style="color: #24292E">)) </span><span style="color: #6A737D"># 根据字符名称输出对应字符</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(lookup(</span><span style="color: #032F62">&#39;BABY&#39;</span><span style="color: #24292E">).encode()) </span><span style="color: #6A737D"># 查看该字符的字节编码</span></span></code></pre></div></div></figure>
<pre><code>LATIN CAPITAL LETTER A
👶
b&#39;\xf0\x9f\x91\xb6&#39;</code></pre>
<h2 id="mutation-operations">Mutation Operations</h2>
<h3 id="一些对象是可以改变的">一些对象是可以改变的</h3>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">suits </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [</span><span style="color: #032F62">&#39;coin&#39;</span><span style="color: #24292E">, </span><span style="color: #032F62">&#39;string&#39;</span><span style="color: #24292E">, </span><span style="color: #032F62">&#39;myriad&#39;</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #24292E">original_suits </span><span style="color: #D73A49">=</span><span style="color: #24292E"> suits</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(suits.pop()) </span><span style="color: #6A737D"># 弹出一个元素（默认最后一个）</span></span>
<span class="line"><span style="color: #24292E">suits.remove(</span><span style="color: #032F62">&#39;string&#39;</span><span style="color: #24292E">) </span><span style="color: #6A737D"># 移除指定元素</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(suits)</span></span>
<span class="line"><span style="color: #24292E">suits.append(</span><span style="color: #032F62">&#39;cup&#39;</span><span style="color: #24292E">) </span><span style="color: #6A737D"># 在尾部增加一个元素</span></span>
<span class="line"><span style="color: #24292E">suits.extend([</span><span style="color: #032F62">&#39;sword&#39;</span><span style="color: #24292E">, </span><span style="color: #032F62">&#39;club&#39;</span><span style="color: #24292E">]) </span><span style="color: #6A737D"># 添加序列中的多个元素来拓展列表</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(suits)</span></span>
<span class="line"><span style="color: #24292E">suits[</span><span style="color: #005CC5">2</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;spade&#39;</span></span>
<span class="line"><span style="color: #24292E">suits[</span><span style="color: #005CC5">0</span><span style="color: #24292E">:</span><span style="color: #005CC5">2</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [</span><span style="color: #032F62">&#39;heart&#39;</span><span style="color: #24292E">, </span><span style="color: #032F62">&#39;diamond&#39;</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(original_suits)</span></span></code></pre></div></div></figure>
<pre><code>myriad
[&#39;coin&#39;]
[&#39;coin&#39;, &#39;cup&#39;, &#39;sword&#39;, &#39;club&#39;]
[&#39;heart&#39;, &#39;diamond&#39;, &#39;spade&#39;, &#39;club&#39;]</code></pre>
<p>根据以上代码发现，我们可以对一个对象（suits）进行若干操作来变化其值
而我们在最初将suits与original_suits进行绑定，故变化也会在original_suits中体现
综上，所有指向相同对象的names都会受到<strong>Mutation</strong>的影响，其中这里的mutation指对象发生的变化
只有可变类型的对象才能更改，如列表与字典</p>
<h3 id="函数调用时发生的mutation">函数调用时发生的Mutation</h3>
<p>函数可以更改其作用域中任何可变对象的值</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">mystery</span><span style="color: #24292E">(s):</span></span>
<span class="line"><span style="color: #24292E">    s.pop()</span></span>
<span class="line"><span style="color: #24292E">    s.pop()</span></span>
<span class="line"><span style="color: #24292E">four </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">2</span><span style="color: #24292E">,</span><span style="color: #005CC5">3</span><span style="color: #24292E">,</span><span style="color: #005CC5">4</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #24292E">mystery(four)</span></span></code></pre></div></div></figure>
<p>mystery函数实现了对列表对象值的更改，甚至mystery不需要传入参数，直接更改其所在作用域（全局作用域）中four列表的内容</p>
<h3 id="表达式的mutation">表达式的Mutation</h3>
<p>表达式的值会随着names绑定值或对象的改变而改变</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">x </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">2</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(x</span><span style="color: #D73A49">+</span><span style="color: #24292E">x)</span></span>
<span class="line"><span style="color: #24292E">x.append(</span><span style="color: #005CC5">3</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(x</span><span style="color: #D73A49">+</span><span style="color: #24292E">x)</span></span></code></pre></div></div></figure>
<pre><code>[1, 2, 1, 2]
[1, 2, 3, 1, 2, 3]</code></pre>
<h2 id="tuples">Tuples</h2>
<ul>
<li>元组是一种不可变的序列，使用圆括号包裹起来</li>
<li>实际上，任何以逗号隔开的元素都会被解释成元组，非必须加圆括号</li>
<li>使用<code>tuple()</code>创建元组或将其他序列转化为元组</li>
<li>在单个元素后加一个逗号可以将单个元素转化成元组</li>
<li>元组可以相加，也可以使用成员运算符in来判断元素是否存在</li>
<li>由于元组不可变，可以将其作为字典的键使用</li>
<li>若元组中包含了可变对象，则该对象可以被更改</li>
</ul>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">s </span><span style="color: #D73A49">=</span><span style="color: #24292E"> ([</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">2</span><span style="color: #24292E">],</span><span style="color: #005CC5">3</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">s[</span><span style="color: #005CC5">0</span><span style="color: #24292E">][</span><span style="color: #005CC5">0</span><span style="color: #24292E">]</span><span style="color: #D73A49">=</span><span style="color: #005CC5">4</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(s)</span></span></code></pre></div></div></figure>
<pre><code>([4, 2], 3)</code></pre>
<h2 id="mutation">Mutation</h2>
<h3 id="相同与改变">相同与改变</h3>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [</span><span style="color: #005CC5">10</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #24292E">b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(a</span><span style="color: #D73A49">==</span><span style="color: #24292E">b)</span></span>
<span class="line"><span style="color: #24292E">a.append(</span><span style="color: #005CC5">20</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(a</span><span style="color: #D73A49">==</span><span style="color: #24292E">b)</span></span></code></pre></div></div></figure>
<pre><code>True
True</code></pre>
<p>在这个例子中，我们可以说a与b是<strong>相同的</strong>，因为b与a绑定到了同一个对象，当对其中一个发生变化，另一个也会同时改变</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [</span><span style="color: #005CC5">10</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #24292E">b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [</span><span style="color: #005CC5">10</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(a</span><span style="color: #D73A49">==</span><span style="color: #24292E">b)</span></span>
<span class="line"><span style="color: #24292E">b.append(</span><span style="color: #005CC5">20</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(a</span><span style="color: #D73A49">==</span><span style="color: #24292E">b)</span></span></code></pre></div></div></figure>
<p>在这个例子中，a与b是<strong>不同的</strong>，尽管它们曾有过相同的内容，但对b进行改变后，a会随之改变，因此这时二者便不同了</p>
<h3 id="identity-operators">Identity Operators</h3>
<p><strong>Identity</strong>： <code>&lt;exp0&gt; is &lt;exp1&gt;</code>
当两个表达式指向相同对象时返回True <strong>Equality</strong>
<code>&lt;exp0&gt; == &lt;exp1&gt;</code>
当两个表达式拥有相同值时返回True</p>
<p><strong>相同对象始终拥有相等的值，但反之不一定成立</strong></p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [</span><span style="color: #005CC5">10</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #24292E">b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [</span><span style="color: #005CC5">10</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #24292E">c </span><span style="color: #D73A49">=</span><span style="color: #24292E"> b</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(a </span><span style="color: #D73A49">is</span><span style="color: #24292E"> b)</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(b </span><span style="color: #D73A49">is</span><span style="color: #24292E"> c)</span></span></code></pre></div></div></figure>
<pre><code>False
True</code></pre>
<h3 id="可变对象在函数中的默认值">可变对象在函数中的默认值</h3>
<p>函数中声明的默认值是函数值的一部分，而不是每次调用时才生成
这导致了若该对象是可变的，而且在函数中间进行了修改，则该修改会在下次调用函数时保留
如下面的代码，每次调用增加的值会保留在默认值中</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f</span><span style="color: #24292E">(s</span><span style="color: #D73A49">=</span><span style="color: #24292E">[]):</span></span>
<span class="line"><span style="color: #24292E">    s.append(</span><span style="color: #005CC5">3</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">len</span><span style="color: #24292E">(s)</span></span>
<span class="line"><span style="color: #D73A49">for</span><span style="color: #24292E"> i </span><span style="color: #D73A49">in</span><span style="color: #24292E"> </span><span style="color: #005CC5">range</span><span style="color: #24292E">(</span><span style="color: #005CC5">3</span><span style="color: #24292E">):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">print</span><span style="color: #24292E">(f())</span></span></code></pre></div></div></figure>
<pre><code>1
2
3</code></pre>
<h2 id="mutable-fuctions">Mutable Fuctions</h2>
<p>在函数中使用可变对象可以在多次调用时保留上次操作的值</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">make_withdraw_list</span><span style="color: #24292E">(balance):</span></span>
<span class="line"><span style="color: #24292E">    b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [balance]</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">withdraw</span><span style="color: #24292E">(amount):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> amount </span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> b[</span><span style="color: #005CC5">0</span><span style="color: #24292E">]:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;Insufficient funds&#39;</span></span>
<span class="line"><span style="color: #24292E">        b[</span><span style="color: #005CC5">0</span><span style="color: #24292E">] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> b[</span><span style="color: #005CC5">0</span><span style="color: #24292E">] </span><span style="color: #D73A49">-</span><span style="color: #24292E"> amount</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> b[</span><span style="color: #005CC5">0</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> withdraw</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">withdraw </span><span style="color: #D73A49">=</span><span style="color: #24292E"> make_withdraw_list(</span><span style="color: #005CC5">100</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(withdraw(</span><span style="color: #005CC5">25</span><span style="color: #24292E">))</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(withdraw(</span><span style="color: #005CC5">25</span><span style="color: #24292E">))</span></span>
<span class="line"><span style="color: #24292E">withdraw(</span><span style="color: #005CC5">100</span><span style="color: #24292E">)</span></span></code></pre></div></div></figure>
<pre><code>75
50
&#39;Insufficient funds&#39;</code></pre>
<p>该函数将存款存在作为可变对象的列表中
函数中的withdraw函数始终指向列表b并修改其值，该列表总是这个列表，随着时间其中的内容被更改
为了实现每次更改列表中的值，该函数使用了可变对象来创建了一个可变函数
<img src="images/Lecture15——Mutability/function.png"
alt="function" /></p>
]]></content>
      <categories>
        <category>CS61A</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>CS61A</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61A】CS61A——Objects</title>
    <url>/CS61A/CS61A%20Objects/</url>
    <content><![CDATA[<h1 id="objects">Objects</h1>
<h2 id="oopobject-oriented-programming">OOP(Object-Oriented
Programming)</h2>
<h3 id="类class">类(class)</h3>
<p>定义了某种类型的多个对象该如何表现 ### 对象(object)
类的一个实例，决定该类的类型 ### 方法(method)
在对象上调用的函数，使用点(.)调用 注意
方法不同于函数在于方法特定于对应对象 ### 蕴含理念
将复杂的大型程序组织成小的模块化组件 - 使用数据抽象 -
捆绑多个信息与相关行为 使用分散状态的计算 - 每个对象有自己的本地状态 -
每个对象也知道如何管理自己的本地状态 -
使用<strong>方法</strong>与对象交互 -
几个对象可能属于一个共同<strong>类</strong>的实例 -
不同的类可以相互关联</p>
<h2 id="例lists">例：Lists</h2>
<p>内置的list函数其实是一个类
在可迭代对象上调用list可以创建一个list类的新实例
list类定义了有关list的各种用法： - 方法：append, extend, insert ,etc. -
加法与乘法运算 - 元素查找与赋值</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(</span><span style="color: #005CC5">list</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">s </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">list</span><span style="color: #24292E">(</span><span style="color: #005CC5">range</span><span style="color: #24292E">(</span><span style="color: #005CC5">3</span><span style="color: #24292E">))</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(</span><span style="color: #005CC5">type</span><span style="color: #24292E">(s))</span></span></code></pre></div></div></figure>
<pre><code>&lt;class &#39;list&#39;&gt;
&lt;class &#39;list&#39;&gt;</code></pre>
<h2 id="class-statement">Class Statement</h2>
<p>一个类描述了其实例的行为
例如，我们定义一个银行账户类，实现的功能如下：</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Account</span><span style="color: #24292E">:   </span><span style="color: #6A737D"># 一个类以class开头，并给他命名</span></span>
<span class="line"><span style="color: #24292E">    </span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #005CC5">__init__</span><span style="color: #24292E">(self, account_holder):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #032F62">&#39;&#39;&#39;</span></span>
<span class="line"><span style="color: #032F62">        定义创建类的新实例时会发生什么，即给予对象属性</span></span>
<span class="line"><span style="color: #032F62">        一般使用方法名__init__来构造一个类的实例，调用时自动执行, 该方法有时也被称为构造方法</span></span>
<span class="line"><span style="color: #032F62">        将新实例称为self，并给它分配属性，其中，account_holder是调用时传入的内容</span></span>
<span class="line"><span style="color: #032F62">        &#39;&#39;&#39;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.balance </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.holder </span><span style="color: #D73A49">=</span><span style="color: #24292E"> account_holder</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">deposit</span><span style="color: #24292E">(self, amount):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #032F62">&#39;&#39;&#39;</span></span>
<span class="line"><span style="color: #032F62">        deposit方法调用两个参数</span></span>
<span class="line"><span style="color: #032F62">        self： self是该方法被调用时的类的实例</span></span>
<span class="line"><span style="color: #032F62">        amount：添加的余额</span></span>
<span class="line"><span style="color: #032F62">        &#39;&#39;&#39;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.balance </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">self</span><span style="color: #24292E">.balance </span><span style="color: #D73A49">+</span><span style="color: #24292E"> amount</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">self</span><span style="color: #24292E">.balance   </span><span style="color: #6A737D"># 出现输出时的情况，若没有return则返回None</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">withdraw</span><span style="color: #24292E">(self, amount):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> amount </span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">self</span><span style="color: #24292E">.balance:   </span><span style="color: #6A737D"># 引用balance时要加.,因为其是对象的一个属性</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;Insufficient funds&#39;</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.balance </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">self</span><span style="color: #24292E">.balance </span><span style="color: #D73A49">-</span><span style="color: #24292E"> amount</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">self</span><span style="color: #24292E">.balance</span></span></code></pre></div></div></figure>
<h2 id="creating-instances">Creating Instances</h2>
<h3 id="object-construction">Object Construction</h3>
<p>当一个类被调用时: - 创建一个该类的新的实例 -
<code>__init__</code>方法被调用，其中以新对象作为其中的第一个元素,
一般命名为self, 并带有在调用表达式中的任何额外参数</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Account(</span><span style="color: #032F62">&#39;Alan&#39;</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(a.holder)</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(a.balance)</span></span></code></pre></div></div></figure>
<pre><code>Alan
0</code></pre>
<h3 id="instance-attributes">Instance Attributes</h3>
<p>对象的属性可以通过点号表达式(.)来访问与更改 若属性之前不存在,
也可以为其赋值, 可以在任何时候增加新的属性</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">a.balance </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">12</span><span style="color: #24292E">   </span><span style="color: #6A737D"># 已存在的属性可以被更改</span></span>
<span class="line"><span style="color: #24292E">b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Account(</span><span style="color: #032F62">&#39;Ada&#39;</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">b.balance </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">20</span></span>
<span class="line"><span style="color: #24292E">a.backup </span><span style="color: #D73A49">=</span><span style="color: #24292E"> b   </span><span style="color: #6A737D"># 新属性可以在任何时候添加</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(a.backup.balance)</span></span></code></pre></div></div></figure>
<pre><code>20</code></pre>
<h3 id="object-identity">Object Identity</h3>
<p>每个用户定义类的对象都有一个唯一的标识
标识运算符<code>is</code>与<code>is not</code>可以判断两个表达式是否是相同的对象
使用赋值将一个对象绑定到一个新名称时不会创建一个新对象</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(a </span><span style="color: #D73A49">is</span><span style="color: #24292E"> a)</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(a </span><span style="color: #D73A49">is</span><span style="color: #24292E"> </span><span style="color: #D73A49">not</span><span style="color: #24292E"> b)</span></span>
<span class="line"><span style="color: #24292E">c </span><span style="color: #D73A49">=</span><span style="color: #24292E"> a</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(a </span><span style="color: #D73A49">is</span><span style="color: #24292E"> c)</span></span></code></pre></div></div></figure>
<pre><code>True
True
True</code></pre>
<h2 id="methods">Methods</h2>
<h3 id="invoking-methods">Invoking Methods</h3>
<p>调用方法意味着用点表达式定义类中定义的一个方法
所有调用方法都通过self变量访问对象,所以他们可以访问与操作对象的属性
如deposit方法中定义了两个参数, 但点表达式会自动为方法提供第一个参数</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">tom </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Account(</span><span style="color: #032F62">&#39;Tom&#39;</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #005CC5">print</span><span style="color: #24292E">(tom.deposit(</span><span style="color: #005CC5">100</span><span style="color: #24292E">))  </span><span style="color: #6A737D"># 调用时只需要一个参数, 方法会自动绑定到self(这里是tom)</span></span></code></pre></div></div></figure>
<pre><code>100</code></pre>
]]></content>
      <categories>
        <category>CS61A</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>CS61A</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61A】CS61A——Sequence</title>
    <url>/CS61A/CS61A%20Sequence/</url>
    <content><![CDATA[<h1 id="sequence">Sequence</h1>
<h2 id="lists">Lists</h2>
<p>列表是python中的内置数据类型</p>
<ul>
<li>使用[]创建列表</li>
<li>使用赋值语句命名列表</li>
<li>使用name[下标]访问列表元素(0-index)，或使用getitem(<list>
,<index>)(operator模块)来访问元素</li>
<li>使用len()函数获取元素个数</li>
</ul>
<p>name[下标]是一种元素评估表达式，可以依次评估下标对应元素</p>
<p>列表中的元素可以是表达式，此时列表中的值将绑定为表达式的结果</p>
<p><code>digits = [2//2,2+2,2,2*2]</code></p>
<p>列表间可以相加与相乘（运算符或函数）</p>
<p><code>[2,7]+[1,8,2,8]*2 == [2,7,1,8,2,8,1,8,2,8]</code></p>
<p>列表中的元素可以是任何东西，包括列表</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">pairs </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [[</span><span style="color: #005CC5">10</span><span style="color: #24292E">,</span><span style="color: #005CC5">20</span><span style="color: #24292E">],[</span><span style="color: #005CC5">30</span><span style="color: #24292E">,</span><span style="color: #005CC5">40</span><span style="color: #24292E">]]</span></span>
<span class="line"><span style="color: #24292E">pairs[</span><span style="color: #005CC5">1</span><span style="color: #24292E">][</span><span style="color: #005CC5">0</span><span style="color: #24292E">] </span><span style="color: #6A737D"># 结果是30</span></span></code></pre></div></div></figure>
<h2 id="in运算符">in运算符</h2>
<p>in运算符可以判断某元素是否存在于列表中</p>
<p>not in 运算符可以判断某元素是否不存在于列表中</p>
<p>返回值为True 或 False</p>
<p><strong>这两个运算符寻找的是单独元素，而非子序列</strong></p>
<p>e.g.</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #24292E">digits </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">8</span><span style="color: #24292E">,</span><span style="color: #005CC5">2</span><span style="color: #24292E">,</span><span style="color: #005CC5">8</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #24292E"> </span><span style="color: #D73A49">&gt;&gt;&gt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E"> </span><span style="color: #D73A49">in</span><span style="color: #24292E"> digits</span></span>
<span class="line"><span style="color: #005CC5">True</span></span>
<span class="line"><span style="color: #D73A49">&gt;&gt;&gt;</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;1&#39;</span><span style="color: #24292E"> </span><span style="color: #D73A49">in</span><span style="color: #24292E"> digits</span></span>
<span class="line"><span style="color: #005CC5">False</span></span>
<span class="line"><span style="color: #D73A49">&gt;&gt;&gt;</span><span style="color: #24292E"> [</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">2</span><span style="color: #24292E">] </span><span style="color: #D73A49">in</span><span style="color: #24292E"> [[</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">2</span><span style="color: #24292E">],</span><span style="color: #005CC5">3</span><span style="color: #24292E">,</span><span style="color: #005CC5">4</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #005CC5">True</span></span>
<span class="line"><span style="color: #D73A49">&gt;&gt;&gt;</span><span style="color: #24292E"> [</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">2</span><span style="color: #24292E">] </span><span style="color: #D73A49">in</span><span style="color: #24292E"> [[[</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">2</span><span style="color: #24292E">],</span><span style="color: #005CC5">3</span><span style="color: #24292E">],</span><span style="color: #005CC5">4</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #005CC5">False</span></span></code></pre></div></div></figure>
<h2 id="for-statement">For Statement</h2>
<h3 id="执行过程">执行过程</h3>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">for</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">name</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> </span><span style="color: #D73A49">in</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">expression</span><span style="color: #D73A49">&gt;</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">suite</span><span style="color: #D73A49">&gt;</span></span></code></pre></div></div></figure>
<ul>
<li>执行<expression>，该表达式必须是一个可迭代的量（如一个序列）</li>
<li>对序列中的每个元素，按序进行如下操作：
<ul>
<li>在当前作用域中将每个元素赋给<name></li>
<li>执行<suite>语句块中的语句</li>
</ul></li>
</ul>
<p>### 序列解包</p>
<blockquote>
<p>e.g.寻找序列中相同元素的数对</p>
<p>pairs = [[1,2],[2,2],[3,2],[4,4]]</p>
</blockquote>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">for</span><span style="color: #24292E"> x, y </span><span style="color: #D73A49">in</span><span style="color: #24292E"> paris:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> x</span><span style="color: #D73A49">==</span><span style="color: #24292E">y:</span></span>
<span class="line"><span style="color: #24292E">        same_count</span><span style="color: #D73A49">+=</span><span style="color: #005CC5">1</span></span></code></pre></div></div></figure>
<p>该循环中，for循环会自动将paris中的内层列表中的两个元素赋给x,y两个变量</p>
<h2 id="ranges">Ranges</h2>
<p>range是表示连续整数的序列，通过给出起始与结束值获得范围内的整数</p>
<p><strong>range包括起始值而不包括结束值</strong></p>
<p>用法：<code>range(&lt;起始值(默认为0)&gt;, &lt;结束值&gt;, [步长])</code></p>
<p>作用：</p>
<ul>
<li>计算长度：结束值-起始值</li>
<li>选择元素：起始值+index</li>
<li>作为计数器：用_等当作name而不实际使用它</li>
</ul>
<p>转换列表：使用list() - 列表构造函数</p>
<h2 id="list-comprehension">List Comprehension</h2>
<p>列表中可以写一些语句来构造列表</p>
<p>e.g.1</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">&gt;&gt;&gt;</span><span style="color: #24292E"> odds </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">3</span><span style="color: #24292E">,</span><span style="color: #005CC5">5</span><span style="color: #24292E">,</span><span style="color: #005CC5">7</span><span style="color: #24292E">,</span><span style="color: #005CC5">9</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #D73A49">&gt;&gt;&gt;</span><span style="color: #24292E"> [x</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E"> </span><span style="color: #D73A49">for</span><span style="color: #24292E"> x </span><span style="color: #D73A49">in</span><span style="color: #24292E"> odds]</span></span>
<span class="line"><span style="color: #24292E">[</span><span style="color: #005CC5">2</span><span style="color: #24292E">,</span><span style="color: #005CC5">4</span><span style="color: #24292E">,</span><span style="color: #005CC5">6</span><span style="color: #24292E">,</span><span style="color: #005CC5">8</span><span style="color: #24292E">,</span><span style="color: #005CC5">10</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #D73A49">&gt;&gt;&gt;</span><span style="color: #24292E"> [x </span><span style="color: #D73A49">for</span><span style="color: #24292E"> x </span><span style="color: #D73A49">in</span><span style="color: #24292E"> odds </span><span style="color: #D73A49">if</span><span style="color: #24292E"> </span><span style="color: #005CC5">25</span><span style="color: #D73A49">%</span><span style="color: #24292E">x </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #24292E">[</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">5</span><span style="color: #24292E">]</span></span></code></pre></div></div></figure>
<p>e.g.2 查找某个数的因数</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">divisors</span><span style="color: #24292E">(n):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> [</span><span style="color: #005CC5">1</span><span style="color: #24292E">]</span><span style="color: #D73A49">+</span><span style="color: #24292E">[x </span><span style="color: #D73A49">for</span><span style="color: #24292E"> x </span><span style="color: #D73A49">in</span><span style="color: #24292E"> </span><span style="color: #005CC5">range</span><span style="color: #24292E">(</span><span style="color: #005CC5">2</span><span style="color: #24292E">,n) </span><span style="color: #D73A49">if</span><span style="color: #24292E"> n</span><span style="color: #D73A49">%</span><span style="color: #24292E">x</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">]</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>CS61A</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>CS61A</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61A】CS61A——Representations</title>
    <url>/CS61A/CS61A%20Representations/</url>
    <content><![CDATA[<h1 id="representations">Representations</h1>
<h2 id="string-representations">String Representations</h2>
<p>字符串用来表达语言与程序<br />
Python中，有两种字符串表达 - <code>str</code>：对人类可读 -
<code>repr</code>：对解释器刻可读 这两种一般相同，但也有不同之处<br />
### repr String for an Object
repr函数返回一个python表达式(字符串)，该表达式会评估为一个等同的对象<br />
对一个对象的repr调用eval会给你一个与原始对象等价的对象<br />
调用repr的结果与在python交互界面输出的结果相同</p>
<h3 id="str-string-for-an-object">str String for an Object</h3>
<p>str函数接受任何对象，返回一个字符串，字符串是原始对象的人类可以解释的表示<br />
对表达式调用str的结果与调用print时输出的结果相同</p>
<h2 id="f-strings">F-strings</h2>
<h3 id="string-interpolation">String Interpolation</h3>
<p>字符串插值包括对一些含有表达式的字符串字面量求值 -
可以使用+进行字符串连接实现 <code>'pi starts with'+str(pi)+'...'</code>
- 也可以使用f-string功能实现字符串插值
<code>f'pi starts with &#123;pi&#125;'</code>
花括号中的将会作为表达式看待并给出计算结果 f-string的计算结果包括str
string和子表达式的值</p>
<h2 id="polymorphic-functions">Polymorphic Functions</h2>
<p>多态函数是一种适用于多种数据类型的函数<br />
如str和repr函数都是多态函数，它们接受任何类型的对象<br />
原理：repr调用了一个零参数方法<code>__repr__</code>以便在参数上获取他返回的repr字符串<br />
str同样调用一个 零参数方法<code>__str__</code><br />
对于repr函数：</p>
<ul>
<li>repr函数内部只调用了一个名为repr的类属性，而实例属性<code>__repr__</code>被忽略了</li>
<li>实现如下：</li>
</ul>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #005CC5">repr</span><span style="color: #24292E">(x):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">type</span><span style="color: #24292E">(x).</span><span style="color: #005CC5">__repr__</span><span style="color: #24292E">(x)</span></span></code></pre></div></div></figure>
<p>对于str函数： - 实例属性<code>__str__</code>被忽略了 -
若类上根本没有<code>__str__</code>属性，则调用str只会返回repr返回的内容</p>
<h3 id="interface">Interface</h3>
<p>对象传递信息的方式：通过互相查找属性或方法<br />
属性的查找规则允许不同数据类型通过具有相同属性名称来响应相同信息</p>
<p>共享信息：在许多不同类上引起相似行为的属性名称<br />
接口：一组共享信息与一些规范（表示其含义）</p>
<p>如实现__repr__与__str__的类实现了一个接口，一下是用类来展示该接口的代码</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Ratio</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #005CC5">__init__</span><span style="color: #24292E">(self, n, d):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.numer </span><span style="color: #D73A49">=</span><span style="color: #24292E"> n</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.denom </span><span style="color: #D73A49">=</span><span style="color: #24292E"> d</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #005CC5">__repr__</span><span style="color: #24292E">(self):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;Ratio(</span><span style="color: #005CC5">{0}</span><span style="color: #032F62">, </span><span style="color: #005CC5">{1}</span><span style="color: #032F62">)&#39;</span><span style="color: #24292E">.format(</span><span style="color: #005CC5">self</span><span style="color: #24292E">.numer, </span><span style="color: #005CC5">self</span><span style="color: #24292E">.denom)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #005CC5">__str__</span><span style="color: #24292E">(self):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;</span><span style="color: #005CC5">{0}</span><span style="color: #032F62">/</span><span style="color: #005CC5">{1}</span><span style="color: #032F62">&#39;</span><span style="color: #24292E">.format(</span><span style="color: #005CC5">self</span><span style="color: #24292E">.numer, </span><span style="color: #005CC5">self</span><span style="color: #24292E">.denom)</span></span></code></pre></div></div></figure>
<p>当我们令<code>half = Ratio(1,2)</code>，直接打印half，输出为可读版本，而直接在解释器展示half，就会输出python表达式</p>
<h2 id="special-method-names">Special Method Names</h2>
<p>python中，以两个下划线包围的名字表示它们具有某种内置行为 -
<code>__init__</code>：构造对象时会自动调用的方法 -
<code>__repr__</code>：将对象以python表达式的方式输出，在交互式python界面时用于显示值的方法
- <code>__add__</code>：用于将一个对象加入另一个对象 -
<code>__bool__</code>：用于将一个对象转换为布尔值 -
<code>__float__</code>：用于将一个对象转换为实数
同时，以下代码实现了将两个对象相加</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Ratio</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #005CC5">__init__</span><span style="color: #24292E">(self, n, d):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.numer </span><span style="color: #D73A49">=</span><span style="color: #24292E"> n</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">self</span><span style="color: #24292E">.denom </span><span style="color: #D73A49">=</span><span style="color: #24292E"> d</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #005CC5">__repr__</span><span style="color: #24292E">(self):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;Ratio(</span><span style="color: #005CC5">{0}</span><span style="color: #032F62">, </span><span style="color: #005CC5">{1}</span><span style="color: #032F62">)&#39;</span><span style="color: #24292E">.format(</span><span style="color: #005CC5">self</span><span style="color: #24292E">.numer, </span><span style="color: #005CC5">self</span><span style="color: #24292E">.denom)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #005CC5">__str__</span><span style="color: #24292E">(self):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;</span><span style="color: #005CC5">{0}</span><span style="color: #032F62">/</span><span style="color: #005CC5">{1}</span><span style="color: #032F62">&#39;</span><span style="color: #24292E">.format(</span><span style="color: #005CC5">self</span><span style="color: #24292E">.numer, </span><span style="color: #005CC5">self</span><span style="color: #24292E">.denom)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #005CC5">__add__</span><span style="color: #24292E">(self, other):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> </span><span style="color: #005CC5">isinstance</span><span style="color: #24292E">(other, </span><span style="color: #005CC5">int</span><span style="color: #24292E">):</span></span>
<span class="line"><span style="color: #24292E">            n </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">self</span><span style="color: #24292E">.numer</span><span style="color: #D73A49">+</span><span style="color: #005CC5">self</span><span style="color: #24292E">.denom</span><span style="color: #D73A49">*</span><span style="color: #24292E">other</span></span>
<span class="line"><span style="color: #24292E">            d </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">self</span><span style="color: #24292E">.denom</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">elif</span><span style="color: #24292E"> </span><span style="color: #005CC5">isinstance</span><span style="color: #24292E">(other, Ratio):</span></span>
<span class="line"><span style="color: #24292E">            n </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">self</span><span style="color: #24292E">.numer</span><span style="color: #D73A49">*</span><span style="color: #24292E">other.denom </span><span style="color: #D73A49">+</span><span style="color: #005CC5">self</span><span style="color: #24292E">.denom</span><span style="color: #D73A49">*</span><span style="color: #24292E">other.numer</span></span>
<span class="line"><span style="color: #24292E">            d </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">self</span><span style="color: #24292E">.denom</span><span style="color: #D73A49">*</span><span style="color: #24292E">other.denom</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">elif</span><span style="color: #24292E"> </span><span style="color: #005CC5">isinstance</span><span style="color: #24292E">(other, </span><span style="color: #005CC5">float</span><span style="color: #24292E">):</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">float</span><span style="color: #24292E">(</span><span style="color: #005CC5">self</span><span style="color: #24292E">)</span><span style="color: #D73A49">+</span><span style="color: #24292E">other</span></span>
<span class="line"><span style="color: #24292E">        g </span><span style="color: #D73A49">=</span><span style="color: #24292E"> gcd(n,d)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> Ratio(n</span><span style="color: #D73A49">//</span><span style="color: #24292E">g, d</span><span style="color: #D73A49">//</span><span style="color: #24292E">g)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">__radd__</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">__add__</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #005CC5">__float__</span><span style="color: #24292E">(self):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">self</span><span style="color: #24292E">.numer</span><span style="color: #D73A49">/</span><span style="color: #005CC5">self</span><span style="color: #24292E">.denom</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">gcd</span><span style="color: #24292E">(n, d):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E"> n</span><span style="color: #D73A49">!=</span><span style="color: #24292E">d:</span></span>
<span class="line"><span style="color: #24292E">        n, d </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">min</span><span style="color: #24292E">(n, d), </span><span style="color: #005CC5">abs</span><span style="color: #24292E">(n</span><span style="color: #D73A49">-</span><span style="color: #24292E">d)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> n</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>CS61A</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>CS61A</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61A】CS61A——Tree Recursion</title>
    <url>/CS61A/CS61A%20Tree%20Recursion/</url>
    <content><![CDATA[<h1 id="tree-recursion">Tree Recursion</h1>
<h2 id="order-of-recursive-calls">Order of Recursive Calls</h2>
<h3 id="e.g.1cascade">e.g.1:Cascade</h3>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">cascade</span><span style="color: #24292E">(n):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> n</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">10</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">print</span><span style="color: #24292E">(n)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">print</span><span style="color: #24292E">(n)</span></span>
<span class="line"><span style="color: #24292E">        cascade(n</span><span style="color: #D73A49">//</span><span style="color: #005CC5">10</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">print</span><span style="color: #24292E">(n)</span></span></code></pre></div></div></figure>
<p>结果为</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">&gt;&gt;&gt;</span><span style="color: #24292E"> cascade(</span><span style="color: #005CC5">12345</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #005CC5">12345</span></span>
<span class="line"><span style="color: #005CC5">1234</span></span>
<span class="line"><span style="color: #005CC5">123</span></span>
<span class="line"><span style="color: #005CC5">12</span></span>
<span class="line"><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #005CC5">12</span></span>
<span class="line"><span style="color: #005CC5">123</span></span>
<span class="line"><span style="color: #005CC5">1234</span></span>
<span class="line"><span style="color: #005CC5">12345</span></span></code></pre></div></div></figure>
<p>首先一直调用cascade到底，返回None，从调用入口出来后继续执行cascade下面的语句</p>
<figure>
<img src="Lecture10——Tree%20Recursion/image-20250204215810317.png"
alt="cascade" />
<figcaption aria-hidden="true">cascade</figcaption>
</figure>
<p>还可以缩短为以下</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">cascade_short</span><span style="color: #24292E">(n):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">print</span><span style="color: #24292E">(n)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> n</span><span style="color: #D73A49">&gt;</span><span style="color: #005CC5">10</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        cascade(n</span><span style="color: #D73A49">//</span><span style="color: #005CC5">10</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">print</span><span style="color: #24292E">(n)</span></span></code></pre></div></div></figure>
<h3 id="e.g.2inverse-cascade">e.g.2:Inverse Cascade</h3>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">inverse_cascade</span><span style="color: #24292E">(n):</span></span>
<span class="line"><span style="color: #24292E">    grow(n)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">print</span><span style="color: #24292E">(n)</span></span>
<span class="line"><span style="color: #24292E">    shrink(n)</span></span>
<span class="line"><span style="color: #24292E">    </span></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">f_then_g</span><span style="color: #24292E">(f,g,n):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> n:</span></span>
<span class="line"><span style="color: #24292E">        f(n)</span></span>
<span class="line"><span style="color: #24292E">        g(n)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">grow </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">lambda</span><span style="color: #24292E"> n: f_then_g(grow,</span><span style="color: #005CC5">print</span><span style="color: #24292E">,n</span><span style="color: #D73A49">//</span><span style="color: #005CC5">10</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">shrink </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">lambda</span><span style="color: #24292E"> n: f_then_g(</span><span style="color: #005CC5">print</span><span style="color: #24292E">,shrink,n</span><span style="color: #D73A49">//</span><span style="color: #005CC5">10</span><span style="color: #24292E">)</span></span></code></pre></div></div></figure>
<p>grow先进行处理，每次将数字缩短一节，到达递归底部后退出时便是从小到大依次输出</p>
<p>shrink先打印出来当前n，然后将数字缩短一节，这样递归过程便实现了从大到小依次输出</p>
<h2 id="tree-recursion-1">Tree Recursion</h2>
<p>当递归函数对自身调用超过一次时，发生树形递归，产生树状过程</p>
<h3 id="e.g.1-斐波那契数列">e.g.1 斐波那契数列</h3>
<figure>
<img src="Lecture10——Tree%20Recursion/image-20250204225729280.png"
alt="树形斐波那契" />
<figcaption aria-hidden="true">树形斐波那契</figcaption>
</figure>
<p><figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fib</span><span style="color: #24292E">(n):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> n</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">elif</span><span style="color: #24292E"> n</span><span style="color: #D73A49">==</span><span style="color: #005CC5">1</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> fib(n</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">)</span><span style="color: #D73A49">+</span><span style="color: #24292E">fib(n</span><span style="color: #D73A49">-</span><span style="color: #005CC5">2</span><span style="color: #24292E">)</span></span></code></pre></div></div></figure></p>
<h3 id="e.g.2-计算分区">e.g.2 计算分区</h3>
<blockquote>
<p>将正整数n分为大小不超过m的分区的方式有多少种，即n能以多少种方式表示为递增的不超过m部分之和</p>
<p>e.g. count_partitions(6,4)</p>
<p>有以下可能：</p>
<p><span class="math inline">\(2+4=6\)</span></p>
<p><span class="math inline">\(1+1+4=6\)</span></p>
<p><span class="math inline">\(3+3=6\)</span></p>
<p><span class="math inline">\(1+2+3=6\)</span></p>
<p><span class="math inline">\(1+1+1+3=6\)</span></p>
<p>……</p>
</blockquote>
<p>分为两种情况考虑：</p>
<ul>
<li>至少分一个4</li>
<li>不分4</li>
</ul>
<p>这样我们可以把递归问题拆分为两个小问题，将两种情况相加</p>
<ul>
<li><p>count_partitions(2,4)</p></li>
<li><p>count_partitions(6,3)</p>
<p>以此类推，count_partitions(6,3)按同样方式考虑，分3与不分3，直到递归底部</p></li>
</ul>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">count_partitions</span><span style="color: #24292E">(n,m):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> n</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">elif</span><span style="color: #24292E"> n</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">0</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">elif</span><span style="color: #24292E"> m</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        with_m </span><span style="color: #D73A49">=</span><span style="color: #24292E"> count_partitions(n</span><span style="color: #D73A49">-</span><span style="color: #24292E">m,m)</span></span>
<span class="line"><span style="color: #24292E">        without_m </span><span style="color: #D73A49">=</span><span style="color: #24292E"> count_partitions(n,m</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> with_m</span><span style="color: #D73A49">+</span><span style="color: #24292E">without_m</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>CS61A</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>CS61A</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61A】CS61A——Trees</title>
    <url>/CS61A/CS61A%20Trees/</url>
    <content><![CDATA[<h1 id="trees">Trees</h1>
<h2 id="描述树形结构的术语">描述树形结构的术语</h2>
<p><strong>递归描述</strong> - 一课树有一个根节点和一系列分支节点 -
每个分支也是一棵树，也有根节点与分支节点 -
没有分支节点的树被称为叶子节点</p>
<p><strong>亲戚描述</strong></p>
<ul>
<li>树的每个位置被称为节点</li>
<li>每个节点可以表示任何值</li>
<li>一个节点可以称为另一个节点的父节点/子节点 <img
src="Lecture14——Trees/trees.png" alt="trees" /></li>
</ul>
<h2 id="实现树形结构的抽象">实现树形结构的抽象</h2>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">tree</span><span style="color: #24292E">(label, branches</span><span style="color: #D73A49">=</span><span style="color: #24292E">[]):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> branch </span><span style="color: #D73A49">in</span><span style="color: #24292E"> branches:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">assert</span><span style="color: #24292E"> is_tree(branch), </span><span style="color: #032F62">&quot;branches must be trees&quot;</span><span style="color: #24292E"> </span><span style="color: #6A737D"># 确保构造的是一棵树</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> [label] </span><span style="color: #D73A49">+</span><span style="color: #005CC5">list</span><span style="color: #24292E">(branches) </span><span style="color: #6A737D"># 将同一层的分支节点放在一个列表中</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">label</span><span style="color: #24292E">(tree):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> tree[</span><span style="color: #005CC5">0</span><span style="color: #24292E">]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">branches</span><span style="color: #24292E">(tree):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> tree[</span><span style="color: #005CC5">1</span><span style="color: #24292E">:]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">is_tree</span><span style="color: #24292E">(tree):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;判断是不是一棵树&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> </span><span style="color: #005CC5">type</span><span style="color: #24292E">(tree) </span><span style="color: #D73A49">!=</span><span style="color: #24292E"> </span><span style="color: #005CC5">list</span><span style="color: #24292E"> </span><span style="color: #D73A49">or</span><span style="color: #24292E"> </span><span style="color: #005CC5">len</span><span style="color: #24292E">(tree) </span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">1</span><span style="color: #24292E">: </span><span style="color: #6A737D"># 确保树的分支是树，以及存在一个值</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">False</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> branch </span><span style="color: #D73A49">in</span><span style="color: #24292E"> branches(tree): </span><span style="color: #6A737D"># 确保树的分支的分支都是树</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> </span><span style="color: #D73A49">not</span><span style="color: #24292E"> is_tree(branch):</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">False</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">True</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">is_leaf</span><span style="color: #24292E">(tree): </span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;判断树本身是不是叶子节点&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">not</span><span style="color: #24292E"> branches(tree)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">if</span><span style="color: #24292E"> </span><span style="color: #005CC5">__name__</span><span style="color: #24292E"> </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;__main__&quot;</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    t </span><span style="color: #D73A49">=</span><span style="color: #24292E"> tree(</span><span style="color: #005CC5">1</span><span style="color: #24292E">, [tree(</span><span style="color: #005CC5">5</span><span style="color: #24292E">, [tree(</span><span style="color: #005CC5">7</span><span style="color: #24292E">)]), tree(</span><span style="color: #005CC5">6</span><span style="color: #24292E">)])</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">print</span><span style="color: #24292E">(t)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">print</span><span style="color: #24292E">(label(t))</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">print</span><span style="color: #24292E">(branches(t))</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">print</span><span style="color: #24292E">(label(branches(t)[</span><span style="color: #005CC5">0</span><span style="color: #24292E">]))</span></span></code></pre></div></div></figure>
<pre><code>[1, [5, [7]], [6]]
1
[[5, [7]], [6]]
5</code></pre>
<h2 id="tree-processing">Tree Processing</h2>
<h3 id="处理叶子节点">处理叶子节点</h3>
<p>使用递归，将会在每个分支节点进行递归调用，最后合并</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">count_leaves</span><span style="color: #24292E">(t):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Count the leaves of tree T&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> is_leaf(t):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">sum</span><span style="color: #24292E">([count_leaves(b) </span><span style="color: #D73A49">for</span><span style="color: #24292E"> b </span><span style="color: #D73A49">in</span><span style="color: #24292E"> branches(t)])</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">if</span><span style="color: #24292E"> </span><span style="color: #005CC5">__name__</span><span style="color: #24292E"> </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;__main__&quot;</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    t </span><span style="color: #D73A49">=</span><span style="color: #24292E"> tree(</span><span style="color: #005CC5">1</span><span style="color: #24292E">, [tree(</span><span style="color: #005CC5">5</span><span style="color: #24292E">, [tree(</span><span style="color: #005CC5">7</span><span style="color: #24292E">)]), tree(</span><span style="color: #005CC5">6</span><span style="color: #24292E">)])</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">print</span><span style="color: #24292E">(count_leaves(t))</span></span></code></pre></div></div></figure>
<pre><code>2</code></pre>
<h3 id="返回叶子节点的值">返回叶子节点的值</h3>
<p>实现leaves函数，返回树的叶子节点的值的列表</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">leaves</span><span style="color: #24292E">(tree):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;return a list containing the leaf labels of tree&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> is_leaf(tree):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> [label(tree)]</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">sum</span><span style="color: #24292E">([leaves(b) </span><span style="color: #D73A49">for</span><span style="color: #24292E"> b </span><span style="color: #D73A49">in</span><span style="color: #24292E"> branches(tree)], [])</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">if</span><span style="color: #24292E"> </span><span style="color: #005CC5">__name__</span><span style="color: #24292E"> </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;__main__&quot;</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    t </span><span style="color: #D73A49">=</span><span style="color: #24292E"> tree(</span><span style="color: #005CC5">1</span><span style="color: #24292E">, [tree(</span><span style="color: #005CC5">5</span><span style="color: #24292E">, [tree(</span><span style="color: #005CC5">7</span><span style="color: #24292E">)]), tree(</span><span style="color: #005CC5">6</span><span style="color: #24292E">)])</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">print</span><span style="color: #24292E">(leaves(t))</span></span></code></pre></div></div></figure>
<pre><code>[7, 6]</code></pre>
<h3 id="根据树创建树">根据树创建树</h3>
<p>使用递归根据另一棵树创建一颗新树 如让叶子节点值+1的树
或让所有节点都+1的树</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">increment_leaves</span><span style="color: #24292E">(t):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;return a tree like t but with leaf labels incremented&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> is_leaf(t):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> tree(label(t)</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        bs </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [increment_leaves(b) </span><span style="color: #D73A49">for</span><span style="color: #24292E"> b </span><span style="color: #D73A49">in</span><span style="color: #24292E"> branches(t)]</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> tree(label(t), bs)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">increment</span><span style="color: #24292E">(t):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;return a tree like t but with all labels incremented&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> tree(label(t)</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">, [increment(b) </span><span style="color: #D73A49">for</span><span style="color: #24292E"> b </span><span style="color: #D73A49">in</span><span style="color: #24292E"> branches(t)])</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">if</span><span style="color: #24292E"> </span><span style="color: #005CC5">__name__</span><span style="color: #24292E"> </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;__main__&quot;</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    t </span><span style="color: #D73A49">=</span><span style="color: #24292E"> tree(</span><span style="color: #005CC5">1</span><span style="color: #24292E">, [tree(</span><span style="color: #005CC5">5</span><span style="color: #24292E">, [tree(</span><span style="color: #005CC5">7</span><span style="color: #24292E">)]), tree(</span><span style="color: #005CC5">6</span><span style="color: #24292E">)])</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">print</span><span style="color: #24292E">(leaves(t))</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">print</span><span style="color: #24292E">(increment_leaves(t))</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">print</span><span style="color: #24292E">(increment(t))</span></span></code></pre></div></div></figure>
<pre><code>[7, 6]
[1, [5, [8]], [7]]
[2, [6, [8]], [7]]</code></pre>
<h2 id="例print_tree">例：print_tree</h2>
<p>按节点在树中的深度缩进打印一颗树</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">print_tree</span><span style="color: #24292E">(t, indent </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">print</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39; &#39;</span><span style="color: #D73A49">*</span><span style="color: #24292E">indent </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">str</span><span style="color: #24292E">(label(t)))</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> b </span><span style="color: #D73A49">in</span><span style="color: #24292E"> branches(t):</span></span>
<span class="line"><span style="color: #24292E">        print_tree(b, indent</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">if</span><span style="color: #24292E"> </span><span style="color: #005CC5">__name__</span><span style="color: #24292E"> </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;__main__&quot;</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    t </span><span style="color: #D73A49">=</span><span style="color: #24292E"> tree(</span><span style="color: #005CC5">1</span><span style="color: #24292E">, [tree(</span><span style="color: #005CC5">5</span><span style="color: #24292E">, [tree(</span><span style="color: #005CC5">7</span><span style="color: #24292E">)]), tree(</span><span style="color: #005CC5">6</span><span style="color: #24292E">)])</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">print</span><span style="color: #24292E">(print_tree(t))</span></span></code></pre></div></div></figure>
<pre><code>1
 5
  7
 6
None</code></pre>
<h2 id="例-求从根节点沿路径到叶子节点求和并打印">例：
求从根节点沿路径到叶子节点求和并打印</h2>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">print_sums</span><span style="color: #24292E">(t, so_far):</span></span>
<span class="line"><span style="color: #24292E">    so_far </span><span style="color: #D73A49">=</span><span style="color: #24292E"> so_far </span><span style="color: #D73A49">+</span><span style="color: #24292E">label(t)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> is_leaf(t):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">print</span><span style="color: #24292E">(so_far)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E"> b </span><span style="color: #D73A49">in</span><span style="color: #24292E"> branches(t):</span></span>
<span class="line"><span style="color: #24292E">            print_sums(b,so_far)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">if</span><span style="color: #24292E"> </span><span style="color: #005CC5">__name__</span><span style="color: #24292E"> </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;__main__&quot;</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    t </span><span style="color: #D73A49">=</span><span style="color: #24292E"> tree(</span><span style="color: #005CC5">1</span><span style="color: #24292E">, [tree(</span><span style="color: #005CC5">5</span><span style="color: #24292E">, [tree(</span><span style="color: #005CC5">7</span><span style="color: #24292E">)]), tree(</span><span style="color: #005CC5">6</span><span style="color: #24292E">)])</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">print</span><span style="color: #24292E">(print_sums(t, </span><span style="color: #005CC5">0</span><span style="color: #24292E">))</span></span></code></pre></div></div></figure>
<pre><code>13
7
None</code></pre>
]]></content>
      <categories>
        <category>CS61A</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>CS61A</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61A】Project1-Hog</title>
    <url>/CS61A/Project1%20Hog/</url>
    <content><![CDATA[<h1 id="project1-hog">Project1-Hog</h1>
<p>实现一个掷骰子游戏</p>
<h2 id="规则">规则</h2>
<p>两位玩家依次掷任意数量(不多于10个)骰子，点数之和先达到GOAL的胜利。</p>
<ul>
<li>Sow Sad: 若其中一个骰子点数为一，则该玩家此轮得分为1</li>
<li>Boar Brawl:
玩家可以选择不掷骰子，得分为<code>max(1,3*abs(对手得分十位数-自己得分个位数))</code>，位数不够补零。</li>
<li>Sus Fuss:
若一局结束后，玩家点数数值有三或四个因数(包括1和点数本身)，该玩家点数会变为比当前数值大的最近的一个质数</li>
</ul>
<h2 id="phase-1-rules-of-the-game">Phase 1: Rules of the Game</h2>
<p>模拟游戏的进行</p>
<h3 id="problem-0">Problem 0</h3>
<p>熟悉dice.py，了解骰子的生成</p>
<ul>
<li>make_fair_dice(<SIDE>)用于生成每面概率相等的SIDE面骰子</li>
<li>make_test_dice(<range>)用于测试循环投出一系列指定值</li>
</ul>
<p>掷出一次骰子的方法：调用生成骰子赋值给的变量<code>e.g. six_sided()</code></p>
<h3 id="problem-1">Problem 1</h3>
<p>实现掷骰子函数，并实现规则Sow Sad</p>
<blockquote>
<p>在定义函数时，若出现形参后已经赋值的情况，该值代表该函数不传入参数时形参默认值</p>
<p>如<code>def roll_dice(num_rolls, dice=six_sided)</code>，若不传入dice参数则默认为six_sided</p>
</blockquote>
<p><strong>roll_dice()函数：</strong></p>
<p>参数：</p>
<ul>
<li>num_rolls指掷骰子次数</li>
<li>dice指传入的骰子（默认值为六面骰子）</li>
</ul>
<p>理解：</p>
<ul>
<li>该函数返回的是num_roll次结果之和，若其中有1则返回1</li>
<li>若上次调用函数掷骰子次数少于掷骰子次数，则下次掷骰子时会接着上次开始而非从头开始</li>
<li>在循环中return语句会结束一个循环</li>
</ul>
<p>My code：</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">roll_dice</span><span style="color: #24292E">(num_rolls, dice</span><span style="color: #D73A49">=</span><span style="color: #24292E">six_sided):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Simulate rolling the DICE exactly NUM_ROLLS &gt; 0 times. Return the sum of</span></span>
<span class="line"><span style="color: #032F62">    the outcomes unless any of the outcomes is 1. In that case, return 1.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    num_rolls:  The number of dice rolls that will be made.</span></span>
<span class="line"><span style="color: #032F62">    dice:       A function that simulates a single dice roll outcome. Defaults to the six sided dice.</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># These assert statements ensure that num_rolls is a positive integer.</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">assert</span><span style="color: #24292E"> </span><span style="color: #005CC5">type</span><span style="color: #24292E">(num_rolls) </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">int</span><span style="color: #24292E">, </span><span style="color: #032F62">&#39;num_rolls must be an integer.&#39;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">assert</span><span style="color: #24292E"> num_rolls </span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">, </span><span style="color: #032F62">&#39;Must roll at least once.&#39;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># BEGIN PROBLEM 1</span></span>
<span class="line"><span style="color: #24292E">    total </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">    flag </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> i </span><span style="color: #D73A49">in</span><span style="color: #24292E"> </span><span style="color: #005CC5">range</span><span style="color: #24292E">(num_rolls):</span></span>
<span class="line"><span style="color: #24292E">        temp </span><span style="color: #D73A49">=</span><span style="color: #24292E"> dice()</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> temp</span><span style="color: #D73A49">==</span><span style="color: #005CC5">1</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">            flag </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">        total </span><span style="color: #D73A49">+=</span><span style="color: #24292E"> temp</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> flag:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> total</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># END PROBLEM 1</span></span></code></pre></div></div></figure>
<h3 id="problem-2">Problem 2</h3>
<p>实现规则Boar Brawl</p>
<p><strong>boar_brawl()函数：</strong></p>
<p>参数：</p>
<ul>
<li>player_score：自己的分数</li>
<li>opponent_score：对手的分数</li>
</ul>
<p>理解：</p>
<ul>
<li>获取自己分数的个位数与对手分数的十位数</li>
<li>相减并取绝对值后乘三</li>
<li>若小于1则输出1，否则输出计算结果</li>
</ul>
<p>My code：</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">boar_brawl</span><span style="color: #24292E">(player_score, opponent_score):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Return the points scored by rolling 0 dice according to Boar Brawl.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    player_score:     The total score of the current player.</span></span>
<span class="line"><span style="color: #032F62">    opponent_score:   The total score of the other player.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># BEGIN PROBLEM 2</span></span>
<span class="line"><span style="color: #24292E">    player_one </span><span style="color: #D73A49">=</span><span style="color: #24292E"> player_score</span><span style="color: #D73A49">%</span><span style="color: #005CC5">10</span></span>
<span class="line"><span style="color: #24292E">    opponent_ten </span><span style="color: #D73A49">=</span><span style="color: #24292E"> opponent_score</span><span style="color: #D73A49">%</span><span style="color: #005CC5">100</span><span style="color: #D73A49">//</span><span style="color: #005CC5">10</span></span>
<span class="line"><span style="color: #24292E">    result </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">3</span><span style="color: #D73A49">*</span><span style="color: #005CC5">abs</span><span style="color: #24292E">(opponent_ten</span><span style="color: #D73A49">-</span><span style="color: #24292E">player_one)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> result</span><span style="color: #D73A49">&gt;=</span><span style="color: #005CC5">1</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> result</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># END PROBLEM 2</span></span></code></pre></div></div></figure>
<p><strong>注意：传入的参数不一定是十位数，需要进行一些处理</strong></p>
<h3 id="problem-3">Problem 3</h3>
<p>实现函数，将前两个规则结合，输出正确结果</p>
<p><strong>take_turn()函数：</strong></p>
<p>参数：</p>
<ul>
<li>num_rolls：掷骰子次数</li>
<li>player_score：自己的分数</li>
<li>opponent_score：对手的分数</li>
<li>dice：使用的骰子</li>
</ul>
<p>理解：</p>
<ul>
<li>若num_rolls&gt;0，则按照正常规则进行，获得本轮掷骰点数之和</li>
<li>若num_rolls=0，即不掷骰子，等同于选择使用Boar
Brawl规则，执行该函数</li>
</ul>
<p>My code：</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">take_turn</span><span style="color: #24292E">(num_rolls, player_score, opponent_score, dice</span><span style="color: #D73A49">=</span><span style="color: #24292E">six_sided):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Return the points scored on a turn rolling NUM_ROLLS dice when the</span></span>
<span class="line"><span style="color: #032F62">    player has PLAYER_SCORE points and the opponent has OPPONENT_SCORE points.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    num_rolls:       The number of dice rolls that will be made.</span></span>
<span class="line"><span style="color: #032F62">    player_score:    The total score of the current player.</span></span>
<span class="line"><span style="color: #032F62">    opponent_score:  The total score of the other player.</span></span>
<span class="line"><span style="color: #032F62">    dice:            A function that simulates a single dice roll outcome.</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># Leave these assert statements here; they help check for errors.</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">assert</span><span style="color: #24292E"> </span><span style="color: #005CC5">type</span><span style="color: #24292E">(num_rolls) </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">int</span><span style="color: #24292E">, </span><span style="color: #032F62">&#39;num_rolls must be an integer.&#39;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">assert</span><span style="color: #24292E"> num_rolls </span><span style="color: #D73A49">&gt;=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">, </span><span style="color: #032F62">&#39;Cannot roll a negative number of dice in take_turn.&#39;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">assert</span><span style="color: #24292E"> num_rolls </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">, </span><span style="color: #032F62">&#39;Cannot roll more than 10 dice.&#39;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># BEGIN PROBLEM 3</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> num_rolls</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> boar_brawl(player_score,opponent_score)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> roll_dice(num_rolls,dice)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># END PROBLEM 3</span></span></code></pre></div></div></figure>
<h3 id="problem-4">Problem 4</h3>
<p>实现Sus Fuss规则</p>
<p><strong>num_factors()函数</strong>：</p>
<p>参数：</p>
<ul>
<li>n：要计算的数n</li>
</ul>
<p>理解：</p>
<ul>
<li>返回数n的因数个数</li>
<li>1和n本身也算进去</li>
</ul>
<p>My code：</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">num_factors</span><span style="color: #24292E">(n):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Return the number of factors of N, including 1 and N itself.&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># BEGIN PROBLEM 4</span></span>
<span class="line"><span style="color: #24292E">    total </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> i </span><span style="color: #D73A49">in</span><span style="color: #24292E"> </span><span style="color: #005CC5">range</span><span style="color: #24292E">(</span><span style="color: #005CC5">1</span><span style="color: #24292E">,n</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> n</span><span style="color: #D73A49">%</span><span style="color: #24292E">i</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">            total</span><span style="color: #D73A49">+=</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> total</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># END PROBLEM 4</span></span></code></pre></div></div></figure>
<p><strong>sus_points()函数</strong>：</p>
<p>参数：</p>
<ul>
<li>score：某玩家的分数</li>
</ul>
<p>理解：</p>
<ul>
<li>该函数用于更新玩家在Sus Fuss规则下新的分数</li>
<li>即用于判断符合条件下大于该分数数值的下一个质数</li>
<li>若该数值不符合条件，则返回本身</li>
</ul>
<p>My code:</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">sus_points</span><span style="color: #24292E">(score):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Return the new score of a player taking into account the Sus Fuss rule.&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># BEGIN PROBLEM 4</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> num_factors(score)</span><span style="color: #D73A49">==</span><span style="color: #005CC5">3</span><span style="color: #24292E"> </span><span style="color: #D73A49">or</span><span style="color: #24292E"> num_factors(score)</span><span style="color: #D73A49">==</span><span style="color: #005CC5">4</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">while</span><span style="color: #24292E"> </span><span style="color: #005CC5">True</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">            score</span><span style="color: #D73A49">+=</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">if</span><span style="color: #24292E"> is_prime(score):</span></span>
<span class="line"><span style="color: #24292E">                </span><span style="color: #D73A49">return</span><span style="color: #24292E"> score</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> score</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># END PROBLEM 4</span></span></code></pre></div></div></figure>
<p><strong>sus_update()函数</strong>：</p>
<p>参数：</p>
<ul>
<li>num_rolls：掷骰子次数</li>
<li>player_score：自己的分数</li>
<li>opponent_score：对手的分数</li>
<li>dice：使用的骰子</li>
</ul>
<p>理解：</p>
<ul>
<li>用于输出num_rolls次掷骰子后，考虑以上三种规则后的点数之和</li>
<li>现根据take_turn()函数求出满足前两个规则的本轮分数之和，并累加到当前分数上</li>
<li>再判断此时分数是否满足第三个规则，进行相应分数改动</li>
</ul>
<p>My code:</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">sus_update</span><span style="color: #24292E">(num_rolls, player_score, opponent_score, dice</span><span style="color: #D73A49">=</span><span style="color: #24292E">six_sided):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Return the total score of a player who starts their turn with</span></span>
<span class="line"><span style="color: #032F62">    PLAYER_SCORE and then rolls NUM_ROLLS DICE, *including* Sus Fuss.</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># BEGIN PROBLEM 4</span></span>
<span class="line"><span style="color: #24292E">    score </span><span style="color: #D73A49">=</span><span style="color: #24292E"> player_score </span><span style="color: #D73A49">+</span><span style="color: #24292E"> take_turn(num_rolls, player_score, opponent_score, dice)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> sus_points(score)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># END PROBLEM 4</span></span></code></pre></div></div></figure>
<h3 id="problem-5">Problem 5</h3>
<p>完整实现游戏模拟</p>
<p><strong>play()函数</strong>：</p>
<p>参数：</p>
<ul>
<li>strategy0：player0使用的策略</li>
<li>strategy1：player1使用的策略</li>
<li>update：使用的更新函数（有无sus）</li>
<li>score0：player0的起始分数</li>
<li>score1：player1的起始分数</li>
<li>dice：使用的骰子</li>
<li>goal：实现游戏结束的数值</li>
</ul>
<p>理解：</p>
<ul>
<li>strategy指的是玩家掷骰子数量</li>
<li>strategy函数传入自己与对手的分数，根据两者分数得出下次掷骰子数量</li>
<li>使用传入的update函数来决定分数改变策略（是否采用sus fuss规则）</li>
</ul>
<p>My code：</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">play</span><span style="color: #24292E">(strategy0, strategy1, update,</span></span>
<span class="line"><span style="color: #24292E">         score0</span><span style="color: #D73A49">=</span><span style="color: #005CC5">0</span><span style="color: #24292E">, score1</span><span style="color: #D73A49">=</span><span style="color: #005CC5">0</span><span style="color: #24292E">, dice</span><span style="color: #D73A49">=</span><span style="color: #24292E">six_sided, goal</span><span style="color: #D73A49">=</span><span style="color: #005CC5">GOAL</span><span style="color: #24292E">):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Simulate a game and return the final scores of both players, with</span></span>
<span class="line"><span style="color: #032F62">    Player 0&#39;s score first and Player 1&#39;s score second.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    E.g., play(always_roll_5, always_roll_5, sus_update) simulates a game in</span></span>
<span class="line"><span style="color: #032F62">    which both players always choose to roll 5 dice on every turn and the Sus</span></span>
<span class="line"><span style="color: #032F62">    Fuss rule is in effect.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    A strategy function, such as always_roll_5, takes the current player&#39;s</span></span>
<span class="line"><span style="color: #032F62">    score and their opponent&#39;s score and returns the number of dice the current</span></span>
<span class="line"><span style="color: #032F62">    player chooses to roll.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    An update function, such as sus_update or simple_update, takes the number</span></span>
<span class="line"><span style="color: #032F62">    of dice to roll, the current player&#39;s score, the opponent&#39;s score, and the</span></span>
<span class="line"><span style="color: #032F62">    dice function used to simulate rolling dice. It returns the updated score</span></span>
<span class="line"><span style="color: #032F62">    of the current player after they take their turn.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    strategy0: The strategy for player0.</span></span>
<span class="line"><span style="color: #032F62">    strategy1: The strategy for player1.</span></span>
<span class="line"><span style="color: #032F62">    update:    The update function (used for both players).</span></span>
<span class="line"><span style="color: #032F62">    score0:    Starting score for Player 0</span></span>
<span class="line"><span style="color: #032F62">    score1:    Starting score for Player 1</span></span>
<span class="line"><span style="color: #032F62">    dice:      A function of zero arguments that simulates a dice roll.</span></span>
<span class="line"><span style="color: #032F62">    goal:      The game ends and someone wins when this score is reached.</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    who </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">  </span><span style="color: #6A737D"># Who is about to take a turn, 0 (first) or 1 (second)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># BEGIN PROBLEM 5</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E"> score0</span><span style="color: #D73A49">&lt;</span><span style="color: #24292E">goal </span><span style="color: #D73A49">and</span><span style="color: #24292E"> score1 </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> goal:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> who</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">            score0 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> update(strategy0(score0, score1), score0, score1, dice)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">            score1 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> update(strategy1(score1, score0), score1, score0, dice)</span></span>
<span class="line"><span style="color: #24292E">        who </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #24292E"> who</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># END PROBLEM 5</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> score0, score1</span></span></code></pre></div></div></figure>
<h2 id="phase-2-strategies">Phase 2: Strategies</h2>
<p>这部分将会根据自己与对手的分数生成每轮玩家的掷骰数（0-10）</p>
<h3 id="problem-6">Problem 6</h3>
<p>返回一个函数，获取自己与对手分数并输出指定骰子个数</p>
<p>理解：</p>
<ul>
<li>返回的是函数，有两个参数：自己与对手分数</li>
<li>无论两者分数多少，返回的总是一开始传入的指定骰子个数</li>
</ul>
<p>My code：</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">always_roll</span><span style="color: #24292E">(n):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Return a player strategy that always rolls N dice.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    A player strategy is a function that takes two total scores as arguments</span></span>
<span class="line"><span style="color: #032F62">    (the current player&#39;s score, and the opponent&#39;s score), and returns a</span></span>
<span class="line"><span style="color: #032F62">    number of dice that the current player will roll this turn.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">strategy = always_roll(3)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">strategy(0, 0)</span></span>
<span class="line"><span style="color: #032F62">    3</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">strategy(99, 99)</span></span>
<span class="line"><span style="color: #032F62">    3</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">assert</span><span style="color: #24292E"> n </span><span style="color: #D73A49">&gt;=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E"> </span><span style="color: #D73A49">and</span><span style="color: #24292E"> n </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># BEGIN PROBLEM 6</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">lambda</span><span style="color: #24292E"> x,y: n</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># END PROBLEM 6</span></span></code></pre></div></div></figure>
<h3 id="problem-7">Problem 7</h3>
<p>判断每种分数组合是否都有一种对应的掷骰个数（分数组合指一种自己与对手的分数）</p>
<p><strong>is_always_roll()函数：</strong></p>
<p>参数：</p>
<ul>
<li>strategy：掷骰策略</li>
<li>goal：玩家胜利要达到的目标分数</li>
</ul>
<p>理解：</p>
<ul>
<li>自己与对手的得分在胜利之前可能性均有100种（0-99），故可能性组合有10000种</li>
<li>该函数实现了判断每种可能性组合下返回的掷骰数是否相同</li>
<li>goal不一定是100</li>
</ul>
<p>My code：</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">is_always_roll</span><span style="color: #24292E">(strategy, goal</span><span style="color: #D73A49">=</span><span style="color: #005CC5">GOAL</span><span style="color: #24292E">):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Return whether STRATEGY always chooses the same number of dice to roll</span></span>
<span class="line"><span style="color: #032F62">    given a game that goes to GOAL points.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">is_always_roll(always_roll_5)</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">is_always_roll(always_roll(3))</span></span>
<span class="line"><span style="color: #032F62">    True</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">is_always_roll(catch_up)</span></span>
<span class="line"><span style="color: #032F62">    False</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># BEGIN PROBLEM 7</span></span>
<span class="line"><span style="color: #24292E">    num </span><span style="color: #D73A49">=</span><span style="color: #24292E"> strategy(</span><span style="color: #005CC5">0</span><span style="color: #24292E">,</span><span style="color: #005CC5">0</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> i </span><span style="color: #D73A49">in</span><span style="color: #24292E"> </span><span style="color: #005CC5">range</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">,goal):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E"> j </span><span style="color: #D73A49">in</span><span style="color: #24292E"> </span><span style="color: #005CC5">range</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">,goal):</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">if</span><span style="color: #24292E"> strategy(i,j)</span><span style="color: #D73A49">!=</span><span style="color: #24292E">num:</span></span>
<span class="line"><span style="color: #24292E">                </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">False</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">True</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># END PROBLEM 7</span></span></code></pre></div></div></figure>
<h3 id="problem-8">Problem 8</h3>
<p>返回一个函数，用来调用n次掷骰函数，并返回这n次掷骰得到的值之和的平均值</p>
<h4 id="语法特性args">语法特性：*args</h4>
<p>*args参数允许函数接受任意数量的位置参数，以元组形式传入</p>
<p>args可以改为其他名称，*必须有</p>
<p>应用：</p>
<ol type="1">
<li>定义的函数接受不定数量位置参数时</li>
<li>编写高阶函数（higher-order
function）时，传递参数给内部的定义的函数</li>
</ol>
<p><strong>make_averaged()函数</strong></p>
<p>参数：</p>
<ul>
<li>original_function：调用的掷骰函数</li>
<li>times_called：调用次数</li>
</ul>
<p>理解：</p>
<ul>
<li>函数需要做到执行n次掷骰函数，并将返回值累加，最后求这n次和的平均值</li>
<li>在内联函数中使用了*args来表示若干参数，与调入的掷骰函数参数数量一致</li>
</ul>
<p>My code：</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">make_averaged</span><span style="color: #24292E">(original_function, times_called</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1000</span><span style="color: #24292E">):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Return a function that returns the average value of ORIGINAL_FUNCTION</span></span>
<span class="line"><span style="color: #032F62">    called TIMES_CALLED times.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    To implement this function, you will have to use *args syntax.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">dice = make_test_dice(4, 2, 5, 1)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">averaged_dice = make_averaged(roll_dice, 40)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">averaged_dice(1, dice)  # The avg of 10 4&#39;s, 10 2&#39;s, 10 5&#39;s, and 10 1&#39;s</span></span>
<span class="line"><span style="color: #032F62">    3.0</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># BEGIN PROBLEM 8</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">average_cal</span><span style="color: #24292E">(</span><span style="color: #D73A49">*</span><span style="color: #24292E">args):</span></span>
<span class="line"><span style="color: #24292E">        suma </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E"> i </span><span style="color: #D73A49">in</span><span style="color: #24292E"> </span><span style="color: #005CC5">range</span><span style="color: #24292E">(times_called):</span></span>
<span class="line"><span style="color: #24292E">            suma</span><span style="color: #D73A49">+=</span><span style="color: #24292E">original_function(</span><span style="color: #D73A49">*</span><span style="color: #24292E">args)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> suma</span><span style="color: #D73A49">/</span><span style="color: #24292E">times_called</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> average_cal</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># END PROBLEM 8</span></span></code></pre></div></div></figure>
<h3 id="problem-9">Problem 9</h3>
<p>实现函数，枚举掷骰次数（1-10），看哪次的分数平均值最大</p>
<p><strong>max_scoring_num_rolls()函数</strong></p>
<p>参数：</p>
<ul>
<li>dice：使用的骰子</li>
<li>times_called：调用次数</li>
</ul>
<p>理解</p>
<ul>
<li>遍历掷骰次数，调用make_averaged函数计算平均值，取1-10掷骰次数中平均值最大值</li>
<li>当平均值相等时取更小的</li>
</ul>
<p>My code：</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">max_scoring_num_rolls</span><span style="color: #24292E">(dice</span><span style="color: #D73A49">=</span><span style="color: #24292E">six_sided, times_called</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1000</span><span style="color: #24292E">):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Return the number of dice (1 to 10) that gives the maximum average score for a turn.</span></span>
<span class="line"><span style="color: #032F62">    Assume that the dice always return positive outcomes.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">dice = make_test_dice(1, 6)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">max_scoring_num_rolls(dice)</span></span>
<span class="line"><span style="color: #032F62">    1</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># BEGIN PROBLEM 9</span></span>
<span class="line"><span style="color: #24292E">    maxi </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">    maxc </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> i </span><span style="color: #D73A49">in</span><span style="color: #24292E"> </span><span style="color: #005CC5">range</span><span style="color: #24292E">(</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">11</span><span style="color: #24292E">):</span></span>
<span class="line"><span style="color: #24292E">        temp </span><span style="color: #D73A49">=</span><span style="color: #24292E"> make_averaged(roll_dice,times_called)(i,dice)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> temp </span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> maxc:</span></span>
<span class="line"><span style="color: #24292E">            maxc </span><span style="color: #D73A49">=</span><span style="color: #24292E"> temp</span></span>
<span class="line"><span style="color: #24292E">            maxi </span><span style="color: #D73A49">=</span><span style="color: #24292E"> i</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> maxi</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># END PROBLEM 9</span></span></code></pre></div></div></figure>
<h3 id="problem-10">Problem 10</h3>
<p>采用<em>Boar
Brawl</em>规则，若roll出0时根据该规则得到的分数比threshold大，返回0，否则返回掷骰次数</p>
<p><strong>boar_strategy()函数 </strong></p>
<p>参数：</p>
<ul>
<li>score：自己的分数</li>
<li>opponent_score：对手的分数</li>
<li>threshold：阈值分数，若采用boar
brawl得到的分数大于它则返回掷骰0次</li>
<li>num_rolls：掷骰次数</li>
</ul>
<p>理解：</p>
<ul>
<li>boar brawl规则是在掷骰0次下的特殊规则</li>
<li>若采用该规则策略获得的分数要比正常掷骰获得的分数更高，就采用该策略（返回掷骰次数0次）</li>
<li>否则按正常掷骰次数掷骰</li>
</ul>
<p>My code：</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">boar_strategy</span><span style="color: #24292E">(score, opponent_score, threshold</span><span style="color: #D73A49">=</span><span style="color: #005CC5">11</span><span style="color: #24292E">, num_rolls</span><span style="color: #D73A49">=</span><span style="color: #005CC5">6</span><span style="color: #24292E">):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;This strategy returns 0 dice if Boar Brawl gives at least THRESHOLD</span></span>
<span class="line"><span style="color: #032F62">    points, and returns NUM_ROLLS otherwise. Ignore score and Sus Fuss.</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># BEGIN PROBLEM 10</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> boar_brawl(score,opponent_score)</span><span style="color: #D73A49">&gt;=</span><span style="color: #24292E">threshold: </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> num_rolls  </span><span style="color: #6A737D"># Remove this line once implemented.</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># END PROBLEM 10</span></span></code></pre></div></div></figure>
<h3 id="problem-11">Problem 11</h3>
<p>采用<em>Sus Fuss</em>规则，若roll出0时根据该规则与<em>Boar
Brawl</em>规则得到的分数与起始分数差值比threshold大，返回0，否则返回掷骰次数</p>
<p><strong>sus_strategy()函数</strong></p>
<p>参数：</p>
<ul>
<li>score：自己的分数</li>
<li>opponent_score：对手的分数</li>
<li>threshold：阈值分数，若采用boar
brawl得到的分数大于它则返回掷骰0次</li>
<li>num_rolls：掷骰次数</li>
</ul>
<p>理解：</p>
<ul>
<li>即在boar brawl规则下采用sus fuss规则得到分数</li>
<li>若采用该规则策略获得的分数要比正常掷骰获得的分数更高，就采用该策略（返回掷骰次数0次）</li>
<li>否则按正常掷骰次数掷骰</li>
</ul>
<p>My code：</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">sus_strategy</span><span style="color: #24292E">(score, opponent_score, threshold</span><span style="color: #D73A49">=</span><span style="color: #005CC5">11</span><span style="color: #24292E">, num_rolls</span><span style="color: #D73A49">=</span><span style="color: #005CC5">6</span><span style="color: #24292E">):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;This strategy returns 0 dice when your score would increase by at least threshold.&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># BEGIN PROBLEM 11</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> sus_update(</span><span style="color: #005CC5">0</span><span style="color: #24292E">,score,opponent_score) </span><span style="color: #D73A49">-</span><span style="color: #24292E"> score </span><span style="color: #D73A49">&gt;=</span><span style="color: #24292E">threshold: </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> num_rolls  </span><span style="color: #6A737D"># Remove this line once implemented.</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># END PROBLEM 11</span></span></code></pre></div></div></figure>
<h3 id="problem-12">Problem 12</h3>
<p>结合上述所有策略与自己的策略，实现最终策略</p>
<p>My code：</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">final_strategy</span><span style="color: #24292E">(score, opponent_score):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Write a brief description of your final strategy.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    *** YOUR DESCRIPTION HERE ***</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># BEGIN PROBLEM 12</span></span>
<span class="line"><span style="color: #24292E">    threshold </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">GOAL</span><span style="color: #D73A49">-</span><span style="color: #24292E">score</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> score</span><span style="color: #D73A49">&gt;</span><span style="color: #005CC5">80</span><span style="color: #24292E"> </span><span style="color: #D73A49">and</span><span style="color: #24292E"> score</span><span style="color: #D73A49">-</span><span style="color: #24292E">opponent_score</span><span style="color: #D73A49">&gt;</span><span style="color: #005CC5">20</span><span style="color: #24292E">: </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">6</span><span style="color: #24292E">  </span><span style="color: #6A737D"># Remove this line once implemented.</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># END PROBLEM 12</span></span></code></pre></div></div></figure>
]]></content>
      <categories>
        <category>CS61A</category>
      </categories>
      <tags>
        <tag>Project</tag>
        <tag>Python</tag>
        <tag>CS61A</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61A】Project2-Cat</title>
    <url>/CS61A/Project2%20Cat/</url>
    <content><![CDATA[<h1 id="project2-cat">Project2-Cat</h1>
<p>实现一个金山打字通（？）</p>
<p>具体实现：记录打字速度以及自动修正拼写错误的字符</p>
<h2 id="phase-1-typing">Phase 1: Typing</h2>
<p>实现打字以及检测打字速度相关功能</p>
<h3 id="problem-1">Problem 1</h3>
<p>挑选用户打字的段落</p>
<p><strong>pick函数</strong></p>
<p>参数：</p>
<ul>
<li>paragraphs：一串字符串记录了打字内容</li>
<li>select：一个函数，检测段落是否能被选择</li>
<li>k：非负数，作为index</li>
</ul>
<p>思路：</p>
<ul>
<li>函数功能实现了用户选择第k个段落作为打字内容</li>
<li>若选择的k没有对应段落则返回空字符串</li>
<li>选择的字符串要符合select函数的条件</li>
<li>符合条件的才能编号第k个字符串</li>
</ul>
<p>code：</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">pick</span><span style="color: #24292E">(paragraphs, select, k):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Return the Kth paragraph from PARAGRAPHS for which SELECT called on the</span></span>
<span class="line"><span style="color: #032F62">    paragraph returns True. If there are fewer than K such paragraphs, return</span></span>
<span class="line"><span style="color: #032F62">    the empty string.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    Arguments:</span></span>
<span class="line"><span style="color: #032F62">        paragraphs: a list of strings</span></span>
<span class="line"><span style="color: #032F62">        select: a function that returns True for paragraphs that can be selected</span></span>
<span class="line"><span style="color: #032F62">        k: an integer</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">ps = [&#39;hi&#39;, &#39;how are you&#39;, &#39;fine&#39;]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">s = lambda p: len(p) &lt;= 4</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">pick(ps, s, 0)</span></span>
<span class="line"><span style="color: #032F62">    &#39;hi&#39;</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">pick(ps, s, 1)</span></span>
<span class="line"><span style="color: #032F62">    &#39;fine&#39;</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">pick(ps, s, 2)</span></span>
<span class="line"><span style="color: #032F62">    &#39;&#39;</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># BEGIN PROBLEM 1</span></span>
<span class="line"><span style="color: #24292E">    valid_para </span><span style="color: #D73A49">=</span><span style="color: #24292E"> []</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> s </span><span style="color: #D73A49">in</span><span style="color: #24292E"> paragraphs:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> select(s):</span></span>
<span class="line"><span style="color: #24292E">            valid_para.append(s)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> k</span><span style="color: #D73A49">&gt;=</span><span style="color: #005CC5">len</span><span style="color: #24292E">(valid_para):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;&#39;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> valid_para[k]</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># END PROBLEM 1</span></span></code></pre></div></div></figure>
<h3 id="problem-2">Problem 2</h3>
<p>通过给定的关键词选取段落</p>
<p><strong>about函数</strong></p>
<p>参数：subject：关键词列表</p>
<p>思路：</p>
<ul>
<li>about函数用于pick函数中的select选项，用于筛选指定关键字的段落</li>
<li>故它返回的是一个select函数，若段落满足条件则返回True否则返回False</li>
<li>单词匹配时不区分大小写，但要是一个完整单词，且不能是单词的字串</li>
<li>可以使用给定的函数remove_punctuation-去除标点，lower-变小写，split-将一句话分割为若干单词存入列表</li>
</ul>
<p>code：</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">about</span><span style="color: #24292E">(subject):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Return a select function that returns whether</span></span>
<span class="line"><span style="color: #032F62">    a paragraph contains one of the words in SUBJECT.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    Arguments:</span></span>
<span class="line"><span style="color: #032F62">        subject: a list of words related to a subject</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">about_dogs = about([&#39;dog&#39;, &#39;dogs&#39;, &#39;pup&#39;, &#39;puppy&#39;])</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">pick([&#39;Cute Dog!&#39;, &#39;That is a cat.&#39;, &#39;Nice pup!&#39;], about_dogs, 0)</span></span>
<span class="line"><span style="color: #032F62">    &#39;Cute Dog!&#39;</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">pick([&#39;Cute Dog!&#39;, &#39;That is a cat.&#39;, &#39;Nice pup.&#39;], about_dogs, 1)</span></span>
<span class="line"><span style="color: #032F62">    &#39;Nice pup.&#39;</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">assert</span><span style="color: #24292E"> </span><span style="color: #005CC5">all</span><span style="color: #24292E">([lower(x) </span><span style="color: #D73A49">==</span><span style="color: #24292E"> x </span><span style="color: #D73A49">for</span><span style="color: #24292E"> x </span><span style="color: #D73A49">in</span><span style="color: #24292E"> subject]), </span><span style="color: #032F62">&#39;subjects should be lowercase.&#39;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># BEGIN PROBLEM 2</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">select</span><span style="color: #24292E">(para):</span></span>
<span class="line"><span style="color: #24292E">        sp_para </span><span style="color: #D73A49">=</span><span style="color: #24292E"> split(remove_punctuation(para))</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E"> i </span><span style="color: #D73A49">in</span><span style="color: #24292E"> </span><span style="color: #005CC5">range</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">,</span><span style="color: #005CC5">len</span><span style="color: #24292E">(sp_para)):</span></span>
<span class="line"><span style="color: #24292E">            sp_para[i]</span><span style="color: #D73A49">=</span><span style="color: #24292E">lower(sp_para[i])</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E"> s </span><span style="color: #D73A49">in</span><span style="color: #24292E"> subject:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">if</span><span style="color: #24292E"> s </span><span style="color: #D73A49">in</span><span style="color: #24292E"> sp_para:</span></span>
<span class="line"><span style="color: #24292E">                </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">True</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">False</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> select</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># END PROBLEM 2</span></span></code></pre></div></div></figure>
<h3 id="problem-3">Problem 3</h3>
<p>计算已经输入且匹配单词占需要输入内容的百分比</p>
<p><strong>accuracy函数</strong></p>
<p>参数：</p>
<ul>
<li>typed：已经输入的内容</li>
<li>source：需要输入的内容</li>
</ul>
<p>思路：</p>
<ul>
<li>按单词顺序匹配指定输入内容，第一个对第一个，第二个对第二个….</li>
<li>区分大小写，且包含标点符号</li>
<li>若已经输入内容比需要输入内容长，则长的部分认定为不正确</li>
<li>若两者均为空字符串则准确率为100.0，若前者为空后者非空或前者非空后者为空则准确率为0.0</li>
</ul>
<p>code：</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">accuracy</span><span style="color: #24292E">(typed, source):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Return the accuracy (percentage of words typed correctly) of TYPED</span></span>
<span class="line"><span style="color: #032F62">    when compared to the prefix of SOURCE that was typed.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    Arguments:</span></span>
<span class="line"><span style="color: #032F62">        typed: a string that may contain typos</span></span>
<span class="line"><span style="color: #032F62">        source: a string without errors</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">accuracy(&#39;Cute Dog!&#39;, &#39;Cute Dog.&#39;)</span></span>
<span class="line"><span style="color: #032F62">    50.0</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">accuracy(&#39;A Cute Dog!&#39;, &#39;Cute Dog.&#39;)</span></span>
<span class="line"><span style="color: #032F62">    0.0</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">accuracy(&#39;cute Dog.&#39;, &#39;Cute Dog.&#39;)</span></span>
<span class="line"><span style="color: #032F62">    50.0</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">accuracy(&#39;Cute Dog. I say!&#39;, &#39;Cute Dog.&#39;)</span></span>
<span class="line"><span style="color: #032F62">    50.0</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">accuracy(&#39;Cute&#39;, &#39;Cute Dog.&#39;)</span></span>
<span class="line"><span style="color: #032F62">    100.0</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">accuracy(&#39;&#39;, &#39;Cute Dog.&#39;)</span></span>
<span class="line"><span style="color: #032F62">    0.0</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">accuracy(&#39;&#39;, &#39;&#39;)</span></span>
<span class="line"><span style="color: #032F62">    100.0</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    typed_words </span><span style="color: #D73A49">=</span><span style="color: #24292E"> split(typed)</span></span>
<span class="line"><span style="color: #24292E">    source_words </span><span style="color: #D73A49">=</span><span style="color: #24292E"> split(source)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># BEGIN PROBLEM 3</span></span>
<span class="line"><span style="color: #24292E">    cnt </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> t, s </span><span style="color: #D73A49">in</span><span style="color: #24292E"> </span><span style="color: #005CC5">zip</span><span style="color: #24292E">(typed_words, source_words):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> t</span><span style="color: #D73A49">==</span><span style="color: #24292E">s:</span></span>
<span class="line"><span style="color: #24292E">            cnt</span><span style="color: #D73A49">+=</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> </span><span style="color: #005CC5">len</span><span style="color: #24292E">(typed_words)</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E"> </span><span style="color: #D73A49">and</span><span style="color: #24292E"> </span><span style="color: #005CC5">len</span><span style="color: #24292E">(source_words)</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">100.0</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">elif</span><span style="color: #24292E"> </span><span style="color: #005CC5">len</span><span style="color: #24292E">(typed_words)</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E"> </span><span style="color: #D73A49">or</span><span style="color: #24292E"> </span><span style="color: #005CC5">len</span><span style="color: #24292E">(source_words)</span><span style="color: #D73A49">==</span><span style="color: #005CC5">0</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0.0</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> (cnt</span><span style="color: #D73A49">/</span><span style="color: #005CC5">len</span><span style="color: #24292E">(typed_words))</span><span style="color: #D73A49">*</span><span style="color: #005CC5">100</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># END PROBLEM 3</span></span></code></pre></div></div></figure>
<p>注意：</p>
<ul>
<li>同时遍历两个列表时，使用zip函数解包，因为原代码实现的是遍历一个包含两个列表的元组</li>
<li>空字符部分特判，因为计算百分比时可能会导致分母为0</li>
<li>计算的是已经输入字符与需要输入字符匹配的字符个数在已经输入字符中的占比，分母是typed_words的长度</li>
</ul>
<h3 id="problem-4">Problem 4</h3>
<p>按照words/min计算打字速度</p>
<p><strong>wpm函数</strong></p>
<p>参数：</p>
<ul>
<li>typed：已经输入的内容</li>
<li>elapsed：总共打字时间（按秒计）</li>
</ul>
<p>思路：</p>
<ul>
<li>wpm的计算是按照字符数来的，单位是每五个字符数，这样可以减少单词长度对结果的影响</li>
<li><span class="math inline">\(wpm =
\frac{\frac{字符数}{5}}{时间(min)}\)</span></li>
</ul>
<p>code:</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">wpm</span><span style="color: #24292E">(typed, elapsed):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Return the words-per-minute (WPM) of the TYPED string.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    Arguments:</span></span>
<span class="line"><span style="color: #032F62">        typed: an entered string</span></span>
<span class="line"><span style="color: #032F62">        elapsed: an amount of time in seconds</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">wpm(&#39;hello friend hello buddy hello&#39;, 15)</span></span>
<span class="line"><span style="color: #032F62">    24.0</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">wpm(&#39;0123456789&#39;,60)</span></span>
<span class="line"><span style="color: #032F62">    2.0</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">assert</span><span style="color: #24292E"> elapsed </span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">, </span><span style="color: #032F62">&#39;Elapsed time must be positive&#39;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># BEGIN PROBLEM 4</span></span>
<span class="line"><span style="color: #24292E">    length </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">len</span><span style="color: #24292E">(typed)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> (length</span><span style="color: #D73A49">/</span><span style="color: #005CC5">5</span><span style="color: #24292E">)</span><span style="color: #D73A49">/</span><span style="color: #24292E">(elapsed</span><span style="color: #D73A49">/</span><span style="color: #005CC5">60</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># END PROBLEM 4</span></span></code></pre></div></div></figure>
<p>注意：elapsed单位是秒，wpm使用的时间是分钟</p>
<h2 id="phase-2-autocorrect">Phase 2: Autocorrect</h2>
<p>按下空格触发单词自动纠正，若最近的一个词接近正确词汇但不正确，则会用正确词汇替代</p>
<h3 id="problem-5">Problem 5</h3>
<p>返回一个列表，内部提供了几个接近输入单词的正确单词</p>
<p>参数：</p>
<ul>
<li>typed_word：一个字符串，表示输入的单词</li>
<li>word_list：源单词列表</li>
<li>diff_function：评估单词不同程度的函数</li>
<li>limit：单词能否被更改的阈值</li>
</ul>
<p>思路：</p>
<ul>
<li><p>autocorrect实现的</p>
<ul>
<li>若输入字符已经在word_list中，将会直接返回该字符</li>
<li>否则会返回基于diff函数计算的不同程度最小的单词</li>
<li>若输入单词与word_list中最小的不同程度仍大于limit，则返回输入单词</li>
</ul></li>
<li><p>所有输入单词和word_list中的单词都是小写且没有标点</p></li>
<li><p>若多个单词与输入字符不同程度最小相同，则返回最靠前的</p></li>
<li><p>不同程度可以使用两个单词相同部分长度衡量</p></li>
</ul>
<p>code：</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">autocorrect</span><span style="color: #24292E">(typed_word, word_list, diff_function, limit):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Returns the element of WORD_LIST that has the smallest difference</span></span>
<span class="line"><span style="color: #032F62">    from TYPED_WORD. If multiple words are tied for the smallest difference,</span></span>
<span class="line"><span style="color: #032F62">    return the one that appears closest to the front of WORD_LIST. If the</span></span>
<span class="line"><span style="color: #032F62">    difference is greater than LIMIT, instead return TYPED_WORD.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    Arguments:</span></span>
<span class="line"><span style="color: #032F62">        typed_word: a string representing a word that may contain typos</span></span>
<span class="line"><span style="color: #032F62">        word_list: a list of strings representing source words</span></span>
<span class="line"><span style="color: #032F62">        diff_function: a function quantifying the difference between two words</span></span>
<span class="line"><span style="color: #032F62">        limit: a number</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">ten_diff = lambda w1, w2, limit: 10 # Always returns 10</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">autocorrect(&quot;hwllo&quot;, [&quot;butter&quot;, &quot;hello&quot;, &quot;potato&quot;], ten_diff, 20)</span></span>
<span class="line"><span style="color: #032F62">    &#39;butter&#39;</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">first_diff = lambda w1, w2, limit: (1 if w1[0] != w2[0] else 0) # Checks for matching first char</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">autocorrect(&quot;tosting&quot;, [&quot;testing&quot;, &quot;asking&quot;, &quot;fasting&quot;], first_diff, 10)</span></span>
<span class="line"><span style="color: #032F62">    &#39;testing&#39;</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># BEGIN PROBLEM 5</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> typed_word </span><span style="color: #D73A49">in</span><span style="color: #24292E"> word_list:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> typed_word</span></span>
<span class="line"><span style="color: #24292E">    word_diff </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [diff_function(typed_word, s, limit) </span><span style="color: #D73A49">for</span><span style="color: #24292E"> s </span><span style="color: #D73A49">in</span><span style="color: #24292E"> word_list]</span></span>
<span class="line"><span style="color: #24292E">    min_diff </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">min</span><span style="color: #24292E">(word_diff)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> min_diff </span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> limit:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> typed_word</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E"> :</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> word_list[word_diff.index(min_diff)]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># END PROBLEM 5</span></span></code></pre></div></div></figure>
<p>注意：</p>
<ul>
<li>可以使用<code>list.index(&lt;val&gt;)</code>获取列表中某值的下标</li>
</ul>
<h3 id="problem-6">Problem 6</h3>
<p>返回为纠正单词需要修改的字符个数</p>
<p>参数：</p>
<ul>
<li>typed：输入单词</li>
<li>source：目标单词</li>
<li>limit：最多修改字符数</li>
</ul>
<p>思路：</p>
<ul>
<li><p>比较个位字符，若不同则执行更改，记录更改数</p></li>
<li><p>若一边比另一边长，长度的不同也算入更改数</p></li>
<li><p>若更改数比limit打，则返回任何大于limit的数（为了避免多余的计算）</p></li>
<li><p>要求使用递归</p></li>
</ul>
<p>code：</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">feline_fixes</span><span style="color: #24292E">(typed, source, limit):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;A diff function for autocorrect that determines how many letters</span></span>
<span class="line"><span style="color: #032F62">    in TYPED need to be substituted to create SOURCE, then adds the difference in</span></span>
<span class="line"><span style="color: #032F62">    their lengths and returns the result.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    Arguments:</span></span>
<span class="line"><span style="color: #032F62">        typed: a starting word</span></span>
<span class="line"><span style="color: #032F62">        source: a string representing a desired goal word</span></span>
<span class="line"><span style="color: #032F62">        limit: a number representing an upper bound on the number of chars that must change</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">big_limit = 10</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">feline_fixes(&quot;nice&quot;, &quot;rice&quot;, big_limit)    # Substitute: n -&gt; r</span></span>
<span class="line"><span style="color: #032F62">    1</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">feline_fixes(&quot;range&quot;, &quot;rungs&quot;, big_limit)  # Substitute: a -&gt; u, e -&gt; s</span></span>
<span class="line"><span style="color: #032F62">    2</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">feline_fixes(&quot;pill&quot;, &quot;pillage&quot;, big_limit) # Don&#39;t substitute anything, length difference of 3.</span></span>
<span class="line"><span style="color: #032F62">    3</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">feline_fixes(&quot;roses&quot;, &quot;arose&quot;, big_limit)  # Substitute: r -&gt; a, o -&gt; r, s -&gt; o, e -&gt; s, s -&gt; e</span></span>
<span class="line"><span style="color: #032F62">    5</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">feline_fixes(&quot;rose&quot;, &quot;hello&quot;, big_limit)   # Substitute: r-&gt;h, o-&gt;e, s-&gt;l, e-&gt;l, length difference of 1.</span></span>
<span class="line"><span style="color: #032F62">    5</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># BEGIN PROBLEM 6</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># assert False, &#39;Remove this line&#39;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">compute</span><span style="color: #24292E">(typed_w,source_w,count):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> count </span><span style="color: #D73A49">&gt;</span><span style="color: #24292E"> limit:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> limit</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> typed_w </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">and</span><span style="color: #24292E"> source_w </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;&quot;</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> count</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">elif</span><span style="color: #24292E"> typed_w </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;&quot;</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> compute(typed_w,source_w[</span><span style="color: #005CC5">1</span><span style="color: #24292E">:],count</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">elif</span><span style="color: #24292E"> source_w </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;&quot;</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> compute(typed_w[</span><span style="color: #005CC5">1</span><span style="color: #24292E">:],source_w,count</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">elif</span><span style="color: #24292E"> typed_w[</span><span style="color: #005CC5">0</span><span style="color: #24292E">]</span><span style="color: #D73A49">==</span><span style="color: #24292E">source_w[</span><span style="color: #005CC5">0</span><span style="color: #24292E">]:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> compute(typed_w[</span><span style="color: #005CC5">1</span><span style="color: #24292E">:],source_w[</span><span style="color: #005CC5">1</span><span style="color: #24292E">:],count)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> compute(typed_w[</span><span style="color: #005CC5">1</span><span style="color: #24292E">:],source_w[</span><span style="color: #005CC5">1</span><span style="color: #24292E">:],count</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> compute(typed,source,</span><span style="color: #005CC5">0</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># END PROBLEM 6</span></span></code></pre></div></div></figure>
<p>注意：</p>
<ul>
<li>超过limit限制的一律设为limit+1</li>
<li>通过slice来每次递归往后截取一位字符，比较每次截取后的首字符来判断相同与否，不相同让count+1</li>
<li>递归出口为两字符串均被截取成空串，返回计数</li>
<li>长度不同的情况下，已经被截成空串的不再截取，长串继续截取，该情况下直接让count+1</li>
</ul>
<h3 id="problem-7">Problem 7</h3>
<p>返回将输入字符改为目标字符所需要执行的操作次数，操作有以下：</p>
<ul>
<li>添加字符</li>
<li>删除字符</li>
<li>替换字符</li>
</ul>
<p>参数：</p>
<ul>
<li>typed：输入单词</li>
<li>source：目标单词</li>
<li>limit：最多修改字符数</li>
</ul>
<p>思路：</p>
<ul>
<li>比较输入单词与指定单词，寻找不同位置</li>
<li>若需要修改数量大于limit，则返回任何大于limit的值</li>
<li>代码需要使用递归，应需要三个递归调用以及两个递归出口</li>
</ul>
<p>code：</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">minimum_mewtations</span><span style="color: #24292E">(typed, source, limit):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;A diff function that computes the edit distance from TYPED to SOURCE.</span></span>
<span class="line"><span style="color: #032F62">    This function takes in a string TYPED, a string SOURCE, and a number LIMIT.</span></span>
<span class="line"><span style="color: #032F62">    Arguments:</span></span>
<span class="line"><span style="color: #032F62">        typed: a starting word</span></span>
<span class="line"><span style="color: #032F62">        source: a string representing a desired goal word</span></span>
<span class="line"><span style="color: #032F62">        limit: a number representing an upper bound on the number of edits</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">big_limit = 10</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">minimum_mewtations(&quot;cats&quot;, &quot;scat&quot;, big_limit)       # cats -&gt; scats -&gt; scat</span></span>
<span class="line"><span style="color: #032F62">    2</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">minimum_mewtations(&quot;purng&quot;, &quot;purring&quot;, big_limit)   # purng -&gt; purrng -&gt; purring</span></span>
<span class="line"><span style="color: #032F62">    2</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">minimum_mewtations(&quot;ckiteus&quot;, &quot;kittens&quot;, big_limit) # ckiteus -&gt; kiteus -&gt; kitteus -&gt; kittens</span></span>
<span class="line"><span style="color: #032F62">    3</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># assert False, &#39;Remove this line&#39;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> limit</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">0</span><span style="color: #24292E">: </span><span style="color: #6A737D"># Base cases should go here, you may add more base cases as needed.</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6A737D"># BEGIN</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6A737D"># END</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># Recursive cases should go below here</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> typed </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">and</span><span style="color: #24292E"> source </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;&quot;</span><span style="color: #24292E">: </span><span style="color: #6A737D"># Feel free to remove or add additional cases</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6A737D"># BEGIN</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6A737D"># END</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">elif</span><span style="color: #24292E"> typed </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;&quot;</span><span style="color: #24292E"> </span><span style="color: #D73A49">or</span><span style="color: #24292E"> source </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #032F62">&quot;&quot;</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">abs</span><span style="color: #24292E">(</span><span style="color: #005CC5">len</span><span style="color: #24292E">(typed)</span><span style="color: #D73A49">-</span><span style="color: #005CC5">len</span><span style="color: #24292E">(source))</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">elif</span><span style="color: #24292E"> typed[</span><span style="color: #005CC5">0</span><span style="color: #24292E">] </span><span style="color: #D73A49">==</span><span style="color: #24292E"> source[</span><span style="color: #005CC5">0</span><span style="color: #24292E">]:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> minimum_mewtations(typed[</span><span style="color: #005CC5">1</span><span style="color: #24292E">:],source[</span><span style="color: #005CC5">1</span><span style="color: #24292E">:],limit)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        add </span><span style="color: #D73A49">=</span><span style="color: #24292E"> minimum_mewtations(typed,source[</span><span style="color: #005CC5">1</span><span style="color: #24292E">:],limit</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">        remove </span><span style="color: #D73A49">=</span><span style="color: #24292E"> minimum_mewtations(typed[</span><span style="color: #005CC5">1</span><span style="color: #24292E">:],source,limit</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">        substitute </span><span style="color: #D73A49">=</span><span style="color: #24292E"> minimum_mewtations(typed[</span><span style="color: #005CC5">1</span><span style="color: #24292E">:],source[</span><span style="color: #005CC5">1</span><span style="color: #24292E">:],limit</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6A737D"># BEGIN</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">min</span><span style="color: #24292E">(add,remove,substitute)</span><span style="color: #D73A49">+</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6A737D"># END</span></span></code></pre></div></div></figure>
<p>注意：</p>
<ul>
<li><p>和上一个problem类似，使用递归与slice一位位判断</p></li>
<li><p>三种操作依次递归，并取最小值</p></li>
</ul>
<h2 id="phase-3-multiplayer">Phase 3: Multiplayer</h2>
<p>实现多人对战模式</p>
<h3 id="problem-8">Problem 8</h3>
<p>将玩家输入进度与信息传入多人服务器并返回对应信息</p>
<p><strong>report_progress函数</strong></p>
<p>参数：</p>
<ul>
<li>typed：输入的字符，列表存储</li>
<li>source：需要输入的字符，列表存储</li>
<li>user_id：当前玩家id</li>
<li>upload：上传进度的函数</li>
</ul>
<p>思路：</p>
<ul>
<li>将输入字符与需要输入字符比较，计算输入进度</li>
<li>输入进度指已经输入正确单词与需要输入正确单词的比例（因此，若中间有一个单词打错，后面再正确也不会记录）</li>
<li>函数的返回值是计算的进度</li>
</ul>
<p>code：</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">report_progress</span><span style="color: #24292E">(typed, source, user_id, upload):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Upload a report of your id and progress so far to the multiplayer server.</span></span>
<span class="line"><span style="color: #032F62">    Returns the progress so far.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    Arguments:</span></span>
<span class="line"><span style="color: #032F62">        typed: a list of the words typed so far</span></span>
<span class="line"><span style="color: #032F62">        source: a list of the words in the typing source</span></span>
<span class="line"><span style="color: #032F62">        user_id: a number representing the id of the current user</span></span>
<span class="line"><span style="color: #032F62">        upload: a function used to upload progress to the multiplayer server</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">print_progress = lambda d: print(&#39;ID:&#39;, d[&#39;id&#39;], &#39;Progress:&#39;, d[&#39;progress&#39;])</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62"># The above function displays progress in the format ID: __, Progress: __</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">print_progress({&#39;id&#39;: 1, &#39;progress&#39;: 0.6})</span></span>
<span class="line"><span style="color: #032F62">    ID: 1 Progress: 0.6</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">typed = [&#39;how&#39;, &#39;are&#39;, &#39;you&#39;]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">source = [&#39;how&#39;, &#39;are&#39;, &#39;you&#39;, &#39;doing&#39;, &#39;today&#39;]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">report_progress(typed, source, 2, print_progress)</span></span>
<span class="line"><span style="color: #032F62">    ID: 2 Progress: 0.6</span></span>
<span class="line"><span style="color: #032F62">    0.6</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">report_progress([&#39;how&#39;, &#39;aree&#39;], source, 3, print_progress)</span></span>
<span class="line"><span style="color: #032F62">    ID: 3 Progress: 0.2</span></span>
<span class="line"><span style="color: #032F62">    0.2</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># BEGIN PROBLEM 8</span></span>
<span class="line"><span style="color: #24292E">    typed_count </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> t,s </span><span style="color: #D73A49">in</span><span style="color: #24292E"> </span><span style="color: #005CC5">zip</span><span style="color: #24292E">(typed,source):</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E"> t </span><span style="color: #D73A49">!=</span><span style="color: #24292E"> s:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">break</span></span>
<span class="line"><span style="color: #24292E">        typed_count</span><span style="color: #D73A49">+=</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">    ratio </span><span style="color: #D73A49">=</span><span style="color: #24292E"> typed_count</span><span style="color: #D73A49">/</span><span style="color: #005CC5">len</span><span style="color: #24292E">(source)</span></span>
<span class="line"><span style="color: #24292E">    upload({</span><span style="color: #032F62">&#39;id&#39;</span><span style="color: #24292E">: user_id, </span><span style="color: #032F62">&#39;progress&#39;</span><span style="color: #24292E">: ratio})</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> ratio</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># END PROBLEM 8</span></span></code></pre></div></div></figure>
<p>注意：</p>
<ul>
<li>判断是否相等时，若发现不等就需要break结束循环</li>
</ul>
<h3 id="problem-9">Problem 9</h3>
<p>计算两个玩家输入每个单词时的用时差</p>
<p><strong>time_per_word函数</strong></p>
<p>参数：</p>
<ul>
<li>words：按输入顺序排列的单词列表</li>
<li>timestamps_per_player：一个二维列表，记录了每位玩家开始与结束输入每个单词的时间</li>
</ul>
<p><strong>data abstraction：match</strong></p>
<p>参数：</p>
<ul>
<li>words：输入单词组成的单词列表</li>
<li>times：二维列表，记录了每个玩家输入每个单词需要多长时间，如<code>times[i][j]</code>指玩家i输入单词<code>words[j]</code>所花费的时间</li>
</ul>
<p>思路：</p>
<ul>
<li>timestamps_per_player记录的是每个玩家敲每个单词的开始与结束时间</li>
<li>传入match后，时间会自动计算为敲每个单词使用的时间（结束-开始），并存入每个单词key对应的value中</li>
<li>通过get_all_word与get_all_times函数可以返回match中对应的键与值形成的列表</li>
<li>通过get_word与time函数可以返回指定的键与值</li>
</ul>
<p>code:</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">time_per_word</span><span style="color: #24292E">(words, timestamps_per_player):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Given timing data, return a match data abstraction, which contains a</span></span>
<span class="line"><span style="color: #032F62">    list of words and the amount of time each player took to type each word.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    Arguments:</span></span>
<span class="line"><span style="color: #032F62">        words: a list of words, in the order they are typed.</span></span>
<span class="line"><span style="color: #032F62">        timestamps_per_player: A list of lists of timestamps including the time</span></span>
<span class="line"><span style="color: #032F62">                          the player started typing, followed by the time</span></span>
<span class="line"><span style="color: #032F62">                          the player finished typing each word.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">p = [[75, 81, 84, 90, 92], [19, 29, 35, 36, 38]]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">match = time_per_word([&#39;collar&#39;, &#39;plush&#39;, &#39;blush&#39;, &#39;repute&#39;], p)</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">get_all_words(match)</span></span>
<span class="line"><span style="color: #032F62">    [&#39;collar&#39;, &#39;plush&#39;, &#39;blush&#39;, &#39;repute&#39;]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">get_all_times(match)</span></span>
<span class="line"><span style="color: #032F62">    [[6, 3, 6, 2], [10, 6, 1, 2]]</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># BEGIN PROBLEM 9</span></span>
<span class="line"><span style="color: #24292E">    times </span><span style="color: #D73A49">=</span><span style="color: #24292E"> []</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> l </span><span style="color: #D73A49">in</span><span style="color: #24292E"> timestamps_per_player:</span></span>
<span class="line"><span style="color: #24292E">        each_times </span><span style="color: #D73A49">=</span><span style="color: #24292E"> []</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E"> i </span><span style="color: #D73A49">in</span><span style="color: #24292E"> </span><span style="color: #005CC5">range</span><span style="color: #24292E">(</span><span style="color: #005CC5">1</span><span style="color: #24292E">,</span><span style="color: #005CC5">len</span><span style="color: #24292E">(l)):</span></span>
<span class="line"><span style="color: #24292E">            each_times.append(l[i]</span><span style="color: #D73A49">-</span><span style="color: #24292E">l[i</span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E">])</span></span>
<span class="line"><span style="color: #24292E">        times.append(each_times)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> match(words,times)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># END PROBLEM 9</span></span></code></pre></div></div></figure>
<p>注意：</p>
<ul>
<li><p>该函数的作用是通过调用match函数构造该抽象类型</p></li>
<li><p>但match函数需要每个单词的时间差，故需要在该函数中处理输入的时间列表（结束-开始）</p></li>
<li><p>将处理后的列表与传入该函数的单词列表传入match函数并返回获得的抽象类型</p></li>
</ul>
<h3 id="problem-10">Problem 10</h3>
<p>返回每个单词哪位玩家敲得块</p>
<p><strong>fastest_words函数</strong></p>
<p>参数：</p>
<ul>
<li>match：match函数中获得的抽象数据类型</li>
</ul>
<p>思路：</p>
<ul>
<li>比较多个玩家输入每个字符时间，选择输入时间最少的</li>
<li>返回的列表中存储了每个玩家输入最快的单词组成的列表</li>
<li>若多个玩家输入时间相同，则取编号更小的玩家</li>
</ul>
<p>code:</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fastest_words</span><span style="color: #24292E">(match):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;Return a list of lists of which words each player typed fastest.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    Arguments:</span></span>
<span class="line"><span style="color: #032F62">        match: a match data abstraction as returned by time_per_word.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">p0 = [5, 1, 3]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">p1 = [4, 1, 6]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">fastest_words(match([&#39;Just&#39;, &#39;have&#39;, &#39;fun&#39;], [p0, p1]))</span></span>
<span class="line"><span style="color: #032F62">    [[&#39;have&#39;, &#39;fun&#39;], [&#39;Just&#39;]]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">p0  # input lists should not be mutated</span></span>
<span class="line"><span style="color: #032F62">    [5, 1, 3]</span></span>
<span class="line"><span style="color: #032F62">    </span><span style="color: #D73A49">&gt;&gt;&gt; </span><span style="color: #032F62">p1</span></span>
<span class="line"><span style="color: #032F62">    [4, 1, 6]</span></span>
<span class="line"><span style="color: #032F62">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    player_indices </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">range</span><span style="color: #24292E">(</span><span style="color: #005CC5">len</span><span style="color: #24292E">(get_all_times(match)))  </span><span style="color: #6A737D"># contains an *index* for each player</span></span>
<span class="line"><span style="color: #24292E">    word_indices </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">range</span><span style="color: #24292E">(</span><span style="color: #005CC5">len</span><span style="color: #24292E">(get_all_words(match)))    </span><span style="color: #6A737D"># contains an *index* for each word</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># BEGIN PROBLEM 10</span></span>
<span class="line"><span style="color: #24292E">    result </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [[] </span><span style="color: #D73A49">for</span><span style="color: #24292E"> i </span><span style="color: #D73A49">in</span><span style="color: #24292E"> player_indices]</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> i </span><span style="color: #D73A49">in</span><span style="color: #24292E"> word_indices:</span></span>
<span class="line"><span style="color: #24292E">        min_player </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E"> j </span><span style="color: #D73A49">in</span><span style="color: #24292E"> player_indices:</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">if</span><span style="color: #24292E"> min_player </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #005CC5">1</span><span style="color: #24292E"> </span><span style="color: #D73A49">or</span><span style="color: #24292E"> time(match, j, i) </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> time(match, min_player, i):</span></span>
<span class="line"><span style="color: #24292E">                min_player </span><span style="color: #D73A49">=</span><span style="color: #24292E"> j</span></span>
<span class="line"><span style="color: #24292E">        result[min_player].append(get_word(match,i))</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> result</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D"># END PROBLEM 10</span></span></code></pre></div></div></figure>
<p>注意：</p>
<ul>
<li>列表中创建多个列表要用for表达式<code>[[] for _ in player_indices]</code></li>
<li>result列表中下标表示玩家，对应元素表示该玩家最快的单词组成的列表</li>
<li>我们首先遍历单词，然后遍历玩家找出时间最小的玩家，并将对应单词存入该玩家对应列表</li>
</ul>
]]></content>
      <categories>
        <category>CS61A</category>
      </categories>
      <tags>
        <tag>Project</tag>
        <tag>Python</tag>
        <tag>CS61A</tag>
      </tags>
  </entry>
  <entry>
    <title>【CS61A】CS61A——Recursion</title>
    <url>/CS61A/CS61A%20Recursion/</url>
    <content><![CDATA[<h1 id="recursion">Recursion</h1>
<h2 id="recursive-functions">Recursive Functions</h2>
<p>定义：在函数体中直接或间接调用自身的函数叫递归函数</p>
<p>即在执行函数体时还会调用若干次函数自身</p>
<p>递归函数的结构：</p>
<ul>
<li>def头定义</li>
<li>条件语句用来判断基本条件，无递归调用（递归出口）</li>
<li>递归条件用来递归调用</li>
</ul>
<p>判断递归是否正确：</p>
<ul>
<li>验证基本条件</li>
<li>将递归函数看作函数抽象</li>
<li>假设f(n-1)正确，验证f(n)的正确性</li>
</ul>
<h2 id="e.g.1用递归求各位数字和">e.g.1:用递归求各位数字和</h2>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">split</span><span style="color: #24292E">(n):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;把n分成最后一位与其他位两部分&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> n</span><span style="color: #D73A49">//</span><span style="color: #005CC5">10</span><span style="color: #24292E">, n</span><span style="color: #D73A49">%</span><span style="color: #005CC5">10</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">sum_digits</span><span style="color: #24292E">(n):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;求和各位数字&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> n</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">10</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> n</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        all_but_last,last </span><span style="color: #D73A49">=</span><span style="color: #24292E"> split(n)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> sum_digits(all_but_last)</span><span style="color: #D73A49">+</span><span style="color: #24292E">last</span></span></code></pre></div></div></figure>
<h2 id="e.g.2阶乘使用diagram">e.g.2:阶乘（使用diagram）</h2>
<figure>
<img src="Lecture9——Recursion/image-20250204103944972.png" alt="阶乘" />
<figcaption aria-hidden="true">阶乘</figcaption>
</figure>
<h2 id="递归与迭代">递归与迭代</h2>
<figure>
<img src="Lecture9——Recursion/image-20250204105346086.png"
alt="递归与迭代" />
<figcaption aria-hidden="true">递归与迭代</figcaption>
</figure>
<p>递归转换到迭代：弄清需要通过迭代保持的状态</p>
<p>迭代转换到递归：迭代保持的状态可以通过参数传递</p>
<h2 id="互递归mutual-recursion">互递归（Mutual Recursion）</h2>
<h3 id="e.g.-luhn-algorithm">e.g. Luhn Algorithm</h3>
<p>改算法常用于信用卡等的校验码计算，步骤如下：</p>
<p><strong>步骤 1：反转数字</strong></p>
<p>算法首先通过反转您正在检查的数字的数字。</p>
<p><strong>步骤 2：每隔一个数字翻倍</strong></p>
<p>从左侧的第一个数字开始（由于反转，现在是原始数字的最后一个数字），对每个第二个数字进行翻倍。</p>
<p><strong>步骤 3：求乘积的数字之和</strong></p>
<p>如果翻倍后的数字大于 9，则将乘积的数字相加（例如，翻倍 8 得到
16，因此相加 1 + 6 = 7）。</p>
<p><strong>步骤 4：将所有数字相加</strong></p>
<p>在上述操作后，将所有数字相加。</p>
<p><strong>步骤 5：检查是否能被 10 整除</strong></p>
<p>如果总和能被 10 整除（即以 0 结尾），则该数字根据 Luhn
算法是有效的。否则，它是无效的。</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div><div class="code"><pre class="shiki github-light"><code><span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">split</span><span style="color: #24292E">(n):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;把n分成最后一位与其他位两部分&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> n</span><span style="color: #D73A49">//</span><span style="color: #005CC5">10</span><span style="color: #24292E">, n</span><span style="color: #D73A49">%</span><span style="color: #005CC5">10</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">sum_digits</span><span style="color: #24292E">(n):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #032F62">&quot;&quot;&quot;求和各位数字&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> n</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">10</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> n</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        all_but_last,last </span><span style="color: #D73A49">=</span><span style="color: #24292E"> split(n)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> sum_digits(all_but_last)</span><span style="color: #D73A49">+</span><span style="color: #24292E">last</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">luhn_sum</span><span style="color: #24292E">(n):</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> n</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">10</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> n</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        all_but_last, last </span><span style="color: #D73A49">=</span><span style="color: #24292E"> split(n)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> luhn_sum_double(all_but_last)</span><span style="color: #D73A49">+</span><span style="color: #24292E">last</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">def</span><span style="color: #24292E"> </span><span style="color: #6F42C1">luhn_sum_double</span><span style="color: #24292E">(n):</span></span>
<span class="line"><span style="color: #24292E">    all_but_last, last </span><span style="color: #D73A49">=</span><span style="color: #24292E"> split(n)</span></span>
<span class="line"><span style="color: #24292E">    luhn_digit </span><span style="color: #D73A49">=</span><span style="color: #24292E"> sum_digits(</span><span style="color: #005CC5">2</span><span style="color: #D73A49">*</span><span style="color: #24292E">last)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> n</span><span style="color: #D73A49">&lt;</span><span style="color: #005CC5">10</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> luhn_digit</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> luhn_sum(all_but_last)</span><span style="color: #D73A49">+</span><span style="color: #24292E">luhn_digit</span></span></code></pre></div></div></figure>
<p>这里使用互递归让分离出来的数字奇数位不执行乘二操作，偶数位执行乘二操作</p>
]]></content>
      <categories>
        <category>CS61A</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>CS61A</tag>
      </tags>
  </entry>
</search>
